<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>工具使用 on kakahuote</title>
        <link>https://blog.928330.xyz/categories/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/</link>
        <description>Recent content in 工具使用 on kakahuote</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>zh-cn</language>
        <copyright>Example Person</copyright>
        <lastBuildDate>Sun, 24 Aug 2025 21:42:35 +0800</lastBuildDate><atom:link href="https://blog.928330.xyz/categories/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>Apache入门</title>
        <link>https://blog.928330.xyz/p/apache%E5%85%A5%E9%97%A8/</link>
        <pubDate>Sat, 23 Aug 2025 19:26:25 +0800</pubDate>
        
        <guid>https://blog.928330.xyz/p/apache%E5%85%A5%E9%97%A8/</guid>
        <description>&lt;img src="http://picture.928330.xyz/typora/66d1339d8d7af.jpg" alt="Featured image of post Apache入门" /&gt;&lt;p&gt;时隔一个月，又来学服务器了&lt;/p&gt;
&lt;p&gt;其实是因为美亚杯做到了apache相关内容啦&lt;/p&gt;
&lt;p&gt;猜你喜欢：&lt;a class=&#34;link&#34; href=&#34;http://blog.928330.xyz/p/nginx%E5%85%A5%E9%97%A8/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Nginx入门
    
    &lt;span style=&#34;white-space: nowrap;&#34;&gt;&lt;svg width=&#34;.7em&#34;
        height=&#34;.7em&#34; viewBox=&#34;0 0 21 21&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;
        &lt;path d=&#34;m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z&#34; fill=&#34;currentColor&#34; /&gt;
        &lt;path d=&#34;M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z&#34;
            fill=&#34;currentColor&#34;&gt;
    &lt;/svg&gt;&lt;/span&gt;
    
&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;何为apache&#34;&gt;何为Apache
&lt;/h1&gt;&lt;p&gt;Apache HTTP Server（简称Apache，或httpd，使用时为Apache2）是Apache软件基金会的一个开源网页服务器项目&lt;/p&gt;
&lt;p&gt;自1995年发布以来，它凭借其稳定性、强大的功能、丰富的模块和跨平台特性，一度成为全球使用最广泛的Web服务器&lt;/p&gt;
&lt;p&gt;它的核心优势在于其高度模块化的设计，几乎所有功能，从SSL加密(&lt;code&gt;mod_ssl&lt;/code&gt;)、URL重写(&lt;code&gt;mod_rewrite&lt;/code&gt;)到与各种后端语言（如PHP的&lt;code&gt;mod_php&lt;/code&gt;）的集成，都是通过模块实现的，这使得Apache具有极高的灵活性和可扩展性&lt;/p&gt;
&lt;h2 id=&#34;nginx-vs-apache&#34;&gt;Nginx vs Apache
&lt;/h2&gt;&lt;p&gt;在之前，我们介绍了如何使用nginx：&lt;a class=&#34;link&#34; href=&#34;http://blog.928330.xyz/p/nginx%E5%85%A5%E9%97%A8/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Nginx入门
    
    &lt;span style=&#34;white-space: nowrap;&#34;&gt;&lt;svg width=&#34;.7em&#34;
        height=&#34;.7em&#34; viewBox=&#34;0 0 21 21&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;
        &lt;path d=&#34;m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z&#34; fill=&#34;currentColor&#34; /&gt;
        &lt;path d=&#34;M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z&#34;
            fill=&#34;currentColor&#34;&gt;
    &lt;/svg&gt;&lt;/span&gt;
    
&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;那么它和apache之间究竟有什么区别？&lt;/p&gt;
&lt;h3 id=&#34;核心架构&#34;&gt;核心架构
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;这是两者最根本的区别&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;apache&#34;&gt;Apache
&lt;/h4&gt;&lt;p&gt;采用基于进程或线程的模型，它有多种工作模式（MPM），如&lt;code&gt;prefork&lt;/code&gt;（每个请求一个进程）和&lt;code&gt;worker&lt;/code&gt;/&lt;code&gt;event&lt;/code&gt;（每个请求一个线程）&lt;/p&gt;
&lt;p&gt;这种模型对于每个连接都会消耗一定的系统资源，在高并发下内存占用较高&lt;/p&gt;
&lt;h4 id=&#34;nginx&#34;&gt;Nginx
&lt;/h4&gt;&lt;p&gt;采用事件驱动的异步非阻塞架构&lt;/p&gt;
&lt;p&gt;它用极少数的工作进程就能处理成千上万的并发连接，资源消耗极低，特别擅长应对高并发和处理静态资源&lt;/p&gt;
&lt;h3 id=&#34;功能与生态&#34;&gt;功能与生态
&lt;/h3&gt;&lt;h4 id=&#34;apache-1&#34;&gt;Apache
&lt;/h4&gt;&lt;p&gt;历史悠久，功能模块极其丰富，生态系统成熟&lt;/p&gt;
&lt;p&gt;对于动态内容（如PHP），其&lt;code&gt;mod_php&lt;/code&gt;模块直接在Apache进程内执行，处理流程简单直接&lt;/p&gt;
&lt;p&gt;它的&lt;code&gt;.htaccess&lt;/code&gt;文件提供了强大的目录级配置能力，让开发者无需修改主配置就能调整行为&lt;/p&gt;
&lt;h4 id=&#34;nginx-1&#34;&gt;Nginx
&lt;/h4&gt;&lt;p&gt;核心功能是高性能的HTTP服务和反向代理&lt;/p&gt;
&lt;p&gt;它的模块化设计虽然也很强大，但通常更侧重于性能和网络层面&lt;/p&gt;
&lt;p&gt;它不支持&lt;code&gt;.htaccess&lt;/code&gt;，所有配置集中管理，性能更高，也更符合现代运维理念&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;总的来说：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Apache稳定、功能全面，对动态内容支持极佳&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Nginx轻量、高效，在高并发、静态资源和反向代理场景下更好用&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;在现代架构中两者常常协同工作，用Nginx处理静态资源和代理，后端再由Apache处理复杂的动态业务逻辑&lt;/strong&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;apache的主要用法&#34;&gt;Apache的主要用法
&lt;/h2&gt;&lt;h3 id=&#34;web服务器&#34;&gt;Web服务器
&lt;/h3&gt;&lt;p&gt;直接向客户端提供静态（HTML, CSS, 图片）和动态（PHP, Perl, Python）内容的服务&lt;/p&gt;
&lt;p&gt;Apache对动态内容的原生支持非常出色，是许多传统Web应用（如WordPress, Joomla）的首选平台&lt;/p&gt;
&lt;h3 id=&#34;反向代理服务器&#34;&gt;反向代理服务器
&lt;/h3&gt;&lt;p&gt;通过&lt;code&gt;mod_proxy&lt;/code&gt;模块，Apache可以作为客户端和后端应用服务器之间的中间人，实现请求转发、负载均衡，并隐藏后端服务细节&lt;/p&gt;
&lt;h3 id=&#34;负载均衡器&#34;&gt;负载均衡器
&lt;/h3&gt;&lt;p&gt;配合&lt;code&gt;mod_proxy_balancer&lt;/code&gt;模块，Apache可以将接收到的请求分发到后端的多台服务器上，从而提高网站的可用性和处理能力&lt;/p&gt;
&lt;h3 id=&#34;访问控制与url重写&#34;&gt;访问控制与URL重写
&lt;/h3&gt;&lt;p&gt;强大的&lt;code&gt;.htaccess&lt;/code&gt;和&lt;code&gt;mod_rewrite&lt;/code&gt;功能，使其在URL美化（伪静态）、访问权限控制等方面表现非常灵活&lt;/p&gt;
&lt;h1 id=&#34;目录结构&#34;&gt;目录结构
&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;和nginx一样，不同发行版和安装方式的apache的目录结构有差异，只不过apache的差异更为显著&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;与nginx不同，apache官方一般只提供二进制编译安装的文件，&lt;code&gt;.deb&lt;/code&gt;文件更多是交给第三方打包&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;源码编译安装&#34;&gt;源码编译安装
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;名称为apache2&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;自定义程度最高，所有文件通常都集中在指定的前缀下（默认为&lt;code&gt;/usr/local/apache2&lt;/code&gt;）&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/                                                  &lt;span style=&#34;color:#7f848e&#34;&gt;# 根目录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;└── usr/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    └── local/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        └── apache2/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── bin/                         &lt;span style=&#34;color:#7f848e&#34;&gt;# 可执行文件 (httpd, apachectl, ab等)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── build/                      &lt;span style=&#34;color:#7f848e&#34;&gt;# 编译时使用的脚本和工具&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── cgi-bin/                   &lt;span style=&#34;color:#7f848e&#34;&gt;# CGI脚本示例目录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── conf/                       &lt;span style=&#34;color:#7f848e&#34;&gt;# 配置文件目录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            │   ├── httpd.&lt;span style=&#34;color:#e5c07b&#34;&gt;conf&lt;/span&gt;         # 主配置文件
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            │   ├── extra/                 &lt;span style=&#34;color:#7f848e&#34;&gt;# 额外的配置文件 (vhosts.conf, ssl.conf等)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            │   └── mime.&lt;span style=&#34;color:#e5c07b&#34;&gt;types&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── htdocs/                    # 默认 Web 根目录
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            │   └── index.&lt;span style=&#34;color:#e5c07b&#34;&gt;html&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── icons/                       # Apache默认图标目录
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── include/                    &lt;span style=&#34;color:#7f848e&#34;&gt;# C/C++头文件，用于开发模块&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── logs/                         &lt;span style=&#34;color:#7f848e&#34;&gt;# 日志文件目录 (access_log, error_log)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            └── modules/                  &lt;span style=&#34;color:#7f848e&#34;&gt;# 动态加载的模块 (.so 文件)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;debianubuntu官方仓库-通过apt安装&#34;&gt;Debian/Ubuntu官方仓库 (通过apt安装)
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;名称为apache2&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;目录结构遵循Debian的策略，将配置文件、模块和站点配置分拆到不同目录，便于管理&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/                                                       &lt;span style=&#34;color:#7f848e&#34;&gt;# 根目录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── etc/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   └── apache2/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       ├── apache2.&lt;span style=&#34;color:#e5c07b&#34;&gt;conf&lt;/span&gt;                  # 主配置文件，主要包含全局设置
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       ├── conf-available/                &lt;span style=&#34;color:#7f848e&#34;&gt;# 可用的配置片段目录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       ├── conf-enabled/                 &lt;span style=&#34;color:#7f848e&#34;&gt;# 已启用的配置片段 (符号链接)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       ├── mods-available/              &lt;span style=&#34;color:#7f848e&#34;&gt;# 可用的模块配置文件 (.load, .conf)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       ├── mods-enabled/               &lt;span style=&#34;color:#7f848e&#34;&gt;# 已启用的模块 (符号链接)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       ├── sites-available/                &lt;span style=&#34;color:#7f848e&#34;&gt;# 可用的虚拟主机配置文件&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       │   └── 000-default.&lt;span style=&#34;color:#e5c07b&#34;&gt;conf&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       └── sites-enabled/                 # 已启用的虚拟主机配置 (符号链接)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│           └── 000-default.&lt;span style=&#34;color:#e5c07b&#34;&gt;conf&lt;/span&gt; -&amp;gt; ../sites-available/000-default.conf
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── usr/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── sbin/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   │   └── &lt;span style=&#34;color:#e5c07b&#34;&gt;apache2ctl&lt;/span&gt;                     # Apache 控制脚本
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   └── lib/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       └── apache2/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│           └── modules/                    &lt;span style=&#34;color:#7f848e&#34;&gt;# 模块二进制文件 (.so)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── var/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── www/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   │   └── html/                             &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认 Web 根目录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   │       └── index.&lt;span style=&#34;color:#e5c07b&#34;&gt;html&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   └── log/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       └── apache2/                         &lt;span style=&#34;color:#7f848e&#34;&gt;# 日志文件目录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│           ├── access.&lt;span style=&#34;color:#e5c07b&#34;&gt;log&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│           └── &lt;span style=&#34;color:#c678dd&#34;&gt;error&lt;/span&gt;.log
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;└── lib/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    └── systemd/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        └── system/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            └── apache2.&lt;span style=&#34;color:#e5c07b&#34;&gt;service&lt;/span&gt; # Systemd 服务单元
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;centosrhel官方仓库-通过yumdnf安装&#34;&gt;CentOS/RHEL官方仓库 (通过yum/dnf安装)
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;名称为httpd&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;目录结构与Debian系有所不同，但同样遵循系统规范&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;关于systemd位置的问题，可以查看&lt;/strong&gt;：&lt;a class=&#34;link&#34; href=&#34;http://blog.928330.xyz/p/nginx%E5%85%A5%E9%97%A8/#systemd%E7%9A%84%E4%BD%8D%E7%BD%AE&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;nginx入门 — systemd
    
    &lt;span style=&#34;white-space: nowrap;&#34;&gt;&lt;svg width=&#34;.7em&#34;
        height=&#34;.7em&#34; viewBox=&#34;0 0 21 21&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;
        &lt;path d=&#34;m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z&#34; fill=&#34;currentColor&#34; /&gt;
        &lt;path d=&#34;M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z&#34;
            fill=&#34;currentColor&#34;&gt;
    &lt;/svg&gt;&lt;/span&gt;
    
&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/                                                                     &lt;span style=&#34;color:#7f848e&#34;&gt;# 根目录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── etc/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   └── httpd/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       ├── conf/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       │   └── httpd.&lt;span style=&#34;color:#e5c07b&#34;&gt;conf&lt;/span&gt;                              # 主配置文件
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       ├── conf.d/                                         &lt;span style=&#34;color:#7f848e&#34;&gt;# 子配置目录，所有 .conf 文件会被自动加载&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       │   └── welcome.&lt;span style=&#34;color:#e5c07b&#34;&gt;conf&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       └── conf.modules.d/                           # 模块加载配置目录
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── usr/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── sbin/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   │   └── &lt;span style=&#34;color:#e5c07b&#34;&gt;httpd&lt;/span&gt;                                           # 主程序二进制文件
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   └── lib64/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       └── httpd/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│           └── modules/                                  &lt;span style=&#34;color:#7f848e&#34;&gt;# 模块二进制文件 (.so)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── var/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── www/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   │   ├── html/                                            &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认 Web 根目录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   │   └── cgi-bin/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   └── log/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       └── httpd/                                            &lt;span style=&#34;color:#7f848e&#34;&gt;# 日志文件目录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│           ├── &lt;span style=&#34;color:#e5c07b&#34;&gt;access_log&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│           └── error_log
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;└── usr/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    └── lib/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        └── systemd/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            └── system/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                └── httpd.&lt;span style=&#34;color:#e5c07b&#34;&gt;service&lt;/span&gt;                            # Systemd 服务单元
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;docker镜像官方-httpd&#34;&gt;Docker镜像（官方 httpd）
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;docker镜像目录结构取决于镜像的制作者，没有自己的专属结构&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;以官方的&lt;code&gt;httpd&lt;/code&gt;镜像为例，它是基于Debian或Alpine Linux构建的，其内部结构通常类似于源码编译安装&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/                                           &lt;span style=&#34;color:#7f848e&#34;&gt;# 根目录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;└── usr/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    └── local/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        └── apache2/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── bin/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── cgi-bin/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── conf/                &lt;span style=&#34;color:#7f848e&#34;&gt;# 配置文件目录 (可挂载)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── htdocs/            &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认 Web 根目录 (可挂载)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── icons/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── include/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── logs/                 &lt;span style=&#34;color:#7f848e&#34;&gt;# 日志文件目录 (符号链接)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            └── modules/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;唯一要注意的是日志文件：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Docker容器的httpd的日志输出到标准输出(stdout)和标准错误(stderr)，而不是写入文件&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;执行如下命令：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;grep -E &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;ErrorLog|CustomLog&amp;#34;&lt;/span&gt; /usr/local/apache2/conf/httpd.conf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;输出中会有这样两行：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;ErrorLog&lt;/span&gt; /&lt;span style=&#34;color:#e06c75&#34;&gt;proc&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;self&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;fd&lt;/span&gt;/&lt;span style=&#34;color:#d19a66&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;CustomLog&lt;/span&gt; /&lt;span style=&#34;color:#e06c75&#34;&gt;proc&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;self&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;fd&lt;/span&gt;/&lt;span style=&#34;color:#d19a66&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;common&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;也就是说，访问日志和错误日志不会被写入文件，而是重定向到标准输入和标准错误&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;我们可以通过docker的命令来查看它们：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;docker&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;logs&lt;/span&gt; &amp;lt;&lt;span style=&#34;color:#e06c75&#34;&gt;容器ID&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;常用命令&#34;&gt;常用命令
&lt;/h1&gt;&lt;h2 id=&#34;使用systemctl管理apache&#34;&gt;使用systemctl管理Apache
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;适用于通过系统包管理器安装的Apache服务，比如&lt;code&gt;apache2&lt;/code&gt;或&lt;code&gt;httpd&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;下文以&lt;code&gt;apache2&lt;/code&gt;为例&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;启动&#34;&gt;启动
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl start apache2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;停止&#34;&gt;停止
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl stop apache2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;重启&#34;&gt;重启
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl restart apache2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;重新加载配置&#34;&gt;重新加载配置
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;不会中断现有连接&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl reload apache2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;查看状态&#34;&gt;查看状态
&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;systemctl status apache2  # 或 httpd
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;使用apachectl或-apache2ctl&#34;&gt;使用apachectl（或 apache2ctl）
&lt;/h2&gt;&lt;p&gt;这是Apache自带的控制工具，适合调试、配置检查&lt;/p&gt;
&lt;p&gt;它其实就是对&lt;code&gt;httpd&lt;/code&gt;可执行程序的一个封装，方便管理Apache&lt;/p&gt;
&lt;h3 id=&#34;启动-1&#34;&gt;启动
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;apachectl start
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;停止-1&#34;&gt;停止
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;apachectl start
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;重新加载配置-1&#34;&gt;重新加载配置
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;不会中断现有连接&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;apachectl graceful
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;查看版本&#34;&gt;查看版本
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;apachectl -v
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;检查配置文件语法&#34;&gt;检查配置文件语法
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;apachectl -t
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;debianubuntu专属工具a2en--a2dis&#34;&gt;Debian/Ubuntu专属工具：a2en* / a2dis*
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;这些工具主要管理站点配置和模块，对&lt;code&gt;/etc/apache2/&lt;/code&gt;下的文件进行操作&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;启用：在&lt;code&gt;*-available&lt;/code&gt; → &lt;code&gt;*-enabled&lt;/code&gt;创建符号链接&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;禁用：删除对应链接&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;操作之后要记得重启（&lt;code&gt;reload&lt;/code&gt; / &lt;code&gt;graceful&lt;/code&gt;）&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;管理站点虚拟主机--site&#34;&gt;管理站点（虚拟主机） —— site
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;/etc/apache2/sites-enabled/site.conf&lt;/code&gt; -&amp;gt; &lt;code&gt;/etc/apache2/sites-available/site.conf&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;启用站点&#34;&gt;启用站点
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;a2ensite site.conf 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;site.conf&lt;/code&gt;是要启用的虚拟主机配置文件，它定义了一个网站在Apache上的访问方式，包括域名、网站目录、日志路径等&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;禁用站点&#34;&gt;禁用站点
&lt;/h4&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;a2dissite site.conf
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;管理模块--mod&#34;&gt;管理模块 —— mod
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;/etc/apache2/mods-enabled/module_name.load&lt;/code&gt; -&amp;gt; &lt;code&gt;/etc/apache2/mods-available/module_name.load&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;/etc/apache2/mods-enabled/module_name.os&lt;/code&gt; -&amp;gt; &lt;code&gt;/etc/apache2/mods-available/module_name.os&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;部分模块会有配置文件：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;/etc/apache2/mods-enabled/module_name.conf&lt;/code&gt; -&amp;gt; &lt;code&gt;/etc/apache2/mods-available/module_name.conf&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;启用模块&#34;&gt;启用模块
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;a2enmod module_name
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;module_name&lt;/code&gt;是要启动的模块名称，不用带后缀名&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;禁用模块&#34;&gt;禁用模块
&lt;/h4&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;a2dismod module_name
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;管理配置文件--conf&#34;&gt;管理配置文件 —— conf
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;/etc/apache2/conf-enabled/config_name.conf&lt;/code&gt; -&amp;gt; &lt;code&gt;/etc/apache2/conf-available/config_name.conf&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;启用配置&#34;&gt;启用配置
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;a2enconf config_name
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;config_name&lt;/code&gt;是要加载的配置文件名称，不用带后缀名&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;禁用配置&#34;&gt;禁用配置
&lt;/h4&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;a2disconf file.conf
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;主配置文件-httpdconf&#34;&gt;主配置文件 (httpd.conf)
&lt;/h1&gt;&lt;p&gt;主配置文件在各个不同系统的路径不同：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;在RHEL/CentOS上通常是&lt;code&gt;/etc/httpd/conf/httpd.conf&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;在Debian/Ubuntu上是&lt;code&gt;/etc/apache2/apache2.conf&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;它定义了服务器的全局行为、加载的模块、默认设置以及如何包含其他配置文件&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;不同系统配置文件使用的语法也差不多，以下是一个典型的&lt;code&gt;httpd.conf&lt;/code&gt;（RHEL/CentOS风格）文件的结构：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# -------------------- 全局配置 --------------------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;ServerRoot&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/etc/httpd&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;Listen&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;80&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;User&lt;/span&gt; apache
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;Group&lt;/span&gt; apache
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;PidFile&lt;/span&gt; run/httpd.pid
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;Timeout&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;60&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;KeepAlive&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;On&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;MaxKeepAliveRequests&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;100&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;KeepAliveTimeout&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# -------------------- 模块加载与条件判断 --------------------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 直接加载关键模块&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LoadModule&lt;/span&gt; mpm_event_module modules/mod_mpm_event.so
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LoadModule&lt;/span&gt; authz_core_module modules/mod_authz_core.so
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 包含其他模块配置文件&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;Include&lt;/span&gt; conf.modules.d/*.conf
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# -------------------- 主服务器配置 --------------------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;ServerAdmin&lt;/span&gt; root@localhost
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# ServerName www.example.com:80&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 使用&amp;lt;IfModule&amp;gt;确保模块存在时才应用指令&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;IfModule&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;dir_module&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;DirectoryIndex&lt;/span&gt; index.html index.php
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/IfModule&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;DocumentRoot&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/var/www/html&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# -------------------- 目录与文件访问控制 --------------------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 限URL需要认证&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/admin&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;AuthType&lt;/span&gt; Basic
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;AuthName&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;Admin Area&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;AuthUserFile&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/etc/httpd/.htpasswd&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; valid-user
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Location&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 默认禁止访问所有文件系统&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Directory&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;AllowOverride&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;none&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;all&lt;/span&gt; denied
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Directory&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 开放 Web 根目录的访问权限&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Directory&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/var/www/html&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Options&lt;/span&gt; Indexes FollowSymLinks
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;AllowOverride&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;None&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;all&lt;/span&gt; granted
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Directory&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 使用&amp;lt;Files&amp;gt;块保护敏感文件&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Files&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;.ht*&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;all&lt;/span&gt; denied
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Files&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# -------------------- 日志配置 --------------------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;ErrorLog&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;logs/error_log&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LogLevel&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;warn&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LogFormat&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;%h %l %u %t \&amp;#34;%r\&amp;#34; %&amp;gt;s %b \&amp;#34;%{Referer}i\&amp;#34; \&amp;#34;%{User-Agent}i\&amp;#34;&amp;#34;&lt;/span&gt; combined
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;CustomLog&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;logs/access_log&amp;#34;&lt;/span&gt; combined
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# -------------------- 包含其他配置文件 --------------------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;IncludeOptional&lt;/span&gt; conf.d/*.conf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;全局配置&#34;&gt;全局配置
&lt;/h2&gt;&lt;p&gt;这部分指令定义了Apache服务器的底层运行参数，影响服务器的整体性能和安全&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;ServerRoot&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/etc/httpd&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;Listen&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;80&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;User&lt;/span&gt; apache
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;Group&lt;/span&gt; apache
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;PidFile&lt;/span&gt; run/httpd.pid
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;Timeout&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;60&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;KeepAlive&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;On&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;MaxKeepAliveRequests&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;100&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;KeepAliveTimeout&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ServerRoot&lt;/code&gt;：指定Apache的安装根目录&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;配置文件中的所有相对路径（如&lt;code&gt;PidFile&lt;/code&gt;, &lt;code&gt;ErrorLog&lt;/code&gt;）都将基于此目录进行解析&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Listen&lt;/code&gt;：指定服务器监听的网络地址和端口&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;若不指定IP地址，则监听所有网络接口&lt;/p&gt;
&lt;p&gt;可以配置多个&lt;code&gt;Listen&lt;/code&gt;指令来监听不同的端口或地址，例如&lt;code&gt;Listen 80&lt;/code&gt;和&lt;code&gt;Listen 127.0.0.1:8080&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;User&lt;/code&gt; &amp;amp; &lt;code&gt;Group&lt;/code&gt;：设置运行Apache工作进程的系统用户和用户组&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;主进程（master process）以root身份启动以绑定低位端口（&amp;lt;1024），但子进程会切换到此处的低权限用户，这是关键的安全措施&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;PidFile&lt;/code&gt;：指定于存放Apache主进程的进程ID（PID）的文件&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这个文件被&lt;code&gt;apachectl&lt;/code&gt;等控制脚本用来向主进程发送信号（如stop, restart, reload）&lt;/p&gt;
&lt;p&gt;路径通常是相对于&lt;code&gt;ServerRoot&lt;/code&gt;的，如果没写，Apache 会用编译时的默认路径：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Debian/Ubuntu&lt;/strong&gt;：&lt;code&gt;/var/run/apache2/apache2.pid&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;RHEL/CentOS&lt;/strong&gt;：&lt;code&gt;/var/run/httpd/httpd.pid&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;源码安装&lt;/strong&gt;：&lt;code&gt;logs/httpd.pid&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Timeout&lt;/code&gt;：服务器在各种网络操作中等待的秒数，包括等待接收GET请求、在TCP包发送之间等待ACK等&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;如果超过此时长，连接将被视为超时并关闭&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;KeepAlive&lt;/code&gt;：启用HTTP持久连接&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;开启后，客户端可以在同一个TCP连接上发送多个请求，极大减少了TCP握手和慢启动的开销，显著提升网站加载速度，特别是对于包含大量小资源的页面&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;MaxKeepAliveRequests&lt;/code&gt;：在&lt;code&gt;KeepAlive&lt;/code&gt;开启时，限制单个持久连接上允许处理的最大请求数&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;达到此数目后，连接会自动关闭，有助于防止某个客户端长时间占用连接，并能周期性地回收资源&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;KeepAliveTimeout&lt;/code&gt;：在&lt;code&gt;KeepAlive&lt;/code&gt;开启时，设置服务器完成请求后等待下次请求的最长时间（秒）&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;如果超时仍未收到新请求，连接将关闭&lt;/p&gt;
&lt;p&gt;合理的设置（通常是2-5秒）可以在性能和服务器资源消耗之间取得平衡&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;模块加载与条件判断&#34;&gt;模块加载与条件判断
&lt;/h2&gt;&lt;p&gt;Apache的功能是高度模块化的，使用任何高级功能（如SSL、重写、代理）前，必须先加载对应的模块&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LoadModule&lt;/span&gt; mpm_event_module modules/mod_mpm_event.so
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LoadModule&lt;/span&gt; authz_core_module modules/mod_authz_core.so
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;Include&lt;/span&gt; conf.modules.d/*.conf
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;IfModule&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;dir_module&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;DirectoryIndex&lt;/span&gt; index.html index.php
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/IfModule&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;LoadModule&lt;/code&gt;：在服务器启动时动态加载指定的模块，使其提供的功能和指令在配置中可用&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;语法为：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LoadModule&lt;/span&gt; &amp;lt;模块名&amp;gt; &amp;lt;模块文件路径&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;模块名是模块内部定义的标识符，路径通常是相对于&lt;code&gt;ServerRoot&lt;/code&gt;的&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Include&lt;/code&gt;：把其它配置文件包含进来&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Apache（httpd）的模块配置通常被拆分放在&lt;code&gt;conf.modules.d/&lt;/code&gt;目录下，每个模块一个配置文件：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;etc&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;httpd&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;conf&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;modules&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;d&lt;/span&gt;/&lt;span style=&#34;color:#d19a66&#34;&gt;00&lt;/span&gt;-&lt;span style=&#34;color:#e06c75&#34;&gt;base&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;conf&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;etc&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;httpd&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;conf&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;modules&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;d&lt;/span&gt;/&lt;span style=&#34;color:#d19a66&#34;&gt;00&lt;/span&gt;-&lt;span style=&#34;color:#e06c75&#34;&gt;mpm&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;conf&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;etc&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;httpd&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;conf&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;modules&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;d&lt;/span&gt;/&lt;span style=&#34;color:#d19a66&#34;&gt;01&lt;/span&gt;-&lt;span style=&#34;color:#e06c75&#34;&gt;cgi&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;conf&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这些&lt;code&gt;.conf&lt;/code&gt;文件里一般只有一两行&lt;code&gt;LoadModule&lt;/code&gt; 指令：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LoadModule&lt;/span&gt; mpm_prefork_module modules/mod_mpm_prefork.so
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LoadModule&lt;/span&gt; rewrite_module modules/mod_rewrite.so
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LoadModule&lt;/span&gt; ssl_module modules/mod_ssl.so
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;那么主配置文件（&lt;code&gt;httpd.conf&lt;/code&gt;）里只要写下面的&lt;code&gt;include&lt;/code&gt;命令：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;Include&lt;/span&gt; conf.modules.d/*.conf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这样就能把这些模块加载指令全部引入，模块配置更加独立，更好管理&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;&amp;lt;IfModule&amp;gt;&lt;/code&gt;块：条件容器块，其内部的指令仅在指定的模块被加载时才会被处理&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这使得配置文件具有更好的可移植性，如果将配置文件部署到一个没有加载特定模块的服务器上，Apache不会因为无法识别模块内的指令而启动失败，而是会忽略整个&lt;code&gt;&amp;lt;IfModule&amp;gt;&lt;/code&gt;块&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;IfModule&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;dir_module&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;DirectoryIndex&lt;/span&gt; index.html index.php
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/IfModule&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在上面的例子，&lt;code&gt;DirectoryIndex&lt;/code&gt;指令只有&lt;code&gt;mod_dir&lt;/code&gt;模块（在配置文件里显示为&lt;code&gt;dir_module&lt;/code&gt;）存在时才生效&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;主服务器配置&#34;&gt;主服务器配置
&lt;/h2&gt;&lt;p&gt;这部分指令定义了“默认服务器”的行为&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;当一个请求的&lt;code&gt;Host&lt;/code&gt;头没有匹配到任何&lt;code&gt;&amp;lt;VirtualHost&amp;gt;&lt;/code&gt;块时，Apache会使用这里的配置来处理该请求&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;ServerAdmin&lt;/span&gt; root@localhost
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;ServerName&lt;/span&gt; www.example.com:80
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;DocumentRoot&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/var/www/html&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;IfModule&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;dir_module&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;DirectoryIndex&lt;/span&gt; index.html index.php
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/IfModule&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ServerAdmin&lt;/code&gt;：设置了服务器管理员的电子邮件地址&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这个地址会显示在Apache生成的错误页面中，方便用户报告问题&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ServerName&lt;/code&gt;：为服务器设置一个规范的域名&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;如果未设置，Apache会尝试通过反向DNS查找来确定，这可能导致启动缓慢或结果不准确&lt;/p&gt;
&lt;p&gt;在全局配置中，它主要用于服务器自我识别和生成重定向URL&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;DocumentRoot&lt;/code&gt;：该指令指定了存放网页文件的根目录&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;当收到一个请求时，Apache会在此目录下查找对应的文件&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;DirectoryIndex&lt;/code&gt;：当客户端请求一个目录（URL以&lt;code&gt;/&lt;/code&gt;结尾）时，Apache会在此目录中查找的文件列表&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这是Apache模块&lt;code&gt;dir_module&lt;/code&gt;里的命令&lt;/p&gt;
&lt;p&gt;它会按照指令中列出的顺序查找，并返回第一个找到的文件作为响应&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;DirectoryIndex&lt;/span&gt; index.html index.php
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;比如上面的命令，如果用户访问&lt;code&gt;http://www.example.com/docs/&lt;/code&gt;（这是个目录），Apache会依次查找：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;/var/www/example/docs/index.html&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/var/www/example/docs/index.php&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;然后将找到的第一个存在的文件返回&lt;/p&gt;
&lt;p&gt;如果都没有，可能报403Forbidden，或者交给&lt;code&gt;mod_autoindex&lt;/code&gt;显示目录列表&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;目录与文件访问控制&#34;&gt;目录与文件访问控制
&lt;/h2&gt;&lt;p&gt;这是Apache安全配置的核心，它允许对文件系统中的路径和特定文件名进行精细的访问控制&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/admin&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;AuthType&lt;/span&gt; Basic
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;AuthName&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;Admin Area&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;AuthUserFile&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/etc/httpd/.htpasswd&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; valid-user
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Location&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Directory&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;AllowOverride&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;none&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;all&lt;/span&gt; denied
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Directory&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Directory&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/var/www/html&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Options&lt;/span&gt; Indexes FollowSymLinks
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;AllowOverride&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;None&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;all&lt;/span&gt; granted
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Directory&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Files&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;.ht*&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;all&lt;/span&gt; denied
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Files&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Apache通过&lt;code&gt;&amp;lt;Directory&amp;gt;&lt;/code&gt;、&lt;code&gt;&amp;lt;Files&amp;gt;&lt;/code&gt;、&lt;code&gt;&amp;lt;Location&amp;gt;&lt;/code&gt;这三种核心容器块，提供了对服务器资源精细化的访问控制&lt;/p&gt;
&lt;p&gt;他们的语法格式十分相似，大部分内部指令也通用，只有小部分不同&lt;/p&gt;
&lt;h3 id=&#34;directory--directorymatch块--物理路径匹配&#34;&gt;&amp;lt;Directory&amp;gt; / &amp;lt;DirectoryMatch&amp;gt;块 —— 物理路径匹配
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;将其中的指令应用于服务器文件系统上的物理目录以及这些目录下的所有文件和子目录&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;格式：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Directory&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;物理路径&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Directory&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;精确路径：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Directory&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/var/www/html&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Directory&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;通配符路径：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Directory&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/var/www/users/*/public_html&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Directory&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;正则有两种写法，效果相同：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;正则表达式路径（使用&amp;lt;Directory&amp;gt;，以 ~ 开头）：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Directory&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;~ &amp;#34;^/var/www/project-(a|b)/src&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Directory&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;正则表达式路径（使用&amp;lt;DirectoryMatch&amp;gt;）：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;DirectoryMatch&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;^/var/www/project-(a|b)/src&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/DirectoryMatch&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;files--filesmatch-块---文件名匹配&#34;&gt;&amp;lt;Files&amp;gt; / &amp;lt;FilesMatch&amp;gt; 块  —— 文件名匹配
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;将其中的指令应用于特定文件名的文件，而不考虑这些文件位于哪个目录下&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&amp;lt;Files&amp;gt;格式：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Files&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;文件名&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Files&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;具体格式参考&amp;lt;Directory&amp;gt;块&lt;/p&gt;
&lt;h3 id=&#34;location--locationmatch块--url路径匹配&#34;&gt;&amp;lt;Location&amp;gt; / &amp;lt;LocationMatch&amp;gt;块 —— URL路径匹配
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;将其中的指令应用于客户端请求的URL路径&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;它不关心这个URL最终对应到哪个文件，甚至这个URL可能根本不对应任何文件（例如由模块动态生成的内容或代理的请求）&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&amp;lt;Location&amp;gt;格式：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Files&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;文件名&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Files&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;具体格式参考&amp;lt;Location&amp;gt;块&lt;/p&gt;
&lt;h3 id=&#34;常用指令&#34;&gt;常用指令
&lt;/h3&gt;&lt;p&gt;以下是在上述容器块中常用的指令，我们会详细说明每个指令的格式、参数和用法&lt;/p&gt;
&lt;h4 id=&#34;require访问授权&#34;&gt;Require：访问授权
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;用于定义谁可以访问资源&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;格式&lt;/strong&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; [not] &amp;lt;授权类型&amp;gt; [参数]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;not&lt;/code&gt;是一个可选的修饰符，用来取反&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;授权类型：&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;授权类型&lt;/th&gt;
          &lt;th&gt;参数&lt;/th&gt;
          &lt;th&gt;说明&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;all&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;granted&lt;/code&gt; / &lt;code&gt;denied&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;无条件允许或拒绝所有请求&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;ip&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;IP地址, 子网掩码, 网段&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;匹配客户端的IP地址&lt;/strong&gt;&lt;br /&gt;例如&lt;code&gt;192.168.1.1&lt;/code&gt;、&lt;code&gt;10.0.0.0/8&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;host&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;主机名, 域名&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;匹配客户端的主机名&lt;/strong&gt;&lt;br /&gt;例如&lt;code&gt;example.org&lt;/code&gt;&lt;br /&gt;&lt;strong&gt;注意&lt;/strong&gt;：这需要进行DNS查询，可能影响性能&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;valid-user&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;(无)&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;要求用户必须通过身份认证&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;user&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;用户名列表&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;要求用户必须是已认证的指定用户之一&lt;/strong&gt;&lt;br /&gt;例如&lt;code&gt;Require user admin john&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;group&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;用户组列表&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;要求用户必须属于已认证的指定用户组之一&lt;/strong&gt;&lt;br /&gt;例如&lt;code&gt;Require group administrators&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;使用Require后，在外层还可以嵌套逻辑容器：&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;逻辑容器&lt;/th&gt;
          &lt;th&gt;逻辑关系&lt;/th&gt;
          &lt;th&gt;说明&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;&amp;lt;RequireAny&amp;gt;&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;OR&lt;/td&gt;
          &lt;td&gt;只要有一条&lt;code&gt;Require&lt;/code&gt;满足就允许访问&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;&amp;lt;RequireAll&amp;gt;&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;AND&lt;/td&gt;
          &lt;td&gt;必须所有&lt;code&gt;Require&lt;/code&gt;条件都满足才允许访问&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;&amp;lt;RequireNone&amp;gt;&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;NOT&lt;/td&gt;
          &lt;td&gt;如果里面任意一条&lt;code&gt;Require&lt;/code&gt;满足，就拒绝访问（取反）&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;示例：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Directory&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/var/www/private&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;RequireAny&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;RequireAll&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; ip &lt;span style=&#34;color:#d19a66&#34;&gt;192.168.0.0/16&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;group&lt;/span&gt; admins
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/RequireAll&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;user&lt;/span&gt; superadmin
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/RequireAny&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Directory&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;意思是IP在&lt;code&gt;192.168&lt;/code&gt;网段且用户属于&lt;code&gt;admins&lt;/code&gt;组，或者用户名是&lt;code&gt;superadmin&lt;/code&gt;的，允许访问&lt;code&gt;/var/www/private&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&#34;options特性控制&#34;&gt;Options：特性控制
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;控制目录中可用的服务器功能和服务，只用于&lt;code&gt;&amp;lt;Directory&amp;gt;&lt;/code&gt;块&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;格式&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;Options&lt;/span&gt; [+-]关键字1 [+-]关键字2 ...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;可以列出多个关键字，使用&lt;code&gt;+&lt;/code&gt;或&lt;code&gt;-&lt;/code&gt;前缀可以在现有选项基础上添加或移除单个选项&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;参数字段&lt;/strong&gt;:&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;关键字&lt;/th&gt;
          &lt;th&gt;说明&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;Indexes&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;如果目录中缺少索引文件（如 &lt;code&gt;index.html&lt;/code&gt;），则&lt;strong&gt;允许服务器生成并显示该目录的文件列表&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;FollowSymLinks&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;允许服务器跟随符号链接访问其指向的文件或目录&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;SymLinksIfOwnerMatch&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;一个更安全的&lt;code&gt;FollowSymLinks&lt;/code&gt;版本，&lt;strong&gt;仅当符号链接和目标文件的所有者相同时才跟随&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;ExecCGI&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;允许在该目录中执行CGI脚本&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;MultiViews&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;启用内容协商功能，&lt;strong&gt;当用户请求的URL没有扩展名时，服务器可以根据客户端偏好（如语言）自动选择最合适的文件&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;All&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;启用除&lt;code&gt;MultiViews&lt;/code&gt;之外的所有选项&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;None&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;禁用所有选项&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;示例：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Apache的&lt;code&gt;Options&lt;/code&gt;指令有两种使用方式：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;覆盖式（没有&lt;code&gt;+&lt;/code&gt;/&lt;code&gt;-&lt;/code&gt;）&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Options Indexes FollowSymLinks
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这一行会清空继承的配置，然后只启用&lt;code&gt;Indexes&lt;/code&gt;和&lt;code&gt;FollowSymLinks&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;增量式（有&lt;code&gt;+&lt;/code&gt;/&lt;code&gt;-&lt;/code&gt;）&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Options -Indexes -ExecCGI +FollowSymLinks
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这一行会在继承父级Options的基础上修改：去掉&lt;code&gt;Indexes&lt;/code&gt;，去掉&lt;code&gt;ExecCGI&lt;/code&gt;，加上&lt;code&gt;FollowSymLinks&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;allowoverride覆盖控制&#34;&gt;AllowOverride：覆盖控制
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;决定目录中的&lt;code&gt;.htaccess&lt;/code&gt;文件是否可以覆盖主配置文件中的设置，仅能在&lt;code&gt;&amp;lt;Directory&amp;gt;&lt;/code&gt;块中使用&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;下文会详细说明&lt;code&gt;.htaccess&lt;/code&gt;文件：&lt;a class=&#34;link&#34; href=&#34;#.htaccess%e6%96%87%e4%bb%b6&#34; &gt;.htaccess文件
    
&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;格式&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;AllowOverride&lt;/span&gt; 关键字1 关键字2 ...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;参数字段&lt;/strong&gt;:&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;关键字&lt;/th&gt;
          &lt;th&gt;说明&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;None&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;完全忽略&lt;code&gt;.htaccess&lt;/code&gt;文件&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;All&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;允许&lt;code&gt;.htaccess&lt;/code&gt;中的所有指令生效&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;AuthConfig&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;允许使用认证相关的指令&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;FileInfo&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;允许使用MIME类型、重写、头信息相关的指令&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;Indexes&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;允许使用索引相关的指令&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;Limit&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;允许使用访问控制指令&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;Options&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;允许在&lt;code&gt;.htaccess&lt;/code&gt;中使用&lt;code&gt;Options&lt;/code&gt; 指令&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;示例&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Directory&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/var/www/wordpress&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;AllowOverride&lt;/span&gt; FileInfo AuthConfig Limit
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Directory&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;auth身份认证系列&#34;&gt;Auth*：身份认证系列
&lt;/h4&gt;&lt;p&gt;这一系列指令共同工作，为资源设置基于用户名和密码的保护&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;指令&lt;/th&gt;
          &lt;th&gt;作用&lt;/th&gt;
          &lt;th&gt;格式&lt;/th&gt;
          &lt;th&gt;说明&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;AuthType&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;设置认证类型&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;`AuthType Basic&lt;/td&gt;
          &lt;td&gt;Digest`&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;AuthName&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;设置认证区域名称&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;AuthName &amp;quot;提示信息&amp;quot;&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;浏览器密码输入框会显示该提示信息&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;AuthUserFile&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;指定用户及密码文件&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;AuthUserFile &amp;quot;/path/to/.htpasswd&amp;quot;&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;文件由 &lt;code&gt;htpasswd&lt;/code&gt; 工具创建，存储用户名和加密密码&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;AuthGroupFile&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;指定用户组文件&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;AuthGroupFile &amp;quot;/path/to/.htgroups&amp;quot;&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;文件定义用户组及其成员，配合 &lt;code&gt;Require group&lt;/code&gt; 使用&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;示例：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/admin&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;AuthType&lt;/span&gt;        Basic
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;AuthName&lt;/span&gt;        &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;Admin Area&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;AuthUserFile&lt;/span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/etc/httpd/.htpasswd&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt;         valid-user
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Location&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;用户访问 &lt;code&gt;http://example.com/admin&lt;/code&gt;后：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;要求客户端进行Basic认证&lt;/li&gt;
&lt;li&gt;浏览器弹出登录框，显示&lt;code&gt;Admin Area&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;用户输入用户名/密码，Apache 从&lt;code&gt;/etc/httpd/.htpasswd&lt;/code&gt; 验证&lt;/li&gt;
&lt;li&gt;验证成功 → 允许访问&lt;code&gt;/admin&lt;/code&gt;
验证失败 → 返回401 Unauthorized&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;sethandler处理器指定&#34;&gt;SetHandler：处理器指定
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;指定服务器遇到某个资源时，交给哪种处理器来处理请求&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;格式：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;SetHandler&lt;/span&gt; &amp;lt;处理器名称&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;参数字段&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;处理器&lt;/th&gt;
          &lt;th&gt;说明&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;server-status&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;由&lt;code&gt;mod_status&lt;/code&gt;模块处理，&lt;strong&gt;生成服务器状态报告&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;server-info&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;由&lt;code&gt;mod_info&lt;/code&gt;模块处理，&lt;strong&gt;生成服务器详细配置信息&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;application/x-httpd-php&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;强制由PHP处理器执行&lt;/strong&gt;（使用&lt;code&gt;mod_php&lt;/code&gt;时）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;cgi-script&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;由&lt;code&gt;mod_cgi&lt;/code&gt;或&lt;code&gt;mod_cgid&lt;/code&gt;处理，&lt;strong&gt;执行CGI脚本&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;cgi&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;由&lt;code&gt;mod_cgi&lt;/code&gt;处理，&lt;strong&gt;通常和&lt;code&gt;cgi-script&lt;/code&gt;等价&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;perl-script&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;由&lt;code&gt;mod_perl&lt;/code&gt;处理，&lt;strong&gt;执行Perl脚本&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;proxy-server&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;由&lt;code&gt;mod_proxy&lt;/code&gt;处理，&lt;strong&gt;将请求代理到后端服务器&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;dav&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;由&lt;code&gt;mod_dav&lt;/code&gt;处理，&lt;strong&gt;实现WebDAV功能&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;imap-file&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;由&lt;code&gt;mod_imap&lt;/code&gt;处理，&lt;strong&gt;用于访问邮件文件&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;示例：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/server-status&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;SetHandler&lt;/span&gt; server-status
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; ip &lt;span style=&#34;color:#d19a66&#34;&gt;127.0.0.1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Location&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这段配置开启了Apache的服务器状态监控页面&lt;code&gt;/server-status&lt;/code&gt;，但只允许本机访问，常用于管理员调试和性能监控&lt;/p&gt;
&lt;h4 id=&#34;headerhttp头控制&#34;&gt;Header：HTTP头控制
&lt;/h4&gt;&lt;p&gt;来自&lt;code&gt;mod_headers&lt;/code&gt;模块，用于添加、修改或删除HTTP响应头&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;格式：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;Header&lt;/span&gt; [condition] action 头部名称 &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;值&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;条件参数：&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;条件 (&lt;code&gt;condition&lt;/code&gt;)&lt;/th&gt;
          &lt;th&gt;说明&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;early&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;在响应生成的早期阶段设置头部&lt;/strong&gt;（比默认阶段更早）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;expr=&amp;quot;表达式&amp;quot;&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;只有当表达式为真时才执行该Header动作&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;always&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;无论响应状态码或其他限制，&lt;strong&gt;强制应用该Header&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;动作参数：&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;动作 (&lt;code&gt;action&lt;/code&gt;)&lt;/th&gt;
          &lt;th&gt;说明&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;set&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;设置HTTP响应头&lt;/strong&gt;，如果同名头已存在，则覆盖它&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;add&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;添加HTTP响应头&lt;/strong&gt;，即使同名头已存在，也会再添加一个&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;append&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;将值附加到已存在的同名头值的末尾&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;unset&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;从响应中&lt;strong&gt;移除指定的HTTP头&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;echo&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;仅用于调试，&lt;strong&gt;输出指定头的值&lt;/strong&gt;（很少用）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;edit&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;修改已存在头的值&lt;/strong&gt;，基于正则替换&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;merge&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;合并多个值为同一个头&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;示例&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;FilesMatch&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;\.(css|js)$&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Header&lt;/span&gt; set X-Content-Type-Options &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;nosniff&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e5c07b&#34;&gt;Header&lt;/span&gt; set X-Frame-Options &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;DENY&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e5c07b&#34;&gt;Header&lt;/span&gt; append X-Powered-By &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;Apache&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e5c07b&#34;&gt;Header&lt;/span&gt; set Cache-Control &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;max-age=3600&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;expr=%{REQUEST_STATUS} == 200&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e5c07b&#34;&gt;Header&lt;/span&gt; always set Strict-Transport-Security &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;max-age=31536000; includeSubDomains&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/FilesMatch&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;对&lt;code&gt;.css&lt;/code&gt;和&lt;code&gt;.js&lt;/code&gt;文件设置响应头，防止MIME嗅探和被嵌入iframe，添加服务器标识，同时控制缓存和强制HTTPS&lt;/p&gt;
&lt;h2 id=&#34;日志配置&#34;&gt;日志配置
&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;ErrorLog&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;logs/error_log&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LogLevel&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;warn&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LogFormat&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;%h %l %u %t \&amp;#34;%r\&amp;#34; %&amp;gt;s %b \&amp;#34;%{Referer}i\&amp;#34; \&amp;#34;%{User-Agent}i\&amp;#34;&amp;#34;&lt;/span&gt; combined
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;CustomLog&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;logs/access_log&amp;#34;&lt;/span&gt; combined
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ErrorLog&lt;/code&gt;：错误日志文件的路径&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;服务器启动、运行中的错误、模块的诊断信息都会记录在其中&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;LogLevel&lt;/code&gt;：记录在错误日志中的信息的详细程度&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;每条错误日志条目都会带有一个严重性等级，这些等级是代码里写死的，作为用户无法改变某个错误属于什么等级&lt;/p&gt;
&lt;p&gt;Apache支持的日志级别（从高到低）如下：&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;级别&lt;/th&gt;
          &lt;th&gt;描述&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;debug&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;记录所有信息，主要用于开发或调试，信息量极大，通常需编译时启用&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;info&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;普通信息，如配置加载成功、进程启动、连接创建等&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;notice&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;正常但重要的事件，如配置文件重载、进程关闭等&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;warn&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;警告信息，非致命错误，比如配置中存在问题但可以忽略或继续运行&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;error&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;运行过程中出现的错误，如连接失败、服务不可达等&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;crit&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;严重错误，Nginx可能无法继续运行&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;alert&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;必须立刻处理的严重问题&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;emerg&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;紧急状态，比如系统崩溃，Nginx无法启动&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;是否写入日志文件取决于&lt;code&gt;LogLevel&lt;/code&gt;设置的阈值，只会写入大于等于当前设置等级的错误事件&lt;/p&gt;
&lt;p&gt;生产环境通常设置为&lt;code&gt;warn&lt;/code&gt;以捕捉重要问题，同时避免日志泛滥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;LogFormat&lt;/code&gt;：指定访问日志的格式和名称&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;LogFormat &amp;quot;...&amp;quot; combined&lt;/code&gt;表示把这个格式命名为&lt;code&gt;combined&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;格式字符串由固定的文本和&lt;code&gt;%&lt;/code&gt;开头的变量组成，例如 &lt;code&gt;%h&lt;/code&gt; (客户端IP), &lt;code&gt;%&amp;gt;s&lt;/code&gt; (HTTP状态码), &lt;code&gt;%D&lt;/code&gt; (处理请求的时间，单位微秒)，后面日志分析部分会详细说明&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;CustomLog&lt;/code&gt;：设置日志文件位置，并指定使用的格式&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;CustomLog &amp;quot;logs/access_log&amp;quot; combined&lt;/code&gt;表示使用名为&lt;code&gt;combined&lt;/code&gt;的格式（也就是上一行定义的格式）记录访问信息到&lt;code&gt;logs/access_log&lt;/code&gt;文件中&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;虚拟主机配置文件&#34;&gt;虚拟主机配置文件
&lt;/h1&gt;&lt;p&gt;虚拟主机是一种技术，它允许一台物理服务器托管多个独立的网站&lt;/p&gt;
&lt;p&gt;与Nginx的一个server块就是一台虚拟主机不同，Apache一般将虚拟主机配置文件单独存放&lt;/p&gt;
&lt;p&gt;通常，我们会为每个网站创建一个独立的配置文件，在RHEL/CentOS中通常存放在&lt;code&gt;conf.d/&lt;/code&gt;或&lt;code&gt;conf/vhosts.d/&lt;/code&gt; 目录下，而在Debian/Ubuntu中则存放在 &lt;code&gt;sites-available/&lt;/code&gt; 目录中&lt;/p&gt;
&lt;h2 id=&#34;virtualhost块&#34;&gt;&amp;lt;VirtualHost&amp;gt;块
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;&amp;lt;VirtualHost&amp;gt;&lt;/code&gt;块是定义一个虚拟主机所有配置的容器，它通过监听的IP地址和端口号来区分不同的虚拟主机&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;VirtualHost&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;[ip-address]:[port]&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/VirtualHost&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;[ip-address]&lt;/code&gt;&lt;/strong&gt;: 虚拟主机将响应的IP地址。&lt;code&gt;*&lt;/code&gt;代表所有IP地址&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;[port]&lt;/code&gt;&lt;/strong&gt;: 虚拟主机将监听的端口号。通常是&lt;code&gt;80&lt;/code&gt;（HTTP）或&lt;code&gt;443&lt;/code&gt;（HTTPS）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在一个虚拟主机配置文件中，我们可以配置与主配置文件中类似的指令，但范围仅限于这个特定的虚拟主机&lt;/p&gt;
&lt;p&gt;以下是一个完整的的虚拟主机配置文件示例，它处理了HTTPS服务的配置：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# HTTPS 虚拟主机配置&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;VirtualHost&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;*:443&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 定义该虚拟主机响应的域名&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ServerName&lt;/span&gt; www.example.com
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ServerAlias&lt;/span&gt; example.com
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 为该虚拟主机指定独立的Web根目录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;DocumentRoot&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/var/www/example.com&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 配置独立的日志文件，便于分析&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ErrorLog&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/var/log/httpd/example.com-error.log&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;CustomLog&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/var/log/httpd/example.com-access.log&amp;#34;&lt;/span&gt; combined
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 开启HTTPS并指定证书文件&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;SSLEngine&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;on&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;SSLCertificateFile&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/etc/pki/tls/certs/example.com.crt&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;SSLCertificateKeyFile&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/etc/pki/tls/private/example.com.key&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;SSLCertificateChainFile&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/etc/pki/tls/certs/chain.crt&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 为该站点的目录设置权限&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Directory&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/var/www/example.com&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e5c07b&#34;&gt;Options&lt;/span&gt; -Indexes +FollowSymLinks
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e5c07b&#34;&gt;AllowOverride&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;All&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;all&lt;/span&gt; granted
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Directory&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/VirtualHost&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ServerName&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;为该虚拟主机指定一个唯一的域名，当客户端的请求头中的&lt;code&gt;Host&lt;/code&gt;字段与此处的&lt;code&gt;ServerName&lt;/code&gt;或&lt;code&gt;ServerAlias&lt;/code&gt;匹配时，该请求就会由这个虚拟主机处理&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ServerAlias&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;为虚拟主机设置一个或多个别名，例如&lt;code&gt;example.com&lt;/code&gt;可以作为&lt;code&gt;www.example.com&lt;/code&gt;的别名&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;HTTPS 相关的指令：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;SSLEngine on&lt;/code&gt;&lt;/strong&gt;: 开启SSL/TLS加密引擎&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;SSLCertificateFile&lt;/code&gt;&lt;/strong&gt;: 指定SSL证书文件的路径（公钥，通常是&lt;code&gt;.crt&lt;/code&gt;或&lt;code&gt;.pem&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;SSLCertificateKeyFile&lt;/code&gt;&lt;/strong&gt;: 指定与证书匹配的私钥文件路径（&lt;code&gt;.key&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;SSLCertificateChainFile&lt;/code&gt;&lt;/strong&gt;: 如果证书需要中间证书链才能被浏览器信任，则需要指定此文件&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;http到https跳转&#34;&gt;HTTP到HTTPS跳转
&lt;/h2&gt;&lt;p&gt;下面是一个经典的例子，它唯一的目的就是利用&lt;code&gt;mod_rewrite&lt;/code&gt;模块将所有HTTP请求重定向到对应的HTTPS URL，以确保用户无论如何访问，都会被安全地引导至加密连接&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 将所有 HTTP 请求永久重定向到 HTTPS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;VirtualHost&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;*:80&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 定义该虚拟主机响应的域名&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ServerName&lt;/span&gt; www.example.com
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ServerAlias&lt;/span&gt; example.com
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 启用URL重写引擎&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;RewriteEngine&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;On&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 定义重定向规则&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;RewriteRule&lt;/span&gt; ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/VirtualHost&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;&amp;lt;VirtualHost *:80&amp;gt;&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;*&lt;/code&gt;表示该虚拟主机将响应服务器上任何IP地址的请求，&lt;code&gt;80&lt;/code&gt;指定了它只监听来自标准HTTP端口&lt;code&gt;80&lt;/code&gt;的请求&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ServerName&lt;/code&gt; 和 &lt;code&gt;ServerAlias&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;当一个请求的&lt;code&gt;Host&lt;/code&gt;头（域名）与&lt;code&gt;www.example.com&lt;/code&gt;或&lt;code&gt;example.com&lt;/code&gt;匹配时，就由该虚拟主机来处理&lt;/p&gt;
&lt;p&gt;这确保了即使服务器上托管了多个网站，这条重定向规则也只会应用于&lt;code&gt;example.com&lt;/code&gt;这个域名的HTTP请求，而不会影响到其他网站&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;RewriteEngine On&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这是启用Apache &lt;code&gt;mod_rewrite&lt;/code&gt;模块重写的开关，必须先开启，其下的&lt;code&gt;RewriteRule&lt;/code&gt;指令才能生效&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这是整个重定向逻辑的核心，它定义了一条具体的重写规则&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;^(.\*)$&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;它捕获了请求路径的全部内容，例如 &lt;code&gt;/about/&lt;/code&gt; 或 &lt;code&gt;/images/logo.png?id=123&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;https://%{HTTP_HOST}%{REQUEST_URI}&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这是重定向的目标URL&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;https://&lt;/code&gt;：**将协议从HTTP改为HTTPS&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;%{HTTP_HOST}&lt;/code&gt;：**这是一个Apache服务器变量，它会动态地获取客户端请求头中的&lt;code&gt;Host&lt;/code&gt;字段值&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;%{REQUEST_URI}&lt;/code&gt;：**另一个服务器变量，它会动态地获取请求的完整URI路径，包括查询字符串&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;[R=301,L]&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这些是控制重写行为的标志&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;R=301&lt;/code&gt;：&lt;/strong&gt;&lt;code&gt;R&lt;/code&gt;代表&lt;code&gt;redirect&lt;/code&gt;（重定向），&lt;code&gt;301&lt;/code&gt;指定了HTTP状态码为301 Moved Permanently，这个状态码告诉浏览器和搜索引擎这个跳转是永久性的，确保SEO权重不丢失&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;L&lt;/code&gt;：&lt;/strong&gt;&lt;code&gt;last&lt;/code&gt;，指示Apache一旦这条规则被匹配并执行，就停止处理任何后续的重写规则&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;当一个用户访问&lt;code&gt;http://www.example.com/login&lt;/code&gt;时，整个流程如下：&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;客户端向服务器的&lt;code&gt;80&lt;/code&gt;端口发送一个HTTP请求&lt;/li&gt;
&lt;li&gt;Apache接收到请求，根据&lt;code&gt;Host&lt;/code&gt;头匹配到这个&lt;code&gt;&amp;lt;VirtualHost *:80&amp;gt;&lt;/code&gt;块&lt;/li&gt;
&lt;li&gt;&lt;code&gt;RewriteEngine On&lt;/code&gt;生效，Apache开始检查&lt;code&gt;RewriteRule&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;RewriteRule&lt;/code&gt;匹配到请求路径&lt;code&gt;/login&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Apache根据规则，动态构建出目标URL：&lt;code&gt;https://www.example.com/login&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;R=301,L&lt;/code&gt;标志告诉Apache向客户端发送一个&lt;code&gt;301&lt;/code&gt;重定向响应&lt;/li&gt;
&lt;li&gt;客户端浏览器接收到&lt;code&gt;301&lt;/code&gt;响应后，会自动向&lt;code&gt;https://www.example.com/login&lt;/code&gt;发起一个新的请求，这个请求将由服务器上监听&lt;code&gt;443&lt;/code&gt;端口的虚拟主机（即HTTPS配置）来处理&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;htaccess文件&#34;&gt;.htaccess文件
&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;.htaccess&lt;/code&gt;文件（分布式配置文件）是一个目录级配置片段，只应用于&amp;lt;Directory&amp;gt;块&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;它允许开发者或非root用户在不修改主配置文件的情况下，对特定目录及其子目录进行配置&lt;/p&gt;
&lt;h2 id=&#34;工作原理&#34;&gt;工作原理
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;Apach 在读取配置时并不会一次性加载&lt;code&gt;.htaccess&lt;/code&gt;，而是每次处理请求时才去磁盘查找并应用它&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;比如，当Apache收到一个对&lt;code&gt;/var/www/site/dir/file.html&lt;/code&gt;的请求时，它会依次查找以下文件：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;/var/www/site/dir/.htaccess&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/var/www/site/.htaccess&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/var/www/.htaccess&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;每找到一个&lt;code&gt;.htaccess&lt;/code&gt;，就解析并应用里面的配置写在对应&amp;lt;Directory&amp;gt;块中&lt;/p&gt;
&lt;p&gt;这种递归查找机制对性能有显著影响，因为它增加了文件系统的I/O开销&lt;/p&gt;
&lt;p&gt;因此，除非必要，通常不建议广泛使用&lt;code&gt;.htaccess&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;.htaccess&lt;/code&gt;文件中的指令是否生效，完全取决于前文提到过主文件配置的&lt;code&gt;AllowOverride&lt;/code&gt;指令：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;#AllowOverride%ef%bc%9a%e8%a6%86%e7%9b%96%e6%8e%a7%e5%88%b6&#34; &gt;AllowOverride：覆盖控制
    
&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;典型用例与指令&#34;&gt;典型用例与指令
&lt;/h2&gt;&lt;p&gt;下面是一个典型的&lt;code&gt;.htaccess&lt;/code&gt;文件内容：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 启用重写引擎&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;RewriteEngine&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;On&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 将所有以.html结尾的请求重定向到不带.html的URL&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 例如：/about.html -&amp;gt; /about&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;RewriteRule&lt;/span&gt; ^(.*)\.html$ /$1 [R=301,L]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 为目录设置访问密码保护&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;AuthType&lt;/span&gt; Basic
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;AuthName&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;Restricted Area&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;AuthUserFile&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/var/www/site/dir/.htpasswd&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; valid-user
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 强制将目录索引文件设置为index.php&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;DirectoryIndex&lt;/span&gt; index.php
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 在响应头中添加自定义信息&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;IfModule&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;mod_headers.c&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Header&lt;/span&gt; set X-Custom-Header &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;My Website&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/IfModule&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在上面的例子中，我们使用了以下指令：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;RewriteEngine&lt;/code&gt;和&lt;code&gt;RewriteRule&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;URL重写，这在构建“伪静态”URL或实现SEO友好的链接时非常有用&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Auth*&lt;/code&gt;系列指令&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;用于对整个目录进行密码保护。这在&lt;code&gt;/admin&lt;/code&gt;或&lt;code&gt;/private&lt;/code&gt;等需要认证的目录中非常常见&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;DirectoryIndex&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;用于覆盖主配置文件中定义的索引文件顺序&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Header&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;添加或修改HTTP响应头&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;这些指令与主配置文件中的用法相同，但其作用范围仅限于&lt;code&gt;.htaccess&lt;/code&gt;文件所在的目录&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;事实上，&amp;lt;Directory&amp;gt;块能够使用的指令，在&lt;code&gt;.htaccess&lt;/code&gt;文件大多都能使用，只是范围受制于&lt;code&gt;AllowOverride&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;这使得它非常灵活，尤其是在共享主机环境中&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id=&#34;常用模块&#34;&gt;常用模块
&lt;/h1&gt;&lt;p&gt;Apache的核心优势在于其高度模块化的设计，几乎所有高级功能都由特定的模块提供。这些模块必须在主配置文件（通常是&lt;code&gt;httpd.conf&lt;/code&gt;或&lt;code&gt;apache2.conf&lt;/code&gt;）中通过&lt;code&gt;LoadModule&lt;/code&gt;指令加载后才能使用。&lt;/p&gt;
&lt;p&gt;本章节将详细介绍几个Apache最常用且功能强大的模块，并讲解它们的配置方法。&lt;/p&gt;
&lt;h2 id=&#34;mod_rewriteurl重写&#34;&gt;mod_rewrite：URL重写
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;mod_rewrite&lt;/code&gt;允许服务器根据正则表达式和规则集来重写请求的URL&lt;/p&gt;
&lt;p&gt;这通常用于实现伪静态、URL美化、HTTP重定向等&lt;/p&gt;
&lt;p&gt;使用之前，我们要确保在主配置文件中启用了&lt;code&gt;mod_rewrite&lt;/code&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;在Debian/Ubuntu中：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;a2enmod&lt;/span&gt; rewrite
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;在RHEL/CentOS中：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LoadModule&lt;/span&gt; rewrite_module modules/mod_rewrite.so
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;核心指令&#34;&gt;核心指令
&lt;/h3&gt;&lt;h4 id=&#34;rewriteengine&#34;&gt;RewriteEngine
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;该指令用于在特定配置上下文中开启或关闭重写引擎&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;开启：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;RewriteEngine&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;On&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;关闭：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;RewriteEngine&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;Off&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;rewriterule&#34;&gt;RewriteRule
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;这是定义重写规则的指令，其格式为：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;RewriteRule&lt;/span&gt; 模式 替代 [标志]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;参数&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;模式&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;用于匹配请求的URI路径（不包含域名和协议）的正则表达式&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;替代&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;匹配成功后，用于构建新URL的字符串或路径&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;标志&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;可选，用于控制重写规则的行为（如外部重定向、停止处理等）&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;常用标志：&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;标志&lt;/th&gt;
          &lt;th&gt;缩写&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;L&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;last&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;停止处理当前规则集中的其他规则&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;R&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;redirect&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;执行外部重定向&lt;/strong&gt;（发送&lt;code&gt;302&lt;/code&gt;状态码给浏览器）可指定状态码，如&lt;code&gt;R=301&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;NC&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;nocase&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;使模式匹配不区分大小写&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;P&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;proxy&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;将请求代理到指定的替代URL，需要&lt;code&gt;mod_proxy&lt;/code&gt;模块&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;QSA&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;qsappend&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;将原始请求的查询字符串（URL中&lt;code&gt;?&lt;/code&gt;之后的部分）附加到替代URL后&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;NE&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;noescape&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;禁止对重写后的URL进行特殊字符转义&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;CO&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;cookie&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;设置一个Cookie&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;E&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;env&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;设置环境变量&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;G&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;gone&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;返回410 Gone状态码&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;F&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;forbidden&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;返回403 Forbidden状态码&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;NC&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;nocase&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;匹配不区分大小写&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;L&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;last&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;停止后续规则处理&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;多个标志可以使用逗号,隔开，比如&lt;code&gt;[R=301,L]&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;rewritecond&#34;&gt;RewriteCond
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;用于设置条件，当条件满足时才执行紧随其后的RewriteRule&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;RewriteCond&lt;/span&gt; 字段 模式 [标志]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;参数&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;字段&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;待测试的字符串，比如主机名&lt;code&gt;%{HTTP_HOST}&lt;/code&gt;等&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;模式&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;条件模式，支持正则表达式匹配&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;标志&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;可选标志，如 &lt;code&gt;NC&lt;/code&gt;、&lt;code&gt;OR&lt;/code&gt; 等&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;常用标志：&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;标志&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;NC&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;No Case&lt;/strong&gt;，匹配时忽略大小写&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;OR&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;Logical OR&lt;/strong&gt;，与下一条 RewriteCond 条件做“或”逻辑（默认是“与” AND）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;AND&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;Logical AND&lt;/strong&gt;，与下一条条件做“与”逻辑（默认可省略）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;GT&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;Greater Than&lt;/strong&gt;，仅对数值比较有效&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;LT&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;Less Than&lt;/strong&gt;，仅对数值比较有效&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;EQ&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;Equal&lt;/strong&gt;，数值比较等于&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;NE&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;Not Equal&lt;/strong&gt;，数值比较不等于&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;示例&#34;&gt;示例
&lt;/h3&gt;&lt;h4 id=&#34;示例1实现伪静态url&#34;&gt;示例1：实现伪静态URL
&lt;/h4&gt;&lt;p&gt;将&lt;code&gt;https://example.com/article.php?id=123&lt;/code&gt;重写为&lt;code&gt;https://example.com/article/123&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 启用重写引擎&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;RewriteEngine&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;On&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 编写规则&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;RewriteRule&lt;/span&gt; ^article/([0-9]+)$ &lt;span style=&#34;color:#98c379&#34;&gt;/article.php&lt;/span&gt;?id=$1 [NC,L]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;示例2强制所有请求到www子域名&#34;&gt;示例2：强制所有请求到www子域名
&lt;/h4&gt;&lt;p&gt;将&lt;code&gt;example.com&lt;/code&gt;重定向到&lt;code&gt;www.example.com&lt;/code&gt;，这有助于避免重复内容问题&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 使用RewriteCond指令添加条件&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;RewriteEngine&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;On&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;RewriteCond&lt;/span&gt; %{HTTP_HOST} ^example.com [NC]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;RewriteRule&lt;/span&gt; ^(.*)$ https://www.example.com/$1 [R=301,L]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;mod_proxy代理模块&#34;&gt;mod_proxy：代理模块
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;mod_proxy&lt;/code&gt;允许服务器将客户端的请求转发到其他后端服务器&lt;/p&gt;
&lt;p&gt;它使得Apache能够作为前端网关，对后端服务进行路由、负载均衡和安全保护&lt;/p&gt;
&lt;p&gt;要使用反向代理功能，必须加载&lt;code&gt;mod_proxy&lt;/code&gt;及其子模块&lt;/p&gt;
&lt;p&gt;最常用的子模块是&lt;code&gt;mod_proxy_http&lt;/code&gt;，用于代理HTTP协议的流量&lt;/p&gt;
&lt;p&gt;在Debian/Ubuntu上：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;a2enmod&lt;/span&gt; proxy proxy_http
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在RHEL/CentOS上：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LoadModule&lt;/span&gt; proxy_module modules/mod_proxy.so
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LoadModule&lt;/span&gt; proxy_http_module modules/mod_proxy_http.so
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;反向代理&#34;&gt;反向代理
&lt;/h3&gt;&lt;h4 id=&#34;proxypass&#34;&gt;ProxyPass
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;用于将匹配路径的请求代理到指定的后端 URL&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyPass&lt;/span&gt; [路径] [URL] [可选参数]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;参数&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;路径&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;代理匹配的本地 URI 前缀，例如 &lt;code&gt;/app&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;URL&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;目标服务器地址，例如 &lt;code&gt;http://127.0.0.1:8080/&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;可选参数&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;retry=&lt;/code&gt;, &lt;code&gt;timeout=&lt;/code&gt;, &lt;code&gt;keepalive=on/off&lt;/code&gt; 等，用于控制代理行为&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;常用参数：&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;参数&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;retry=N&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;后端服务器失败时重试次数（默认 0，表示不重试）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;timeout=N&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;代理请求超时时间（秒），控制连接或响应等待时间&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;acquire=N&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;获取连接的超时时间（秒）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;keepalive=on/off&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;是否启用与后端的持久连接（HTTP Keep-Alive）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;disablereuse=on/off&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;禁止复用已建立的后端连接&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;max=number&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;最大并发连接数（可与 &lt;code&gt;mod_proxy_balancer&lt;/code&gt; 配合）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;ttl=N&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;连接在连接池中存活的时间（秒）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;timeout=N&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;请求超时，连接超时&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;flushpackets=on/off&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;每次写数据包时立即刷新到客户端&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;lbmethod=byrequests/bytraffic/...&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;仅在负载均衡时使用，选择负载均衡策略&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;keepalive=on/off&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;控制是否启用HTTP持久连接&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;proxypassreverse&#34;&gt;ProxyPassReverse
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;用于修改后端服务器响应头中的重定向地址，使客户端看到的URL正确&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyPassReverse&lt;/span&gt; [路径] [URL]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;参数&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;路径&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;客户端访问的本地URI前缀&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;URL&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;后端服务器的URL，对响应头进行重写&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;基本上写法和ProxyPass保持一致，也就是把url改回去，改成对应域名&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;比如我们写下配置：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyPass&lt;/span&gt;        &lt;span style=&#34;color:#98c379&#34;&gt;/app&lt;/span&gt;  http://127.0.0.1:8080/myapp
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyPassReverse&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/app&lt;/span&gt;  http://127.0.0.1:8080/myapp
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;客户端请求：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;GET&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/app/&lt;/span&gt; HTTP/1.1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Host: www.example.&lt;span style=&#34;color:#e5c07b&#34;&gt;com&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Apache转发给后端：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;GET&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/myapp/&lt;/span&gt; HTTP/1.1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Host: 127.0.0.1:8080
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;后端响应：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;HTTP/1.1 302 &lt;span style=&#34;color:#e5c07b&#34;&gt;Found&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Location: http://127.0.0.1:8080/myapp/login
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;如果没有&lt;code&gt;ProxyPassReverse&lt;/code&gt;，客户端会收到真实后端地址，绕过了代理&lt;/p&gt;
&lt;p&gt;有&lt;code&gt;ProxyPassReverse&lt;/code&gt;时，Apache会把返回的&lt;code&gt;Location&lt;/code&gt;改写成：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;HTTP/1.1 302 &lt;span style=&#34;color:#e5c07b&#34;&gt;Found&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Location: http://www.example.com/app/login
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;客户端依然通过代理访问，保持一致性&lt;/p&gt;
&lt;h4 id=&#34;proxypreservehost&#34;&gt;ProxyPreserveHost
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;用来控制在反向代理时，是否保留客户端原始请求中的&lt;code&gt;Host&lt;/code&gt;头信息&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyPreserveHost&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;On&lt;/span&gt;|Off
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;On&lt;/strong&gt;：Apache 转发请求时，保留客户端原始&lt;code&gt;Host&lt;/code&gt;头&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Off（默认）&lt;/strong&gt;：Apache会把&lt;code&gt;Host&lt;/code&gt;头改成后端服务器的地址&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;示例-1&#34;&gt;示例
&lt;/h4&gt;&lt;p&gt;假设有一个Node.js应用在&lt;code&gt;http://127.0.0.1:3000&lt;/code&gt;上运行，我们希望通过Apache的&lt;code&gt;/api/&lt;/code&gt;路径来访问它&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;VirtualHost&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;*:80&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ServerName&lt;/span&gt; api.example.com
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 禁用正向代理，后面会提到&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyRequests&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;Off&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 保留客户端原始Host头&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyPreserveHost&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;On&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 定义代理规则：将所有 /api/ 请求代理到后端服务器&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyPass&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/api/&lt;/span&gt; http://127.0.0.1:3000/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 重写响应头：将后端返回的 http://127.0.0.1:3000/ 地址重写为 http://api.example.com/api/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyPassReverse&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/api/&lt;/span&gt; http://127.0.0.1:3000/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/VirtualHost&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;当用户访问&lt;code&gt;http://api.example.com/api/users&lt;/code&gt;时，Apache会接收请求，&lt;code&gt;ProxyPass&lt;/code&gt;规则会将该请求转发到后端&lt;code&gt;http://127.0.0.1:3000/users&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;如果后端服务器返回了一个重定向响应（例如，&lt;code&gt;Location: http://127.0.0.1:3000/auth&lt;/code&gt;），&lt;code&gt;ProxyPassReverse&lt;/code&gt;会修改该头信息，将其替换为&lt;code&gt;http://api.example.com/api/auth&lt;/code&gt;，确保用户的浏览器能够正确地跳转&lt;/p&gt;
&lt;h3 id=&#34;proxy块&#34;&gt;&amp;lt;Proxy&amp;gt;块
&lt;/h3&gt;&lt;h4 id=&#34;proxy&#34;&gt;&amp;lt;Proxy&amp;gt;
&lt;/h4&gt;&lt;p&gt;&lt;code&gt;&amp;lt;Proxy&amp;gt;&lt;/code&gt;块是一个容器指令，用于对特定的代理URL或一组代理URL应用细粒度的配置&lt;/p&gt;
&lt;p&gt;它的使用类似于&lt;code&gt;&amp;lt;Directory&amp;gt;&lt;/code&gt;或&lt;code&gt;&amp;lt;Location&amp;gt;&lt;/code&gt;，但针对的是代理目标而不是本地文件系统&lt;/p&gt;
&lt;p&gt;虽然&lt;code&gt;ProxyPass&lt;/code&gt;指令支持在行内附加参数，但使用&lt;code&gt;&amp;lt;Proxy&amp;gt;&lt;/code&gt;块配合&lt;code&gt;ProxySet&lt;/code&gt;指令，可以使配置更加清晰&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;格式：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;&lt;span style=&#34;color:#e06c75&#34;&gt;Proxy&lt;/span&gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;URL&lt;/span&gt;]&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#56b6c2&#34;&gt;..&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;/&lt;span style=&#34;color:#e06c75&#34;&gt;Proxy&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;[URL]&lt;/code&gt;可以是一个完整的URL，一个协议（如&lt;code&gt;http://&lt;/code&gt;），或使用通配符&lt;code&gt;*&lt;/code&gt;（匹配所有代理目标）&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;也可以使用&lt;code&gt;&amp;lt;ProxyMatch&amp;gt;&lt;/code&gt;进行正则表达式匹配，就像之前的访问控制块一样&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;proxyset&#34;&gt;ProxySet
&lt;/h4&gt;&lt;p&gt;&lt;code&gt;&amp;lt;Proxy&amp;gt;&lt;/code&gt;容器和&lt;code&gt;&amp;lt;Location&amp;gt;&lt;/code&gt;等容器一样，可以使用访问控制相关指令（比如 &lt;code&gt;Require&lt;/code&gt;）&lt;/p&gt;
&lt;p&gt;但它还额外支持一些和代理相关的指令 —— &lt;code&gt;ProxySet&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ProxySet&lt;/code&gt;允许我们为特定的代理目标设置详细的控制参数&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;格式：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;ProxySet&lt;/span&gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;参数名&lt;/span&gt;]=[&lt;span style=&#34;color:#e06c75&#34;&gt;值&lt;/span&gt;] [&lt;span style=&#34;color:#e06c75&#34;&gt;参数名&lt;/span&gt;]=[&lt;span style=&#34;color:#e06c75&#34;&gt;值&lt;/span&gt;]&lt;span style=&#34;color:#56b6c2&#34;&gt;..&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;参数&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;retry=N&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;后端服务器失败时重试次数（默认 0，表示不重试）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;timeout=N&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;代理请求超时时间（秒），控制连接或响应等待时间&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;acquire=N&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;获取连接的超时时间（秒）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;keepalive=on/off&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;是否启用与后端的持久连接（HTTP Keep-Alive）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;disablereuse=on/off&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;禁止复用已建立的后端连接&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;max=number&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;最大并发连接数（可与 &lt;code&gt;mod_proxy_balancer&lt;/code&gt; 配合）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;ttl=N&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;连接在连接池中存活的时间（秒）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;flushpackets=on/off&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;每次写数据包时立即刷新到客户端&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;示例-2&#34;&gt;示例
&lt;/h4&gt;&lt;p&gt;假设我们要代理到两个后端服务：一个API和一个博客，并希望为它们设置不同的超时时间&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;VirtualHost&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;*:80&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ServerName&lt;/span&gt; example.com
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyRequests&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;Off&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyPreserveHost&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;On&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 代理API服务，设置15秒超时，并启用持久连接&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Proxy&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;http://127.0.0.1:8080&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e5c07b&#34;&gt;ProxySet&lt;/span&gt; timeout=15 keepalive=on
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Proxy&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyPass&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/api/&lt;/span&gt; http://127.0.0.1:8080/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyPassReverse&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/api/&lt;/span&gt; http://127.0.0.1:8080/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 代理博客服务，不设置特定超时，使用默认配置&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Proxy&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;http://127.0.0.1:9000&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#7f848e&#34;&gt;# 可以在此处添加特定配置&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Proxy&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyPass&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/blog/&lt;/span&gt; http://127.0.0.1:9000/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyPassReverse&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/blog/&lt;/span&gt; http://127.0.0.1:9000/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/VirtualHost&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;此配置比在&lt;code&gt;ProxyPass&lt;/code&gt;中添加参数更清晰，且允许对每个后端应用独特的代理行为&lt;/p&gt;
&lt;h3 id=&#34;正向代理&#34;&gt;正向代理
&lt;/h3&gt;&lt;p&gt;在正向代理模式下，Apache扮演客户端的代理&lt;/p&gt;
&lt;p&gt;当客户端请求外部资源时，请求会首先发送给Apache，由Apache代为访问外部网络&lt;/p&gt;
&lt;h4 id=&#34;配置&#34;&gt;配置
&lt;/h4&gt;&lt;p&gt;正向代理的配置非常简单：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyRequests&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;On&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这是开启正向代理功能的指令&lt;/p&gt;
&lt;h4 id=&#34;示例-3&#34;&gt;示例
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 开启正向代理功能&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyRequests&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;On&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Proxy&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 允许来自特定IP的请求通过此代理&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; ip &lt;span style=&#34;color:#d19a66&#34;&gt;192.168.1.0/24&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 禁止所有其他请求&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;all&lt;/span&gt; denied
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Proxy&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这里&lt;code&gt;&amp;lt;Proxy *&amp;gt;&lt;/code&gt;匹配所有目标地址，启用正向代理后，Apache会接受客户端发来的完整URL请求，然后去请求目标站点，再把响应转发回来，目标站点只会看到Apache的IP，不会看到客户端的真实IP&lt;/p&gt;
&lt;h2 id=&#34;mod_sslssltls加密模块&#34;&gt;mod_ssl：SSL/TLS加密模块
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;mod_ssl&lt;/code&gt;是Apache实现HTTPS加密服务的模块，它使用OpenSSL库来处理加密和解密&lt;/p&gt;
&lt;p&gt;其配置通常在&lt;code&gt;443&lt;/code&gt;端口的&lt;code&gt;&amp;lt;VirtualHost&amp;gt;&lt;/code&gt;块中完成&lt;/p&gt;
&lt;h3 id=&#34;使用之前&#34;&gt;使用之前
&lt;/h3&gt;&lt;p&gt;大多数现代Linux发行版在安装Apache时，&lt;code&gt;mod_ssl&lt;/code&gt;默认已经被加载，如果没有，我们需要手动启用它&lt;/p&gt;
&lt;p&gt;在Debian/Ubuntu上：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;a2enmod&lt;/span&gt; ssl
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在RHEL/CentOS上：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LoadModule&lt;/span&gt; ssl_module modules/mod_ssl.so
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;核心指令-1&#34;&gt;核心指令
&lt;/h3&gt;&lt;p&gt;这些指令定义了HTTPS服务所需的证书和密钥文件&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;指令&lt;/th&gt;
          &lt;th&gt;格式&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;SSLEngine&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;SSLEngine on&lt;/code&gt;或&lt;code&gt;SSLEngine off&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;开启或关闭该虚拟主机上的SSL/TLS引擎&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;SSLCertificateFile&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;SSLCertificateFile /path/to/fullchain.crt&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;指定SSL证书文件（公钥）&lt;/strong&gt;&lt;br /&gt;推荐使用包含服务器证书和所有中间证书的完整链文件&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;SSLCertificateKeyFile&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;SSLCertificateKeyFile /path/to/private.key&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;指定与证书配对的私钥文件&lt;/strong&gt;&lt;br /&gt;此文件必须严格保密&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;SSLCertificateChainFile&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;SSLCertificateChainFile /path/to/chain.crt&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;指定中间证书链文件&lt;/strong&gt;&lt;br /&gt;如果&lt;code&gt;SSLCertificateFile&lt;/code&gt;已包含完整链，则此指令可选&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;Protocols&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;Protocols h2 http/1.1&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;指定服务器支持的协议版本，可写多个&lt;/strong&gt;&lt;br /&gt;&lt;code&gt;h2&lt;/code&gt;代表HTTP/2&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;SSLCipherSuite&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;SSLCipherSuite [套件列表]&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;指定服务器支持的加密套件列表&lt;/strong&gt;&lt;br /&gt;增强安全性&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;示例-4&#34;&gt;示例
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;VirtualHost&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;*:443&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ServerName&lt;/span&gt; secure.example.com
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;DocumentRoot&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/var/www/secure.example.com&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ErrorLog&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;logs/secure.example.com-error.log&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;CustomLog&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;logs/secure.example.com-access.log&amp;#34;&lt;/span&gt; combined
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 开启SSL/TLS引擎&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;SSLEngine&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;on&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 指定证书文件和私钥文件&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;SSLCertificateFile&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/etc/pki/tls/certs/secure.example.com.crt&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;SSLCertificateKeyFile&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/etc/pki/tls/private/secure.example.com.key&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;SSLCertificateChainFile&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/etc/pki/tls/certs/chain.crt&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 推荐的安全性设置&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Protocols&lt;/span&gt; h2 http/1.1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;SSLHonorCipherOrder&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;on&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;SSLCipherSuite&lt;/span&gt; EECDH+AESGCM:EDH+AESGCM
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/VirtualHost&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;该配置块定义了一个监听443端口的虚拟主机&lt;/p&gt;
&lt;p&gt;它通过&lt;code&gt;SSLEngine on&lt;/code&gt;指令开启了HTTPS服务，并使用&lt;code&gt;SSLCertificateFile&lt;/code&gt;、&lt;code&gt;SSLCertificateKeyFile&lt;/code&gt;和&lt;code&gt;SSLCertificateChainFile&lt;/code&gt;指令指定了相应的证书和密钥&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Protocols&lt;/code&gt;和&lt;code&gt;SSLCipherSuite&lt;/code&gt;指令则用于限制协议版本和加密算法，以确保安全性和性能&lt;/p&gt;
&lt;h1 id=&#34;日志分析&#34;&gt;日志分析
&lt;/h1&gt;&lt;h2 id=&#34;访问日志access_log&#34;&gt;访问日志（&lt;code&gt;access_log&lt;/code&gt;）
&lt;/h2&gt;&lt;p&gt;访问日志记录了所有客户端对服务器的请求&lt;/p&gt;
&lt;h3 id=&#34;日志格式&#34;&gt;日志格式
&lt;/h3&gt;&lt;p&gt;Apache默认使用&lt;code&gt;combined&lt;/code&gt;格式，它是一种全面且常用的格式，记录了请求的方方面面&lt;/p&gt;
&lt;p&gt;日志格式通过&lt;code&gt;LogFormat&lt;/code&gt;指令定义，并由&lt;code&gt;CustomLog&lt;/code&gt;指令引用：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LogFormat&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;%h %l %u %t \&amp;#34;%r\&amp;#34; %&amp;gt;s %b \&amp;#34;%{Referer}i\&amp;#34; \&amp;#34;%{User-Agent}i\&amp;#34;&amp;#34;&lt;/span&gt; combined
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;CustomLog&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;logs/access_log&amp;#34;&lt;/span&gt; combined
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;格式字段&#34;&gt;格式字段
&lt;/h3&gt;&lt;p&gt;下表详细解释了&lt;code&gt;combined&lt;/code&gt;日志格式中的每个字段&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;字段标识符&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
          &lt;th&gt;示例&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;%h&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;远程主机&lt;/strong&gt;&lt;br /&gt;客户端的IP地址&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;123.123.123.123&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;%l&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;远程登录名&lt;/strong&gt;&lt;br /&gt;由&lt;code&gt;identd&lt;/code&gt;确定，通常为&lt;code&gt;-&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;-&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;%u&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;远程用户&lt;/strong&gt;&lt;br /&gt;由HTTP认证确定的用户名&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;用户名&lt;/code&gt; (如果进行了认证)，否则为 &lt;code&gt;-&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;%t&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;时间&lt;/strong&gt;&lt;br /&gt;服务器收到请求的本地时间&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;[10/Oct/2000:13:55:36 -0700]&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;\&amp;quot;%r\&amp;quot;&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;请求行&lt;/strong&gt;&lt;br /&gt;完整的HTTP请求行，包括方法、路径和协议&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;&amp;quot;GET /apache_pb.gif HTTP/1.0&amp;quot;&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;%&amp;gt;s&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;状态码&lt;/strong&gt;&lt;br /&gt;返回给客户端的HTTP状态码&lt;br /&gt;&lt;strong&gt;&lt;code&gt;%s&lt;/code&gt;：最初请求的状态码&lt;/strong&gt;&lt;br /&gt;&lt;strong&gt;&lt;code&gt;%&amp;gt;s&lt;/code&gt;：最终响应状态码&lt;/strong&gt;（如果有内部重定向，记录重定向后的状态码）&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;200&lt;/code&gt;、&lt;code&gt;404&lt;/code&gt;、&lt;code&gt;301&lt;/code&gt;、&lt;code&gt;500&lt;/code&gt;等&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;%b&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;响应体大小&lt;/strong&gt;&lt;br /&gt;响应体的大小（字节），不包括响应头&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;2326&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;\&amp;quot;%{Referer}i\&amp;quot;&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;来源&lt;/strong&gt;&lt;br /&gt;请求的来源URL&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;&amp;quot;http://www.example.com/start.html&amp;quot;&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;\&amp;quot;%{User-Agent}i\&amp;quot;&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;用户代理&lt;/strong&gt;&lt;br /&gt;客户端浏览器或设备信息&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;&amp;quot;Mozilla/4.08 [en] (Win98; I ;Nav)&amp;quot;&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;实际示例&#34;&gt;实际示例
&lt;/h3&gt;&lt;p&gt;下面是一些常见的日志条目：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;成功请求 (&lt;code&gt;200 OK&lt;/code&gt;)&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;10.0.0.5 - - [20/Aug/2025:10:30:01 +0800] &amp;#34;&lt;span style=&#34;color:#e5c07b&#34;&gt;GET&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/index.html&lt;/span&gt; HTTP/1.1&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34; 200 450 &amp;#34;&lt;/span&gt;http://example.com/home&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt;Mozilla/5.0 (Windows NT &lt;span style=&#34;color:#d19a66&#34;&gt;10&lt;/span&gt;.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;来自内网IP&lt;code&gt;10.0.0.5&lt;/code&gt;的客户端，使用Chrome浏览器访问&lt;code&gt;http://example.com/home&lt;/code&gt;成功请求了根目录下的&lt;code&gt;index.html&lt;/code&gt;文件，服务器返回了&lt;code&gt;200&lt;/code&gt;状态码，响应体大小为&lt;code&gt;450&lt;/code&gt;字节&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;文件未找到 (&lt;code&gt;404 Not Found&lt;/code&gt;)&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;8.8.4.4 - - [20/Aug/2025:10:30:15 +0800] &amp;#34;&lt;span style=&#34;color:#e5c07b&#34;&gt;GET&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/robots.txt&lt;/span&gt; HTTP/1.1&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34; 404 213 &amp;#34;&lt;/span&gt;https://www.google.com/search?q=site:example.com&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt;Googlebot/2.1 (+http://www.google.com/bot.html)&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Google爬虫（&lt;code&gt;Googlebot&lt;/code&gt;）从搜索引擎结果页进入，请求了&lt;code&gt;robots.txt&lt;/code&gt;文件，但服务器返回了 &lt;code&gt;404&lt;/code&gt; 错误，表示该文件不存在，响应体大小为&lt;code&gt;213&lt;/code&gt;字节，通常是Apache默认的&lt;code&gt;404&lt;/code&gt;错误页面&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;永久重定向 (&lt;code&gt;301 Moved Permanently&lt;/code&gt;)&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;123.123.123.123 - - [20/Aug/2025:10:30:20 +0800] &amp;#34;&lt;span style=&#34;color:#e5c07b&#34;&gt;GET&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/old-page&lt;/span&gt; HTTP/1.1&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34; 301 245 &amp;#34;&lt;/span&gt;-&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt;Mozilla/5.0 (iPhone; CPU iPhone &lt;span style=&#34;color:#c678dd&#34;&gt;OS&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;16&lt;/span&gt;_0 like Mac &lt;span style=&#34;color:#c678dd&#34;&gt;OS&lt;/span&gt; X) AppleWebKit/605.1.15 (KHTML, like Gecko) CriOS/106.0.5249.101 Mobile/15E148 Safari/604.1&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;来自IP&lt;code&gt;123.123.123.123&lt;/code&gt;的iPhone客户端请求了&lt;code&gt;/old-page&lt;/code&gt;，但服务器配置了&lt;code&gt;301&lt;/code&gt;重定向，将请求永久指向了新地址，浏览器从HTTPS页面跳转到HTTP页面时，出于安全考虑，默认不会发送Referer，故而referer字段为空&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;服务器内部错误 (&lt;code&gt;500 Internal Server Error&lt;/code&gt;)&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;192.168.1.10 - - [20/Aug/2025:10:30:35 +0800] &amp;#34;&lt;span style=&#34;color:#e5c07b&#34;&gt;GET&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/api/data&lt;/span&gt; HTTP/1.1&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34; 500 503 &amp;#34;&lt;/span&gt;-&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt;curl/7.68.0&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;内网IP&lt;code&gt;192.168.1.10&lt;/code&gt;请求&lt;code&gt;http://example.com/dashboard&lt;/code&gt;页面（可能是一个脚本或API调用）返回了&lt;code&gt;500&lt;/code&gt;内部服务器错误，这通常意味着后端脚本（如PHP或Python）执行失败，要排查具体原因，必须查看错误日志&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;错误日志error_log&#34;&gt;错误日志（&lt;code&gt;error_log&lt;/code&gt;）
&lt;/h2&gt;&lt;p&gt;错误日志记录了服务器启动、运行、关闭过程中的所有诊断信息和错误&lt;/p&gt;
&lt;h3 id=&#34;格式与字段&#34;&gt;格式与字段
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;error.log&lt;/code&gt;条目的通用格式如下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;[时间戳]&lt;/span&gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;模块&lt;/span&gt;:&lt;span style=&#34;color:#e06c75&#34;&gt;日志级别&lt;/span&gt;] [&lt;span style=&#34;color:#e06c75&#34;&gt;pid&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;进程ID&lt;/span&gt;:&lt;span style=&#34;color:#e06c75&#34;&gt;tid&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;线程ID&lt;/span&gt;] [&lt;span style=&#34;color:#e06c75&#34;&gt;client&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;客户端IP&lt;/span&gt;:&lt;span style=&#34;color:#e06c75&#34;&gt;端口&lt;/span&gt;] &lt;span style=&#34;color:#e06c75&#34;&gt;错误描述&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;[时间戳]&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;日志事件发生的时间&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;[模块:日志级别]&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;指明产生日志的Apache模块（如&lt;code&gt;core&lt;/code&gt;、&lt;code&gt;proxy_http&lt;/code&gt;等）以及该事件的严重程度，具体看：&lt;a class=&#34;link&#34; href=&#34;#%e6%97%a5%e5%bf%97%e9%85%8d%e7%bd%ae&#34; &gt;日志配置
    
&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;[pid 进程ID:tid 线程ID]&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;指明是哪个Apache进程和线程产生了该日志，这在调试多进程或多线程问题时很有用&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;[client 客户端IP:端口]&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;指明导致错误的客户端IP地址和端口&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;示例-5&#34;&gt;示例
&lt;/h3&gt;&lt;p&gt;下面是一些常见的错误日志条目：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;文件权限问题&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;[Wed Aug 20 10:30:00.123456 2025]&lt;/span&gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;core&lt;/span&gt;:&lt;span style=&#34;color:#e06c75&#34;&gt;crit&lt;/span&gt;] [&lt;span style=&#34;color:#e06c75&#34;&gt;pid&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;12345&lt;/span&gt;] (&lt;span style=&#34;color:#d19a66&#34;&gt;13&lt;/span&gt;)&lt;span style=&#34;color:#e06c75&#34;&gt;Permission&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;denied&lt;/span&gt;: &lt;span style=&#34;color:#e06c75&#34;&gt;AH00035&lt;/span&gt;: &lt;span style=&#34;color:#e06c75&#34;&gt;Unable&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;to&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;change&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;to&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;root&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;directory&lt;/span&gt;: /&lt;span style=&#34;color:#c678dd&#34;&gt;var&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;www&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;site&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;dir&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这是一个严重的错误（&lt;code&gt;crit&lt;/code&gt;），通常发生在Apache启动时，它表明Apache进程（PID为12345）没有权限访问或切换到&lt;code&gt;/var/www/site/dir&lt;/code&gt;目录，通常是由于文件或目录权限设置不正确所致，需要检查该目录的用户和组是否与&lt;code&gt;httpd.conf&lt;/code&gt;中定义的&lt;code&gt;User&lt;/code&gt;和&lt;code&gt;Group&lt;/code&gt;匹配&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;配置文件语法错误&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;[Wed Aug 20 10:31:00.987654 2025]&lt;/span&gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;core&lt;/span&gt;:&lt;span style=&#34;color:#e06c75&#34;&gt;warn&lt;/span&gt;] [&lt;span style=&#34;color:#e06c75&#34;&gt;pid&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;12345&lt;/span&gt;] &lt;span style=&#34;color:#e06c75&#34;&gt;AH00547&lt;/span&gt;: &lt;span style=&#34;color:#e06c75&#34;&gt;The&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;document&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;root&lt;/span&gt; /&lt;span style=&#34;color:#c678dd&#34;&gt;var&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;www&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;example&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;com&lt;/span&gt;/&lt;span style=&#34;color:#c678dd&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;does&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;not&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;exist&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这是一个警告（&lt;code&gt;warn&lt;/code&gt;），服务器尝试启动，但发现&lt;code&gt;DocumentRoot&lt;/code&gt;指令中指定的 &lt;code&gt;/var/www/example.com/public&lt;/code&gt;目录不存在，Apache虽然可以启动，但网站将无法正常访问&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;后端连接失败&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;[Wed Aug 20 10:32:00.123456 2025]&lt;/span&gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;proxy&lt;/span&gt;:&lt;span style=&#34;color:#e06c75&#34;&gt;error&lt;/span&gt;] [&lt;span style=&#34;color:#e06c75&#34;&gt;pid&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;12345&lt;/span&gt;:&lt;span style=&#34;color:#e06c75&#34;&gt;tid&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;67890&lt;/span&gt;] [&lt;span style=&#34;color:#e06c75&#34;&gt;client&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;192.168&lt;/span&gt;.&lt;span style=&#34;color:#d19a66&#34;&gt;1.50&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;12345&lt;/span&gt;] &lt;span style=&#34;color:#e06c75&#34;&gt;AH00959&lt;/span&gt;: &lt;span style=&#34;color:#e06c75&#34;&gt;ap_proxy_connect_backend&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;disabling&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;connection&lt;/span&gt;: (&lt;span style=&#34;color:#d19a66&#34;&gt;111&lt;/span&gt;)&lt;span style=&#34;color:#e06c75&#34;&gt;Connection&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;refused&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这是一个错误（&lt;code&gt;error&lt;/code&gt;），&lt;code&gt;proxy&lt;/code&gt;模块无法连接到后端服务器，因为它返回了“连接被拒绝”（&lt;code&gt;Connection refused&lt;/code&gt;）的错误，这通常意味着后端应用服务没有运行，或者防火墙阻止了连接&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;mod_rewrite&lt;/code&gt; 调试信息&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;[Wed Aug 20 10:33:00.789012 2025]&lt;/span&gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;rewrite&lt;/span&gt;:&lt;span style=&#34;color:#e06c75&#34;&gt;trace1&lt;/span&gt;] [&lt;span style=&#34;color:#e06c75&#34;&gt;pid&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;12345&lt;/span&gt;] (&lt;span style=&#34;color:#d19a66&#34;&gt;2&lt;/span&gt;) &lt;span style=&#34;color:#c678dd&#34;&gt;init&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;rewrite&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;engine&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;with&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;requested&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;uri&lt;/span&gt; /&lt;span style=&#34;color:#e06c75&#34;&gt;about&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;[Wed Aug 20 10:33:00.789012 2025]&lt;/span&gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;rewrite&lt;/span&gt;:&lt;span style=&#34;color:#e06c75&#34;&gt;trace3&lt;/span&gt;] [&lt;span style=&#34;color:#e06c75&#34;&gt;pid&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;12345&lt;/span&gt;] &lt;span style=&#34;color:#e06c75&#34;&gt;applying&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;pattern&lt;/span&gt; &amp;#39;^(.*)$&amp;#39; &lt;span style=&#34;color:#e06c75&#34;&gt;to&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;uri&lt;/span&gt; &amp;#39;/&lt;span style=&#34;color:#e06c75&#34;&gt;about&lt;/span&gt;&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这些是级别为&lt;code&gt;trace1&lt;/code&gt;和&lt;code&gt;trace3&lt;/code&gt;的调试信息，它们在 &lt;code&gt;LogLevel&lt;/code&gt; 设置为 &lt;code&gt;trace&lt;/code&gt; 时才会出现，这对于排查复杂的&lt;code&gt;mod_rewrite&lt;/code&gt;规则非常有用，可以逐行跟踪规则的匹配和处理过程&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;docker环境中日志的特殊格式&#34;&gt;Docker环境中日志的特殊格式
&lt;/h2&gt;&lt;p&gt;有时，在使用官方&lt;code&gt;httpd&lt;/code&gt;Docker镜像时，通过&lt;code&gt;docker logs&lt;/code&gt;命令看到的日志格式与直接查看文件日志略有不同&lt;/p&gt;
&lt;p&gt;根据设置，Docker的日志驱动程序在将容器的&lt;code&gt;stdout&lt;/code&gt;和&lt;code&gt;stderr&lt;/code&gt;流捕获并输出时，可能会给每一行日志加上额外的前缀信息，这个前缀通常包含&lt;strong&gt;时间戳&lt;/strong&gt;和&lt;strong&gt;日志流的来源&lt;/strong&gt;（&lt;code&gt;stdout&lt;/code&gt;或&lt;code&gt;stderr&lt;/code&gt;），其标准格式为：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;[时间戳]&lt;/span&gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;日志流&lt;/span&gt;] [&lt;span style=&#34;color:#e06c75&#34;&gt;原始日志内容&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;字段&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
          &lt;th&gt;示例&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;时间戳&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;Docker记录该日志的时间，精确到纳秒&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;2025-08-20T02:30:00.123456789Z&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;日志流&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;指明日志来源：&lt;br /&gt;标准输出：&lt;code&gt;stdout&lt;/code&gt;，对应访问日志&lt;br /&gt;标准错误：stderr`，对应错误日志&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;stdout&lt;/code&gt;或&lt;code&gt;stderr&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;示例-6&#34;&gt;示例
&lt;/h3&gt;&lt;p&gt;一个完整的&lt;code&gt;docker logs&lt;/code&gt;访问日志条目看起来像这样：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;2025&lt;/span&gt;-&lt;span style=&#34;color:#d19a66&#34;&gt;08&lt;/span&gt;-&lt;span style=&#34;color:#d19a66&#34;&gt;20&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;T02&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;30&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;00.123456789&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;Z&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;stdout&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;172.17&lt;/span&gt;.&lt;span style=&#34;color:#d19a66&#34;&gt;0.3&lt;/span&gt; - - [&lt;span style=&#34;color:#d19a66&#34;&gt;20&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;Aug&lt;/span&gt;/&lt;span style=&#34;color:#d19a66&#34;&gt;2025&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;02&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;30&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;00&lt;/span&gt; +&lt;span style=&#34;color:#d19a66&#34;&gt;0000&lt;/span&gt;] &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;GET / HTTP/1.1&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;200&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;45&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;curl/7.64.1&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;一个完整的错误日志条目看起来像这样：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;2025&lt;/span&gt;-&lt;span style=&#34;color:#d19a66&#34;&gt;08&lt;/span&gt;-&lt;span style=&#34;color:#d19a66&#34;&gt;20&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;T02&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;30&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;05.987654321&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;Z&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;stderr&lt;/span&gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;Wed&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;Aug&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;20&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;02&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;30&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;05.987654&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;2025&lt;/span&gt;] [&lt;span style=&#34;color:#e06c75&#34;&gt;core&lt;/span&gt;:&lt;span style=&#34;color:#e06c75&#34;&gt;error&lt;/span&gt;] [&lt;span style=&#34;color:#e06c75&#34;&gt;pid&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#e06c75&#34;&gt;AH00037&lt;/span&gt;: &lt;span style=&#34;color:#e06c75&#34;&gt;File&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;not&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;found&lt;/span&gt;: /&lt;span style=&#34;color:#e06c75&#34;&gt;usr&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;local&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;apache2&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;htdocs&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;non&lt;/span&gt;-&lt;span style=&#34;color:#e06c75&#34;&gt;existent&lt;/span&gt;-&lt;span style=&#34;color:#c678dd&#34;&gt;file&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;html&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;分析技巧&#34;&gt;分析技巧
&lt;/h2&gt;&lt;p&gt;以下命令示例均基于&lt;code&gt;access.log&lt;/code&gt;文件&lt;/p&gt;
&lt;h3 id=&#34;统计访问量最多的ip地址&#34;&gt;统计访问量最多的IP地址
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cut -d &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39; &amp;#39;&lt;/span&gt; -f &lt;span style=&#34;color:#d19a66&#34;&gt;1&lt;/span&gt; access.log | sort | uniq -c | sort -rn | head -10
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;cut -d &#39; &#39; -f 1 access.log&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;使用 &lt;code&gt;cut&lt;/code&gt; 命令以空格为分隔符（&lt;code&gt;-d &#39; &#39;&lt;/code&gt;），提取每行的第一个字段（&lt;code&gt;-f 1&lt;/code&gt;），即客户端 IP 地址&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;sort&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;对提取出的所有 IP 地址进行排序，这是&lt;code&gt;uniq&lt;/code&gt;命令去重和计数的前提&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;uniq -c&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;统计每个 IP 地址出现的次数（&lt;code&gt;-c&lt;/code&gt; 表示计数）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;sort -rn&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;对上一步的结果进行再次排序&lt;/p&gt;
&lt;p&gt;&lt;code&gt;-r&lt;/code&gt;表示降序排序，&lt;code&gt;-n&lt;/code&gt;表示按数值大小排序（而不是按字典顺序），确保最高的访问次数排在最前面&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;head -10&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;输出排序后的前10行，即访问次数最多的前10个IP地址及其次数&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;统计特定页面或文件的访问次数&#34;&gt;统计特定页面或文件的访问次数
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;grep -c &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/index.php&amp;#34;&lt;/span&gt; access.log
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;grep &amp;quot;/index.php&amp;quot; access.log&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;在&lt;code&gt;access.log&lt;/code&gt;文件中搜索所有包含&lt;code&gt;/index.php&lt;/code&gt;字符串的行&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;-c&lt;/code&gt;选项&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;告诉&lt;code&gt;grep&lt;/code&gt;只输出匹配的行数，而不显示匹配的行本身&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;统计特定ip地址的访问总次数&#34;&gt;统计特定IP地址的访问总次数
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;grep -w &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;192.168.200.2&amp;#34;&lt;/span&gt; access.log | wc -l
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;grep -w &amp;quot;192.168.200.2&amp;quot; access.log&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;使用&lt;code&gt;grep&lt;/code&gt;搜索 IP 地址&lt;/p&gt;
&lt;p&gt;&lt;code&gt;-w&lt;/code&gt;选项确保只匹配一个完整的“单词”，即只匹配&lt;code&gt;192.168.200.2&lt;/code&gt;这个完整的IP地址&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;|&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;管道符，将&lt;code&gt;grep&lt;/code&gt;命令的输出作为&lt;code&gt;wc&lt;/code&gt;命令的输入&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;wc -l&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;统计来自管道的行数（&lt;code&gt;-l&lt;/code&gt;表示行）&lt;/p&gt;
&lt;p&gt;每行代表一次访问，因此行数即为总访问次数&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;统计特定时间段内的独立ip访问数&#34;&gt;统计特定时间段内的独立IP访问数
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;grep &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;03/Aug/2023:08:&amp;#34;&lt;/span&gt; access.log | awk &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;{print $1}&amp;#39;&lt;/span&gt; | sort | uniq | wc -l
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;grep &amp;quot;03/Aug/2023:08:&amp;quot; access.log&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;根据日志中的时间戳格式，筛选出所有在 2023年8月03日8时这个小时段内的访问记录&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;awk &#39;{print $1}&#39;&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;awk&lt;/code&gt;命令默认以空格分隔字段，&lt;code&gt;{print $1}&lt;/code&gt;提取每行的第一个字段，即IP地址&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;sort&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;对所有提取出的IP地址进行排序&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;uniq&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;去重，只保留唯一的IP地址&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;wc -l&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;统计去重后剩下的行数，即独立IP地址的数量&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;查找特定ip地址的详细访问记录&#34;&gt;查找特定IP地址的详细访问记录
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;grep &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;192.168.200.2&amp;#34;&lt;/span&gt; access.log | more
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;grep &amp;quot;192.168.200.2&amp;quot; access.log&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;搜索包含该IP地址的所有日志行&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;| more&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;如果匹配的行数太多，&lt;code&gt;more&lt;/code&gt;命令会进行分页显示，方便逐页查看，按空格键翻页，按&lt;code&gt;q&lt;/code&gt;键退出&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;文章至此告一段落，笔者使用的也不多，之后边学边更新吧&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Nginx入门</title>
        <link>https://blog.928330.xyz/p/nginx%E5%85%A5%E9%97%A8/</link>
        <pubDate>Thu, 24 Jul 2025 22:15:30 +0800</pubDate>
        
        <guid>https://blog.928330.xyz/p/nginx%E5%85%A5%E9%97%A8/</guid>
        <description>&lt;img src="http://picture.928330.xyz/typora/94b5f0d5aceb41498d7d03bcff81ecf5.jpeg" alt="Featured image of post Nginx入门" /&gt;&lt;p&gt;开玩笑的，其实nginx和apache一样好用&lt;/p&gt;
&lt;p&gt;apache移步：&lt;a class=&#34;link&#34; href=&#34;http://blog.928330.xyz/p/apache%E5%85%A5%E9%97%A8/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Apache入门
    
    &lt;span style=&#34;white-space: nowrap;&#34;&gt;&lt;svg width=&#34;.7em&#34;
        height=&#34;.7em&#34; viewBox=&#34;0 0 21 21&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;
        &lt;path d=&#34;m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z&#34; fill=&#34;currentColor&#34; /&gt;
        &lt;path d=&#34;M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z&#34;
            fill=&#34;currentColor&#34;&gt;
    &lt;/svg&gt;&lt;/span&gt;
    
&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;什么是nginx&#34;&gt;什么是Nginx
&lt;/h1&gt;&lt;p&gt;Nginx（发音为 &amp;ldquo;engine-X&amp;rdquo;）是一款开源的、高性能的HTTP和反向代理服务器&lt;/p&gt;
&lt;p&gt;它的设计哲学是提供极致的性能、稳定性、丰富的功能、简单的配置和低资源消耗，看上去就很厉害&lt;/p&gt;
&lt;p&gt;Nginx采用事件驱动的异步非阻塞架构&lt;/p&gt;
&lt;p&gt;与传统的Apache等服务器为每个请求创建一个新进程或线程不同，Nginx使用一个主进程和少数几个工作进程&lt;/p&gt;
&lt;p&gt;主进程负责读取配置、管理工作进程，而真正处理网络请求的是工作进程&lt;/p&gt;
&lt;p&gt;每个工作进程都是单线程的，异步地处理成千上万个并发连接&lt;/p&gt;
&lt;p&gt;这种模型避免了创建和销毁进程/线程的开销以及上下文切换的成本，因此能以极低的内存占用应对高并发场景&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;接下来我们会介绍直接安装的Nginx，也会顺带介绍通过Docker容器启动的Nginx&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;二者在活动状态控制和日志方面有些区别，配置基本一致&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id=&#34;主要用法&#34;&gt;主要用法
&lt;/h1&gt;&lt;h2 id=&#34;web服务器&#34;&gt;Web服务器
&lt;/h2&gt;&lt;p&gt;直接向客户端提供静态资源（如HTML、CSS、图片）的服务&lt;/p&gt;
&lt;p&gt;由于其高效的文件读取和网络传输能力，Nginx在处理静态内容方面表现极其出色,&lt;del&gt;适合搭建博客&lt;/del&gt;&lt;/p&gt;
&lt;h2 id=&#34;反向代理服务器&#34;&gt;反向代理服务器
&lt;/h2&gt;&lt;p&gt;它是是客户端和后端真实服务器之间的中间人&lt;/p&gt;
&lt;p&gt;它可以将客户端请求转发到后端的应用服务器（如Node.js、Java、Python应用），并将后端响应返回给客户端，从而实现请求分发、负载均衡，并能隐藏后端服务的真实IP和端口，提升安全性&lt;/p&gt;
&lt;h2 id=&#34;负载均衡器&#34;&gt;负载均衡器
&lt;/h2&gt;&lt;p&gt;当后端有多台服务器时，Nginx可以根据预设的策略将请求分发到这些服务器上，从而分担单一服务器的压力&lt;/p&gt;
&lt;h2 id=&#34;api网关&#34;&gt;API网关
&lt;/h2&gt;&lt;p&gt;在微服务架构中，Nginx可以作为所有API请求的统一入口，执行如身份验证、速率限制、日志记录、服务发现等通用功能&lt;/p&gt;
&lt;h1 id=&#34;目录结构&#34;&gt;目录结构
&lt;/h1&gt;&lt;h2 id=&#34;不同来源&#34;&gt;不同来源
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;通过不同方式安装的nginx的默认目录结构都会有所差别&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;官方nginx包从-nginxorg&#34;&gt;官方Nginx包（从 nginx.org）
&lt;/h3&gt;&lt;p&gt;从Nginx下载官方提供的&lt;code&gt;.rpm/.deb&lt;/code&gt;包安装&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;/&lt;/span&gt;                                                                 &lt;span style=&#34;color:#7f848e&#34;&gt;# 根目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;etc/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx/&lt;/span&gt;                                           &lt;span style=&#34;color:#7f848e&#34;&gt;# 配置文件目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx.conf&lt;/span&gt;                                &lt;span style=&#34;color:#7f848e&#34;&gt;# 主配置文件（Nginx 的核心配置）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;mime.types&lt;/span&gt;                              &lt;span style=&#34;color:#7f848e&#34;&gt;# MIME类型映射表
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;conf.d/&lt;/span&gt;                                     &lt;span style=&#34;color:#7f848e&#34;&gt;# 子配置目录（用于虚拟主机）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;           &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;default.conf&lt;/span&gt;                          &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认网站配置文件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;usr/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;sbin/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx&lt;/span&gt;                                       &lt;span style=&#34;color:#7f848e&#34;&gt;# 主程序二进制文件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;share/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;           &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;html/&lt;/span&gt;                                  &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认 Web 根目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;               &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;index.html&lt;/span&gt;                      &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认欢迎页面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;               &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;50x.html&lt;/span&gt;                        &lt;span style=&#34;color:#7f848e&#34;&gt;# 服务器错误页面（如 500、502）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;var/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;log/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx/&lt;/span&gt;                                    &lt;span style=&#34;color:#7f848e&#34;&gt;# 日志文件目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;           &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;access.log&lt;/span&gt;                           &lt;span style=&#34;color:#7f848e&#34;&gt;# 访问日志
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;           &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;error.log&lt;/span&gt;                             &lt;span style=&#34;color:#7f848e&#34;&gt;# 错误日志
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;lib/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;systemd/&lt;/span&gt;                                    &lt;span style=&#34;color:#7f848e&#34;&gt;# 服务管理相关
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;system/&lt;/span&gt;                                   &lt;span style=&#34;color:#7f848e&#34;&gt;# Nginx systemd 配置
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;              &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx.service&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;源码编译安装&#34;&gt;源码编译安装
&lt;/h3&gt;&lt;p&gt;从Nginx官方下载源码&lt;code&gt;.tar.gz&lt;/code&gt;，自己编译安装&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;/&lt;/span&gt;                                                               &lt;span style=&#34;color:#7f848e&#34;&gt;# 根目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;usr/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;local/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;sbin/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx&lt;/span&gt;                              &lt;span style=&#34;color:#7f848e&#34;&gt;# 主程序二进制文件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;conf/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx.conf&lt;/span&gt;                       &lt;span style=&#34;color:#7f848e&#34;&gt;# 主配置文件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;mime.types&lt;/span&gt;                     &lt;span style=&#34;color:#7f848e&#34;&gt;# MIME类型映射表
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;conf.d/&lt;/span&gt;                            &lt;span style=&#34;color:#7f848e&#34;&gt;# 子配置目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;default.conf&lt;/span&gt;                &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认网站配置文件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;html/&lt;/span&gt;                                    &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认 Web 根目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;index.html&lt;/span&gt;                       &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认欢迎页面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;50x.html&lt;/span&gt;                          &lt;span style=&#34;color:#7f848e&#34;&gt;# 服务器错误页面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;logs/&lt;/span&gt;                                     &lt;span style=&#34;color:#7f848e&#34;&gt;# 日志文件目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;                &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;access.log&lt;/span&gt;                         &lt;span style=&#34;color:#7f848e&#34;&gt;# 访问日志
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;                &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;error.log&lt;/span&gt;                            &lt;span style=&#34;color:#7f848e&#34;&gt;# 错误日志
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;debianubuntu官方仓库&#34;&gt;Debian/Ubuntu官方仓库
&lt;/h3&gt;&lt;p&gt;通过&lt;code&gt;apt&lt;/code&gt;安装&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;虽然&lt;code&gt;apt&lt;/code&gt;也是调用&lt;code&gt;dpkg&lt;/code&gt;安装&lt;code&gt;.deb&lt;/code&gt;包，但debian/ubuntu维护的&lt;code&gt;.deb&lt;/code&gt;包和官方打包的不太一样，因此web根目录等等路径和直接使用官方包安装会有所差别&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;/&lt;/span&gt;                                                                 &lt;span style=&#34;color:#7f848e&#34;&gt;# 根目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;etc/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx/&lt;/span&gt;                                           &lt;span style=&#34;color:#7f848e&#34;&gt;# 配置文件目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx.conf&lt;/span&gt;                                &lt;span style=&#34;color:#7f848e&#34;&gt;# 主配置文件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;mime.types&lt;/span&gt;                              &lt;span style=&#34;color:#7f848e&#34;&gt;# MIME类型映射表
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;conf.d/&lt;/span&gt;                                     &lt;span style=&#34;color:#7f848e&#34;&gt;# 子配置目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;           &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;default.conf&lt;/span&gt;                         &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认网站配置文件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;usr/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;sbin/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx&lt;/span&gt;                                       &lt;span style=&#34;color:#7f848e&#34;&gt;# 主程序二进制文件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;var/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;www/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;html/&lt;/span&gt;                                      &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认 Web 根目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;index.html&lt;/span&gt;                          &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认欢迎页面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;50x.html&lt;/span&gt;                             &lt;span style=&#34;color:#7f848e&#34;&gt;# 服务器错误页面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;log/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx/&lt;/span&gt;                                      &lt;span style=&#34;color:#7f848e&#34;&gt;# 日志文件目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;           &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;access.log&lt;/span&gt;                            &lt;span style=&#34;color:#7f848e&#34;&gt;# 访问日志
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;           &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;error.log&lt;/span&gt;                              &lt;span style=&#34;color:#7f848e&#34;&gt;# 错误日志
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;lib/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;systemd/&lt;/span&gt;                                     &lt;span style=&#34;color:#7f848e&#34;&gt;# 服务管理相关
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;system/&lt;/span&gt;                                   &lt;span style=&#34;color:#7f848e&#34;&gt;# Nginx systemd 配置
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;              &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx.service&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;centosrhel官方仓库&#34;&gt;CentOS/RHEL官方仓库
&lt;/h3&gt;&lt;p&gt;通过&lt;code&gt;yum&lt;/code&gt;/&lt;code&gt;dnf&lt;/code&gt;安装&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;路径、配置和布局就是官方Nginx提供的.rmp包规范的结构，所以和第一种很像&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;/&lt;/span&gt;                                                               &lt;span style=&#34;color:#7f848e&#34;&gt;# 根目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;etc/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx/&lt;/span&gt;                                         &lt;span style=&#34;color:#7f848e&#34;&gt;# 配置文件目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx.conf&lt;/span&gt;                               &lt;span style=&#34;color:#7f848e&#34;&gt;# 主配置文件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;mime.types&lt;/span&gt;                             &lt;span style=&#34;color:#7f848e&#34;&gt;# MIME类型映射表
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;conf.d/&lt;/span&gt;                                    &lt;span style=&#34;color:#7f848e&#34;&gt;# 子配置目录（用于虚拟主机）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;           &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;default.conf&lt;/span&gt;                        &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认网站配置文件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;usr/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;sbin/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx&lt;/span&gt;                                      &lt;span style=&#34;color:#7f848e&#34;&gt;# 主程序二进制文件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;usr/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;share/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;           &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;html/&lt;/span&gt;                                 &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认 Web 根目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;               &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;index.html&lt;/span&gt;                     &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认欢迎页面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;               &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;50x.html&lt;/span&gt;                        &lt;span style=&#34;color:#7f848e&#34;&gt;# 服务器错误页面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;var/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;log/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx/&lt;/span&gt;                                    &lt;span style=&#34;color:#7f848e&#34;&gt;# 日志文件目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;           &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;access.log&lt;/span&gt;                          &lt;span style=&#34;color:#7f848e&#34;&gt;# 访问日志
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;           &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;error.log&lt;/span&gt;                             &lt;span style=&#34;color:#7f848e&#34;&gt;# 错误日志
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;usr/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;lib/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;systemd/&lt;/span&gt;                                 &lt;span style=&#34;color:#7f848e&#34;&gt;# 服务管理相关
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;system/&lt;/span&gt;                               &lt;span style=&#34;color:#7f848e&#34;&gt;# Nginx systemd 配置
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;                &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx.service&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;docker镜像官方-nginx&#34;&gt;Docker镜像（官方 Nginx）
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;没有固定结构&lt;/strong&gt;，因为Docker镜像只是一个文件系统的快照，完全取决于镜像制作者，具体看上面四种&lt;/p&gt;
&lt;p&gt;这里以官方镜像为例，也就是&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;/&lt;/span&gt;                                                  &lt;span style=&#34;color:#7f848e&#34;&gt;# 根目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;etc/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx/&lt;/span&gt;                            &lt;span style=&#34;color:#7f848e&#34;&gt;# 配置文件目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx.conf&lt;/span&gt;                  &lt;span style=&#34;color:#7f848e&#34;&gt;# 主配置文件（Nginx 的核心配置）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;mime.types&lt;/span&gt;                &lt;span style=&#34;color:#7f848e&#34;&gt;# MIME类型映射表
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;conf.d/&lt;/span&gt;                       &lt;span style=&#34;color:#7f848e&#34;&gt;# 子配置目录（用于虚拟主机）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;           &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;default.conf&lt;/span&gt;           &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认网站配置文件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;usr/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;share/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;      &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;html/&lt;/span&gt;                     &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认的 Web 根目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;           &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;index.html&lt;/span&gt;        &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认欢迎页面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;           &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;50x.html&lt;/span&gt;           &lt;span style=&#34;color:#7f848e&#34;&gt;# 服务器错误页面（如 500、502）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;sbin/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx&lt;/span&gt;                         &lt;span style=&#34;color:#7f848e&#34;&gt;# 主程序二进制文件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;var/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;log/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx/&lt;/span&gt;                       &lt;span style=&#34;color:#7f848e&#34;&gt;# 日志文件目录（部分精简镜像无日志输出）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;             &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;access.log&lt;/span&gt;             &lt;span style=&#34;color:#7f848e&#34;&gt;# 访问日志（默认可能未启用）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;             &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;error.log&lt;/span&gt;                &lt;span style=&#34;color:#7f848e&#34;&gt;# 错误日志（默认可能未启用）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;一些问题&#34;&gt;一些问题
&lt;/h2&gt;&lt;h3 id=&#34;日志文件&#34;&gt;日志文件
&lt;/h3&gt;&lt;p&gt;&lt;span style=&#34;color:red;font-size:20px&#34;&gt;&lt;strong&gt;Docker镜像的Nginx日志默认输出到标准输出/错误，而不是文件中&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;在编译安装（&lt;code&gt;make install&lt;/code&gt;）的传统方式中，Nginx日志会记录在：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;usr&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;local&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;nginx&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;logs&lt;/span&gt;/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;在&lt;code&gt;.deb&lt;/code&gt;包和系统包安装（&lt;code&gt;apt/yum&lt;/code&gt;）的方式中，Nginx日志会记录在：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/&lt;span style=&#34;color:#c678dd&#34;&gt;var&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;log&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;nginx&lt;/span&gt;/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;而在Docker官方镜像中，日志默认不写入上面的文件，而是输出到标准输出和标准错误&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;执行以下命令：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ls -l /var/log/nginx/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;我们可以看到如下输出：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;lrwxrwxrwx &lt;span style=&#34;color:#d19a66&#34;&gt;1&lt;/span&gt; root root &lt;span style=&#34;color:#d19a66&#34;&gt;11&lt;/span&gt; Jul &lt;span style=&#34;color:#d19a66&#34;&gt;15&lt;/span&gt; 01:14 access.log -&amp;gt; /dev/stdout
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;lrwxrwxrwx &lt;span style=&#34;color:#d19a66&#34;&gt;1&lt;/span&gt; root root &lt;span style=&#34;color:#d19a66&#34;&gt;11&lt;/span&gt; Jul &lt;span style=&#34;color:#d19a66&#34;&gt;15&lt;/span&gt; 01:14 error.log -&amp;gt; /dev/stderr
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;虽然&lt;code&gt;nginx.conf&lt;/code&gt;配置的是&lt;code&gt;/var/log/nginx/access.log&lt;/code&gt;，但由于它是个符号链接，等于就是输出到了标准输出&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;这些输出会被记录到docker容器的日志里，docker中查看日志的方式&lt;/strong&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;docker&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;logs&lt;/span&gt; &amp;lt;&lt;span style=&#34;color:#e06c75&#34;&gt;容器ID&lt;/span&gt;&amp;gt;/&amp;lt;&lt;span style=&#34;color:#e06c75&#34;&gt;名称&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;配置文件&#34;&gt;配置文件
&lt;/h3&gt;&lt;p&gt;&lt;span style=&#34;color:red;font-size:20px&#34;&gt;&lt;strong&gt;&lt;code&gt;/etc/nginx/conf.d/&lt;/code&gt;是主配置目录，&lt;code&gt;/etc/nginx/nginx.conf&lt;/code&gt;是主配置文件&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Nginx的主配置文件是&lt;code&gt;/etc/nginx/nginx.conf&lt;/code&gt;，在这个文件中有这样一行代码：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;/etc/nginx/conf.d/*.conf&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;include&lt;/code&gt;是Nginx配置语言中的指令，用于包含其他配置文件&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;也就是说，&lt;code&gt;/etc/nginx/nginx.conf&lt;/code&gt;默认会包含&lt;code&gt;/etc/nginx/conf.d/&lt;/code&gt;这个子目录中的所有配置（.conf）&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;web-根目录&#34;&gt;Web 根目录
&lt;/h3&gt;&lt;p&gt;&lt;span style=&#34;color:red;font-size:20px&#34;&gt;&lt;strong&gt;不同安装方式下，Nginx的默认Web根目录不同&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;在编译安装（&lt;code&gt;make install&lt;/code&gt;）的传统方式中，Web根目录在：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;usr&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;local&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;nginx&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;html&lt;/span&gt;/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;默认包含以下文件：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;index&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;html&lt;/span&gt;   # &lt;span style=&#34;color:#e06c75&#34;&gt;默认欢迎页面&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;x&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;html&lt;/span&gt;     # &lt;span style=&#34;color:#e06c75&#34;&gt;服务器错误页面&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;在Debian/Ubuntu系统包安装方式中，Web根目录在：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/&lt;span style=&#34;color:#c678dd&#34;&gt;var&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;www&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;html&lt;/span&gt;/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;在官方包和CentOS/RHEL系统包安装方式中，Web根目录在：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;usr&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;share&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;nginx&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;html&lt;/span&gt;/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;可以通过修改Nginx配置文件中的&lt;code&gt;root&lt;/code&gt;指令来改变Web根目录：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;listen&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;80&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;server_name&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;localhost&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;root&lt;/span&gt; /&lt;span style=&#34;color:#e06c75&#34;&gt;path&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;to&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;your&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;webroot&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;index&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;index&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;html&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;关于server块我们后面会细讲&lt;/p&gt;
&lt;h3 id=&#34;systemd的位置&#34;&gt;systemd的位置
&lt;/h3&gt;&lt;p&gt;其实这个不是nginx的问题，而是一个历史问题 —— linux文件系统的演进&lt;/p&gt;
&lt;p&gt;**FHS，全称Filesystem Hierarchy Standard（文件系统层次结构标准）**是 Linux 系统的一个标准，规定了 目录结构、文件存放位置及用途，让不同 Linux 发行版在文件布局上保持一致性&lt;/p&gt;
&lt;p&gt;在早期，FHS规定&lt;code&gt;/lib/&lt;/code&gt;用于存放核心库文件和与系统启动紧密相关的可执行文件（比如init系统所需的库、二进制），而&lt;code&gt;/usr/lib/&lt;/code&gt;用于存放非核心、额外安装的软件库&lt;/p&gt;
&lt;p&gt;但在systemd出现后，由于systemd的服务单元文件属于系统服务配置，与系统启动密切相关，但又不是二进制程序本身，于是他的位置有了一些不同：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Debian/Ubuntu：选择&lt;code&gt;/lib/systemd/system/&lt;/code&gt;放置核心包的单元文件（比如nginx、sshd），保证系统启动时总能找到&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;CentOS/RHEL/Fedora：更倾向使用&lt;code&gt;/usr/lib/systemd/system/&lt;/code&gt;，虽然&lt;code&gt;/lib/systemd/system/&lt;/code&gt;也存在，但它通常是指向前者的符号链接&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;现在&lt;code&gt;/lib/&lt;/code&gt;和&lt;code&gt;/usr/lib/&lt;/code&gt;往往通过软链接或包管理器自动管理，保证旧路径和新路径都能访问到服务单元文件，所以你会看到同样的 Nginx 服务在不同发行版或者不同安装方式下，路径可能不同&lt;/p&gt;
&lt;h1 id=&#34;常用命令&#34;&gt;常用命令
&lt;/h1&gt;&lt;p&gt;Nginx直接安装在本机时，使用&lt;code&gt;systemctl&lt;/code&gt;或者&lt;code&gt;service&lt;/code&gt;命令控制&lt;/p&gt;
&lt;p&gt;通过Docker容器使用时，就按照Docker容器的使用方法（没用过看这里：&lt;a class=&#34;link&#34; href=&#34;http://blog.928330.xyz/p/%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8Bdocker/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;快速上手Docker
    
    &lt;span style=&#34;white-space: nowrap;&#34;&gt;&lt;svg width=&#34;.7em&#34;
        height=&#34;.7em&#34; viewBox=&#34;0 0 21 21&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;
        &lt;path d=&#34;m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z&#34; fill=&#34;currentColor&#34; /&gt;
        &lt;path d=&#34;M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z&#34;
            fill=&#34;currentColor&#34;&gt;
    &lt;/svg&gt;&lt;/span&gt;
    
&lt;/a&gt;）&lt;/p&gt;
&lt;p&gt;下面介绍一些Nginx本身的命令：&lt;/p&gt;
&lt;h2 id=&#34;查看版本&#34;&gt;查看版本
&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;nginx -v
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;输出当前安装的Nginx版本号，用于确认是否正确安装Nginx及其版本信息&lt;/p&gt;
&lt;h2 id=&#34;检查配置文件语法&#34;&gt;检查配置文件语法
&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;nginx -t
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;在每次修改配置文件后必须执行&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;使用后，主进程会fork一个临时子进程，子进程尝试解析所有配置文件，但不会绑定端口或真正启动服务&lt;/p&gt;
&lt;p&gt;若语法无误，会提示&lt;code&gt;syntax is ok&lt;/code&gt;和 &lt;code&gt;test is successful&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;若有错误，会明确指出是哪一行、哪个文件配置有误&lt;/p&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250724132842292&#34; href=&#34;http://picture.928330.xyz/typora/image-20250724132842292.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250724132842292.png&#34; alt=&#34;image-20250724132842292&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h2 id=&#34;重新加载配置文件&#34;&gt;重新加载配置文件
&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;nginx -s reload
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;强制停止&#34;&gt;强制停止
&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;nginx -s stop
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;配置文件-1&#34;&gt;配置文件
&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;Nginx的所有功能都是通过配置文件&lt;code&gt;nginx.conf&lt;/code&gt;来驱动的&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;该文件主要由多个配置块组成，这些块由花括号&lt;code&gt;{}&lt;/code&gt;界定，可以嵌套，形成了层级分明的结构&lt;/p&gt;
&lt;p&gt;一个典型的&lt;code&gt;nginx.conf&lt;/code&gt;结构如下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;nginx.conf&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;全局块&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;events块&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;http块&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;server块（可多个）&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;location块（可多个）&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;具体示例如下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;user&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;nginx&lt;/span&gt;; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;worker_processes&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;auto&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;error_log&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;/var/log/nginx/error.log&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;warn&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;pid&lt;/span&gt;        &lt;span style=&#34;color:#98c379&#34;&gt;/var/run/nginx.pid&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;events&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;worker_connections&lt;/span&gt;  &lt;span style=&#34;color:#d19a66&#34;&gt;1024&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;http&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;include&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;/etc/nginx/mime.types&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;default_type&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;application/octet-stream&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;log_format&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;main&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$remote_addr&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$remote_user&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$time_local]&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$request&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                      &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$status&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$body_bytes_sent&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$http_referer&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                      &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$http_user_agent&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$http_x_forwarded_for&amp;#34;&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;access_log&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;/var/log/nginx/access.log&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;main&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;sendfile&lt;/span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;on&lt;/span&gt;; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;tcp_nopush&lt;/span&gt;      &lt;span style=&#34;color:#e06c75&#34;&gt;on&lt;/span&gt;; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;keepalive_timeout&lt;/span&gt;  &lt;span style=&#34;color:#d19a66&#34;&gt;65&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;listen&lt;/span&gt;       &lt;span style=&#34;color:#d19a66&#34;&gt;80&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;server_name&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;localhost&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#c678dd&#34;&gt;root&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;/usr/share/nginx/html&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#c678dd&#34;&gt;index&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;index.html&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;index.htm&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;全局块&#34;&gt;全局块
&lt;/h2&gt;&lt;p&gt;位于配置文件顶部，未嵌套于任何块中&lt;/p&gt;
&lt;p&gt;用于配置Nginx整体运行环境，影响所有子模块&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;user&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;nginx&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;worker_processes&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;auto&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;error_log&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;/var/log/nginx/error.log&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;warn&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;pid&lt;/span&gt;        &lt;span style=&#34;color:#98c379&#34;&gt;/var/run/nginx.pid&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;user&lt;/code&gt;：指定运行工作进程的用户和用户组&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;worker_processes&lt;/code&gt;：指定工作进程数量&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;auto&lt;/code&gt;表示自动与 CPU 核心数一致&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;error_log&lt;/code&gt;：设置错误日志的路径和日志级别&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;每条错误日志条目都会带有一个严重性等级，这些等级是代码里写死的，作为用户无法改变某个错误属于什么等级&lt;/p&gt;
&lt;p&gt;Nginx支持的日志级别（从高到低）如下：&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;级别&lt;/th&gt;
          &lt;th&gt;描述&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;debug&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;记录所有信息，主要用于开发或调试，信息量极大，通常需编译时启用&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;info&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;普通信息，如配置加载成功、进程启动、连接创建等&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;notice&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;正常但重要的事件，如配置文件重载、进程关闭等&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;warn&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;警告信息，非致命错误，比如配置中存在问题但可以忽略或继续运行&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;error&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;运行过程中出现的错误，如连接失败、服务不可达等&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;crit&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;严重错误，Nginx可能无法继续运行&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;alert&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;必须立刻处理的严重问题&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;emerg&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;紧急状态，比如系统崩溃，Nginx无法启动&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;是否写入日志文件取决于&lt;code&gt;LogLevel&lt;/code&gt;设置的阈值，只会写入大于等于当前设置等级的错误事件&lt;/p&gt;
&lt;p&gt;生产环境通常设置为&lt;code&gt;warn&lt;/code&gt;以捕捉重要问题，同时避免日志泛滥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;pid&lt;/code&gt;：指定记录主进程PID的文件路径&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;events块&#34;&gt;events块
&lt;/h2&gt;&lt;p&gt;紧随全局块之后，一级块&lt;/p&gt;
&lt;p&gt;用于配置与网络连接处理相关的指令，影响工作进程的并发性能&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;events&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;worker_connections&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;1024&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;worker_connections&lt;/code&gt;：每个工作进程可同时处理的最大连接数&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;总并发连接数约为&lt;code&gt;worker_processes * worker_connections&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;http块&#34;&gt;http块
&lt;/h2&gt;&lt;p&gt;紧随events块之后，一级块&lt;/p&gt;
&lt;p&gt;用于配置HTTP协议相关的指令，是配置Web服务的核心部分&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;http&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;include&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;/etc/nginx/mime.types&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;default_type&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;application/octet-stream&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;log_format&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;main&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$remote_addr&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$remote_user&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$time_local]&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$request&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                      &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$status&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$body_bytes_sent&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$http_referer&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                      &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$http_user_agent&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$http_x_forwarded_for&amp;#34;&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;access_log&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;/var/log/nginx/access.log&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;main&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;sendfile&lt;/span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;on&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;tcp_nopush&lt;/span&gt;      &lt;span style=&#34;color:#e06c75&#34;&gt;on&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;keepalive_timeout&lt;/span&gt;  &lt;span style=&#34;color:#d19a66&#34;&gt;65&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;include&lt;/code&gt;：引入外部文件&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这里&lt;code&gt;/etc/nginx/mime.types&lt;/code&gt;用于MIME类型配置&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;default_type&lt;/code&gt;：未明确 MIME 类型时的默认类型&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;log_format&lt;/code&gt;：定义日志名称与格式&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;access_log&lt;/code&gt;：指定访问日志的输出路径及格式&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;sendfile&lt;/code&gt;：启用高效文件传输方式&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;tcp_nopush&lt;/code&gt;：优化网络传输性能，避免频繁发送小包&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;keepalive_timeout&lt;/code&gt;：设置长连接超时时间&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;server块&#34;&gt;server块
&lt;/h2&gt;&lt;p&gt;嵌套于http块内部，二级块，可存在多个，用于配置多个虚拟主机&lt;/p&gt;
&lt;p&gt;用于定义单个虚拟主机的配置，通过监听端口和服务器名称对请求进行分发&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;listen&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;80&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server_name&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;localhost&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;listen&lt;/code&gt;：设置监听的端口&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;只有访问主机该端口的请求才会被接受&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;不过得注意，如果使用docker，docker容器一般会把这个端口转发到主机的某个端口上&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;基本用法：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;listen&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;lt;地址&amp;gt;:&amp;lt;端口&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;[参数]&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;地址&lt;/code&gt;&lt;/strong&gt;（可选）：指定绑定的 IP（默认是所有IP）&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;端口&lt;/code&gt;&lt;/strong&gt;：监听的端口&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;参数&lt;/code&gt;&lt;/strong&gt;（可选）：例如&lt;code&gt;default_server&lt;/code&gt;、&lt;code&gt;ssl&lt;/code&gt;、&lt;code&gt;http2&lt;/code&gt; 等（我们后面都会提到）&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;有一个比较特殊的参数：&lt;code&gt;default_server&lt;/code&gt;，用来指定默认的server块，当Nginx收到请求但找不到任何&lt;code&gt;server_name&lt;/code&gt;匹配时，就会使用这个默认配置来处理请求&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span style=&#34;color:yellow;&#34;&gt;&lt;strong&gt;介绍几种常见&lt;code&gt;listen&lt;/code&gt;字段写法：&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;80&lt;/code&gt;：监听所有IP的80端口（80是默认HTTP端口），相当于&lt;code&gt;0.0.0.0:8080&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;127.0.0.1:8080&lt;/code&gt;：仅监听本地回环地址的8080端口&lt;/p&gt;
&lt;p&gt;&lt;code&gt;[::]:80&lt;/code&gt;：IPv6地址监听80端口&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;server_name&lt;/code&gt;：匹配请求的主机名或域名&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;只有请求头中的Host字段符合，Nginx才会把请求交给这个&lt;code&gt;server&lt;/code&gt;块处理&lt;/p&gt;
&lt;p&gt;可以在&lt;code&gt;server_name&lt;/code&gt;中写多个值，也支持通配符&lt;code&gt;*&lt;/code&gt;，也可以使用&lt;code&gt;_&lt;/code&gt;表示任何Host值&lt;/p&gt;
&lt;p&gt;如果不写这个字段，http块又只有一个server，那么这个server块会所有请求都匹配（包括 IP）&lt;/p&gt;
&lt;p&gt;如果不写这个字段，http块又有多个server，那么这个server块会作为默认server，处理未匹配的请求&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;location块&#34;&gt;location块
&lt;/h2&gt;&lt;p&gt;嵌套于server块内部，三级块&lt;/p&gt;
&lt;p&gt;用于对URI（注意不是URL）进行匹配，制定请求的处理方式，如资源路径、代理规则等&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;root&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;/usr/share/nginx/html&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;index&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;index.html&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;index.htm&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;location&lt;/code&gt;：用于匹配客户端请求的URI&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;示例这里是匹配以&lt;code&gt;/&lt;/code&gt;开头的URI（实际上就是匹配所有请求，因为URI就是以&lt;code&gt;/&lt;/code&gt;开头的）&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;此外，Nginx提供多种匹配方式，优先级不同：&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;类型&lt;/th&gt;
          &lt;th&gt;语法&lt;/th&gt;
          &lt;th&gt;示例&lt;/th&gt;
          &lt;th&gt;说明&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;精确匹配&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;=&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;location = /login {}&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;仅匹配 URI 等于 &lt;code&gt;/login&lt;/code&gt; 的请求&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;前缀匹配&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;/&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;location /images/ {}&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;匹配以 &lt;code&gt;/images/&lt;/code&gt; 开头的 URI&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;正则匹配&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;~&lt;/code&gt;（区分大小写）&lt;br /&gt;&lt;code&gt;~*&lt;/code&gt;（不区分大小写）&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;location ~ \.php$ {}&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;使用正则表达式匹配 URI&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;优先匹配&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;^~&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;location ^~ /static/ {}&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;前缀匹配优先于正则匹配&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;root&lt;/code&gt;：设置请求资源的根目录路径&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;当一个请求到达时，Nginx会将请求的URI拼接到这个路径后面，以确定文件的具体位置&lt;/p&gt;
&lt;p&gt;如果客户端访问&lt;code&gt;/index.html&lt;/code&gt;，那么实际访问的是服务器上的&lt;code&gt;/usr/share/nginx/html/index.html&lt;/code&gt;文件&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;index&lt;/code&gt;：指定访问目录时的默认文件名称&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;如果用户访问的是目录而不是具体文件，Nginx会在&lt;code&gt;/usr/share/nginx/html/&lt;/code&gt;目录下按顺序查找：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;index.html&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;index.htm&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;只要找到其中一个文件，就立即返回该文件作为响应；如果都找不到，会返回403（禁止访问）或404（未找到），视配置而定&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;root&lt;/code&gt;和&lt;code&gt;index&lt;/code&gt;也可以直接写在server块里面，作为所有location块的默认值&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span style=&#34;color:yellow;font-size:18px&#34;&gt;&lt;strong&gt;说了这么多，我们最后总结一下&lt;code&gt;listen&lt;/code&gt;、&lt;code&gt;server_name&lt;/code&gt;、&lt;code&gt;location&lt;/code&gt; 三者是如何配合工作的：&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;用户访问浏览器输入：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-url&#34; data-lang=&#34;url&#34;&gt;http://localhost/images/logo.png
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Nginx内部处理流程如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;看端口：&lt;/strong&gt;
该请求是发给哪个端口，是80，那就匹配所有listen 80的server&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;看Host头：&lt;/strong&gt;
Host是localhost，找哪个server_name匹配上了，进入该server块&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;看URI：&lt;/strong&gt;
URI是/images/logo.png，在这个server中找哪个location匹配得最好，执行该location的规则&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;核心功能--web服务&#34;&gt;核心功能 —— Web服务
&lt;/h1&gt;&lt;p&gt;Web 服务是 Nginx 最基础，也是最核心的功能，它能够高效地处理客户端对静态资源的请求&lt;/p&gt;
&lt;p&gt;这主要通过&lt;code&gt;server&lt;/code&gt;块中的&lt;code&gt;root&lt;/code&gt;、&lt;code&gt;index&lt;/code&gt;、&lt;code&gt;location&lt;/code&gt;来协同完成&lt;/p&gt;
&lt;h2 id=&#34;部署静态资源&#34;&gt;部署静态资源
&lt;/h2&gt;&lt;p&gt;可以把Nginx作为静态资源服务器，当用户请求时，Nginx从服务器的指定文件路径中查找并返回对应的文件：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;listen&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;80&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server_name&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;example.com&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;root&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/var/www/my-project/public&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;index&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;index.html&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;index.htm&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;try_files&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$uri&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$uri/&lt;/span&gt; =&lt;span style=&#34;color:#d19a66&#34;&gt;404&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;location&lt;/span&gt; ~&lt;span style=&#34;color:#98c379&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;\.(jpg|jpeg|gif|png|css|js|ico|webp)&lt;/span&gt;$ {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;expires&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;30d&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;try_files $uri $uri/ =404&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这是一个非常强大的指令，常用于处理单页应用（SPA）的路由，它的语法是：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Nginx&#34; data-lang=&#34;Nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;try_files&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;file1&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;file2&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;...&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;final_action&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;file1, file2, ...&lt;/code&gt;：依次判断路径（支持变量），是否存在有效文件或目录&lt;/li&gt;
&lt;li&gt;&lt;code&gt;final_action&lt;/code&gt;：如果前面都没找到，则执行的动作，常用的有：
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;=404&lt;/code&gt;：返回404错误&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@named_location&lt;/code&gt;：跳转到命名的location块&lt;/li&gt;
&lt;li&gt;&lt;code&gt;uri&lt;/code&gt;：重定向到指定URI&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;现在我们看看示例里面的是什么意思：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Nginx&#34; data-lang=&#34;Nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;try_files&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$uri&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$uri/&lt;/span&gt; =&lt;span style=&#34;color:#d19a66&#34;&gt;404&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;$uri&lt;/code&gt;：尝试将URI直接作为文件名进行查找&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;$uri/&lt;/code&gt;：如果上一步失败，则尝试将URI作为一个目录名，并在该目录下查找由&lt;code&gt;index&lt;/code&gt;指令定义的文件&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;=404&lt;/code&gt;：如果前两步都失败，则返回一个404 Not Found错误&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;location ~* \.(jpg|jpeg|gif|png|css|js|ico|webp)$&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这是一个正则匹配，&lt;code&gt;~*&lt;/code&gt;表示不区分大小写的正则，它会匹配所有以上述后缀结尾的请求&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;expires 30d&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;用于设置HTTP响应头中的&lt;code&gt;Expires&lt;/code&gt;和&lt;code&gt;Cache-Control&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;告诉客户端浏览器可以将这些静态资源缓存30天，从而减少不必要的请求，提升后续访问速度&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;url重写与跳转&#34;&gt;URL重写与跳转
&lt;/h2&gt;&lt;p&gt;Nginx支持在&lt;code&gt;location&lt;/code&gt;块内实现URL重写和跳转，常用于：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;伪静态（SEO优化）&lt;/li&gt;
&lt;li&gt;页面重定向&lt;/li&gt;
&lt;li&gt;接口调整兼容&lt;/li&gt;
&lt;li&gt;HTTPS 强制跳转等场景&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;rewrite&#34;&gt;rewrite
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;rewrite&lt;/code&gt;是Nginx实现伪静态、内部跳转的主要方式&lt;/p&gt;
&lt;p&gt;它的本质是把用户请求的路径改写成另一个内部路径，再由Nginx重新处理&lt;/p&gt;
&lt;h4 id=&#34;基本语法&#34;&gt;基本语法
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;rewrite&lt;/span&gt; &amp;lt;&lt;span style=&#34;color:#e06c75&#34;&gt;正则匹配&lt;/span&gt;&amp;gt; &amp;lt;&lt;span style=&#34;color:#e06c75&#34;&gt;重写路径&lt;/span&gt;&amp;gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;flag&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;正则匹配&lt;/strong&gt;：对当前请求URI进行匹配（不包含域名）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;重写路径&lt;/strong&gt;：替换匹配url的新URI，可引用正则中的子表达式&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;flag 可选标志&lt;/strong&gt;：&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;重写方式&lt;/th&gt;
          &lt;th&gt;用法&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;last&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;使用新URI，从头开始匹配&lt;code&gt;location&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;用于常规重写，不会改变浏览器地址栏&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;break&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;使用新URI，但不再重新匹配&lt;code&gt;location&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;跳出&lt;code&gt;rewrite&lt;/code&gt;，在当前&lt;code&gt;location&lt;/code&gt;内继续执行&lt;br /&gt;不会改变浏览器地址栏&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;permanent&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;返回301，永久重定向&lt;/td&gt;
          &lt;td&gt;会改变浏览器地址栏&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;redirect&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;返回302，临时重定向&lt;/td&gt;
          &lt;td&gt;会改变浏览器地址栏&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;伪静态处理&#34;&gt;伪静态处理
&lt;/h4&gt;&lt;p&gt;将 &lt;code&gt;/product/123.html&lt;/code&gt; 重写为 &lt;code&gt;/product.php?id=123&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;rewrite&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;^/product/([0-9]+)\.html&lt;/span&gt;$ &lt;span style=&#34;color:#98c379&#34;&gt;/product.php?id=&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$1&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;last&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;隐藏真实路径&#34;&gt;隐藏真实路径
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/user/&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;rewrite&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;^/user/([a-z]+)&lt;/span&gt;$ &lt;span style=&#34;color:#98c379&#34;&gt;/profile.php?name=&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$1&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;last&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;return&#34;&gt;return
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;return&lt;/code&gt;用于向客户端返回一个特定的状态码和内容，它不会再走&lt;code&gt;rewrite&lt;/code&gt;的内部处理流程&lt;/p&gt;
&lt;p&gt;比起&lt;code&gt;rewrite&lt;/code&gt;，它更适合用于明确的重定向、报错处理等&lt;/p&gt;
&lt;h4 id=&#34;基本语法-1&#34;&gt;基本语法
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;return&lt;/span&gt; &amp;lt;&lt;span style=&#34;color:#e06c75&#34;&gt;状态码&lt;/span&gt;&amp;gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;文本&lt;/span&gt;|&lt;span style=&#34;color:#e06c75&#34;&gt;URL&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;状态码&lt;/strong&gt;：如301（永久重定向）、302（临时重定向）、403（禁止访问）、404（页面不存在）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;文本或URL&lt;/strong&gt;：可返回跳转地址，也可直接返回文本内容（仅在状态码为200时有效）&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;http强制跳转https&#34;&gt;HTTP强制跳转HTTPS
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;listen&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;80&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server_name&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;example.com&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;301&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;https://&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$server_name$request_uri&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这一点我们下面会详细说明&lt;/p&gt;
&lt;h4 id=&#34;禁止访问某个目录&#34;&gt;禁止访问某个目录
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/private/&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;403&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;简洁跳转到首页&#34;&gt;简洁跳转到首页
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;location&lt;/span&gt; = &lt;span style=&#34;color:#98c379&#34;&gt;/&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;301&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/home/index.html&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;纯文本响应&#34;&gt;纯文本响应
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;location&lt;/span&gt; = &lt;span style=&#34;color:#98c379&#34;&gt;/test&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;200&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;Hello.&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;配置https服务&#34;&gt;配置HTTPS服务
&lt;/h2&gt;&lt;p&gt;为网站启用HTTPS可以对客户端和服务器之间的传输数据进行加密，确保数据安全&lt;/p&gt;
&lt;p&gt;配置前，我们需要从证书颁发机构（CA）获取SSL/TLS证书文件和私钥文件&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Nginx&#34; data-lang=&#34;Nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;listen&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;443&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;ssl&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;http2&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server_name&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;yourdomain.com&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;ssl_certificate&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/path/to/fullchain.pem&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;ssl_certificate_key&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/path/to/privkey.pem&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;ssl_session_cache&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;shared:SSL:10m&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;ssl_session_timeout&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;10m&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;ssl_protocols&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;TLSv1.2&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;TLSv1.3&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;ssl_ciphers&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;ssl_prefer_server_ciphers&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;off&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;root&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/var/www/my-project/public&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;index&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;index.html&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;try_files&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$uri&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$uri/&lt;/span&gt; =&lt;span style=&#34;color:#d19a66&#34;&gt;404&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;listen&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;80&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server_name&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;yourdomain.com&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;301&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;https://&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$server_name$request_uri&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;listen 443 ssl http2&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;443&lt;/code&gt;是HTTPS的标准端口&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;ssl&lt;/code&gt;参数表示在此端口上启用SSL/TLS加密&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;http2&lt;/code&gt;参数表示同时启用HTTP/2协议，它可以显著提升页面加载性能&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ssl_certificate&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;指定证书文件的路径，这通常是&lt;code&gt;.pem&lt;/code&gt;或&lt;code&gt;.crt&lt;/code&gt;格式的公钥证书链文件&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ssl_certificate_key&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;指定与证书配对的私钥文件的路径，通常是&lt;code&gt;.key&lt;/code&gt;格式&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ssl_session_cache&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;开启SSL会话缓存，用于复用TLS握手过程，提升性能&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ssl_session_timeout&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;设置SSL会话的有效时间&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ssl_protocols TLSv1.2 TLSv1.3&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;指定只使用安全的TLS协议版本，废弃老旧且不安全的SSLv3, TLSv1.0, TLSv1.1&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ssl_ciphers&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;指定加密时使用的加密套件列表，配置安全的套件可以防止降级攻击&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ssl_prefer_server_ciphers&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;是否优先使用服务器端指定的加密套件，&lt;code&gt;off&lt;/code&gt;表示客户端优先&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;return 301 https://$server_name$request_uri&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;发送一个永久重定向的HTTP状态码&lt;/p&gt;
&lt;p&gt;&lt;code&gt;$server_name&lt;/code&gt;和&lt;code&gt;$request_uri&lt;/code&gt;是Nginx变量，分别代表当前请求的域名和完整的 URI（包含参数）&lt;/p&gt;
&lt;p&gt;这能确保用户访问任何HTTP页面时都能被准确地重定向到对应的HTTPS版本&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;核心功能--反向代理&#34;&gt;核心功能 —— 反向代理
&lt;/h1&gt;&lt;p&gt;反向代理是Nginx的一个核心功能&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Nginx作为一个中间层，接收客户端的请求，再将请求转发给后端服务器处理，然后将响应返回给客户端&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这种方式的好处包括：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;可以隐藏后端服务器的真实地址和结构&lt;/li&gt;
&lt;li&gt;可以统一对外的入口，便于安全控制和运维管理&lt;/li&gt;
&lt;li&gt;可以实现负载均衡、高可用等复杂功能（后续再讲）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;下面是一个最简单的Nginx配置示例，只实现把请求转发到后端服务器的功能：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;listen&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;80&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server_name&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;www.example.com&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_pass&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;http://127.0.0.1:3000&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;proxy_pass http://127.0.0.1:3000;&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span style=&#34;color:red;&#34;&gt;&lt;strong&gt;这是反向代理的核心语句，即将匹配到的请求转发到本机的3000端口，由本地某个服务来实际处理请求&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;默认情况下，Nginx把请求转发给后端时，不会携带原始客户端的信息&lt;/p&gt;
&lt;p&gt;&lt;span style=&#34;color:yellow;&#34;&gt;&lt;strong&gt;如果后端服务要获取用户的真实IP、请求协议、原始域名等信息，就需要使用&lt;code&gt;proxy_set_header&lt;/code&gt;来手动设置&lt;/strong&gt;：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;listen&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;80&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server_name&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;www.example.com&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_pass&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;http://127.0.0.1:3000&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_set_header&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;Host&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$host&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_set_header&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;X-Real-IP&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$remote_addr&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_set_header&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;X-Forwarded-For&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$proxy_add_x_forwarded_for&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_set_header&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;X-Forwarded-Proto&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$scheme&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这些&lt;code&gt;proxy_set_header&lt;/code&gt;是给后端应用用的：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Host $host&lt;/code&gt;&lt;/strong&gt;：原始请求中的主机名&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;X-Real-IP $remote_addr&lt;/code&gt;&lt;/strong&gt;：客户端的真实 IP&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;X-Forwarded-For $proxy_add_x_forwarded_for&lt;/code&gt;&lt;/strong&gt;：经过的所有代理 IP 列表&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;X-Forwarded-Proto $scheme&lt;/code&gt;&lt;/strong&gt;：原始请求的协议（http 或 https）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span style=&#34;color:yellow;&#34;&gt;&lt;strong&gt;如果我们有多个后端服务（比如多个进程、多个机器），可以用&lt;code&gt;upstream&lt;/code&gt;来统一管理后端服务器组&lt;/strong&gt;：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;upstream&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;backend&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;127.0.0.1&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;3000&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#7f848e&#34;&gt;# server 127.0.0.1:3001;     #可以添加多个
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;listen&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;80&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server_name&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;www.example.com&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_pass&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;http://backend&lt;/span&gt;;   &lt;span style=&#34;color:#7f848e&#34;&gt;#&amp;lt;--这里不一样了，使用的是upstream
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_set_header&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;Host&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$host&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_set_header&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;X-Real-IP&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$remote_addr&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_set_header&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;X-Forwarded-For&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$proxy_add_x_forwarded_for&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_set_header&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;X-Forwarded-Proto&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$scheme&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;现在，我们只需要在&lt;code&gt;proxy_pass&lt;/code&gt;中写 &lt;code&gt;http://backend&lt;/code&gt;即可&lt;/p&gt;
&lt;p&gt;具体的地址都集中写在&lt;code&gt;upstream backend&lt;/code&gt;块中，方便管理和负载均衡&lt;/p&gt;
&lt;h1 id=&#34;核心功能--负载均衡&#34;&gt;核心功能 —— 负载均衡
&lt;/h1&gt;&lt;p&gt;当&lt;code&gt;upstream&lt;/code&gt;块中定义了多台&lt;code&gt;server&lt;/code&gt;时，Nginx就自然地成为了一个负载均衡器&lt;/p&gt;
&lt;p&gt;它会根据指定的策略将请求分发到不同的服务器，以分担流量压力&lt;/p&gt;
&lt;h2 id=&#34;http负载均衡配置&#34;&gt;HTTP负载均衡配置
&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Nginx&#34; data-lang=&#34;Nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;upstream&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;backend_cluster&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;backend1.example.com&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;weight=5&lt;/span&gt;; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;backend2.example.com&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;backend3.example.com&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;backup&lt;/span&gt;; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;backend4.example.com&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;down&lt;/span&gt;;   
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;listen&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;80&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_pass&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;http://backend_cluster&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_connect_timeout&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;5s&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_read_timeout&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;10s&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;weight=5&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;为服务器设置权重，在默认的轮询策略下，权重越高的服务器接收到的请求比例就越高&lt;/p&gt;
&lt;p&gt;这里&lt;code&gt;backend1&lt;/code&gt;的请求量大约是&lt;code&gt;backend2&lt;/code&gt;的5倍&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;backup&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;将服务器标记为备用服务器&lt;/p&gt;
&lt;p&gt;只有当所有非备用的主服务器都无法访问时，Nginx才会将请求转发给它&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;down&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;将服务器标记为永久下线，Nginx不会向它转发任何请求&lt;/p&gt;
&lt;p&gt;这通常用于服务器维护&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;proxy_connect_timeout&lt;/code&gt; &amp;amp; &lt;code&gt;proxy_read_timeout&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;设置Nginx与后端服务器建立连接的超时时间和读取响应的超时时间&lt;/p&gt;
&lt;p&gt;可以防止因个别后端服务响应缓慢而导致请求长时间挂起&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;负载均衡策略&#34;&gt;负载均衡策略
&lt;/h3&gt;&lt;h3 id=&#34;轮询&#34;&gt;轮询
&lt;/h3&gt;&lt;p&gt;默认策略，无需任何指令&lt;/p&gt;
&lt;p&gt;请求被按顺序、轮流分发到每台服务器，并考虑权重&lt;/p&gt;
&lt;h3 id=&#34;权重weight&#34;&gt;权重（weight）
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;就像我们之前提到过的例子，&lt;code&gt;weight&lt;/code&gt;越高，分配的请求越多&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;此策略适合后端性能不一致的情况（强机多干活）&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;upstream&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;backend_cluster&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;192.168.0.1&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;weight=3&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;192.168.0.2&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;weight=1&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;上例中，第一个服务器将获得大约75%的请求，第二个约25%&lt;/p&gt;
&lt;h3 id=&#34;ip哈希ip_hash&#34;&gt;IP哈希（ip_hash）
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;根据客户端IP地址的哈希值来选择服务器&lt;/strong&gt;，这能确保来自同一个客户端的请求始终被定向到同一台后端服务器&lt;/p&gt;
&lt;p&gt;此策略对于需要保持用户会话状态的应用非常重要&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Nginx&#34; data-lang=&#34;Nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;upstream&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;backend_cluster&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;ip_hash&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;backend1.example.com&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;backend2.example.com&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;最少连接-least_conn&#34;&gt;最少连接 (least_conn)
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;将新请求发送到当前活动连接数最少的服务器&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;此策略在处理耗时不同或长连接较多的请求时，能使负载分布得更加均匀&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Nginx&#34; data-lang=&#34;Nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;upstream&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;backend_cluster&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;least_conn&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;backend1.example.com&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;backend2.example.com&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;核心功能--tcpudp代理&#34;&gt;核心功能 —— TCP/UDP代理
&lt;/h1&gt;&lt;p&gt;Nginx不仅能代理HTTP，还能通过&lt;code&gt;stream&lt;/code&gt;模块在更底层的传输层（TCP/UDP）进行代理&lt;/p&gt;
&lt;p&gt;例如代理数据库连接、游戏服务器、DNS 查询等&lt;/p&gt;
&lt;p&gt;&lt;code&gt;stream&lt;/code&gt;块必须配置在&lt;code&gt;http&lt;/code&gt;块之外，位于主配置文件的顶层，和&lt;code&gt;http&lt;/code&gt;是平级的&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Nginx&#34; data-lang=&#34;Nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;stream&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;upstream&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;mysql_cluster&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;192.168.1.101&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;3306&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;weight=2&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;192.168.1.102&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;3306&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;listen&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;3307&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_pass&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;mysql_cluster&lt;/span&gt;; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_timeout&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;20s&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;listen&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;53&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;udp&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_pass&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;8.8.8.8&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;53&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;你可以看到，stream块和http块的写法基本上是一样的，但是细节上还是有些不同：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;stream&lt;/code&gt;块不支持&lt;code&gt;location&lt;/code&gt;，没有路径匹配&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;stream&lt;/code&gt;块不解析协议内容，没有&lt;code&gt;proxy_set_header&lt;/code&gt;，只转发原始TCP/UDP数据流&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;stream&lt;/code&gt;块不支持&lt;code&gt;ip_hash&lt;/code&gt;的负载均衡策略&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;日志分析&#34;&gt;日志分析
&lt;/h1&gt;&lt;h2 id=&#34;为何要分析nginx日志&#34;&gt;为何要分析Nginx日志
&lt;/h2&gt;&lt;p&gt;在现代 Web 架构中，Nginx 作为流量的入口，记录着大量有用的信息&lt;/p&gt;
&lt;p&gt;虽然ELK等日志平台功能强大，但并非所有环境都配备&lt;/p&gt;
&lt;p&gt;掌握底层的命令行分析技巧，能让我们在任何服务器上快速、灵活地定位问题&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;注意&lt;/strong&gt;：&lt;/p&gt;
&lt;p&gt;在处理大型日志文件（如 &amp;gt;1GB）时，应避免直接使用&lt;code&gt;cat&lt;/code&gt;读取整个文件，这会消耗大量内存&lt;/p&gt;
&lt;p&gt;应使用&lt;code&gt;head&lt;/code&gt;,&lt;code&gt;tail&lt;/code&gt;,&lt;code&gt;grep&lt;/code&gt;,&lt;code&gt;sed&lt;/code&gt;,&lt;code&gt;awk&lt;/code&gt;等可以流式处理的工具进行查看修改，或先对日志进行切割&lt;/p&gt;
&lt;p&gt;实在想要看全部，也应该选择使用&lt;code&gt;less&lt;/code&gt;或&lt;code&gt;more&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;日志类型与格式&#34;&gt;日志类型与格式
&lt;/h2&gt;&lt;h3 id=&#34;访问日志accesslog&#34;&gt;访问日志（access.log）
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;access.log&lt;/code&gt;记录了每一个对Nginx服务器的HTTP请求的详细信息&lt;/p&gt;
&lt;h4 id=&#34;默认格式combined--main&#34;&gt;默认格式：combined / main
&lt;/h4&gt;&lt;p&gt;Nginx官方默认格式是&lt;code&gt;combined&lt;/code&gt;，不过现在常见的更多是&lt;code&gt;main&lt;/code&gt;（包括之前我们给出的docker容器的nginx）&lt;/p&gt;
&lt;p&gt;其实&lt;code&gt;main&lt;/code&gt;只是自定义的名字，本质和&lt;code&gt;combined&lt;/code&gt;是类似的，甚至很多公司就是直接copy默认的&lt;code&gt;combined&lt;/code&gt;格式起个名叫&lt;code&gt;main&lt;/code&gt;，但更多的则是增加了一些字段（比如新增&lt;code&gt;$http_x_forwarded_for&lt;/code&gt;字段）&lt;/p&gt;
&lt;p&gt;我们就以上文提到的配置文件示例里的&lt;code&gt;main&lt;/code&gt;格式为例，这也是最为常见的格式之一，理解了就行&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Nginx&#34; data-lang=&#34;Nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;log_format&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;main&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$remote_addr&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$remote_user&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$time_local]&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$request&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$status&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$body_bytes_sent&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$http_referer&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$http_user_agent&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$http_x_forwarded_for&amp;#34;&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;access_log&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;/var/log/nginx/access.log&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;main&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;变量名是Nginx内置的变量&lt;/strong&gt;，&lt;strong&gt;不能随意改名字&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;变量&lt;/th&gt;
          &lt;th&gt;解释&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;$remote_addr&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;客户端IP地址&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;$remote_user&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;客户端用户名称&lt;/strong&gt;（用于HTTP认证，通常为&lt;code&gt;-&lt;/code&gt;）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;[$time_local]&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;服务器本地的请求处理完成时间&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;&amp;quot;$request&amp;quot;&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;完整的原始请求行&lt;/strong&gt;，如 &lt;code&gt;&amp;quot;GET /index.html HTTP/1.1&amp;quot;&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;$status&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;HTTP响应状态码&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;$body_bytes_sent&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;发送给客户端的响应体大小&lt;/strong&gt;（字节）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;&amp;quot;$http_referer&amp;quot;&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;请求的来源页面URL&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;&amp;quot;$http_user_agent&amp;quot;&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;客户端的浏览器、操作系统等信息&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;&amp;quot;$http_x_forwarded_for&amp;quot;&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;（重要）&lt;/strong&gt; 记录了&lt;strong&gt;通过代理服务器访问的客户端真实IP地址&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;来看一个实际的main格式的access.log的条目：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;111.111&lt;/span&gt;.&lt;span style=&#34;color:#d19a66&#34;&gt;111.111&lt;/span&gt; - - [&lt;span style=&#34;color:#d19a66&#34;&gt;28&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;Apr&lt;/span&gt;/&lt;span style=&#34;color:#d19a66&#34;&gt;2021&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;14&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;44&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;11&lt;/span&gt; +&lt;span style=&#34;color:#d19a66&#34;&gt;0800&lt;/span&gt;] &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;GET /api/channel/unread.jsp HTTP/1.1&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;200&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;65&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;https://www.xxxx.cn/&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;Mozilla/5.0...&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;123.123.123.123&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$remote_addr&lt;/code&gt;&lt;/strong&gt;：&lt;code&gt;111.111.111.111&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;这是Nginx看到的客户端IP，可能是负载均衡/代理的IP，不一定是真实用户的IP&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$remote_user&lt;/code&gt;&lt;/strong&gt;：&lt;code&gt;- -&lt;/code&gt;
如果客户端经过了HTTP认证，这里会记录认证用户名，否则为&lt;code&gt;-&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;第一个 &lt;code&gt;-&lt;/code&gt;：远程用户名（几乎不用，常为空）&lt;/li&gt;
&lt;li&gt;第二个 &lt;code&gt;-&lt;/code&gt;：认证用户名（如果用 Basic Auth 才会有）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$time_local&lt;/code&gt;&lt;/strong&gt;：&lt;code&gt;28/Apr/2021:14:44:11 +0800&lt;/code&gt;
这是Nginx记录的本地时间，时区为+0800（北京时间）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$request&lt;/code&gt;&lt;/strong&gt;：&lt;code&gt;GET /api/channel/unread.jsp HTTP/1.1&lt;/code&gt;
包含请求方法、URL路径和HTTP协议版本&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$status&lt;/code&gt;&lt;/strong&gt;：&lt;code&gt;200&lt;/code&gt;
HTTP状态码，表示请求成功&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$body_bytes_sent&lt;/code&gt;&lt;/strong&gt;：&lt;code&gt;65&lt;/code&gt;
响应体大小（字节数），不包含响应头&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$http_referer&lt;/code&gt;&lt;/strong&gt;：&lt;code&gt;https://www.xxxx.cn/&lt;/code&gt;
请求来源页面，如果用户是从某个页面跳转过来的，这里会显示该页面URL，若没有则为&lt;code&gt;-&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$http_user_agent&lt;/code&gt;&lt;/strong&gt;：&lt;code&gt;Mozilla/5.0...&lt;/code&gt;
客户端的User-Agent，表示浏览器或客户端的标识信息&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$http_x_forwarded_for&lt;/code&gt;&lt;/strong&gt;：&lt;code&gt;123.123.123.123&lt;/code&gt;
代理服务器通过HTTP头传递的真实客户端IP，用来识别经过代理时的原始用户地址&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;这条日志告诉我们：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;在北京时间&lt;code&gt;021-04-28 14:44:11&lt;/code&gt;，有一个客户端访问了接口&lt;code&gt;/api/channel/unread.jsp&lt;/code&gt;，使用的是&lt;code&gt;GET&lt;/code&gt;请求，HTTP版本是&lt;code&gt;1.1&lt;/code&gt;，返回状态码&lt;code&gt;200&lt;/code&gt;（成功），响应大小&lt;code&gt;65&lt;/code&gt;字节，请求来自页面&lt;code&gt;https://www.xxxx.cn/&lt;/code&gt;，使用的客户端是某个&lt;code&gt;Mozilla浏览器/模拟器&lt;/code&gt;，其真实IP是&lt;code&gt;123.123.123.123&lt;/code&gt;，但请求是经过代理，Nginx看到的源IP是&lt;code&gt;111.111.111.111&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&#34;增强的自定义格式json&#34;&gt;增强的自定义格式：JSON
&lt;/h4&gt;&lt;p&gt;为了便于程序（如 Logstash, Fluentd）解析，JSON格式也是目前的主流选择，属于典型的非默认格式&lt;/p&gt;
&lt;p&gt;它的结构清晰，键值对明确，机器解析友好，避免了&lt;code&gt;awk&lt;/code&gt;和&lt;code&gt;cut&lt;/code&gt;对字段位置的强依赖&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;log_format&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;json_analytics&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;escape=json&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;{&lt;span style=&#34;color:#c678dd&#34;&gt;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&amp;#34;timestamp&amp;#34;:&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$time_iso8601&amp;#34;,&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&amp;#34;client_ip&amp;#34;:&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$remote_addr&amp;#34;,&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&amp;#34;request&amp;#34;:&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$request&amp;#34;,&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&amp;#34;status&amp;#34;:&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$status,&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&amp;#34;bytes_sent&amp;#34;:&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$body_bytes_sent,&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&amp;#34;http_referer&amp;#34;:&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$http_referer&amp;#34;,&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&amp;#34;http_user_agent&amp;#34;:&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$http_user_agent&amp;#34;,&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&amp;#34;real_ip&amp;#34;:&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$http_x_forwarded_for&amp;#34;,&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&amp;#34;request_time&amp;#34;:&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$request_time,&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&amp;#34;upstream_time&amp;#34;:&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$upstream_response_time&amp;#34;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;}&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;access_log&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/var/log/nginx/access.log&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;json_analytics&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;新增字段&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$request_time&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Nginx从接收到请求第一个字节到发送完最后一个字节的总时长（秒），性能指标&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$upstream_response_time&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;从Nginx连接到上游后端服务到接收完响应头的时长，用于判断是 Nginx 慢还是后端服务慢&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;上面一个例子的JSON格式示例如下&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-JSON&#34; data-lang=&#34;JSON&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;#34;timestamp&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;2025-08-16T14:30:00+09:00&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;#34;client_ip&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;111.111.111.111&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;#34;request&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;GET /api/users HTTP/1.1&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;#34;status&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#d19a66&#34;&gt;200&lt;/span&gt;, &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;#34;bytes_sent&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#d19a66&#34;&gt;1500&lt;/span&gt;, &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;#34;http_referer&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;#34;http_user_agent&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;curl/7.68.0&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;#34;real_ip&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;123.123.123.123&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;#34;request_time&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#d19a66&#34;&gt;0.025&lt;/span&gt;, &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;#34;upstream_time&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;0.024&amp;#34;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;JSON日志使用&lt;code&gt;jq&lt;/code&gt;工具可以轻松解析：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;统计状态码为500的请求数量:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cat access.log | jq &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;select(.status == 500)&amp;#39;&lt;/span&gt; | wc -l
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;找出请求时间最长的10个请求：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cat access.log | jq &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;.request_time&amp;#39;&lt;/span&gt; | sort -nr | head -n &lt;span style=&#34;color:#d19a66&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;docker环境下的日志&#34;&gt;Docker环境下的日志
&lt;/h4&gt;&lt;p&gt;上文已经提到过，在Docker中，nginx日志输出到标准输出和标准错误，记录在docker的日志中&lt;/p&gt;
&lt;p&gt;虽然日志本身的格式不会变，但Docker的日志驱动可能（取决于设置）会在每行日志前添加额外信息：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;[时间戳]&lt;/span&gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;日志流&lt;/span&gt;] [&lt;span style=&#34;color:#e06c75&#34;&gt;原始日志内容&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;字段&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
          &lt;th&gt;示例&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;时间戳&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;Docker记录该日志的时间，精确到纳秒&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;2025-08-20T02:30:00.123456789Z&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;日志流&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;指明日志来源：&lt;br /&gt;标准输出：&lt;code&gt;stdout&lt;/code&gt;，对应访问日志&lt;br /&gt;标准错误：stderr`，对应错误日志&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;stdout&lt;/code&gt;或&lt;code&gt;stderr&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;实际Docker日志示例（还是上面的例子）&lt;/strong&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;2025&lt;/span&gt;-&lt;span style=&#34;color:#d19a66&#34;&gt;08&lt;/span&gt;-&lt;span style=&#34;color:#d19a66&#34;&gt;16&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;T05&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;45&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;01.123456789&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;Z&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;stdout&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;F&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;111.111&lt;/span&gt;.&lt;span style=&#34;color:#d19a66&#34;&gt;111.111&lt;/span&gt; - - [&lt;span style=&#34;color:#d19a66&#34;&gt;28&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;Apr&lt;/span&gt;/&lt;span style=&#34;color:#d19a66&#34;&gt;2021&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;14&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;44&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;11&lt;/span&gt; +&lt;span style=&#34;color:#d19a66&#34;&gt;0800&lt;/span&gt;] &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;GET /api/channel/unread.jsp HTTP/1.1&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;200&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;65&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;https://www.xxxx.cn/&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;Mozilla/5.0...&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;123.123.123.123&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;2025-08-16T05:45:01.123456789Z&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Docker捕获日志的UTC时间（纳秒精度）&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;stdout F&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;日志来源是stdout，并且标记为F，表示一行完整日志&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;此外还有P标记，示这是多行日志的一部分，被拆分了，需要和后续/前面的片段合并&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;可以直接通过管道分析&lt;code&gt;docker logs&lt;/code&gt;的输出，但通常会配置Docker的日志驱动将这些日志流自动转发到集中的日志管理平台进行统一分析&lt;/p&gt;
&lt;p&gt;比如，&lt;strong&gt;统计客户端IP出现次数的前10：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker logs nginx | awk &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;{print $4}&amp;#39;&lt;/span&gt; | sort | uniq -c | sort -nr | head -n &lt;span style=&#34;color:#d19a66&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;错误日志errorlog&#34;&gt;错误日志（error.log）
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;error.log&lt;/code&gt; 记录 Nginx 启动和运行过程中的诊断信息，是排查问题的关键。&lt;/p&gt;
&lt;h4 id=&#34;一般格式&#34;&gt;一般格式
&lt;/h4&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;时间戳 [错误级别] pid#tid: *cid 错误描述, client: 客户端IP, server: 服务端, request: &amp;#34;请求行&amp;#34;, host: &amp;#34;Host&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;字段&lt;/th&gt;
          &lt;th&gt;说明&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;时间戳&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;错误发生时间&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;[错误级别]&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;当前条目错误的错误等级，具体看：&lt;a class=&#34;link&#34; href=&#34;#%e5%85%a8%e5%b1%80%e5%9d%97&#34; &gt;错误等级
    
&lt;/a&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;pid#tid&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;Nginx工作进程ID和线程ID&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;*&lt;strong&gt;cid&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;客户端连接序列号&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;错误描述&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;具体的错误信息，例如&lt;code&gt;connect() to 127.0.0.1:9000 failed (13: Permission denied)&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;client&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;发生错误的客户端IP&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;server&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;请求的服务端&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;request&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;请求行，如&amp;quot;GET /api HTTP/1.1&amp;quot;`&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;host&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;客户端请求的目标主机名&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;具体示例：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;2025&lt;/span&gt;/&lt;span style=&#34;color:#d19a66&#34;&gt;08&lt;/span&gt;/&lt;span style=&#34;color:#d19a66&#34;&gt;16&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;14&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;35&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;00&lt;/span&gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;crit&lt;/span&gt;] &lt;span style=&#34;color:#d19a66&#34;&gt;12345&lt;/span&gt;#&lt;span style=&#34;color:#d19a66&#34;&gt;12345&lt;/span&gt;: *&lt;span style=&#34;color:#d19a66&#34;&gt;6789&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;connect&lt;/span&gt;() &lt;span style=&#34;color:#e06c75&#34;&gt;to&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;127.0&lt;/span&gt;.&lt;span style=&#34;color:#d19a66&#34;&gt;0.1&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;9000&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;failed&lt;/span&gt; (&lt;span style=&#34;color:#d19a66&#34;&gt;13&lt;/span&gt;: &lt;span style=&#34;color:#e06c75&#34;&gt;Permission&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;denied&lt;/span&gt;) &lt;span style=&#34;color:#c678dd&#34;&gt;while&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;connecting&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;to&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;upstream&lt;/span&gt;, &lt;span style=&#34;color:#e06c75&#34;&gt;client&lt;/span&gt;: &lt;span style=&#34;color:#d19a66&#34;&gt;192.168&lt;/span&gt;.&lt;span style=&#34;color:#d19a66&#34;&gt;1.10&lt;/span&gt;, &lt;span style=&#34;color:#e06c75&#34;&gt;server&lt;/span&gt;: &lt;span style=&#34;color:#e06c75&#34;&gt;example&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;com&lt;/span&gt;, &lt;span style=&#34;color:#e06c75&#34;&gt;request&lt;/span&gt;: &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;GET /api HTTP/1.1&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e06c75&#34;&gt;host&lt;/span&gt;: &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;example.com&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;时间戳&lt;/strong&gt;：&lt;code&gt;2025/08/16 14:35:00&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;错误级别&lt;/strong&gt;：&lt;code&gt;crit&lt;/code&gt;（严重错误）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;pid#tid&lt;/strong&gt;：&lt;code&gt;12345#12345&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;*&lt;strong&gt;cid&lt;/strong&gt;：&lt;code&gt;*6789&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;错误描述&lt;/strong&gt;：&lt;code&gt;connect() to 127.0.0.1:9000 failed (13: Permission denied) while connecting to upstream&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;客户端&lt;/strong&gt;：&lt;code&gt;192.168.1.10&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;服务端&lt;/strong&gt;：&lt;code&gt;example.com&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;请求&lt;/strong&gt;：&lt;code&gt;&amp;quot;GET /api HTTP/1.1&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Host&lt;/strong&gt;：&lt;code&gt;example.com&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;分析&lt;/strong&gt;：&lt;/p&gt;
&lt;p&gt;客户端&lt;code&gt;192.168.1.10&lt;/code&gt;请求 &lt;code&gt;/api&lt;/code&gt;接口时，Nginx尝试连接上游服务&lt;code&gt;127.0.0.1:9000&lt;/code&gt;失败，原因是权限被拒绝（&lt;code&gt;Permission denied&lt;/code&gt;）。日志级别为 &lt;code&gt;crit&lt;/code&gt;，说明这是严重错误，需要检查Nginx或上游服务的权限设置&lt;/p&gt;
&lt;h2 id=&#34;分析技巧&#34;&gt;分析技巧
&lt;/h2&gt;&lt;h3 id=&#34;网站流量核心指标分析-pv--uv&#34;&gt;网站流量核心指标分析 (PV &amp;amp; UV)
&lt;/h3&gt;&lt;p&gt;PV (Page View，页面浏览量) 和 UV (Unique Visitor，独立访客) 是衡量网站价值和用户行为趋势的重要指标&lt;/p&gt;
&lt;h4 id=&#34;统计总uv-根据ip&#34;&gt;统计总UV (根据IP)
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;提取第1个字段(IP)，排序，去重，最后统计独立IP总数：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;awk &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;{print $1}&amp;#39;&lt;/span&gt; access.log | sort | uniq | wc -l
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;统计总pv&#34;&gt;统计总PV
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;直接统计日志总行数即为PV：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wc -l access.log
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;统计某时间段的uv--pv&#34;&gt;统计某时间段的UV / PV
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;统计2021年4月28日14:00-14:59的UV：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;grep &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;28/Apr/2021:14&amp;#34;&lt;/span&gt; access.log | awk &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;{print $1}&amp;#39;&lt;/span&gt; | sort | uniq | wc -l
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;使用sed进行更精确的时间段筛选 (14点到20点)：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sed -n &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;/28\/Apr\/2021:14/,/28\/Apr\/2021:20/p&amp;#39;&lt;/span&gt; access.log | awk &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;{print $1}&amp;#39;&lt;/span&gt; | sort | uniq | wc -l
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;访问来源与异常排查-ip--url&#34;&gt;访问来源与异常排查 (IP &amp;amp; URL)
&lt;/h3&gt;&lt;p&gt;用于判断是否被攻击、接口是否存在Bug或排查流量报警&lt;/p&gt;
&lt;h4 id=&#34;查询访问最频繁的top-10-url&#34;&gt;查询访问最频繁的Top 10 URL
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;提取第7字段(URL)，排序，去重并计数，按计数值倒序排列:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;awk &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;{print $7}&amp;#39;&lt;/span&gt; access.log | sort | uniq -c | sort -k1 -nr | head -n &lt;span style=&#34;color:#d19a66&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;查询访问最频繁的top-10-ip&#34;&gt;查询访问最频繁的Top 10 IP
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;awk &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;{print $1}&amp;#39;&lt;/span&gt; access.log | sort | uniq -c | sort -k1 -nr | head -n &lt;span style=&#34;color:#d19a66&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;查看指定ip在某天访问了哪些-url-top-10&#34;&gt;查看指定IP在某天访问了哪些 URL (Top 10)
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;grep &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;111.111.111.111&amp;#34;&lt;/span&gt; access.log | grep &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;28/Apr/2021&amp;#34;&lt;/span&gt; | awk &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;{print $7}&amp;#39;&lt;/span&gt; | sort | uniq -c | sort -nr | head -n &lt;span style=&#34;color:#d19a66&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;性能与爬虫分析&#34;&gt;性能与爬虫分析
&lt;/h3&gt;&lt;h4 id=&#34;统计爬取次数&#34;&gt;统计爬取次数
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;grep -i &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;spider\|bot&amp;#39;&lt;/span&gt; access.log | wc -l
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;统计每分钟每秒的请求数-top-20&#34;&gt;统计每分钟/每秒的请求数 (Top 20)
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;每分钟: 截取时间字段($4)的第2到18位(到分钟)&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;awk &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;{print $4}&amp;#39;&lt;/span&gt; access.log | cut -c 2-18 | sort | uniq -c | sort -nr | head -n &lt;span style=&#34;color:#d19a66&#34;&gt;20&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;每秒: 截取时间字段($4)的第2到21位(到秒)&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;awk &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;{print $4}&amp;#39;&lt;/span&gt; access.log | cut -c 2-21 | sort | uniq -c | sort -nr | head -n &lt;span style=&#34;color:#d19a66&#34;&gt;20&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;分析请求响应时间-需自定义日志格式&#34;&gt;分析请求响应时间 (需自定义日志格式)
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;前提&lt;/strong&gt;: 确保&lt;code&gt;log_format&lt;/code&gt;中包含了&lt;code&gt;$request_time&lt;/code&gt;，我们假设它在最后一个字段&lt;/p&gt;
&lt;h4 id=&#34;列出传输时间超过3秒的top10请求&#34;&gt;列出传输时间超过3秒的Top10请求
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;$NF代表最后一个字段，此命令筛选出最后一个字段值大于3的行：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;awk &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;$NF &amp;gt; 3 {print $NF, $7}&amp;#39;&lt;/span&gt; access.log | sort -k1 -nr | head -n &lt;span style=&#34;color:#d19a66&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;列出最耗时的top10请求&#34;&gt;列出最耗时的Top10请求
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;awk &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;{print $NF, $7}&amp;#39;&lt;/span&gt; access.log | sort -k1 -nr | head -n &lt;span style=&#34;color:#d19a66&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;p&gt;暂时就先讲到这，毕竟只是入个门，详细使用就在实践里面学习吧&lt;/p&gt;
&lt;p&gt;如果之后我需要更加深入使用，这篇文章也会更新的~&lt;/p&gt;
</description>
        </item>
        <item>
        <title>快速上手docker</title>
        <link>https://blog.928330.xyz/p/%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8Bdocker/</link>
        <pubDate>Wed, 23 Jul 2025 19:24:02 +0800</pubDate>
        
        <guid>https://blog.928330.xyz/p/%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8Bdocker/</guid>
        <description>&lt;img src="http://picture.928330.xyz/typora/docker.jpg" alt="Featured image of post 快速上手docker" /&gt;&lt;p&gt;&lt;span style=&#34;color:aqua;font-size:20px&#34;&gt;本教程针对的是linux环境下的docker&lt;/span&gt;&lt;/p&gt;
&lt;h1 id=&#34;docker简介&#34;&gt;Docker简介
&lt;/h1&gt;&lt;h2 id=&#34;什么是docker&#34;&gt;什么是Docker
&lt;/h2&gt;&lt;p&gt;Docker是一个开源的容器化平台，旨在简化应用程序的开发、交付和运行&lt;/p&gt;
&lt;p&gt;它允许开发者将应用程序及其所有依赖项打包到一个轻量级的、可移植的容器中，从而确保在不同环境中都能一致地运行&lt;/p&gt;
&lt;p&gt;容器之间是隔离的，像一个个小型的沙箱&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;一句话&lt;/strong&gt;：Docker就像一个轻量级虚拟机，可以在不同的环境中快速部署运行同样的应用程序&lt;/p&gt;
&lt;h2 id=&#34;docker的主要概念&#34;&gt;Docker的主要概念
&lt;/h2&gt;&lt;h3 id=&#34;容器container&#34;&gt;容器（Container）
&lt;/h3&gt;&lt;p&gt;容器是Docker的核心，&lt;strong&gt;它就像是一个隔离的小程序环境，打包了应用运行所需的一切&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;与传统虚拟机相比，容器不需要包含整个操作系统，只共享宿主机内核，因此占用资源小、启动速度快&lt;/p&gt;
&lt;p&gt;无论在本地、测试环境，还是部署到服务器，运行结果都一致&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;每个容器互相隔离，修改不会影响宿主机或其他容器&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;比如，运行一个Python应用的容器，就像在一个只包含Python的迷你Linux系统里运行它&lt;/p&gt;
&lt;h3 id=&#34;镜像image&#34;&gt;镜像（Image）
&lt;/h3&gt;&lt;p&gt;镜像是构建容器的模板或快照，可以理解为包含了&lt;strong&gt;系统环境+应用程序代码+配置&lt;/strong&gt;的“包”&lt;/p&gt;
&lt;p&gt;镜像一经创建就不变，部署更可靠&lt;/p&gt;
&lt;p&gt;比如我们下载&lt;code&gt;nginx&lt;/code&gt;这个镜像，然后就能启动一个&lt;code&gt;nginx&lt;/code&gt;容器，&lt;strong&gt;就像虚拟机的快照和启动运行&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;即使我们更改了容器，镜像也不会改变，我们也可以把改动的容器制作为新的镜像，类似拍摄快照&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;一个镜像可以启动成多个容器，就像一个类能被实例化成多个对象&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;dockerfile&#34;&gt;Dockerfile
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;它是用来构建镜像的配置脚本&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;里面写入了构建命令，如基于哪个镜像、复制哪些文件、安装哪些软件等&lt;/p&gt;
&lt;p&gt;使用&lt;code&gt;docker build&lt;/code&gt;命令可以将&lt;code&gt;Dockerfile&lt;/code&gt;构建成镜像，然后启动对应的容器&lt;/p&gt;
&lt;h3 id=&#34;仓库registry&#34;&gt;仓库（Registry）
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;存储和分发镜像的平台&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;比如DockerHub，就是Docker官方提供的镜像仓库平台（类似GitHub），有很多官方镜像可以免费下载&lt;/p&gt;
&lt;h1 id=&#34;systemctl命令使用&#34;&gt;systemctl命令使用
&lt;/h1&gt;&lt;p&gt;&lt;code&gt;systemctl&lt;/code&gt;是现代Linux发行版中核心的系统和服务管理器&lt;/p&gt;
&lt;p&gt;它负责启动、停止、检查和管理系统上的各种后台服务（也称为守护进程）&lt;/p&gt;
&lt;p&gt;在使用任何Docker命令之前，必须确保Docker的后台服务正在运行&lt;/p&gt;
&lt;p&gt;接下来我们将以Docker服务为例结合介绍它的各种命令&lt;/p&gt;
&lt;h2 id=&#34;服务的生命周期管理&#34;&gt;服务的生命周期管理
&lt;/h2&gt;&lt;p&gt;这是 &lt;code&gt;systemctl&lt;/code&gt;最核心的功能，用于控制一个服务的运行、停止和重启等&lt;/p&gt;
&lt;h3 id=&#34;启动服务&#34;&gt;启动服务
&lt;/h3&gt;&lt;p&gt;当一个服务处于停止状态时，使用&lt;code&gt;start&lt;/code&gt;命令来启动它&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl start 服务名称
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;eg：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl start docker
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;此命令会启动Docker服务，Docker守护进程会在后台开始运行，准备接收和处理Docker相关的命令&lt;/p&gt;
&lt;p&gt;通常执行此类操作需要管理员权限&lt;/p&gt;
&lt;h3 id=&#34;停止服务&#34;&gt;停止服务
&lt;/h3&gt;&lt;p&gt;停止一个正在运行的服务&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl stop 服务名称
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;eg：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl stop docker
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;此命令会向Docker服务发送停止信号，使其安全地终止&lt;/p&gt;
&lt;p&gt;对于Docker来说，这意味着Docker守护进程会关闭，所有通过该守护进程运行的容器也会停止&lt;/p&gt;
&lt;h3 id=&#34;重启服务&#34;&gt;重启服务
&lt;/h3&gt;&lt;p&gt;这是一个便捷的组合命令，相当于先停止服务再立即启动它&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;这在修改了服务的配置文件后，需要让新配置生效时非常有用&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl restart 服务名称
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;eg：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl restart docker
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;如果修改了Docker的配置文件（例如 &lt;code&gt;/etc/docker/daemon.json&lt;/code&gt;），执行此命令会重启 Docker 服务，使其加载并应用新的配置&lt;/p&gt;
&lt;h3 id=&#34;重新加载服务配置&#34;&gt;重新加载服务配置
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;在不中断服务的情况下，重新加载其配置文件&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl reload 服务名称
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;eg：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl reload docker
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这个命令比&lt;code&gt;restart&lt;/code&gt;更为温和，它会请求服务重新读取其配置文件，而不会终止正在运行的主进程&lt;/p&gt;
&lt;p&gt;但是，并非所有服务都支持&lt;code&gt;reload&lt;/code&gt;操作，如果服务不支持此操作，&lt;code&gt;systemctl&lt;/code&gt;可能会转而执行&lt;code&gt;restart&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Docker服务通常建议使用&lt;code&gt;restart&lt;/code&gt;而不是&lt;code&gt;reload&lt;/code&gt;来应用配置更改&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;服务的状态与信息查看&#34;&gt;服务的状态与信息查看
&lt;/h2&gt;&lt;h3 id=&#34;查看服务详细状态&#34;&gt;查看服务详细状态
&lt;/h3&gt;&lt;p&gt;获取一个服务的全面信息，包括它是否正在运行、最近的日志、进程ID (PID) 等&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl status 服务名称
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;eg：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl status docker
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这是排查服务问题的首选&lt;/p&gt;
&lt;p&gt;它会清晰地显示服务的&lt;code&gt;active&lt;/code&gt;状态，如 &lt;code&gt;active (running)&lt;/code&gt; 或 &lt;code&gt;inactive (dead)&lt;/code&gt;），并附带最近几条相关的日志记录&lt;/p&gt;
&lt;h3 id=&#34;检查服务是否正在运行&#34;&gt;检查服务是否正在运行
&lt;/h3&gt;&lt;p&gt;快速检查一个服务当前是否处于活动状态&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl is-active 服务名称
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;eg：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl is-active docker
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;此命令的返回值非常简洁：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;如果服务正在运行，它会输出&lt;code&gt;active&lt;/code&gt;并返回状态码 0&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;如果服务未运行，它会输出&lt;code&gt;inactive&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这在编写自动化脚本时很有用，可以根据返回值来判断是否需要执行某些操作&lt;/p&gt;
&lt;h2 id=&#34;服务的开机自启动管理&#34;&gt;服务的开机自启动管理
&lt;/h2&gt;&lt;h3 id=&#34;设置开机自启动&#34;&gt;设置开机自启动
&lt;/h3&gt;&lt;p&gt;将一个服务设置为在系统启动时自动运行&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl &lt;span style=&#34;color:#e5c07b&#34;&gt;enable&lt;/span&gt; 服务名称
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;eg：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl &lt;span style=&#34;color:#e5c07b&#34;&gt;enable&lt;/span&gt; docker
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;执行此命令后，&lt;code&gt;systemd&lt;/code&gt;会创建必要的符号链接，确保下次系统启动时，Docker服务会自动启动&lt;/p&gt;
&lt;p&gt;这是一个一次性的设置，之后无需再手动启动&lt;/p&gt;
&lt;h3 id=&#34;禁止开机自启动&#34;&gt;禁止开机自启动
&lt;/h3&gt;&lt;p&gt;取消一个服务的开机自启动设置&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl disable 服务名称
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;eg：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl disable docker
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;此命令会移除&lt;code&gt;enable&lt;/code&gt;命令创建的符号链接，下次系统重启后，Docker服务将不会自动运行&lt;/p&gt;
&lt;p&gt;这并不会影响当前正在运行的服务状态&lt;/p&gt;
&lt;h3 id=&#34;检查服务是否开机自启动&#34;&gt;检查服务是否开机自启动
&lt;/h3&gt;&lt;p&gt;查看一个服务当前是否被设置为开机自启动&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl is-enabled 服务名称
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;eg：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl is-enabled docker
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;此命令会返回 &lt;code&gt;enabled&lt;/code&gt; (已设置) 或 &lt;code&gt;disabled&lt;/code&gt; (未设置)&lt;/p&gt;
&lt;h1 id=&#34;docker更改源&#34;&gt;Docker更改源
&lt;/h1&gt;&lt;p&gt;不知道为什么国内忽然无法访问官方的镜像仓库了，为了加快Docker镜像的下载速度，我们通常需要将 Docker的默认源&lt;code&gt;registry.docker.io&lt;/code&gt;更换为国内的镜像加速源&lt;/p&gt;
&lt;h2 id=&#34;检查安装状态&#34;&gt;检查安装状态
&lt;/h2&gt;&lt;p&gt;首先要确认你的系统已正确安装了Docker，可以执行：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker --version
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;返回的是docker版本，确认无误后继续&lt;/p&gt;
&lt;h2 id=&#34;编辑配置文件&#34;&gt;编辑配置文件
&lt;/h2&gt;&lt;p&gt;Docker 的镜像源配置文件通常位于&lt;code&gt;/etc/docker/daemon.json&lt;/code&gt;，如果文件不存在，可以手动创建&lt;/p&gt;
&lt;p&gt;使用任意文本编辑器打开，例如使用vim（不知道怎么使用vim的可以看一眼：&lt;a class=&#34;link&#34; href=&#34;http://blog.928330.xyz/p/vim%E7%BC%96%E8%BE%91%E5%99%A8%E5%AE%8C%E5%85%A8%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;vim使用教程
    
    &lt;span style=&#34;white-space: nowrap;&#34;&gt;&lt;svg width=&#34;.7em&#34;
        height=&#34;.7em&#34; viewBox=&#34;0 0 21 21&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;
        &lt;path d=&#34;m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z&#34; fill=&#34;currentColor&#34; /&gt;
        &lt;path d=&#34;M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z&#34;
            fill=&#34;currentColor&#34;&gt;
    &lt;/svg&gt;&lt;/span&gt;
    
&lt;/a&gt;）：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vim /etc/docker/daemon.json
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;然后将内容修改为以下格式：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;#34;registry-mirrors&amp;#34;&lt;/span&gt;: [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    	&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;https://&amp;lt;加速地址1&amp;gt;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;https://&amp;lt;加速地址2&amp;gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;当然你还能添加更多加速地址，但是注意最后一个加速地址后面就不能有逗号了&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;b站up:大海资源&lt;/strong&gt;整理的当前可用的国内镜像源：https://www.dhzy.fun/archives/6852.html&lt;/p&gt;
&lt;h2 id=&#34;重启服务-1&#34;&gt;重启服务
&lt;/h2&gt;&lt;p&gt;修改完配置后，需要重启 Docker 服务以使配置生效：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl restart docker
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;验证是否生效&#34;&gt;验证是否生效
&lt;/h2&gt;&lt;p&gt;可以执行如下命令查看当前镜像加速器配置是否生效：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker info | grep -A &lt;span style=&#34;color:#d19a66&#34;&gt;10&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;Registry Mirrors&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;从输出中查找包含&lt;code&gt;Registry Mirrors&lt;/code&gt;的那一行，并显示它后面10行&lt;/p&gt;
&lt;p&gt;如果是下面这样的输出，说明配置成功了：&lt;/p&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250722202433203&#34; href=&#34;http://picture.928330.xyz/typora/image-20250722202433203.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250722202433203.png&#34; alt=&#34;image-20250722202433203&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h2 id=&#34;注意事项&#34;&gt;注意事项
&lt;/h2&gt;&lt;p&gt;修改配置文件时要确保JSON格式正确，例如逗号不能多不能少&lt;/p&gt;
&lt;p&gt;有些加速源如阿里云需要登录账号并绑定使用，获取专属地址&lt;/p&gt;
&lt;p&gt;如果使用的是非systemd系统，要使用service命令重启Docker&lt;/p&gt;
&lt;h1 id=&#34;docker使用&#34;&gt;Docker使用
&lt;/h1&gt;&lt;h2 id=&#34;镜像管理&#34;&gt;镜像管理
&lt;/h2&gt;&lt;h3 id=&#34;查找镜像&#34;&gt;查找镜像
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker search &amp;lt;镜像名称&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;docker search&lt;/code&gt;使用的是DockerHub的HTTP API，没有镜像源概念，无法走国内加速&lt;/p&gt;
&lt;p&gt;如果无法访问，必须使用代理，或者通过别的方式访问官网：https://hub.docker.com/&lt;/p&gt;
&lt;h3 id=&#34;拉取镜像&#34;&gt;拉取镜像
&lt;/h3&gt;&lt;p&gt;从仓库中下载一个镜像到你的本地机器&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker pull &amp;lt;镜像名称&amp;gt;:&amp;lt;标签&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;镜像名称&lt;/strong&gt;：想要下载的软件，例如&lt;code&gt;nginx&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;标签&lt;/strong&gt; ：通常用来表示软件的版本，例如&lt;code&gt;latest&lt;/code&gt;表示最新版，&lt;code&gt;1.21&lt;/code&gt;表示特定版本&lt;/p&gt;
&lt;p&gt;​           如果省略标签，Docker 会默认使用&lt;code&gt;latest&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;eg：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker pull nginx:latest
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;此命令会从镜像源下载最新版本的Nginx镜像&lt;/p&gt;
&lt;h3 id=&#34;查看本地镜像&#34;&gt;查看本地镜像
&lt;/h3&gt;&lt;p&gt;列出所有已经下载到本地计算机上的镜像&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker images
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250722204915819&#34; href=&#34;http://picture.928330.xyz/typora/image-20250722204915819.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250722204915819.png&#34; alt=&#34;image-20250722204915819&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;REPOSITORY&lt;/strong&gt;：仓库名&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;TAG&lt;/strong&gt; ：标签&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;IMAGE ID&lt;/strong&gt;：镜像的唯一ID&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;CREATED&lt;/strong&gt;：创建时间&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;SIZE&lt;/strong&gt;：镜像大小&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;保存更改的镜像&#34;&gt;保存更改的镜像
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker commit &lt;span style=&#34;color:#56b6c2&#34;&gt;[&lt;/span&gt;选项&lt;span style=&#34;color:#56b6c2&#34;&gt;]&lt;/span&gt; &amp;lt;容器ID&amp;gt;/&amp;lt;容器名称&amp;gt; &amp;lt;镜像名称&amp;gt;:&amp;lt;标签&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;常用选项：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;-m &amp;quot;提交信息&amp;quot;&lt;/code&gt;&lt;/strong&gt;：&lt;strong&gt;为此次操作添加描述性说明&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;类似于 Git 的 commit message，便于记录修改内容&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;-a &amp;quot;作者&amp;quot;&lt;/code&gt;&lt;/strong&gt;：&lt;strong&gt;指定作者信息&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;方便追踪是谁进行了修改或创建操作&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;eg：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker commit -m&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;update&amp;#34;&lt;/span&gt; -a&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;kakahuote&amp;#34;&lt;/span&gt; 8950b5741b30 mynginx:mod
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这个命令会执行以下操作：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;把名为&lt;code&gt;8950b5741b30&lt;/code&gt;的容器保存为一个新的镜像&lt;/li&gt;
&lt;li&gt;添加说明信息&lt;code&gt;&amp;quot;update&amp;quot;&lt;/code&gt;，记录镜像的更改内容&lt;/li&gt;
&lt;li&gt;指定作者为&lt;code&gt;kakahuote&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;创建一个名为&lt;code&gt;mynginx&lt;/code&gt;、标签为&lt;code&gt;mod&lt;/code&gt;的新镜像&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250723135839721&#34; href=&#34;http://picture.928330.xyz/typora/image-20250723135839721.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250723135839721.png&#34; alt=&#34;image-20250723135839721&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h3 id=&#34;删除镜像&#34;&gt;删除镜像
&lt;/h3&gt;&lt;p&gt;当某个镜像不再需要时，可以将其从本地删除以释放磁盘空间&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker rmi &amp;lt;镜像ID&amp;gt;/&amp;lt;镜像名称&amp;gt;:&amp;lt;标签&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;只能删除没有被任何容器（包括已停止的容器）使用的镜像&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;如果需要删除一个被使用的镜像，必须先删除所有依赖它的容器&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;也可以使用&lt;code&gt;-f&lt;/code&gt;选项强制删除，但这可能会导致依赖该镜像的容器无法再次启动或者其他未知错误，慎用！&lt;/p&gt;
&lt;p&gt;如果不指定标签，默认删除的会是&lt;code&gt;latest&lt;/code&gt;标签，如果没有&lt;code&gt;latest&lt;/code&gt;则会报错，所以&lt;strong&gt;建议指定标签删除&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;eg：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker rmi mynginx:mod
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250723140153114&#34; href=&#34;http://picture.928330.xyz/typora/image-20250723140153114.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250723140153114.png&#34; alt=&#34;image-20250723140153114&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h2 id=&#34;容器管理&#34;&gt;容器管理
&lt;/h2&gt;&lt;h3 id=&#34;创建并运行容器&#34;&gt;创建并运行容器
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker run &lt;span style=&#34;color:#56b6c2&#34;&gt;[&lt;/span&gt;选项&lt;span style=&#34;color:#56b6c2&#34;&gt;]&lt;/span&gt; &amp;lt;镜像名称&amp;gt;:&amp;lt;标签&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;常用选项：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;--name&lt;/code&gt;&lt;/strong&gt;：&lt;strong&gt;为容器指定一个自定义的名称&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;如果省略，Docker会自动生成一个随机名称&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;-d&lt;/code&gt;&lt;/strong&gt;：&lt;strong&gt;以分离模式在后台运行容器&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这对于运行像Web服务器这样的长期服务很重要，否则容器会占据你的终端进行输出和报错等行为&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;-P&lt;/code&gt;(大写)&lt;/strong&gt;：将容器内部所有暴露的端口&lt;strong&gt;随机映射&lt;/strong&gt;到主机的空闲端口上&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;-p&lt;/code&gt;(小写)&lt;/strong&gt;：&lt;strong&gt;指定端口映射&lt;/strong&gt;，其常用格式如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;主机端口:容器端口&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker run -d -p 8080:80 nginx
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;此命令将主机的&lt;code&gt;8080&lt;/code&gt;端口映射到容器的&lt;code&gt;80&lt;/code&gt;端口&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;&amp;lt;IP地址&amp;gt;:主机端口:容器端口&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;指定只将主机的特定IP地址的端口映射到容器&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker run -d -p 127.0.0.1:8081:80 nginx
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;此命令将主机&lt;code&gt;127.0.0.1&lt;/code&gt;这个回环地址的&lt;code&gt;8081&lt;/code&gt;端口映射到容器的&lt;code&gt;80&lt;/code&gt;端口&lt;/p&gt;
&lt;p&gt;这样，只有在本机才能通过&lt;code&gt;127.0.0.1:8081&lt;/code&gt;访问，来自外部网络的访问会被拒绝&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;主机端口:&amp;lt;容器端口/协议&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;默认情况下，端口映射使用的是TCP协议，也可以显式指定UDP协议&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Pdocker run -d -p 8082:53/udp nginx
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;此命令将主机的&lt;code&gt;8082&lt;/code&gt;端口映射到nginx容器的&lt;code&gt;53&lt;/code&gt;UDP端口&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;--rm&lt;/code&gt;&lt;/strong&gt;：&lt;strong&gt;使容器在停止后被自动删除&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;适合用于测试和运行一次性任务&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;eg：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker run --name my-nginx -d -p 8080:80 nginx
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这个命令会执行以下操作：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;检查本地是否存在&lt;code&gt;nginx:latest&lt;/code&gt;镜像，如果不存在，会自动拉取&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;基于此镜像创建一个名为 &lt;code&gt;my-nginx&lt;/code&gt; 的容器&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;-d&lt;/code&gt;：让这个容器在后台持续运行&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;-p 8080:80&lt;/code&gt;：将你本机的8080端口的流量转发到容器内部的80端口（Nginx默认在80端口监听）&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;命令执行后，在浏览器中访问&lt;code&gt;http://你的主机IP地址:8080&lt;/code&gt;或&lt;code&gt;http://localhost:8080&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;如果看到Nginx的欢迎页面，则表示容器已成功运行&lt;/p&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250722140517678&#34; href=&#34;http://picture.928330.xyz/typora/image-20250722140517678.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250722140517678.png&#34; alt=&#34;image-20250722140517678&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h3 id=&#34;查看正在运行的容器&#34;&gt;查看正在运行的容器
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker ps
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250723112548978&#34; href=&#34;http://picture.928330.xyz/typora/image-20250723112548978.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250723112548978.png&#34; alt=&#34;image-20250723112548978&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;CONTAINER ID&lt;/strong&gt;：容器的唯一标识，&lt;strong&gt;可以用全部或者前几位操作该容器，只要能唯一识别&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;IMAGE&lt;/strong&gt;：使用的镜像&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;COMMAND&lt;/strong&gt;：容器启动时运行的命令&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;CREATED&lt;/strong&gt;：容器创建的时间&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;STATUS&lt;/strong&gt;：容器状态，这里的字段值是&lt;code&gt;UP&lt;/code&gt;，说明是一个正在运行的容器&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;PORTS&lt;/strong&gt;：端口映射&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;0.0.0.0:8080-&amp;gt;80/tcp&lt;/code&gt;：主机所有IPv4地址的8080端口被映射到容器内部的80端口（TCP 协议）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;:::8080-&amp;gt;80/tcp&lt;/code&gt;：主机所有IPv6地址的8080端口也映射到容器内部的80端口（TCP 协议）&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;NAMES&lt;/strong&gt;：自定义的容器的名字&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;查看所有容器&#34;&gt;查看所有容器
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker ps -a
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;-a&lt;/code&gt;是&lt;code&gt;all&lt;/code&gt;的缩写，代表列出所有容器，包括那些已经停止运行的&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这个命令可以找到旧的、已停止的容器，以便重新启动它们或将它们删除以进行清理&lt;/p&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250723113333889&#34; href=&#34;http://picture.928330.xyz/typora/image-20250723113333889.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250723113333889.png&#34; alt=&#34;image-20250723113333889&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;p&gt;这里的&lt;code&gt;STATUS&lt;/code&gt;字段是&lt;code&gt;exited&lt;/code&gt;，说明这是一个退出的、不在运行的容器&lt;/p&gt;
&lt;h3 id=&#34;停止容器&#34;&gt;停止容器
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker stop &amp;lt;容器名称&amp;gt;/&amp;lt;容器ID&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;说明: 此命令会向容器内的主进程发送一个 &lt;code&gt;SIGTERM&lt;/code&gt; 信号，请求其正常关闭。应用程序会接收到这个信号并执行关闭前的清理工作。&lt;/p&gt;
&lt;p&gt;eg：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker stop nginx
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250723113823707&#34; href=&#34;http://picture.928330.xyz/typora/image-20250723113823707.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250723113823707.png&#34; alt=&#34;image-20250723113823707&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;p&gt;停止后，容器不在运行列表之中&lt;/p&gt;
&lt;h3 id=&#34;启动一个已停止的容器&#34;&gt;启动一个已停止的容器
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker start &amp;lt;容器名称&amp;gt;/&amp;lt;容器ID&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这个命令会使一个处于Exited状态的容器恢复到Up状态，容器会保留其上次停止时的所有配置和数据。&lt;/p&gt;
&lt;p&gt;示例: docker start my-nginx&lt;/p&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250723113946571&#34; href=&#34;http://picture.928330.xyz/typora/image-20250723113946571.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250723113946571.png&#34; alt=&#34;image-20250723113946571&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h3 id=&#34;删除容器&#34;&gt;删除容器
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker rm &amp;lt;容器名称&amp;gt;/&amp;lt;容器ID&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;默认情况下，不能删除一个正在运行的容器，必须先使用&lt;code&gt;docker stop&lt;/code&gt;将其停止&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;如果确定要删除一个运行中的容器，可以添加&lt;code&gt;-f&lt;/code&gt;参数来强制执行&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;容器信息查看与交互&#34;&gt;容器信息查看与交互
&lt;/h2&gt;&lt;h3 id=&#34;查看端口映射&#34;&gt;查看端口映射
&lt;/h3&gt;&lt;p&gt;此命令可以快捷地查看一个容器的端口映射情况&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker port &amp;lt;容器名称&amp;gt;/&amp;lt;容器ID&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;eg：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker port nginx
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250723173634143&#34; href=&#34;http://picture.928330.xyz/typora/image-20250723173634143.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250723173634143.png&#34; alt=&#34;image-20250723173634143&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;p&gt;容器内部的80端口被映射到了：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;0.0.0.0:8080&lt;/code&gt;：表示主机的所有&lt;strong&gt;IPv4&lt;/strong&gt;地址上的8080端口&lt;/li&gt;
&lt;li&gt;&lt;code&gt;[::]:8080&lt;/code&gt;：表示主机的所有&lt;strong&gt;IPv6&lt;/strong&gt;地址上的8080端口&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;也就是说，我们可以使用以下任意方式访问这个容器内的Nginx服务：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;http://localhost:8080&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;http://127.0.0.1:8080&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;http://&amp;lt;主机的IP&amp;gt;:8080&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;如果启用了IPv6网络，还可以使用IPv6地址访问，如&lt;code&gt;http://[::1]:8080&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;查看容器日志&#34;&gt;查看容器日志
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker logs &lt;span style=&#34;color:#56b6c2&#34;&gt;[&lt;/span&gt;选项&lt;span style=&#34;color:#56b6c2&#34;&gt;]&lt;/span&gt; &amp;lt;容器名称&amp;gt;/&amp;lt;容器ID&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;常用选项：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;-f&lt;/code&gt;&lt;/strong&gt;：持续跟踪并输出日志&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;--tail&lt;/code&gt;&lt;/strong&gt;：仅显示日志的最后N行&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;eg：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker logs nginx
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250723115500967&#34; href=&#34;http://picture.928330.xyz/typora/image-20250723115500967.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250723115500967.png&#34; alt=&#34;image-20250723115500967&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h3 id=&#34;在容器内部执行命令&#34;&gt;在容器内部执行命令
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;可以在一个运行中的容器内执行命令，而不进入其交互式Shell&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker &lt;span style=&#34;color:#e5c07b&#34;&gt;exec&lt;/span&gt; &amp;lt;容器名称&amp;gt;/&amp;lt;容器ID&amp;gt; &amp;lt;命令&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;eg：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker &lt;span style=&#34;color:#e5c07b&#34;&gt;exec&lt;/span&gt; nginx ls -l
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250723115709524&#34; href=&#34;http://picture.928330.xyz/typora/image-20250723115709524.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250723115709524.png&#34; alt=&#34;image-20250723115709524&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;p&gt;此命令会在名为&lt;code&gt;nginx&lt;/code&gt;的容器内部执行&lt;code&gt;ls -l&lt;/code&gt; 命令，并返回结果，而我们的终端仍然停留在主机上&lt;/p&gt;
&lt;h3 id=&#34;进入容器的交互式终端&#34;&gt;进入容器的交互式终端
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;对于更复杂的调试，我们就需要一个完整的Shell环境来在容器内部进行操作&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker &lt;span style=&#34;color:#e5c07b&#34;&gt;exec&lt;/span&gt; -it &amp;lt;容器名称&amp;gt;/&amp;lt;容器ID&amp;gt; /bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;-it&lt;/code&gt;是两个选项的组合：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;-i&lt;/code&gt;保持标准输入开启，&lt;code&gt;-t&lt;/code&gt;分配一个伪终端，这共同创建了一个可以交互的命令行界面&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;/bin/bash&lt;/code&gt;是一个常见的Shell程序，有些镜像可能提供的是&lt;code&gt;/bin/sh&lt;/code&gt;，比较不好用&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;也可以在创建容器的时候就进入其交互式终端：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker run -it &amp;lt;镜像名称&amp;gt;:&amp;lt;标签&amp;gt; /bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;eg：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker &lt;span style=&#34;color:#e5c07b&#34;&gt;exec&lt;/span&gt; -it nginx /bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250723121248325&#34; href=&#34;http://picture.928330.xyz/typora/image-20250723121248325.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250723121248325.png&#34; alt=&#34;image-20250723121248325&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;p&gt;执行后命令提示符改变，表示已经进入了容器，可以像在普通Linux环境中一样运行命令&lt;/p&gt;
&lt;p&gt;如果想要退出，可以使用&lt;code&gt;Ctrl+D&lt;/code&gt;，或者输入&lt;code&gt;exit&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;容器网络与连接&#34;&gt;容器网络与连接
&lt;/h2&gt;&lt;p&gt;除了端口映射，Docker还提供了强大的网络功能，允许容器之间方便、安全地互相通信&lt;/p&gt;
&lt;p&gt;在开始之前，我们需要知道docker的网络类型有哪些&lt;/p&gt;
&lt;h3 id=&#34;网络类型&#34;&gt;网络类型
&lt;/h3&gt;&lt;h4 id=&#34;bridge&#34;&gt;bridge
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;bridge&lt;/code&gt;是Docker默认的网络类型，适用于单个主机上容器之间的通信&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;每个容器会获得一个虚拟网卡和私有IP地址&lt;/li&gt;
&lt;li&gt;容器之间可以通过容器名通信&lt;/li&gt;
&lt;li&gt;可以使用&lt;code&gt;-p&lt;/code&gt;参数将容器端口映射到宿主机端口，实现外部访问&lt;/li&gt;
&lt;li&gt;默认的&lt;code&gt;bridge&lt;/code&gt;网络名称就是&lt;code&gt;bridge&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;适用于需要隔离、但仍允许访问外部网络的容器场景&lt;/p&gt;
&lt;h4 id=&#34;host&#34;&gt;host
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;容器与宿主机共享网络栈，不做任何隔离&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;容器没有自己的IP地址&lt;/li&gt;
&lt;li&gt;使用宿主机的IP和端口&lt;/li&gt;
&lt;li&gt;性能更好，网络开销低&lt;/li&gt;
&lt;li&gt;容器中暴露的端口不需要通过&lt;code&gt;-p&lt;/code&gt;映射&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;适用于对网络性能要求极高的场景&lt;/p&gt;
&lt;h4 id=&#34;none&#34;&gt;none
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;容器没有网络连接&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;没有分配IP地址&lt;/li&gt;
&lt;li&gt;不能访问外部网络，也不能与其他容器通信&lt;/li&gt;
&lt;li&gt;除非手动配置网络，否则容器完全断网&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;适用于需要自定义网络配置或完全隔离网络的场景&lt;/p&gt;
&lt;h4 id=&#34;overlay&#34;&gt;overlay
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;用于Docker Swarm集群环境中，支持多主机容器通信&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;可跨宿主机连接容器&lt;/li&gt;
&lt;li&gt;基于VXLAN技术封装&lt;/li&gt;
&lt;li&gt;需要Swarm模式支持&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;适用于需要将多个 Docker 主机上的容器连接成一个网络的分布式应用&lt;/p&gt;
&lt;h4 id=&#34;macvlan&#34;&gt;macvlan
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;让容器像宿主机一样，直接拥有局域网内的独立IP&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;容器像物理主机一样直接连接到物理网络&lt;/li&gt;
&lt;li&gt;容器具有独立MAC和IP地址&lt;/li&gt;
&lt;li&gt;可被局域网中的其他设备直接访问&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;适用于容器需要与局域网设备完全对等通信的场景，例如作为局域网服务节点&lt;/p&gt;
&lt;h4 id=&#34;container&#34;&gt;container
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;多个容器共享同一个网络命名空间，通过&lt;code&gt;--network container:&amp;lt;容器名&amp;gt;&lt;/code&gt;实现&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;使用另一个容器的网络配置&lt;/li&gt;
&lt;li&gt;容器之间通过进程间通信&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;适用于容器需要共享网络堆栈（如日志、监控）的情况&lt;/p&gt;
&lt;h3 id=&#34;查看当前已创建的网络&#34;&gt;查看当前已创建的网络
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker network ls
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250723185658135&#34; href=&#34;http://picture.928330.xyz/typora/image-20250723185658135.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250723185658135.png&#34; alt=&#34;image-20250723185658135&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;NETWORK ID&lt;/strong&gt;：网络的唯一标识&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;NAME&lt;/strong&gt;：网络名称&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;DRIVER&lt;/strong&gt;：网络类型&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;SCOPE&lt;/strong&gt;：作用范围，通常是local(本地网络)或swarm(集群网络)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;创建自定义网络&#34;&gt;创建自定义网络
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker network create -d bridge &amp;lt;网络名称&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;-d&lt;/code&gt;&lt;/strong&gt;：指定网络类型。对于单机环境，&lt;code&gt;bridge&lt;/code&gt;是最常用的类型&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;eg：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker network create -d bridge my-net
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250723185004431&#34; href=&#34;http://picture.928330.xyz/typora/image-20250723185004431.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250723185004431.png&#34; alt=&#34;image-20250723185004431&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h3 id=&#34;删除已定义的网络&#34;&gt;删除已定义的网络
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker network rm &amp;lt;网络名&amp;gt;/&amp;lt;网络ID&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;eg：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker network rm my-net
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250723185631213&#34; href=&#34;http://picture.928330.xyz/typora/image-20250723185631213.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250723185631213.png&#34; alt=&#34;image-20250723185631213&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h3 id=&#34;连接容器到网络&#34;&gt;连接容器到网络
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;我们可以在启动容器时使用&lt;code&gt;--network&lt;/code&gt;选项将其连接到指定的网络&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker run -d --name &amp;lt;容器名称&amp;gt; --network &amp;lt;网络名称&amp;gt; &amp;lt;镜像名称&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;eg：&lt;/p&gt;
&lt;p&gt;我们创建两个容器并都连接到&lt;code&gt;my-net&lt;/code&gt;网络&lt;/p&gt;
&lt;p&gt;首先创建第一个容器 &lt;code&gt;nginx-1&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker run -d --name nginx-1 --network my-net nginx
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;然后创建第二个容器 &lt;code&gt;nginx-2&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker run -d --name nginx-2 --network my-net nginx
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250723190434746&#34; href=&#34;http://picture.928330.xyz/typora/image-20250723190434746.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250723190434746.png&#34; alt=&#34;image-20250723190434746&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h3 id=&#34;容器间通信&#34;&gt;容器间通信
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;当多个容器连接到同一个自定义网络时，它们可以通过容器名称作为主机名直接互相访问&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;我们可以进入一个容器来测试与另一个容器的连通性&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;eg：&lt;/p&gt;
&lt;p&gt;进入&lt;code&gt;nginx-1&lt;/code&gt;容器，然后&lt;code&gt;ping nginx-2&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker &lt;span style=&#34;color:#e5c07b&#34;&gt;exec&lt;/span&gt; -it nginx-1 /bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;进入容器后，由于nginx镜像默认没有 &lt;code&gt;ping&lt;/code&gt; 工具，我们需要先安装它：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;apt-get update &lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; apt-get install -y iputils-ping
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;安装完成后，执行&lt;code&gt;ping&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ping nginx-2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250723190515708&#34; href=&#34;http://picture.928330.xyz/typora/image-20250723190515708.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250723190515708.png&#34; alt=&#34;image-20250723190515708&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;p&gt;可以看到，&lt;code&gt;nginx-1&lt;/code&gt;能够成功解析&lt;code&gt;nginx-2&lt;/code&gt;的名称并与之通信，这证明了容器间的互联已经建立shell&lt;/p&gt;
&lt;h3 id=&#34;查看容器网络信息&#34;&gt;查看容器网络信息
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker inspect &amp;lt;对象ID或名称&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;docker inspect&lt;/code&gt;是一个非常强大的命令，用于查看容器、镜像、网络、卷等对象的详细底层信息&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;它会返回一段JSON 格式的数据，包含几乎所有属性，比如网络配置、挂载卷、环境变量、启动命令等&lt;/p&gt;
&lt;p&gt;这里我们查看容器的信息，并过滤网络部分：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker inspect &amp;lt;容器ID&amp;gt;/&amp;lt;名称&amp;gt; | grep -A &lt;span style=&#34;color:#d19a66&#34;&gt;10&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;NetworkSettings&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250723191822266&#34; href=&#34;http://picture.928330.xyz/typora/image-20250723191822266.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250723191822266.png&#34; alt=&#34;image-20250723191822266&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h3 id=&#34;dns配置&#34;&gt;DNS配置
&lt;/h3&gt;&lt;h4 id=&#34;全局配置&#34;&gt;全局配置
&lt;/h4&gt;&lt;p&gt;我们可以为所有Docker容器配置默认的DNS服务器&lt;/p&gt;
&lt;p&gt;这需要在Docker的守护进程配置文件&lt;code&gt;/etc/docker/daemon.json&lt;/code&gt;中添加&lt;code&gt;dns&lt;/code&gt;字段&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-JSON&#34; data-lang=&#34;JSON&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;#34;dns&amp;#34;&lt;/span&gt;: [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;114.114.114.114&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;8.8.8.8&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;修改此文件后，必须重启 Docker 服务才能生效&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;容器独立配置&#34;&gt;容器独立配置
&lt;/h4&gt;&lt;p&gt;如果只想为某个特定的容器指定 DNS，可以在&lt;code&gt;docker run&lt;/code&gt;时使用相关选项&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker run &lt;span style=&#34;color:#56b6c2&#34;&gt;[&lt;/span&gt;DNS选项&lt;span style=&#34;color:#56b6c2&#34;&gt;]&lt;/span&gt; &amp;lt;镜像名称&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;常用DNS选项：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;--dns=&amp;lt;IP地址&amp;gt;&lt;/code&gt;&lt;/strong&gt;：指定容器使用的DNS服务器地址&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;--dns-search=&amp;lt;域名&amp;gt;&lt;/code&gt;&lt;/strong&gt;：指定DNS搜索域。当查找一个短主机名时，会自动追加这个域名进行尝试&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;--hostname=&amp;lt;主机名&amp;gt;&lt;/code&gt;&lt;/strong&gt;：设置容器内部的主机名&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;eg：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker run -it --rm --hostname&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;myhost --dns&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;114.114.114.114  nginx
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这个命令会启动一个临时的&lt;code&gt;nginx&lt;/code&gt;容器，其主机名为&lt;code&gt;myhost&lt;/code&gt;，使用&lt;code&gt;114.114.114.114&lt;/code&gt;作为DNS服务器&lt;/p&gt;
&lt;h4 id=&#34;常用dns服务器&#34;&gt;常用DNS服务器
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;阿里云公共 DNS&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;223.5.5.5
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;223.6.6.6
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;114 DNS&lt;/strong&gt;（国内知名公共 DNS）&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;114.114.114.114
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;114.114.115.115
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;Google 公共 DNS&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;8.8.8.8
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;8.8.4.4
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;Cloudflare DNS&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;1.1.1.1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;1.0.0.1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;OpenDNS&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;208.67.222.222
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;208.67.220.220
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;docker实例安装&#34;&gt;Docker实例安装
&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;各种镜像安装过程都大差不差，这里以nginx为例，其他的也能作参考&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;查看可用版本&#34;&gt;查看可用版本
&lt;/h2&gt;&lt;h3 id=&#34;访问nginx镜像库地址&#34;&gt;访问Nginx镜像库地址
&lt;/h3&gt;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://hub.docker.com/_/nginx?tab=tags&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://hub.docker.com/_/nginx?tab=tags
    
    &lt;span style=&#34;white-space: nowrap;&#34;&gt;&lt;svg width=&#34;.7em&#34;
        height=&#34;.7em&#34; viewBox=&#34;0 0 21 21&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;
        &lt;path d=&#34;m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z&#34; fill=&#34;currentColor&#34; /&gt;
        &lt;path d=&#34;M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z&#34;
            fill=&#34;currentColor&#34;&gt;
    &lt;/svg&gt;&lt;/span&gt;
    
&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250722123536066&#34; href=&#34;http://picture.928330.xyz/typora/image-20250722123536066.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250722123536066.png&#34; alt=&#34;image-20250722123536066&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;p&gt;可以copy的字段是拉取当前版本镜像的命令，下面是一些介绍：&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;字段&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;Digest&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;每个平台构建出的镜像唯一标识符&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;OS/ARCH&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;表示支持的操作系统和架构&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;Vulnerabilities&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;镜像中检测出的安全漏洞数量&lt;br /&gt;分等级：严重（红）、高（橙）、中（黄）、低（灰）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;Compressed size&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;镜像下载时的压缩大小&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;使用命令查看&#34;&gt;使用命令查看
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker search nginx
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;我们一般都使用最新的，也就是latest&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;拉取最新镜像&#34;&gt;拉取最新镜像
&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker pull nginx:latest
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250722140134826&#34; href=&#34;http://picture.928330.xyz/typora/image-20250722140134826.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250722140134826.png&#34; alt=&#34;image-20250722140134826&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h2 id=&#34;查看是否拉取成功&#34;&gt;查看是否拉取成功
&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker images
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250722140111160&#34; href=&#34;http://picture.928330.xyz/typora/image-20250722140111160.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250722140111160.png&#34; alt=&#34;image-20250722140111160&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h2 id=&#34;运行容器&#34;&gt;运行容器
&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker run --name nginx -p 8080:80 -d nginx
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;参数说明：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&amp;ndash;name nginx&lt;/strong&gt;：容器名称改成nginx&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;-p 8080:80&lt;/strong&gt;： 端口进行映射，将本地8080端口映射到容器内部的80端口&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;-d&lt;/strong&gt;：设置容器在在后台一直运行&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;测试访问&#34;&gt;测试访问
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;http://localhost:8080
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250722140517678&#34; href=&#34;http://picture.928330.xyz/typora/image-20250722140517678.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250722140517678.png&#34; alt=&#34;image-20250722140517678&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
</description>
        </item>
        <item>
        <title>volatility使用说明</title>
        <link>https://blog.928330.xyz/p/volatility%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E/</link>
        <pubDate>Mon, 21 Jul 2025 12:51:01 +0800</pubDate>
        
        <guid>https://blog.928330.xyz/p/volatility%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E/</guid>
        <description>&lt;img src="http://picture.928330.xyz/typora/1pgvz3h0o0wydnqs6q91v9w.jpg" alt="Featured image of post volatility使用说明" /&gt;&lt;h1 id=&#34;前置步骤问题解决&#34;&gt;前置步骤/问题解决
&lt;/h1&gt;&lt;h2 id=&#34;下载&#34;&gt;下载
&lt;/h2&gt;&lt;p&gt;Volatility2：https://github.com/volatilityfoundation/volatility&lt;/p&gt;
&lt;p&gt;Volatility3：https://github.com/volatilityfoundation/volatility3&lt;/p&gt;
&lt;h2 id=&#34;python版本&#34;&gt;python版本
&lt;/h2&gt;&lt;p&gt;update-alternatives是Debian/Ubuntu系统提供的管理系统级默认命令的工具，通过维护符号链接工作&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;设置优先级，一般使用整数：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;update-alternatives --install /usr/bin/python python /usr/bin/python2 &lt;span style=&#34;color:#d19a66&#34;&gt;100&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;update-alternatives --install /usr/bin/python python /usr/bin/python3 &lt;span style=&#34;color:#d19a66&#34;&gt;150&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;查看当前可识别的版本：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; update-alternatives --list python
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/usr/bin/python2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/usr/bin/python3
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/usr/bin/python3.11
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;切换版本：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;update-alternatives --config python
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;有 &lt;span style=&#34;color:#d19a66&#34;&gt;3&lt;/span&gt; 个候选项可用于替换 python &lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;提供 /usr/bin/python&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;。
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  选择       路径               优先级  状态
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;------------------------------------------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#d19a66&#34;&gt;0&lt;/span&gt;            /usr/bin/python3      &lt;span style=&#34;color:#d19a66&#34;&gt;150&lt;/span&gt;       自动模式
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;* &lt;span style=&#34;color:#d19a66&#34;&gt;1&lt;/span&gt;            /usr/bin/python2      &lt;span style=&#34;color:#d19a66&#34;&gt;100&lt;/span&gt;       手动模式
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#d19a66&#34;&gt;2&lt;/span&gt;            /usr/bin/python3      &lt;span style=&#34;color:#d19a66&#34;&gt;150&lt;/span&gt;       手动模式
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#d19a66&#34;&gt;3&lt;/span&gt;            /usr/bin/python3.11   &lt;span style=&#34;color:#d19a66&#34;&gt;125&lt;/span&gt;       手动模式
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;要维持当前值&lt;span style=&#34;color:#56b6c2&#34;&gt;[&lt;/span&gt;*&lt;span style=&#34;color:#56b6c2&#34;&gt;]&lt;/span&gt;请按&amp;lt;回车键&amp;gt;，或者键入选择的编号：
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;输入数字切换版本&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;虚拟环境&#34;&gt;虚拟环境
&lt;/h2&gt;&lt;h3 id=&#34;安装&#34;&gt;安装
&lt;/h3&gt;&lt;p&gt;volatility2是基于python2开发的，所以虚拟环境也要使用python2的virtualenv创建&lt;/p&gt;
&lt;p&gt;这里以我下载python2.7版本的虚拟环境步骤为例，记录一些遇到的问题&lt;/p&gt;
&lt;p&gt;首先下载pip2，需要切换到python2的环境，并且由于linux系统大多放弃了apt对python2的支持，所以无法使用apt install下载，需要手动安装&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1.下载脚本：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl https://bootstrap.pypa.io/pip/2.7/get-pip.py -o get-pip.py
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;2.运行脚本：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo python2 get-pip.py
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;3.检查是否安装成功：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pip2 -V
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;成功显示出pip的版本号，以及它关联的是Python 2.7，就说明已经成功为安装好了pip2&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;4.安装virtualenv：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;安装的版本必须是兼容python2的，直接安装可能会下载到python3的版本，所以要指定版本：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pip2 install &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;virtualenv&amp;lt;20&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;如果是volatility3，也就是基于python3的版本，就可以使用apt直接下载对应的venv工具&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;先更新，后下载：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt update
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;apt install python3-venv
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这样就完成了安装&lt;/p&gt;
&lt;h3 id=&#34;创建&#34;&gt;创建
&lt;/h3&gt;&lt;p&gt;python2：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;python2 -m virtualenv 虚拟环境名
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;python3：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;python3 -m venv 虚拟环境名
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;使用&#34;&gt;使用
&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;source 虚拟环境名/bin/activate
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;提示符前面会多一个&lt;code&gt;(虚拟环境名)&lt;/code&gt;的标记，之后的所有python和pip命令都只作用在此环境下&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;分享依赖&#34;&gt;分享依赖
&lt;/h3&gt;&lt;p&gt;这条命令会将当前环境中所有已安装的库及其版本号写入到&lt;code&gt;requirements.txt&lt;/code&gt;中：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;pip freeze &amp;gt; requirements.txt
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;如果别人需要用，只需创建一个新的虚拟环境，再运行：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;pip install -r requirements.txt
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;通常我们也是使用这个命令来下载对应工具需要的依赖&lt;/p&gt;
&lt;h3 id=&#34;退出&#34;&gt;退出
&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;deactivate
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;删除&#34;&gt;删除
&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;rm -rf 虚拟环境名
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;设置为系统级命令&#34;&gt;设置为系统级命令
&lt;/h2&gt;&lt;h3 id=&#34;编写启动脚本&#34;&gt;编写启动脚本
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vim /usr/local/bin/vol
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;向里面写入下面内容：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;#!/bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;source&lt;/span&gt; /home/kali/volatility2/venv_volatility2/bin/activate &lt;span style=&#34;color:#56b6c2&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; python /home/kali/volatility2/vol.py &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$@&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;&amp;amp;&amp;amp;&lt;/code&gt;的意思是：如果前一个命令成功，则执行后一个命令&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;前者是启动虚拟环境，要写对应创建的虚拟环境路径&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;后者是把所有参数传递给volatility脚本，要写对应的vol.py路径&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;给脚本添加启动权限&#34;&gt;给脚本添加启动权限
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo chmod +x /usr/local/bin/vol
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这样就设置完成了，如果不行，就刷新一下命令缓存再运行：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;hash&lt;/span&gt; -r
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;报错解决&#34;&gt;报错解决
&lt;/h2&gt;&lt;h3 id=&#34;缺少运行库&#34;&gt;缺少运行库
&lt;/h3&gt;&lt;p&gt;换了两个虚拟机，每次运行volatility2的时候都会遇到库pycryptodome和distorm3不存在的问题&lt;/p&gt;
&lt;p&gt;这种情况只要进入对应虚拟环境，然后安装缺少的库即可&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;source&lt;/span&gt; /home/kali/volatility2/venv_volatility2/bin/activate
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pip2 install pycryptodome
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pip2 install distorm3
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;deactivate
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;安装插件&#34;&gt;安装插件
&lt;/h2&gt;&lt;p&gt;volatility2历史悠久，社区也很强大，很多人开发了非常好用的插件，需要我们手动安装&lt;/p&gt;
&lt;p&gt;这里以mimikatz插件为例，具体的下载地址网上一搜就有&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;下载插件，这里使用wget，其他方式随意：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wget https://raw.githubusercontent.com/volatilityfoundation/community/master/FrancescoPicasso/mimikatz.py
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;移动到存放插件的目录，一般是&lt;code&gt;volatility2/volatility/plugins/&lt;/code&gt;：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mv mimikatz.py /home/kali/volatility2/volatility/plugins/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;之后就可以使用了，不过mimikatz使用还需要安装依赖，具体看&lt;a class=&#34;link&#34; href=&#34;#%e6%8f%90%e5%8f%96%e6%98%8e%e6%96%87%e5%af%86%e7%a0%81%ef%bc%88mimikatz%ef%bc%89&#34; &gt;mimikatz
    
&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;volatility常用命令&#34;&gt;Volatility常用命令
&lt;/h1&gt;&lt;h2 id=&#34;系统画像&#34;&gt;系统画像
&lt;/h2&gt;&lt;h3 id=&#34;查看系统信息imageinfoinfo&#34;&gt;查看系统信息（imageinfo/info）
&lt;/h3&gt;&lt;h4 id=&#34;volatility2&#34;&gt;Volatility2
&lt;/h4&gt;&lt;p&gt;这是vol2进行任何分析前必须执行的第一步，用于确定操作系统的Profile，即版本&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; imageinfo 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;&amp;lt;内存镜像&amp;gt;的后缀名没有固定的，可能是raw，dump，img，vmem等等&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250708193517165&#34; href=&#34;http://picture.928330.xyz/typora/image-20250708193517165.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250708193517165.png&#34; alt=&#34;image-20250708193517165&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Suggested Profile(s)：建议的配置文件&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;在后续执行所有其他插件时，都需要通过 &lt;code&gt;--profile=&amp;lt;profile_name&amp;gt;&lt;/code&gt; 参数从这个列表中选择一个来使用&lt;/p&gt;
&lt;p&gt;通常，选择列表中的第一个（&lt;code&gt;Win7SP1x64&lt;/code&gt;）就是最合适的&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;KDBG：内核调试块地址&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;用于定位其他所有系统信息，如进程列表、驱动列表等&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Image date and time：镜像日期和时间，世界标准时间零时区UTC＋0&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这里表明内存快照是在UTC时间2019年12月20日03:47:57被创建&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Image local date and time：原始机器当时的本地时间，包含时区信息&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;03:47:57&lt;/code&gt;加上&lt;code&gt;5小时30分钟&lt;/code&gt;，正好等于&lt;code&gt;09:17:57&lt;/code&gt;，这就是当地的时间&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Number of Processors：处理器数量&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这里显示该系统是单核处理器&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;volatility3&#34;&gt;Volatility3
&lt;/h4&gt;&lt;p&gt;V3会自动检测Profile，之后的命令无需手动输入，此命令用于显示详细的信息&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol3 -f &amp;lt;内存镜像&amp;gt; windows.info.Info
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250712211412813&#34; href=&#34;http://picture.928330.xyz/typora/image-20250712211412813.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250712211412813.png&#34; alt=&#34;image-20250712211412813&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;NTBuildLab&lt;/strong&gt;：&lt;strong&gt;Windows操作系统构建版本标签&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;7601.17514.amd64fre.win7sp1_rtm&lt;/code&gt;，代表一个经过后续更新（修订号17514）的、面向64位amd架构的、已正式发布的、基于Windows7SP1开发分支的操作系统&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;KeNumberProcessors：处理器个数&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;SystemTime&lt;/strong&gt;：&lt;strong&gt;内存快照被制作的时间，世界标准时间零时区UTC＋0&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;NtProductType： Windows操作系统的产品类型&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;NtProductWinNt&lt;/code&gt;：客户端版本&lt;/p&gt;
&lt;p&gt;&lt;code&gt;NtProductServer&lt;/code&gt;：服务器&lt;/p&gt;
&lt;p&gt;&lt;code&gt;NtProductLanManNt&lt;/code&gt;：域控制器，是特定类型的服务器&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;NtMajorVersion / NtMinorVersion&lt;/strong&gt;：&lt;strong&gt;Windows操作系统内核的主版本号和次版本号&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;6.1在WindowsNT内核版本中，对应着Windows7或WindowsServer2008R2&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;PE TimeDateStamp&lt;/strong&gt;：&lt;strong&gt;系统内核文件被编译的时间&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;查看文件信息mftparsermftscan&#34;&gt;查看文件信息（mftparser/mftscan）
&lt;/h3&gt;&lt;p&gt;除了Volatility，还可以使用其他工具导出mft记录：https://github.com/jschicht/Mft2Csv/releases&lt;/p&gt;
&lt;p&gt;下载打开软件，选择&lt;code&gt;$MFT&lt;/code&gt;文件，然后导出到&lt;code&gt;csv&lt;/code&gt;文件即可，导出的条目会以&lt;code&gt;csv&lt;/code&gt;文件的形式存放在软件目录下&lt;/p&gt;
&lt;h4 id=&#34;volatility2-1&#34;&gt;Volatility2
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; mftparser
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250716202015759&#34; href=&#34;http://picture.928330.xyz/typora/image-20250716202015759.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250716202015759.png&#34; alt=&#34;image-20250716202015759&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;MFT entry found at offset &amp;hellip;&lt;/strong&gt;：该MFT记录在内存中的物理偏移地址&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Attribute:In Use &amp;amp; File&lt;/strong&gt;：表明这是一条活动的、描述文件的记录&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Record Number&lt;/strong&gt;：该记录在MFT中的唯一编号&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Link count&lt;/strong&gt;：指向这个文件实体的文件名数量（硬链接数）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;$STANDARD_INFORMATION&lt;/strong&gt;：主属性，只有当&lt;strong&gt;文件内容&lt;/strong&gt;被编辑时，其&lt;code&gt;Modified&lt;/code&gt;和&lt;code&gt;Updated&lt;/code&gt;时间才会改变&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;$FILE_NAME&lt;/strong&gt;：文件名属性，文件&lt;strong&gt;内容被改动、重命名、移动&lt;/strong&gt;时，其&lt;code&gt;Modified&lt;/code&gt;和&lt;code&gt;Updated&lt;/code&gt;时间都会改变&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Creation&lt;/strong&gt;：创建时间&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Modified&lt;/strong&gt;：修改时间&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;MFT Altered&lt;/strong&gt;：MFT记录本身最后一次被修改的时间，例如文件名或权限变更&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Access Date&lt;/strong&gt;：文件内容最后一次被访问的时间（注意：在现代Windows系统中，为提高性能，这个时间戳不一定总是实时更新）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Name/Path&lt;/strong&gt;：显示具体的文件名&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;volatility3-1&#34;&gt;Volatility3
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol3 -f &amp;lt;内存镜像&amp;gt; windows.mftscan.MFTScan
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250716202259656&#34; href=&#34;http://picture.928330.xyz/typora/image-20250716202259656.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250716202259656.png&#34; alt=&#34;image-20250716202259656&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Offset ：偏移量&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这是该 MFT 记录在内存中的虚拟地址&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Record Type：记录类型&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;指明该记录是用于一个文件（FILE）还是一个目录（Directory）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Record Number：记录编号&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这是该文件/目录在整个 MFT 中的唯一索引号&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Link Count：链接计数&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;表示有多少个文件名指向这个相同的文件实体&lt;/p&gt;
&lt;p&gt;例如，值为2意味着这个文件有两个名字，通常一个是长文件名，一个是8.3格式的短文件名&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;MFT Type：MFT类型&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;进一步描述MFT条目的类型，通常与Record Type一致&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Permissions：权限属性&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;显示文件的属性，如 Archive (存档)、System (系统文件)等&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Attribute Type：属性类型&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;指明当前这一行显示的是 MFT 记录中的哪一种具体属性&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;STANDARD_INFORMATION&lt;/code&gt;&lt;/strong&gt;：主属性，只有当&lt;strong&gt;文件内容&lt;/strong&gt;被编辑时，其&lt;code&gt;Modified&lt;/code&gt;和&lt;code&gt;Updated&lt;/code&gt;时间才会改变&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;FILE_NAME&lt;/code&gt;&lt;/strong&gt;：文件名属性，文件&lt;strong&gt;内容被改动、重命名、移动&lt;/strong&gt;时，其&lt;code&gt;Modified&lt;/code&gt;和&lt;code&gt;Updated&lt;/code&gt;时间都会改变&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;最前面带星号的行是隶属于它上面那个不带星号的主记录的子属性&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Created, Modified, Updated, Accessed：四种时间戳&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;分别代表了该属性（STANDARD_INFORMATION 或 FILE_NAME）的：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;创建时间、修改时间、MFT记录更新时间、访问时间（以UTC标准时间显示）&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Filename：文件名&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;当 Attribute Type 为 FILE_NAME 时，这一列会显示具体的文件名&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;查看windows服务svcscan&#34;&gt;查看windows服务（svcscan）
&lt;/h3&gt;&lt;h4 id=&#34;volatility2-2&#34;&gt;Volatility2
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; svcscan
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250706145215760.png&#34; alt=&#34;image-20250706145215760&#34; style=&#34;zoom：67%;&#34; /&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Service Name&lt;/strong&gt;：服务的内部名称&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Display Name&lt;/strong&gt;：服务的显示名称，在服务管理器中的名称&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Process ID&lt;/strong&gt;：该服务的进程的ID&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Service State&lt;/strong&gt;： 服务状态，表明服务是&lt;code&gt;RUNNING&lt;/code&gt;(正在运行) 还是&lt;code&gt;STOPPED&lt;/code&gt;(已停止)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Binary Path&lt;/strong&gt;：服务路径&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;volatility3-2&#34;&gt;Volatility3
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; vol3 -f &amp;lt;内存镜像&amp;gt; windows.svcscan.SvcScan
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250716210316417&#34; href=&#34;http://picture.928330.xyz/typora/image-20250716210316417.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250716210316417.png&#34; alt=&#34;image-20250716210316417&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Offset：偏移量&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这是该服务记录在内存中的虚拟地址&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Order：顺序&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;服务在其服务组内的加载顺序编号&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;PID：进程ID&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;如果该服务当前正在运行，这里会显示托管它的进程的ID，如果服务已停止，则显示为 &lt;code&gt;N/A&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Start：启动类型&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这是在注册表中为该服务配置的启动方式，决定了它如何被启动，有下面几种：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;SERVICE_BOOT_START&lt;/code&gt;：引导启动&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;SERVICE_SYSTEM_START&lt;/code&gt;：系统启动&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;SERVICE_AUTO_START&lt;/code&gt;：自动启动&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;SERVICE_DEMAND_START&lt;/code&gt;：按需启动 (手动)&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;SERVICE_DISABLED&lt;/code&gt;：已禁用&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;State：当前状态&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;表示在捕获内存时该服务的实时状态，有下面这几种：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;SERVICE_STOPPED&lt;/code&gt;：服务已停止&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;SERVICE_START_PENDING&lt;/code&gt;：服务正在启动&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;SERVICE_STOP_PENDING&lt;/code&gt;：服务正在停止&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;SERVICE_RUNNING&lt;/code&gt;：服务正在运行&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;SERVICE_CONTINUE_PENDING&lt;/code&gt;：服务即将继续&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;SERVICE_PAUSE_PENDING&lt;/code&gt;：服务即将暂停&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;SERVICE_PAUSED&lt;/code&gt;：服务已暂停&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Type：服务类型&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;描述了该服务的性质，有下面几种：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;SERVICE_KERNEL_DRIVER&lt;/code&gt;：内核模式驱动程序&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;SERVICE_FILE_SYSTEM_DRIVER&lt;/code&gt;：文件系统驱动程序&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;SERVICE_WIN32_OWN_PROCESS&lt;/code&gt;：独立进程Win32服务&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;SERVICE_WIN32_SHARE_PROCESS&lt;/code&gt;：共享进程Win32服务&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;SERVICE_INTERACTIVE_PROCESS&lt;/code&gt;：交互式服务&lt;/strong&gt;，由于安全原因，这个服务已经被弃用&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Name：服务名&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;服务的短名称或内部名称&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Display：显示名称&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Windows服务管理器中看到的人类可读的名称&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Binary：二进制/运行命令&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这是启动该服务进程时实际使用的命令行&lt;/p&gt;
&lt;p&gt;对于共享服务，这里通常会包含&lt;code&gt;-k &amp;lt;服务组名&amp;gt;&lt;/code&gt;参数，例如&lt;code&gt;C:\Windows\system32\svchost.exe -k DcomLaunch&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Binary (Registry)：注册表中的二进制路径&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这是在注册表中为该服务配置的&lt;code&gt;ImagePath&lt;/code&gt;值&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Dll：服务DLL&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;如果该服务是由一个DLL实现并由&lt;code&gt;svchost.exe&lt;/code&gt;托管的，这里会显示该 DLL 的路径&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;查看驱动模块modulesdriverscanmodscan&#34;&gt;查看驱动模块（modules/driverscan/modscan）
&lt;/h3&gt;&lt;h4 id=&#34;volatility2-3&#34;&gt;Volatility2
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;使用&lt;code&gt;modules&lt;/code&gt;来查看驱动模块，通过遍历内核中的&lt;code&gt;PsLoadedModuleList&lt;/code&gt;官方链表来获取信息：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; modules
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250718095930867&#34; href=&#34;http://picture.928330.xyz/typora/image-20250718095930867.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250718095930867.png&#34; alt=&#34;image-20250718095930867&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Offset(V)&lt;/code&gt;&lt;/strong&gt;：该模块的&lt;code&gt;_LDR_DATA_TABLE_ENTRY&lt;/code&gt;结构在内存中的虚拟地址&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Name&lt;/code&gt;&lt;/strong&gt;：模块的名称，例如 &lt;code&gt;ntoskrnl.exe&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Base&lt;/code&gt;&lt;/strong&gt;：模块被加载到内存中的基地址&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Size&lt;/code&gt;&lt;/strong&gt;：模块在内存中所占空间的大小&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;File&lt;/code&gt;&lt;/strong&gt;：该模块对应的磁盘文件路径&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;或者也可以使用&lt;code&gt;driverscan&lt;/code&gt;通过扫描内存池来寻找驱动对象，这种方式能发现一部分隐藏的驱动对象：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; driverscan
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250718100005508&#34; href=&#34;http://picture.928330.xyz/typora/image-20250718100005508.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250718100005508.png&#34; alt=&#34;image-20250718100005508&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Offset(P)&lt;/code&gt;&lt;/strong&gt;：该驱动对象在内存中的物理地址&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;#Ptr&lt;/code&gt;&lt;/strong&gt;：指向该驱动对象的指针数量&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;#Hnd&lt;/code&gt;&lt;/strong&gt;：该驱动对象的句柄数量&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Start&lt;/code&gt;&lt;/strong&gt;：驱动程序在内存中的起始地址&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Size&lt;/code&gt;&lt;/strong&gt;：驱动程序在内存中所占空间的大小&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Service Key&lt;/code&gt;&lt;/strong&gt;：该驱动在注册表服务项中的名称，这通常与驱动名相同&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Name&lt;/code&gt;&lt;/strong&gt;：驱动的名称&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Driver Name&lt;/code&gt;&lt;/strong&gt;：驱动对象在系统中的完整名称，通常以&lt;code&gt;\Driver\&lt;/code&gt;或&lt;code&gt;\FileSystem\&lt;/code&gt;开头&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;还可以使用modscan扫描模块结构特征寻找驱动，最全面，能发现大多数隐藏模块速度慢，但可能有误报：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; modscan
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250718120519596&#34; href=&#34;http://picture.928330.xyz/typora/image-20250718120519596.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250718120519596.png&#34; alt=&#34;image-20250718120519596&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;物理地址不同是正常的，因为它们扫描和定位的目标数据结构不同&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;volatility3-3&#34;&gt;Volatility3
&lt;/h4&gt;&lt;p&gt;使用&lt;code&gt;modules&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol3 -f &amp;lt;内存镜像&amp;gt; windows.modules.Modules
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250718100737803&#34; href=&#34;http://picture.928330.xyz/typora/image-20250718100737803.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250718100737803.png&#34; alt=&#34;image-20250718100737803&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;p&gt;使用&lt;code&gt;driverscan&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol3 -f &amp;lt;内存镜像&amp;gt; windows.driverscan.DriverScan
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250718100933982&#34; href=&#34;http://picture.928330.xyz/typora/image-20250718100933982.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250718100933982.png&#34; alt=&#34;image-20250718100933982&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;p&gt;使用&lt;code&gt;modscan&lt;/code&gt;：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;vol3 -f &amp;lt;内存镜像&amp;gt; windows.modscan.ModScan
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;&#34; href=&#34;http://picture.928330.xyz/typora/image-20250718120611323.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250718120611323.png&#34; alt=&#34;&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h3 id=&#34;查看驱动程序的irpdriverirp&#34;&gt;查看驱动程序的IRP（driverirp）
&lt;/h3&gt;&lt;h4 id=&#34;volatility2-4&#34;&gt;Volatility2
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; driverirp 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250718133232360&#34; href=&#34;http://picture.928330.xyz/typora/image-20250718133232360.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250718133232360.png&#34; alt=&#34;image-20250718133232360&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;DriverName&lt;/strong&gt;：目标驱动的名称&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;第一列&lt;/strong&gt;：IRP功能码的编号&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;第二列&lt;/strong&gt;：IRP功能码的名称，描述了I/O请求的类型，例如：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;IRP_MJ_CREATE&lt;/code&gt;：当有程序尝试创建或打开文件时，会产生这个请求&lt;/li&gt;
&lt;li&gt;&lt;code&gt;IRP_MJ_READ&lt;/code&gt;：读取文件请求&lt;/li&gt;
&lt;li&gt;&lt;code&gt;IRP_MJ_WRITE&lt;/code&gt;：写入文件请求&lt;/li&gt;
&lt;li&gt;&lt;code&gt;IRP_MJ_DEVICE_CONTROL&lt;/code&gt;：设备控制请求&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;第三列&lt;/strong&gt;：处理该IRP请求的函数在内存中的实际地址&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;第四列&lt;/strong&gt;：该函数地址所属的内核模块&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;volatility3-4&#34;&gt;Volatility3
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol3 -f &amp;lt;内存镜像&amp;gt; windows.driverirp.DriverIrp
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250718133053635&#34; href=&#34;http://picture.928330.xyz/typora/image-20250718133053635.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250718133053635.png&#34; alt=&#34;image-20250718133053635&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Offset&lt;/strong&gt;：该驱动对象在内存中的虚拟地址&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Driver Name&lt;/strong&gt;：驱动对象的名称&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;IRP&lt;/strong&gt;：IRP的主要功能码，代表了驱动程序注册要处理的I/O操作类型，例如：
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;IRP_MJ_CREATE&lt;/code&gt;：文件或设备创建/打开请求&lt;/li&gt;
&lt;li&gt;&lt;code&gt;IRP_MJ_CLOSE&lt;/code&gt;：文件或设备关闭请求&lt;/li&gt;
&lt;li&gt;&lt;code&gt;IRP_MJ_READ&lt;/code&gt;：读取请求&lt;/li&gt;
&lt;li&gt;&lt;code&gt;IRP_MJ_WRITE&lt;/code&gt;：写入请求&lt;/li&gt;
&lt;li&gt;&lt;code&gt;IRP_MJ_DEVICE_CONTROL&lt;/code&gt;：设备控制请求，是驱动程序功能的主要入口&lt;/li&gt;
&lt;li&gt;&lt;code&gt;IRP_MJ_INTERNAL_DEVICE_CONTROL&lt;/code&gt;：内部设备控制请求&lt;/li&gt;
&lt;li&gt;&lt;code&gt;IRP_MJ_PNP&lt;/code&gt;：即插即用相关的请求&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Address&lt;/strong&gt;：处理该类型IRP请求的函数在内存中的实际地址&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Module&lt;/strong&gt;：该函数地址所属的内核模块（驱动文件）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Symbol&lt;/strong&gt;：具体的函数名&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;查看内核回调callbacks&#34;&gt;查看内核回调（callbacks）
&lt;/h3&gt;&lt;h4 id=&#34;volatility2-5&#34;&gt;Volatility2
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; callbacks
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250718170912078&#34; href=&#34;http://picture.928330.xyz/typora/image-20250718170912078.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250718170912078.png&#34; alt=&#34;image-20250718170912078&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h4 id=&#34;volatility3-5&#34;&gt;Volatility3
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol3 -f &amp;lt;内存镜像&amp;gt; windows.callbacks.Callbacks
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250718171002430&#34; href=&#34;http://picture.928330.xyz/typora/image-20250718171002430.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250718171002430.png&#34; alt=&#34;image-20250718171002430&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Type&lt;/code&gt;：回调类型&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;当这类事件发生时，内核会调用所有注册在此的回调函数，例如：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;PspCreateProcessNotifyRoutine&lt;/code&gt;: 当一个新进程被创建时触发&lt;/li&gt;
&lt;li&gt;&lt;code&gt;PspLoadImageNotifyRoutine&lt;/code&gt;: 当一个可执行文件或DLL被加载到内存时触发&lt;/li&gt;
&lt;li&gt;&lt;code&gt;KeBugCheckCallbackListHead&lt;/code&gt;: 当系统发生蓝屏崩溃时触发&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Callback&lt;/code&gt;：回调函数地址&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Module&lt;/code&gt;：所属模块&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;它指明了这个回调函数属于哪个内核模块，即驱动程序&lt;/p&gt;
&lt;p&gt;在正常情况下，这里应该都是&lt;code&gt;ntoskrnl&lt;/code&gt;（内核自身）或已知的、合法的硬件驱动程序（如&lt;code&gt;tcpip&lt;/code&gt;,&lt;code&gt;ndis&lt;/code&gt;等）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Symbol&lt;/code&gt;：回调函数的具体名称&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Detail&lt;/code&gt;：补充说明&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;查看系统调用ssdt&#34;&gt;查看系统调用（ssdt）
&lt;/h3&gt;&lt;h4 id=&#34;volatility2-6&#34;&gt;Volatility2
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; ssdt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250718102449369&#34; href=&#34;http://picture.928330.xyz/typora/image-20250718102449369.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250718102449369.png&#34; alt=&#34;image-20250718102449369&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Entry&lt;/code&gt;&lt;/strong&gt;：SSDT 表中的索引号（入口点编号），以十六进制表示&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Address&lt;/code&gt;&lt;/strong&gt;：该索引号对应的内核函数在内存中的实际地址&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;owned by&lt;/code&gt;&lt;/strong&gt;：指明了这个函数地址属于哪个内核模块&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如果一个函数的Owner不是 &lt;code&gt;ntoskrnl.exe&lt;/code&gt;或&lt;code&gt;win32k.sys&lt;/code&gt;，而是另一个可疑的驱动，或者显示为 &lt;code&gt;(unknown)&lt;/code&gt;，就意味着该函数很可能已被挂钩（Hook），指向了恶意的函数&lt;/p&gt;
&lt;h4 id=&#34;volatility3-6&#34;&gt;Volatility3
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol3 -f &amp;lt;内存镜像&amp;gt; windows.ssdt.SSDT
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250718103947530&#34; href=&#34;http://picture.928330.xyz/typora/image-20250718103947530.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250718103947530.png&#34; alt=&#34;image-20250718103947530&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Index&lt;/code&gt;&lt;/strong&gt;：SSDT 表中的索引号（入口点编号）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Address&lt;/code&gt;&lt;/strong&gt;：该索引号对应的内核函数在内存中的实际地址&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Module&lt;/code&gt;&lt;/strong&gt;：指明了这个函数地址属于哪个内核模块&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Symbol&lt;/code&gt;&lt;/strong&gt;：该内核函数的具体名称&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;查看符号链接symlinkscan&#34;&gt;查看符号链接（symlinkscan）
&lt;/h3&gt;&lt;p&gt;通过扫描内存以寻找并打印出&lt;code&gt;_OBJECT_SYMBOLIC_LINK&lt;/code&gt;结构，列出系统内核中存在的符号链接及其指向的目标&lt;/p&gt;
&lt;h4 id=&#34;volatility2-7&#34;&gt;Volatility2
&lt;/h4&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile=&amp;lt;配置文件&amp;gt; symlinkscan
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250718174120289&#34; href=&#34;http://picture.928330.xyz/typora/image-20250718174120289.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250718174120289.png&#34; alt=&#34;image-20250718174120289&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h3 id=&#34;输出字段详解&#34;&gt;输出字段详解
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Offset(P)&lt;/code&gt;&lt;/strong&gt;：该符号链接对象（&lt;code&gt;_OBJECT_SYMBOLIC_LINK&lt;/code&gt; 结构）在内存中的物理地址&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;#Ptr&lt;/code&gt;&lt;/strong&gt;：指向该符号链接对象的指针数量&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;#Hnd&lt;/code&gt;&lt;/strong&gt;：该符号链接对象的句柄数量&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Creation time&lt;/code&gt;&lt;/strong&gt;：该符号链接被创建的时间戳（以UTC标准时间显示）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;From&lt;/code&gt;&lt;/strong&gt;：这是符号链接自身的名称，可以理解为“快捷方式”的名字&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;To&lt;/code&gt;&lt;/strong&gt;：这是该符号链接实际指向的目标对象的名称，可以理解为“快捷方式”指向的“真实文件”的路径&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;volatility3-7&#34;&gt;Volatility3
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol3 -f &amp;lt;内存镜像&amp;gt; windows.symlinkscan.SymlinkScan
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250718175036375&#34; href=&#34;http://picture.928330.xyz/typora/image-20250718175036375.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250718175036375.png&#34; alt=&#34;image-20250718175036375&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Offset&lt;/code&gt;&lt;/strong&gt;：该符号链接对象（&lt;code&gt;_OBJECT_SYMBOLIC_LINK&lt;/code&gt; 结构）在内存中的虚拟地址&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;CreateTime&lt;/code&gt;&lt;/strong&gt;：该符号链接被创建的时间戳（以UTC标准时间显示）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;From Name&lt;/code&gt;&lt;/strong&gt;：这是符号链接自身的名称，可以理解为“快捷方式”的名字&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;To Name&lt;/code&gt;&lt;/strong&gt;：这是该符号链接实际指向的目标对象的名称，可以理解为“快捷方式”指向的“真实文件”的路径&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;进程分析&#34;&gt;进程分析
&lt;/h2&gt;&lt;h3 id=&#34;查看进程列表pslistpsscan&#34;&gt;查看进程列表（pslist/psscan）
&lt;/h3&gt;&lt;h4 id=&#34;volatility2-8&#34;&gt;Volatility2
&lt;/h4&gt;&lt;p&gt;仅查看显式进程：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; pslist 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;查看包括隐藏进程在内的进程：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; psscan
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250713121935145&#34; href=&#34;http://picture.928330.xyz/typora/image-20250713121935145.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250713121935145.png&#34; alt=&#34;image-20250713121935145&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Offset(V)&lt;/strong&gt;：进程对象在内存中的虚拟地址&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Name&lt;/strong&gt;：进程的映像文件名（通常是&lt;code&gt;.exe&lt;/code&gt;文件名）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;PID&lt;/strong&gt;：进程ID，每个进程唯一的身份编号&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;PPID&lt;/strong&gt;：父进程ID，即启动这个进程的那个进程的ID&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Thds&lt;/strong&gt;：线程数，该进程拥有的线程数量&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Hnds&lt;/strong&gt;：句柄数，该进程打开的句柄数量&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Sess&lt;/strong&gt;：会话ID，用于区分不同的用户登录会话&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Wow64&lt;/strong&gt;：如果为 &lt;code&gt;True&lt;/code&gt;，表示一个32位进程运行在64位系统上&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Start&lt;/strong&gt;：进程的创建时间&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Exit&lt;/strong&gt;：进程的退出时间（如果进程已终止）&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;volatility3-8&#34;&gt;Volatility3
&lt;/h4&gt;&lt;p&gt;仅查看显式进程：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol3 -f &amp;lt;内存镜像&amp;gt; windows.pslist.PsList	
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;查看包括隐藏进程在内的进程：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol3 -f &amp;lt;内存镜像&amp;gt; windows.psscan.PsScan	
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250713113512320.png&#34; alt=&#34;image-20250713113512320&#34; style=&#34;zoom：80%;&#34; /&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;PID&lt;/strong&gt;：进程ID&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;PPID&lt;/strong&gt;：父进程ID，即启动这个进程的那个进程的ID&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ImageFileName&lt;/strong&gt;：进程的映像文件名，通常是&lt;code&gt;.exe&lt;/code&gt;文件名&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Offset(V)&lt;/strong&gt;：进程对象在内存中的虚拟地址&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Threads&lt;/strong&gt;：线程数，该进程拥有的线程数量&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Handles&lt;/strong&gt;：句柄数，该进程打开的句柄数量&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;SessionID&lt;/strong&gt;：会话ID&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Wow64&lt;/strong&gt;：如果为 &lt;code&gt;True&lt;/code&gt;，表示一个32位进程运行在64位系统上&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;CreatTime&lt;/strong&gt;：进程的创建时间&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ExitTime&lt;/strong&gt;：如果进程已终止，显示进程的退出时间&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;File output：是否已经被导出（dump）&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;查看进程父子关系pstree&#34;&gt;查看进程父子关系（pstree）
&lt;/h3&gt;&lt;h4 id=&#34;volatility2-9&#34;&gt;Volatility2
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; pstree
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250706184310572.png&#34; alt=&#34;image-20250706184310572&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;p&gt;&lt;strong&gt;区分父子进程&lt;/strong&gt;：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;wininit.exe&lt;/strong&gt;：行首没有点，它是这个分支的顶级进程&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;services.exe&lt;/strong&gt;：行首有 &lt;strong&gt;1个点&lt;/strong&gt;，它位于 &lt;code&gt;wininit.exe&lt;/code&gt;（0个点）的下方，所以 &lt;code&gt;services.exe&lt;/code&gt; 是 &lt;code&gt;wininit.exe&lt;/code&gt; 的子进程&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;TCPSVCS.EXE&lt;/strong&gt;：行首有 &lt;strong&gt;2个点&lt;/strong&gt;，它位于 &lt;code&gt;services.exe&lt;/code&gt;（1个点）的下方，所以 &lt;code&gt;TCPSVCS.EXE&lt;/code&gt; 是 &lt;code&gt;services.exe&lt;/code&gt; 的子进程&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;当一个进程的父进程ID（PPID）比它自身的进程ID（PID）还要大时，很可能有问题&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;volatility3-9&#34;&gt;Volatility3
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol3 vol.py -f &amp;lt;内存镜像&amp;gt; windows.pstree.PsTree
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250713122632330&#34; href=&#34;http://picture.928330.xyz/typora/image-20250713122632330.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250713122632330.png&#34; alt=&#34;image-20250713122632330&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;与volatility2不同，3使用&lt;code&gt;*&lt;/code&gt;来区分父子进程，&lt;code&gt;*&lt;/code&gt;越多，代表进程的层级越深，是更深层的子进程&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Path&lt;/strong&gt;：每个进程可执行文件在硬盘上的完整路径&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Cmd&lt;/strong&gt;：启动该进程时使用的完整命令行参数&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;发现隐藏进程psxview&#34;&gt;发现隐藏进程（psxview）
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;恶意进程一般会隐藏自身，而人工对比pslist和psscan又太麻烦太不可靠&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;可以使用psxview对比各个扫描方式，寻找隐藏进程&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;volatility2-10&#34;&gt;Volatility2
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; psxview
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250706223744048.png&#34; alt=&#34;image-20250706223744048&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;p&gt;&lt;strong&gt;过滤带有false的项目，可以很快看出哪些进程隐藏了自身（主要看第一个pslist和第二个psscan）：&lt;/strong&gt;&lt;/p&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250706223629735.png&#34; alt=&#34;image-20250706223629735&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;h4 id=&#34;volatility3-10&#34;&gt;Volatility3
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;python3 vol.py -f &amp;lt;内存镜像&amp;gt; windows.malware.psxview.PsXView
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250713130244162&#34; href=&#34;http://picture.928330.xyz/typora/image-20250713130244162.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250713130244162.png&#34; alt=&#34;image-20250713130244162&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;p&gt;过滤False项：&lt;/p&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250713131252462&#34; href=&#34;http://picture.928330.xyz/typora/image-20250713131252462.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250713131252462.png&#34; alt=&#34;image-20250713131252462&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h3 id=&#34;查看进程启动参数cmdline&#34;&gt;查看进程启动参数（cmdline）
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;能看到进程如何被创建的，包括命令行启动和exe文件点击启动&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;但看不到进程内部的交互，不知道进程干了什么&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;volatility2-11&#34;&gt;Volatility2
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; cmdline
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250704132409379.png&#34; alt=&#34;image-20250704132409379&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;h4 id=&#34;volatility3-11&#34;&gt;Volatility3
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol3 -f &amp;lt;内存镜像&amp;gt; windows.cmdline.CmdLine
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250713205930999.png&#34; alt=&#34;image-20250713205930999&#34; style=&#34;zoom：67%;&#34; /&gt;
&lt;h3 id=&#34;查看进程加载的dlldlllist&#34;&gt;查看进程加载的DLL（dlllist）
&lt;/h3&gt;&lt;h4 id=&#34;volatility2-12&#34;&gt;Volatility2
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; dlllist -p 进程pid
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250713210521338&#34; href=&#34;http://picture.928330.xyz/typora/image-20250713210521338.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250713210521338.png&#34; alt=&#34;image-20250713210521338&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h4 id=&#34;volatility3-12&#34;&gt;Volatility3
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol3 -f &amp;lt;内存镜像&amp;gt; windows.dlllist.DllList --pid 进程pid
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;相较于vol2，vol3还给出了dll的加载时间&lt;code&gt;LoadTime&lt;/code&gt;：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250713210420002&#34; href=&#34;http://picture.928330.xyz/typora/image-20250713210420002.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250713210420002.png&#34; alt=&#34;image-20250713210420002&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h3 id=&#34;查看进程权限privs&#34;&gt;查看进程权限（privs）
&lt;/h3&gt;&lt;h4 id=&#34;volatility2-13&#34;&gt;Volatility2
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; privs
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250714095647063&#34; href=&#34;http://picture.928330.xyz/typora/image-20250714095647063.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250714095647063.png&#34; alt=&#34;image-20250714095647063&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h4 id=&#34;volatility3-13&#34;&gt;Volatility3
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol3 -f &amp;lt;内存镜像&amp;gt; windows.privileges.Privs
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250714094913789&#34; href=&#34;http://picture.928330.xyz/typora/image-20250714094913789.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250714094913789.png&#34; alt=&#34;image-20250714094913789&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h3 id=&#34;查看进程对应用户sidgetsids&#34;&gt;查看进程对应用户SID（getsids）
&lt;/h3&gt;&lt;h4 id=&#34;volatility2-14&#34;&gt;Volatility2
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; getsids
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250716110818864&#34; href=&#34;http://picture.928330.xyz/typora/image-20250716110818864.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250716110818864.png&#34; alt=&#34;image-20250716110818864&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h4 id=&#34;volatility3-14&#34;&gt;Volatility3
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol3 -f &amp;lt;内存镜像&amp;gt; windows.getsids.GetSIDs 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250716110351479&#34; href=&#34;http://picture.928330.xyz/typora/image-20250716110351479.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250716110351479.png&#34; alt=&#34;image-20250716110351479&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;p&gt;相较于Volatility2，这个输出更加规范化：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;PID&lt;/strong&gt;：进程ID&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Process&lt;/strong&gt;：进程名&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;SID&lt;/code&gt;&lt;/strong&gt;：安全标识符的字符串表示&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Name&lt;/strong&gt;：该 SID 对应的通用名称&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;一个进程会对应多个SID，是因为一个进程的访问令牌中，不仅包含了其主要运行身份的SID，还包含了该身份所属的所有用户组的SID，这些SID共同决定了该进程的权限&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;例如，System(PID:4)这个进程，它关联了多个SID：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;S-1-5-18 (Local System)&lt;/strong&gt;：这是它的主身份，代表了系统的最高权限&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;S-1-5-32-544 (Administrators)&lt;/strong&gt;：表明它也属于管理员组&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;S-1-1-0 (Everyone)&lt;/strong&gt;：表明它也属于Everyone组&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;查看可能的恶意代码malfind&#34;&gt;查看可能的恶意代码（malfind）
&lt;/h3&gt;&lt;h4 id=&#34;volatility2-15&#34;&gt;Volatility2
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; malfind
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250714104850074&#34; href=&#34;http://picture.928330.xyz/typora/image-20250714104850074.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250714104850074.png&#34; alt=&#34;image-20250714104850074&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;p&gt;volatility2还有一个社区插件，是malfind的深度扫描版本malfinddeep：&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/superponible/volatility-plugins&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/superponible/volatility-plugins
    
    &lt;span style=&#34;white-space: nowrap;&#34;&gt;&lt;svg width=&#34;.7em&#34;
        height=&#34;.7em&#34; viewBox=&#34;0 0 21 21&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;
        &lt;path d=&#34;m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z&#34; fill=&#34;currentColor&#34; /&gt;
        &lt;path d=&#34;M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z&#34;
            fill=&#34;currentColor&#34;&gt;
    &lt;/svg&gt;&lt;/span&gt;
    
&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; malfinddeep
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;volatility3-15&#34;&gt;Volatility3
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol3 -f MemoryDump_Lab5.raw windows.malware.malfind.Malfind
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250714104152510&#34; href=&#34;http://picture.928330.xyz/typora/image-20250714104152510.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250714104152510.png&#34; alt=&#34;image-20250714104152510&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h3 id=&#34;提取进程内存memdumpdump&#34;&gt;提取进程内存（memdump/&amp;ndash;dump）
&lt;/h3&gt;&lt;p&gt;进程内存中潜藏着很多信息，把他们提取出来才能更好的做分析&lt;/p&gt;
&lt;p&gt;比如TrueCrypt进程中会有加密密钥，导出其为.dmp文件后，可以交给EFDD解密加密卷&lt;/p&gt;
&lt;h4 id=&#34;volatility2-16&#34;&gt;Volatility2
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; memdump -p &amp;lt;PID&amp;gt; -D &amp;lt;保存路径&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;提取后的文件为.dump，存储了进程所有的数据，可以在里面搜索目标字符串等&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;如果进程里有想要的文件，可以使用foremost分离文件&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;如果目标比较明显（比如图片），也可以用mv命令修改文件后缀再打开，再在里面找目标文件&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;volatility3-16&#34;&gt;Volatility3
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;vol3不再有单独的dump插件，直接在&lt;code&gt;PsList&lt;/code&gt;插件使用&lt;code&gt;--dump&lt;/code&gt;选项：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol3  -f &amp;lt;内存镜像&amp;gt; -o &amp;lt;保存路径&amp;gt; windows.pslist.PsList --pid &amp;lt;PID&amp;gt; --dump
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;这里的&lt;code&gt;-o&lt;/code&gt;选项用于指定导出文件的路径，必须放在&lt;code&gt;-f&lt;/code&gt;选项后一个！！&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;网络活动分析&#34;&gt;网络活动分析
&lt;/h2&gt;&lt;h3 id=&#34;查看网络连接netscannetstat&#34;&gt;查看网络连接（netscan/netstat）
&lt;/h3&gt;&lt;h4 id=&#34;volatility2-17&#34;&gt;Volatility2
&lt;/h4&gt;&lt;p&gt;查看当前以及历史、隐藏网络链接（这个是XP时代的工具了，很老，不一定有用）：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; connscan
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;查看当前网络链接：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; netscan
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250714113947510&#34; href=&#34;http://picture.928330.xyz/typora/image-20250714113947510.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250714113947510.png&#34; alt=&#34;image-20250714113947510&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;LISTENING&lt;/code&gt;&lt;/strong&gt;：表示某个程序正在一个端口上“监听”，等待外部连接的建立&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ESTABLISHED&lt;/code&gt;&lt;/strong&gt;：表示一个 TCP 连接已经成功建立，双方正在进行数据通信&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;CLOSED&lt;/code&gt;/&lt;code&gt;TIME_WAIT&lt;/code&gt;/&lt;code&gt;SYN_SENT&lt;/code&gt;&lt;/strong&gt;：表示各种已关闭或正在建立/关闭过程中的连接状态&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;UDP 是无连接的协议，所以它没有 &lt;code&gt;State&lt;/code&gt;（状态）字段&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;我们可以从中筛选已经建立链接的项：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; netscan | grep ESTABLISHED 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;如果当前系统中存在挖矿进程，网络连接列表又太长，就可以借此筛选，获取到矿池地址&lt;/p&gt;
&lt;p&gt;或者也可以根据提供的pid把它dump下来具体分析&lt;/p&gt;
&lt;h4 id=&#34;volatility3-17&#34;&gt;Volatility3
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;更加建议使用NetStat，报告更赏心悦目：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol3 -f &amp;lt;内存镜像&amp;gt; windows.netstat.NetStat
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250714114505605&#34; href=&#34;http://picture.928330.xyz/typora/image-20250714114505605.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250714114505605.png&#34; alt=&#34;image-20250714114505605&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;当然，vol3也是有NetScan的：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol3 -f &amp;lt;内存镜像&amp;gt; windows.netscan.NetScan
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250714113608063&#34; href=&#34;http://picture.928330.xyz/typora/image-20250714113608063.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250714113608063.png&#34; alt=&#34;image-20250714113608063&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h2 id=&#34;注册表分析&#34;&gt;注册表分析
&lt;/h2&gt;&lt;h3 id=&#34;查看注册表整体结构hivelist&#34;&gt;查看注册表整体结构（hivelist）
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;hivelist&lt;/code&gt;的主要作用是为后续的&lt;code&gt;printkey&lt;/code&gt;等插件提供每个Hive的虚拟地址（第一列）&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;volatility2-18&#34;&gt;Volatility2
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; hivelist
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250704132014554.png&#34; alt=&#34;image-20250704132014554&#34;  /&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ntuser.dat&lt;/code&gt;&lt;/strong&gt;：用户的注册表文件，这里表明Alissa Simpson和SmartNet是登录状态或近期登录过&lt;/p&gt;
&lt;h4 id=&#34;volatility3-18&#34;&gt;Volatility3
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol3 -f &amp;lt;内存镜像&amp;gt; windows.registry.hivelist.HiveList
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250714193939822&#34; href=&#34;http://picture.928330.xyz/typora/image-20250714193939822.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250714193939822.png&#34; alt=&#34;image-20250714193939822&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h3 id=&#34;查看具体注册表项printkey&#34;&gt;查看具体注册表项（printkey）
&lt;/h3&gt;&lt;h4 id=&#34;volatility2-19&#34;&gt;Volatility2
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;使用逻辑路径：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; printkey -K &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;顶层路径\子路径&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;一定是从对应的hive开始，比如&lt;code&gt;SAM&lt;/code&gt;，&lt;code&gt;SECURITY&lt;/code&gt;等，而不是那五个根键：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250714194449147&#34; href=&#34;http://picture.928330.xyz/typora/image-20250714194449147.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250714194449147.png&#34; alt=&#34;image-20250714194449147&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;也可以使用虚拟地址：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; printkey -o 虚拟地址
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250714194807769.png&#34; alt=&#34;image-20250714194807769&#34; style=&#34;zoom:150%;&#34; /&gt;
&lt;p&gt;&lt;strong&gt;再根据结果返回的&lt;code&gt;SubKeys&lt;/code&gt;使用-K参数：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2  -f  &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; -o 虚拟地址 printkey -K &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;子键名称&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250714194911155&#34; href=&#34;http://picture.928330.xyz/typora/image-20250714194911155.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250714194911155.png&#34; alt=&#34;image-20250714194911155&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h4 id=&#34;volatility3-19&#34;&gt;Volatility3
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;vol3只指定路径会去所有hive中寻找，需要使用逻辑路径＋虚拟地址才能精确定位：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol3 -f &amp;lt;内存镜像&amp;gt; windows.registry.printkey.PrintKey --offset 虚拟地址 --key &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;顶层路径\子路径&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250714195649342&#34; href=&#34;http://picture.928330.xyz/typora/image-20250714195649342.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250714195649342.png&#34; alt=&#34;image-20250714195649342&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h2 id=&#34;用户活动与执行历史&#34;&gt;用户活动与执行历史
&lt;/h2&gt;&lt;h3 id=&#34;查看cmd历史命令cmdscan&#34;&gt;查看cmd历史命令（cmdscan）
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;输出干净，有时能找到超出缓冲区范围的命令，即使已经清屏&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;但没有命令的输出结果，且只限于cmd&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;volatility2-20&#34;&gt;Volatility2
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; cmdscan
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250714200632869.png&#34; alt=&#34;image-20250714200632869&#34; style=&#34;zoom:150%;&#34; /&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Application：DumpIt.exe&lt;/code&gt;&lt;/strong&gt;：Volatility在内存中定位到的这个命令历史记录区是属于&lt;code&gt;DumpIt.exe&lt;/code&gt;的&lt;/p&gt;
&lt;p&gt;这里cmdcount=0，说明没有发现cmd命令&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;DumpIt.exe&lt;/code&gt;是于快速创建物理内存完整转储的工具，也就是创建这个&amp;lt;内存镜像&amp;gt;用的&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;volatility3-20&#34;&gt;Volatility3
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;vol3对于win7等老系统可能不支持，分析会报错，使用时注意&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol3 -f &amp;lt;内存镜像&amp;gt; windows.cmdscan.CmdScan
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250714203803483&#34; href=&#34;http://picture.928330.xyz/typora/image-20250714203803483.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250714203803483.png&#34; alt=&#34;image-20250714203803483&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1.概览信息&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;PID     Process     ConsoleInfo     Property                Address         Data
2084    conhost.exe 0x1445c89b900   _COMMAND_HISTORY        0x1445c89b900   None
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这部分告诉我们，在 PID 为&lt;code&gt;2084&lt;/code&gt;的&lt;code&gt;conhost.exe&lt;/code&gt;进程中，于内存地址&lt;code&gt;0x1445c89b900&lt;/code&gt;处，找到了一个&lt;code&gt;_COMMAND_HISTORY&lt;/code&gt;（命令历史）的数据结构&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2.历史记录的元数据&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;下面几行带单个&lt;code&gt;*&lt;/code&gt;的是这个历史记录本身的属性：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;* 2084  conhost.exe ... _COMMAND_HISTORY.Application  ... cmd.exe
* 2084  conhost.exe ... _COMMAND_HISTORY.CommandCount ... 3
* 2084  conhost.exe ... _COMMAND_HISTORY.CommandCountMax ... 50
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Application：cmd.exe&lt;/code&gt;&lt;/strong&gt;：表明这个命令行窗口的应用程序是&lt;code&gt;cmd.exe&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;CommandCount：3&lt;/code&gt;&lt;/strong&gt;：它表示在这个命令历史缓冲区中，一共记录了3条命令&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;CommandCountMax：50&lt;/code&gt;&lt;/strong&gt;：表示这个缓冲区最多可以记录50条命令&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;3.恢复出的命令内容&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;下面带两个星号&lt;code&gt;**&lt;/code&gt;的部分是用户输入过的命令：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;** 2084 conhost.exe ... CommandBucket_Command_0 ... ping easyforensics.com
** 2084 conhost.exe ... CommandBucket_Command_1 ... ipconfig
** 2084 conhost.exe ... CommandBucket_Command_2 ... ping easyforensics.com
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;CommandBucket_Command_X&lt;/code&gt;&lt;/strong&gt;：代表历史记录缓冲区中的第 X 个槽位&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Data 列&lt;/strong&gt;：清晰地显示了用户按顺序输入的三条命令：
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;ping easyforensics.com&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ipconfig&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ping easyforensics.com&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;查看控制台完整交互consoles&#34;&gt;查看控制台完整交互（consoles）
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;consoles&lt;/code&gt;不仅能看到输入的命令，还能看到命令返回的输出结果，只要是conhost.exe控制的交互式窗口(cmd、poweshell等)就能提取&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;但它受缓冲区大小限制，只寻找当前屏幕缓冲区的内容，如果清屏了(&lt;code&gt;cls&lt;/code&gt;)就找不到了&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;volatility2-21&#34;&gt;Volatility2
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; consoles
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250714202855628&#34; href=&#34;http://picture.928330.xyz/typora/image-20250714202855628.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250714202855628.png&#34; alt=&#34;image-20250714202855628&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h4 id=&#34;volatility3-21&#34;&gt;Volatility3
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;vol3对于win7等老系统可能不支持，分析会报错，使用时注意&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol3 -f &amp;lt;内存镜像&amp;gt; windows.consoles.Consoles
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250714201124616&#34; href=&#34;http://picture.928330.xyz/typora/image-20250714201124616.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250714201124616.png&#34; alt=&#34;image-20250714201124616&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;p&gt;此处显示未找到控制台信息&amp;quot;Console Information Not Found&amp;quot;&lt;/p&gt;
&lt;h3 id=&#34;查看gui程序执行记录userassist&#34;&gt;查看GUI程序执行记录（userassist）
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;展示用户通过GUI启动的程序（点击快捷方式、开始菜单等）的信息，证明用户的主动操作行为&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;它只记录explorer.exe，不接受cmd.exe/powershell.exe，不能看见用户通过命令行启动的程序&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;volatility2-22&#34;&gt;Volatility2
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; userassist
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250704134021193.png&#34; alt=&#34;image-20250704134021193&#34; style=&#34;zoom: 50%;&#34; /&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Registry：...\ntuser.dat&lt;/code&gt;&lt;/strong&gt;：个人注册表配置文件，用户为Alissa Simpson&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;REG_BINARY&lt;/code&gt;&lt;/strong&gt;：程序名称&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Count&lt;/code&gt;&lt;/strong&gt;：程序启动次数&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Focus Count&lt;/code&gt;&lt;/strong&gt;：程序点击次数（焦点）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Last Update&lt;/code&gt;&lt;/strong&gt;：最后一次使用记录&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;volatility3-22&#34;&gt;Volatility3
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol3 -f &amp;lt;内存镜像&amp;gt; windows.registry.userassist.UserAssist
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250715113900449&#34; href=&#34;http://picture.928330.xyz/typora/image-20250715113900449.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250715113900449.png&#34; alt=&#34;image-20250715113900449&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h3 id=&#34;查看程序准备记录shimcacheshimcachemem&#34;&gt;查看程序准备记录（shimcache/shimcachemem）
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;记录任何准备执行的程序（包括后台服务、被浏览的文件等，不一定真的运行了）&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;它甚至能记录已被删除的程序的执行痕迹&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;volatility2-23&#34;&gt;Volatility2
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; shimcache
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250715124707154&#34; href=&#34;http://picture.928330.xyz/typora/image-20250715124707154.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250715124707154.png&#34; alt=&#34;image-20250715124707154&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h4 id=&#34;volatility3-23&#34;&gt;Volatility3
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol3 -f &amp;lt;内存镜像&amp;gt; windows.shimcachemem.ShimcacheMem
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250715124236951&#34; href=&#34;http://picture.928330.xyz/typora/image-20250715124236951.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250715124236951.png&#34; alt=&#34;image-20250715124236951&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h3 id=&#34;查看剪贴板内容clipboard&#34;&gt;查看剪贴板内容（clipboard）
&lt;/h3&gt;&lt;p&gt;&lt;span style=&#34;color:red&#34;&gt;&lt;strong&gt;volatility3没有此功能&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; clipboard
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;除了使用volatility2之外，也可以查看&lt;code&gt;ActivitiesCache.db&lt;/code&gt;数据库&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;从Windows10版本1803开始，&lt;code&gt;ActivitiesCache.db&lt;/code&gt;就开始记录剪贴板活动了，不过前提是要打开下面的设置：&lt;/p&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250715200841039&#34; href=&#34;http://picture.928330.xyz/typora/image-20250715200841039.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250715200841039.png&#34; alt=&#34;image-20250715200841039&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;p&gt;随后，在下面的路径找到&lt;code&gt;ActivitiesCache.db&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;C:&lt;span style=&#34;color:#98c379&#34;&gt;\U&lt;/span&gt;sers&lt;span style=&#34;color:#98c379&#34;&gt;\&amp;lt;&lt;/span&gt;username&amp;gt;&lt;span style=&#34;color:#98c379&#34;&gt;\A&lt;/span&gt;ppData&lt;span style=&#34;color:#98c379&#34;&gt;\L&lt;/span&gt;ocal&lt;span style=&#34;color:#98c379&#34;&gt;\C&lt;/span&gt;onnectedDevicesPlatform&lt;span style=&#34;color:#98c379&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;使用数据库链接后，使用它自带的&lt;code&gt;SmartLookup&lt;/code&gt;视图：&lt;/p&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250715200733649&#34; href=&#34;http://picture.928330.xyz/typora/image-20250715200733649.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250715200733649.png&#34; alt=&#34;image-20250715200733649&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;p&gt;这里我的ClipboardPayload字段为空，是因为我没有打开剪贴板历史记录，嘻嘻&lt;/p&gt;
&lt;h3 id=&#34;查看窗口图像screeenshot&#34;&gt;查看窗口图像（screeenshot）
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;从内存中提取窗口图像甚至恢复桌面画面，截图内容通常是窗口的客户区域，不是全屏桌面&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;需要安装Pillow库：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;source&lt;/span&gt; /home/kali/volatility2/venv_volatility2/bin/activate
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pip2 install Pillow
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;deactivate
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;使用的同时必须指定保存路径（&amp;ndash;dump-dir=）&lt;/strong&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; screenshot --dump-dir&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;保存路径
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250706225854144.png&#34; alt=&#34;image-20250706225854144&#34; style=&#34;zoom: 67%;&#34; /&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;文件名&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;session_0&lt;/td&gt;
          &lt;td&gt;会话 0，表示本地物理桌面用户或服务（如 SYSTEM）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;WinSta0&lt;/td&gt;
          &lt;td&gt;用户交互的窗口站（Window Station），默认GUI桌面就在这里&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Default&lt;/td&gt;
          &lt;td&gt;当前活动桌面&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Winlogon&lt;/td&gt;
          &lt;td&gt;登录界面桌面，可能在锁屏状态时显示&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Disconnect&lt;/td&gt;
          &lt;td&gt;断开连接时显示的桌面（比如远程桌面断开）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Service-0x0-3e7$&lt;/td&gt;
          &lt;td&gt;代表SYSTEM服务账户的窗口站&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;mssrestricteddesk&lt;/td&gt;
          &lt;td&gt;某些安全子系统（如 Speech 或 Office 隔离）的沙盒桌面&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;比如我这里获得的一张当时的屏幕截图&lt;code&gt;session_2.WinSta0.Default.png&lt;/code&gt;，说明用户在查看一张图片：&lt;/p&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250715204836602&#34; href=&#34;http://picture.928330.xyz/typora/image-20250715204836602.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250715204836602.png&#34; alt=&#34;image-20250715204836602&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;p&gt;图片名base64解码就是flag：&lt;code&gt;flag{!!_w3LL_d0n3_St4g3-1_0g_L4B_5_D0n3_!!}&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&#34;查看记事本中的内容notepad&#34;&gt;查看记事本中的内容（notepad）
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;本质是扫描记事本进程&lt;code&gt;notepad.exe&lt;/code&gt;，还原的是正在显示和编辑的内容&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span style=&#34;color:red&#34;&gt;&lt;strong&gt;volatility3没有此功能&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; iehistory
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;查看用户可能编辑的内容editbox&#34;&gt;查看用户可能编辑的内容（editbox）
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;它比&lt;code&gt;notepad&lt;/code&gt;插件更加通用，不只针对记事本，而是扫描所有进程的内存，寻找所有编辑控件并提取文本&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span style=&#34;color:red&#34;&gt;&lt;strong&gt;volatility3没有此功能&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; iehistory
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;查看ie浏览器历史记录iehistory&#34;&gt;查看ie浏览器历史记录（iehistory）
&lt;/h3&gt;&lt;p&gt;&lt;span style=&#34;color:red&#34;&gt;&lt;strong&gt;volatility3没有此功能&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; iehistory
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;查看chrome浏览器历史记录chromehistory&#34;&gt;查看chrome浏览器历史记录（chromehistory）
&lt;/h3&gt;&lt;p&gt;&lt;span style=&#34;color:red&#34;&gt;&lt;strong&gt;volatility3没有此功能&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;需要下载插件&lt;code&gt;chromehistory&lt;/code&gt;和&lt;code&gt;sqlite_help&lt;/code&gt;：&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/superponible/volatility-plugins/blob/master&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/superponible/volatility-plugins/blob/master
    
    &lt;span style=&#34;white-space: nowrap;&#34;&gt;&lt;svg width=&#34;.7em&#34;
        height=&#34;.7em&#34; viewBox=&#34;0 0 21 21&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;
        &lt;path d=&#34;m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z&#34; fill=&#34;currentColor&#34; /&gt;
        &lt;path d=&#34;M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z&#34;
            fill=&#34;currentColor&#34;&gt;
    &lt;/svg&gt;&lt;/span&gt;
    
&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; chromehistory
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;查看firefox浏览器历史记录firefoxhistory&#34;&gt;查看firefox浏览器历史记录（firefoxhistory）
&lt;/h3&gt;&lt;p&gt;&lt;span style=&#34;color:red&#34;&gt;&lt;strong&gt;volatility3没有此功能&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;需要下载插件&lt;code&gt;firefoxhistory&lt;/code&gt;和&lt;code&gt;sqlite_help&lt;/code&gt;：&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/superponible/volatility-plugins/blob/master&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/superponible/volatility-plugins/blob/master
    
    &lt;span style=&#34;white-space: nowrap;&#34;&gt;&lt;svg width=&#34;.7em&#34;
        height=&#34;.7em&#34; viewBox=&#34;0 0 21 21&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;
        &lt;path d=&#34;m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z&#34; fill=&#34;currentColor&#34; /&gt;
        &lt;path d=&#34;M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z&#34;
            fill=&#34;currentColor&#34;&gt;
    &lt;/svg&gt;&lt;/span&gt;
    
&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; firefoxhistory
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;根据历史记录，我们可以去内存中查找是否有对应的文件&lt;/strong&gt;：&lt;a class=&#34;link&#34; href=&#34;#%e6%96%87%e4%bb%b6%e6%89%ab%e6%8f%8f%e4%b8%8e%e6%8f%90%e5%8f%96&#34; &gt;文件扫描与提取
    
&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;查看已安装的软件uninstallinfo&#34;&gt;查看已安装的软件（uninstallinfo）
&lt;/h3&gt;&lt;p&gt;&lt;span style=&#34;color:red&#34;&gt;&lt;strong&gt;volatility3没有此功能&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;需要下载插件&lt;code&gt;uninstallinfo&lt;/code&gt;：&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/superponible/volatility-plugins/blob/master&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/superponible/volatility-plugins/blob/master
    
    &lt;span style=&#34;white-space: nowrap;&#34;&gt;&lt;svg width=&#34;.7em&#34;
        height=&#34;.7em&#34; viewBox=&#34;0 0 21 21&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;
        &lt;path d=&#34;m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z&#34; fill=&#34;currentColor&#34; /&gt;
        &lt;path d=&#34;M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z&#34;
            fill=&#34;currentColor&#34;&gt;
    &lt;/svg&gt;&lt;/span&gt;
    
&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; uninstallinfo
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;查看查入系统的usb设备usbstor&#34;&gt;查看查入系统的USB设备（usbstor）
&lt;/h3&gt;&lt;p&gt;&lt;span style=&#34;color:red&#34;&gt;&lt;strong&gt;volatility3没有此功能&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;需要下载插件&lt;code&gt;usbstor&lt;/code&gt;：&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/ruokeqx/tool-for-CTF/tree/master/volatility_plugins&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/ruokeqx/tool-for-CTF/tree/master/volatility_plugins
    
    &lt;span style=&#34;white-space: nowrap;&#34;&gt;&lt;svg width=&#34;.7em&#34;
        height=&#34;.7em&#34; viewBox=&#34;0 0 21 21&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;
        &lt;path d=&#34;m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z&#34; fill=&#34;currentColor&#34; /&gt;
        &lt;path d=&#34;M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z&#34;
            fill=&#34;currentColor&#34;&gt;
    &lt;/svg&gt;&lt;/span&gt;
    
&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; usbstor
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;密码和凭证获取仅volatility2&#34;&gt;密码和凭证获取（仅volatility2）
&lt;/h2&gt;&lt;p&gt;&lt;span style=&#34;color:red;font-size:23px&#34;&gt;&lt;strong&gt;volatility3没有下面的功能&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;h3 id=&#34;提取本地账户哈希hashdump&#34;&gt;提取本地账户哈希（hashdump）
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;使用SYSTEM里面的SYSKEY提取SAM中的密码哈希&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; hashdump
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;输出格式是：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[&lt;span style=&#34;color:#e06c75&#34;&gt;用户名&lt;/span&gt;]&lt;span style=&#34;color:#56b6c2&#34;&gt;:&lt;/span&gt;[&lt;span style=&#34;color:#e06c75&#34;&gt;RID&lt;/span&gt;]&lt;span style=&#34;color:#56b6c2&#34;&gt;:&lt;/span&gt;[&lt;span style=&#34;color:#e06c75&#34;&gt;LM哈希&lt;/span&gt;]&lt;span style=&#34;color:#56b6c2&#34;&gt;:&lt;/span&gt;[&lt;span style=&#34;color:#e06c75&#34;&gt;NTLM哈希&lt;/span&gt;]&lt;span style=&#34;color:#56b6c2&#34;&gt;:::&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250704120945088&#34; href=&#34;http://picture.928330.xyz/typora/image-20250704120945088.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250704120945088.png&#34; alt=&#34;image-20250704120945088&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h3 id=&#34;提取lsa密钥lsadump&#34;&gt;提取LSA密钥（lsadump）
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;lsa是本地安全机构，通过它可以获取当前登录用户、服务账户等多种形式的凭证，甚至可能是明文密码&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; lsadump
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;以hex转储的形式输出，可能藏有东西&lt;/p&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250704120913200.png&#34; alt=&#34;image-20250704120913200&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;DefaultPassword&lt;/code&gt;&lt;/strong&gt;：系统为自动登录功能存储的密码，如果设置了就是对应用户的密码&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;NL$KM&lt;/code&gt;&lt;/strong&gt;：计算机的密钥，用于计算机和域控制器之间进行安全的通信和认证&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;DPAPI_SYSTEM&lt;/code&gt;&lt;/strong&gt;：系统级DPAPI的主密钥，用于解密用户保存的各种密码（浏览器里的、wifi密码等）&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;提取明文密码mimikatz&#34;&gt;提取明文密码（mimikatz）
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;实际上也是从lsass.exe里面提取，是lsadump的特化&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;非官方插件，需要下载：&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://raw.githubusercontent.com/volatilityfoundation/community/master/FrancescoPicasso&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://raw.githubusercontent.com/volatilityfoundation/community/master/FrancescoPicasso
    
    &lt;span style=&#34;white-space: nowrap;&#34;&gt;&lt;svg width=&#34;.7em&#34;
        height=&#34;.7em&#34; viewBox=&#34;0 0 21 21&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;
        &lt;path d=&#34;m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z&#34; fill=&#34;currentColor&#34; /&gt;
        &lt;path d=&#34;M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z&#34;
            fill=&#34;currentColor&#34;&gt;
    &lt;/svg&gt;&lt;/span&gt;
    
&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;还需要安装依赖，必须是对应旧版本的&lt;code&gt;construct&lt;/code&gt;库：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;source&lt;/span&gt; /home/kali/volatility2/venv_volatility2/bin/activate
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;pip2 install &lt;span style=&#34;color:#e06c75&#34;&gt;construct&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;==&lt;/span&gt;2.5.2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;deactivate
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;随后就可以使用了：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Shell&#34; data-lang=&#34;Shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; mimikatz
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250708203501496&#34; href=&#34;http://picture.928330.xyz/typora/image-20250708203501496.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250708203501496.png&#34; alt=&#34;image-20250708203501496&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h3 id=&#34;查看chrome记录的登录密码lastpass&#34;&gt;查看Chrome记录的登录密码（lastpass）
&lt;/h3&gt;&lt;p&gt;需要下载插件&lt;code&gt;lastpass&lt;/code&gt;：&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/ruokeqx/tool-for-CTF/tree/master/volatility_plugins&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/ruokeqx/tool-for-CTF/tree/master/volatility_plugins
    
    &lt;span style=&#34;white-space: nowrap;&#34;&gt;&lt;svg width=&#34;.7em&#34;
        height=&#34;.7em&#34; viewBox=&#34;0 0 21 21&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;
        &lt;path d=&#34;m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z&#34; fill=&#34;currentColor&#34; /&gt;
        &lt;path d=&#34;M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z&#34;
            fill=&#34;currentColor&#34;&gt;
    &lt;/svg&gt;&lt;/span&gt;
    
&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; lastpass
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;获取truecrypt秘钥信息truecryptmaster&#34;&gt;获取TrueCrypt秘钥信息（truecryptmaster）
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; truecryptmaster 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;获取truecrypt密码信息-truecryptpassphrase&#34;&gt;获取TrueCrypt密码信息 （truecryptpassphrase）
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; truecryptpassphrase 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;文件扫描与提取&#34;&gt;文件扫描与提取
&lt;/h2&gt;&lt;h3 id=&#34;扫描内存中的文件filescan&#34;&gt;扫描内存中的文件（filescan）
&lt;/h3&gt;&lt;h4 id=&#34;volatility2-24&#34;&gt;Volatility2
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; filescan 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;如果知道具体文件名称（&lt;code&gt;-i&lt;/code&gt;忽略大小写）：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; filescan | grep -i &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;secret.txt&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;如果想找指定文件类型（&lt;code&gt;-E&lt;/code&gt;正则匹配）：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;系统版本&amp;gt; filescan | grep  -E &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;jpg|png|jpeg|bmp|gif&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250706184859261&#34; href=&#34;http://picture.928330.xyz/typora/image-20250706184859261.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250706184859261.png&#34; alt=&#34;image-20250706184859261&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;最前面的十六进制是文件地址&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;volatility3-24&#34;&gt;Volatility3
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol3 -f &amp;lt;内存镜像&amp;gt; windows.filescan.FileScan
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250717182605948&#34; href=&#34;http://picture.928330.xyz/typora/image-20250717182605948.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250717182605948.png&#34; alt=&#34;image-20250717182605948&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h3 id=&#34;从内存中转储指定文件dumpfiles&#34;&gt;从内存中转储指定文件（dumpfiles）
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;filescan&lt;/code&gt;插件扫描的是&lt;code&gt;_FILE_OBJECT&lt;/code&gt;这样的内核结构，相当于找到了文件的档案卡&lt;/p&gt;
&lt;p&gt;&lt;code&gt;dumpfiles&lt;/code&gt;插件则是根据这张档案卡的指引，去内存中寻找文件的具体内容&lt;/p&gt;
&lt;p&gt;如果文件的内容当时没有被加载到内存（RAM）中，或者已经被操作系统置换到了页面文件（pagefile.sys）里，那么&lt;code&gt;dumpfiles&lt;/code&gt;就无法从内存镜像中提取出完整的文件数据&lt;/p&gt;
&lt;h4 id=&#34;volatility2-25&#34;&gt;Volatility2
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol2 -f &amp;lt;内存镜像&amp;gt; --profile&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&amp;lt;配置文件&amp;gt; dumpfiles -Q &amp;lt;物理地址&amp;gt; -D &amp;lt;目录&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;下载的文件是.data文件，改后缀或使用foremost等工具分析&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;volatility3-25&#34;&gt;Volatility3
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vol3 -f &amp;lt;内存镜像&amp;gt; -o &amp;lt;目录&amp;gt; windows.dumpfiles.DumpFiles --physaddr &amp;lt;物理地址&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;从内存中搜索字符串-strings&#34;&gt;从内存中搜索字符串 (strings)
&lt;/h3&gt;&lt;p&gt;Volatility3有&lt;code&gt;windows.strings.Strings&lt;/code&gt;插件，不过不太好用，我们主要目的还是搜索字符串&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;常见的用法是先用&lt;code&gt;memdump&lt;/code&gt;转储出某个可疑进程的内存文件，然后对这个小文件执行&lt;code&gt;strings&lt;/code&gt;，这样目标更明确，噪音也更少：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;strings 1234.dmp | grep -i &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;关键词&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
        </item>
        <item>
        <title>wireshark&amp;tshark简易指北</title>
        <link>https://blog.928330.xyz/p/wiresharktshark%E7%AE%80%E6%98%93%E6%8C%87%E5%8C%97/</link>
        <pubDate>Wed, 14 May 2025 01:15:30 +0800</pubDate>
        
        <guid>https://blog.928330.xyz/p/wiresharktshark%E7%AE%80%E6%98%93%E6%8C%87%E5%8C%97/</guid>
        <description>&lt;img src="http://picture.928330.xyz/typora/wireshark-for-cybersecurity.jpg" alt="Featured image of post wireshark&amp;tshark简易指北" /&gt;&lt;h1 id=&#34;wireshark过滤语法&#34;&gt;wireshark过滤语法
&lt;/h1&gt;&lt;h2 id=&#34;运算符&#34;&gt;运算符
&lt;/h2&gt;&lt;h3 id=&#34;比较运算符&#34;&gt;比较运算符
&lt;/h3&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th style=&#34;text-align: left&#34;&gt;操作符&lt;/th&gt;
          &lt;th style=&#34;text-align: left&#34;&gt;别名&lt;/th&gt;
          &lt;th style=&#34;text-align: left&#34;&gt;类C风格&lt;/th&gt;
          &lt;th style=&#34;text-align: left&#34;&gt;描述&lt;/th&gt;
          &lt;th style=&#34;text-align: left&#34;&gt;示例&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;eq&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;any_eq&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;==&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;等于&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;ip.src == 10.0.0.5&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;ne&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;all_ne&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;!=&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;不等于&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;ip.src != 10.0.0.5&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;all_eq&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;===&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;全等&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;ip.src === 10.0.0.5&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;any_ne&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;!==&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;不全等&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;ip.src !== 10.0.0.5&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;gt&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;&amp;gt;&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;大于&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;frame.len &amp;gt; 10&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;lt&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;&amp;lt;&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;小于&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;frame.len &amp;lt; 128&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;ge&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;&amp;gt;=&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;大于或等于&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;frame.len ge 0x100&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;le&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;&amp;lt;=&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;小于或等于&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;frame.len &amp;lt;= 0x20&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;contains&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;协议、字段或切片包含某个值&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;sip.To contains &amp;ldquo;a1762&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;matches&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;~&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;右侧的正则表达式将被用来匹配左侧的字符串&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;http.host matches &amp;ldquo;acme.(org|com|net)&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;span style=&#34;font-size:20px;color:red&#34;&gt;&lt;strong&gt;等于（==）和全等（===）的区别：&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;== 是一种宽松的比较，只要有一个值匹配即可（any if more than one）&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;=== 是一种严格的比较，所有可能的值都必须匹配（all if more than one）&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;同一个包，使用等于（==）可以过滤出源或目的端口为80报文，使用全等（===）则会匹配源目的端口都为80的报文&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip.addr == 10.0.0.0/8    等价于   ip.src==10.0.0.0/8 || ip.dst==10.0.0.0/8
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip.addr === 10.0.0.0/8    等价于   ip.src==10.0.0.0/8 &amp;amp;&amp;amp; ip.dst==10.0.0.0/8
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;逻辑运算符&#34;&gt;逻辑运算符
&lt;/h3&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;操作符&lt;/th&gt;
          &lt;th&gt;类C风格&lt;/th&gt;
          &lt;th&gt;描述&lt;/th&gt;
          &lt;th&gt;示例&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;and&lt;/td&gt;
          &lt;td&gt;&amp;amp;&amp;amp;&lt;/td&gt;
          &lt;td&gt;逻辑与&lt;/td&gt;
          &lt;td&gt;ip.src == 10.0.0.5 &lt;strong&gt;and&lt;/strong&gt; tcp.flags.fin == 1&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;or&lt;/td&gt;
          &lt;td&gt;||&lt;/td&gt;
          &lt;td&gt;逻辑或&lt;/td&gt;
          &lt;td&gt;ip.src == 10.0.0.5 &lt;strong&gt;or&lt;/strong&gt; ip.src == 192.1.1.1&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;xor&lt;/td&gt;
          &lt;td&gt;^^&lt;/td&gt;
          &lt;td&gt;逻辑异或，能且只能满足其中一个&lt;/td&gt;
          &lt;td&gt;tr.dst[0:3] == 0.6.29 &lt;strong&gt;xor&lt;/strong&gt; tr.src[0:3] == 0.6.29&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;not&lt;/td&gt;
          &lt;td&gt;!&lt;/td&gt;
          &lt;td&gt;逻辑非&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;!&lt;/strong&gt; udp&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;[…]&lt;/td&gt;
          &lt;td&gt;不涉及&lt;/td&gt;
          &lt;td&gt;[a:b]：从第a个字符开始取b个字符&lt;/td&gt;
          &lt;td&gt;http.request.method**[0:3]**==&amp;ldquo;GET&amp;rdquo;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;in&lt;/td&gt;
          &lt;td&gt;不涉及&lt;/td&gt;
          &lt;td&gt;匹配集合内的元素，代替==&lt;/td&gt;
          &lt;td&gt;http.request.method &lt;strong&gt;in&lt;/strong&gt; {&amp;ldquo;HEAD&amp;rdquo;, &amp;ldquo;GET&amp;rdquo;}&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;函数&#34;&gt;函数
&lt;/h2&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;函数&lt;/th&gt;
          &lt;th&gt;描述&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;upper&lt;/td&gt;
          &lt;td&gt;将字符串字段转换为大写&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;lower&lt;/td&gt;
          &lt;td&gt;将字符串字段转换为小写&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;len&lt;/td&gt;
          &lt;td&gt;返回字符串字段或字节字段的字节长度&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;count&lt;/td&gt;
          &lt;td&gt;返回帧中字段的出现次数&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;string&lt;/td&gt;
          &lt;td&gt;将非字符串字段转换为字符串&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;vals&lt;/td&gt;
          &lt;td&gt;将字段值转换为其值字符串（如果有）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;dec&lt;/td&gt;
          &lt;td&gt;将无符号整数字段转换为十进制字符串&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;hex&lt;/td&gt;
          &lt;td&gt;将无符号整数字段转换为十六进制字符串&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;max&lt;/td&gt;
          &lt;td&gt;返回参数的最大值&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;min&lt;/td&gt;
          &lt;td&gt;返回参数的最小值&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;abs&lt;/td&gt;
          &lt;td&gt;返回参数的绝对值&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;upperlower&#34;&gt;upper()、lower()
&lt;/h3&gt;&lt;p&gt;可以使用这两个函数，将字符串转化为大小写，再进行正则匹配，做到不区分大小写的功能&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;lower&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;http.server&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; ~ &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;apache&amp;#34;&lt;/span&gt;  //过滤HTTP响应头的server字段为apache的
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;upper&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;http.request.method&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; ~ &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;post|get&amp;#34;&lt;/span&gt;  //过滤http请求方法为POST或GET
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;len&#34;&gt;len()
&lt;/h3&gt;&lt;p&gt;len()函数将返回字段的字节大小，因此可以和比较操作符配合使用，过滤某个报文字段符合大小要求的报文&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;len&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;http.request.uri&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &amp;gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;10&lt;/span&gt;   //过滤http头部的URI字段，大于等于10字节的报文
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;len&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;http.host&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &amp;gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;20&lt;/span&gt;    //过滤HTTP主机名大于等于20字节的报文
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;string&#34;&gt;string()
&lt;/h3&gt;&lt;p&gt;当字段为非字符串类型，而又想转换为字符串字段再进行正则匹配时，很方便&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;string&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;ip.addr&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; ~ &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;^10|^11&amp;#34;&lt;/span&gt;    //过滤IP为10网段开头或者23网段开头的IP
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;string&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;ip.dst&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; matches r&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;^172\.(1[6-9]|2[0-9]|3[0-1])\.[0-9]{1,3}\.255&amp;#34;&lt;/span&gt;   //匹配目的IP中以255结尾的IP地址&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;172.16到172.31&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;maxmin&#34;&gt;max()、min()
&lt;/h3&gt;&lt;p&gt;max()和min()接受相同类型的任意数量的参数，并分别返回集合中最大/最小的参数&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;max&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;tcp.srcport,tcp.dstport&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &amp;lt;&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;1024&lt;/span&gt;   //过滤tcp源端口、目的端口，最大不能超过1024的报文
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;min&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;tcp.srcport+tcp.dstport&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt; &amp;gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;1024&lt;/span&gt;   //过滤tcp源端口+目的端口大于等于1024的报文
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;过滤ip&#34;&gt;过滤IP
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;1）源地址为192.168.0.1的包&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip.src == 192.168.0.1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;2）目的地址为192.168.0.1的包&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip.dst == 192.168.0.1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;3）源地址或目的地址是192.168.0.1的包&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip.addr == 192.168.0.1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;要原地址和目标地址一样就用===&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;4）排除上述包&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;!(表达式)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;过滤协议&#34;&gt;过滤协议
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;1）仅捕获某种协议的包&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;直接写协议名即可，如http（区分大小写）&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2）捕获多种协议的包&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;使用逻辑或&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;http or telent
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;3）排除某种协议的包&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;使用逻辑非&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;not http
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;! http
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;过滤端口需要指明协议&#34;&gt;过滤端口（需要指明协议）
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;1）捕获某一端口的包&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tcp.port == 80
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;2）捕获多端口的包&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;可以用and来表示多端口并列&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tcp.port == 80 and 8080
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;也可以用比较运算符&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;udp.port &amp;gt;= 2048
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;过滤长度内容&#34;&gt;过滤长度、内容
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;1）长度（数据段的长度）&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;udp.length &amp;gt;= 30                        //udp的payload长度
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;http.content_length &amp;lt;= 20          //http消息体长度
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;2）数据包内容&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;使用matches/contains&lt;/p&gt;
&lt;h2 id=&#34;过滤时间&#34;&gt;过滤时间
&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;frame.time &amp;gt;= &amp;#34;Apr 16, 2021 06:00:00.0&amp;#34; &amp;amp;&amp;amp; frame.time &amp;lt;= &amp;#34;Apr 16, 2021 06:59:00.0&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;frame.time &amp;gt; &amp;#34;2024-04-11 11:00:00&amp;#34; and frame.time &amp;lt; &amp;#34;2024-04-11 11:01:00&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;注意：时间是字符串，要用双引号括起来&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id=&#34;tshark基本命令&#34;&gt;tshark基本命令
&lt;/h1&gt;&lt;h2 id=&#34;-r--从一个已有的捕获文件读取数据包进行分析&#34;&gt;&lt;span style=&#34;color:red&#34;&gt;-r&lt;/span&gt; &amp;ndash; 从一个已有的捕获文件读取数据包进行分析
&lt;/h2&gt;&lt;p&gt;**&lt;code&gt;-r 111.pcap&lt;/code&gt;：**从名为 &lt;code&gt;111.pcap&lt;/code&gt; 的文件中读取数据包并简略打印出来&lt;/p&gt;
&lt;p&gt;&lt;span style=&#34;font-size:30px;color:#FF8800&#34;&gt;&lt;strong&gt;eg:&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;1.837951      192.168.1.12 -&amp;gt;192.168.1.5        TCP              72                 8080   -&amp;gt;  45940          [FIN, ACK] Seq=1 ...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;​      &lt;strong&gt;时间戳            原IP           目标IP          协议     数据包长度      源端口    目标端口       报文标头信息&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;-n-n--禁止反向解析&#34;&gt;&lt;span style=&#34;color:red&#34;&gt;-n/-N&lt;/span&gt; &amp;ndash; 禁止反向解析
&lt;/h2&gt;&lt;h3 id=&#34;-n--禁用域名解析不对-ip-地址和端口号进行名称解析&#34;&gt;&lt;span style=&#34;color:aqua&#34;&gt;-n&lt;/span&gt; &amp;ndash; 禁用域名解析，不对 IP 地址和端口号进行名称解析
&lt;/h3&gt;&lt;p&gt;默认情况下，&lt;code&gt;tshark&lt;/code&gt; 会尝试将捕获到的 IP 地址解析为主机名（192.168.1.1-&amp;gt;exaple.com），同时也会将端口号转换为服务名称（如 80 变成 &lt;code&gt;http&lt;/code&gt;，443 变成 &lt;code&gt;https&lt;/code&gt; 等）&lt;/p&gt;
&lt;p&gt;通过使用 &lt;code&gt;-n&lt;/code&gt; 参数，可以避免这些解析，直接显示原始的 IP 地址和端口号&lt;/p&gt;
&lt;p&gt;&lt;span style=&#34;font-size:30px;color:#FF8800&#34;&gt;&lt;strong&gt;eg:&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tshark -r file.pcap   //直接输出
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;192.168.1.1 -&amp;gt; example.com &lt;span style=&#34;color:#d19a66&#34;&gt;80&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tshark -n -r file.pcap  //-n输出
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;192.168.1.1 -&amp;gt; 93.184.216.34 &lt;span style=&#34;color:#d19a66&#34;&gt;80&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;-n--精准控制解析哪些层级&#34;&gt;&lt;span style=&#34;color:aqua&#34;&gt;-N&lt;/span&gt; &amp;ndash; 精准控制解析哪些层级
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;格式：-N &amp;lt;反向解析flag1&amp;gt; -N &amp;lt;反向解析flag2&amp;gt;&amp;hellip;&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th style=&#34;text-align: center&#34;&gt;flag取值&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;d&lt;/td&gt;
          &lt;td&gt;对于DNS包启用解析&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;m&lt;/td&gt;
          &lt;td&gt;启用MAC地址解析&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;n&lt;/td&gt;
          &lt;td&gt;启用网络地址解析&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;N&lt;/td&gt;
          &lt;td&gt;使用外部解析器（例如DNS）进行网络地址解析，n需要被同时启用才有效果&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;t&lt;/td&gt;
          &lt;td&gt;启用传输层端口解析&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: center&#34;&gt;v&lt;/td&gt;
          &lt;td&gt;启用VLAN ID的名称解析&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;span style=&#34;font-size:30px;color:#FF8800&#34;&gt;&lt;strong&gt;eg：&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tshark -r file.pcap   //直接输出
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;1.837951 192.168.1.12 -&amp;gt; 192.168.1.5 TCP &lt;span style=&#34;color:#d19a66&#34;&gt;72&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;45940&lt;/span&gt; -&amp;gt; &lt;span style=&#34;color:#d19a66&#34;&gt;80&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;[&lt;/span&gt;FIN, ACK&lt;span style=&#34;color:#56b6c2&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;Seq&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;Ack&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;2&lt;/span&gt; ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tshark -N t -r file.pcap  //-N t&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;解析传输层端口&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;输出
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;1.837951 192.168.1.12 -&amp;gt; 192.168.1.5 TCP &lt;span style=&#34;color:#d19a66&#34;&gt;72&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;45940&lt;/span&gt; -&amp;gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;(&lt;/span&gt;http&lt;span style=&#34;color:#56b6c2&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;80&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;[&lt;/span&gt;FIN, ACK&lt;span style=&#34;color:#56b6c2&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;Seq&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;Ack&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;2&lt;/span&gt; ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                                                                            ↑
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;-t--指定输出格式&#34;&gt;&lt;span style=&#34;color:red&#34;&gt;-T&lt;/span&gt; &amp;ndash; 指定输出格式
&lt;/h2&gt;&lt;p&gt;**&lt;code&gt;-T fields&lt;/code&gt;：**仅输出指定的字段（需配合 -e 使用）&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;-T text&lt;/code&gt;：**以普通文本格式输出（默认）&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;-T json&lt;/code&gt;：**以 JSON 格式输出&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;-T jsonraw&lt;/code&gt;：**以 JSON（包含原始数据）格式输出&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;-T ek&lt;/code&gt;：**以 ElasticSearch 格式输出&lt;/p&gt;
&lt;h2 id=&#34;-e--指定显示数据包中的特定字段&#34;&gt;&lt;span style=&#34;color:red&#34;&gt;-e&lt;/span&gt; &amp;ndash; 指定显示数据包中的特定字段
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;格式：-e &amp;ldquo;字段1&amp;rdquo; -e &amp;ldquo;字段2&amp;rdquo;&amp;hellip;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;ip.src&lt;/code&gt;：**显示源 IP 地址&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;ip.dst&lt;/code&gt;：**显示目标 IP 地址&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;http.host&lt;/code&gt;：**显示 HTTP 请求中的主机名&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;http.request.uri&lt;/code&gt;：**显示 HTTP 请求中的 URI（即请求的 URL 路径）&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;usbhid.data&lt;/code&gt;：**只提取USB HID 设备数据&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;frame.number&lt;/code&gt;：**显示数据包的报文帧数&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;frame.time&lt;/code&gt;：**显示数据包捕获的时间戳&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;frame.len&lt;/code&gt;：**显示数据包的长度&lt;/p&gt;
&lt;p&gt;&lt;span style=&#34;font-size:30px;color:#FF8800&#34;&gt;&lt;strong&gt;eg:&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tshark -n -r file.pcap -e &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;frame.number&amp;#34;&lt;/span&gt; -e &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;ip.addr&amp;#34;&lt;/span&gt; -e &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;tcp.port&amp;#34;&lt;/span&gt; -e tcp -T fields
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;//输出报文帧数、ip地址、端口、tcp协议的字段
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#d19a66&#34;&gt;1&lt;/span&gt;                  192.168.1.12,192.168.1.8                    37546,80                Transmission Control Protocol,SrcPort: ... 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;报文帧数                        ip地址                                        端口                                   tcp协议的字段
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;-y--筛选过滤报文&#34;&gt;&lt;span style=&#34;color:red&#34;&gt;-Y&lt;/span&gt; &amp;ndash; 筛选过滤报文
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;格式：-Y &amp;ldquo;过滤条件&amp;rdquo;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;用来过滤分析符合过滤表达式的报文，相当于wireshark最上面的过滤筛选栏功能&lt;/p&gt;
&lt;p&gt;&lt;span style=&#34;font-size:30px;color:#FF8800&#34;&gt;&lt;strong&gt;eg:&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tshark -n -r &amp;lt;filename&amp;gt; -Y &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;http.host == &amp;#34;&lt;/span&gt;web-server1&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;  //通过http.host过滤
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tshark -n -r http-keep-alive.pcap -Y &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;tcp.flags.syn==1&amp;amp;&amp;amp;tcp.flags.ack==0&amp;#34;&lt;/span&gt;  //过滤第一次握手的请求
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;-e--设置输出的控制字段&#34;&gt;&lt;span style=&#34;color:red&#34;&gt;-E&lt;/span&gt; &amp;ndash; 设置输出的控制字段
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;通过&lt;code&gt;-T&lt;/code&gt;参数来输出特定格式时，可以配合&lt;code&gt;-E&lt;/code&gt;参数来设置一些选项&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th style=&#34;text-align: left&#34;&gt;参数选项&lt;/th&gt;
          &lt;th style=&#34;text-align: left&#34;&gt;默认&lt;/th&gt;
          &lt;th style=&#34;text-align: left&#34;&gt;含义&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;bom=y|n&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;n&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;在输出前加上UTF-8字节顺序标记（十六进制ef、bb、bf）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;header=y|n&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;n&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;打印一个使用-e作为输出第一行的字段名称头部&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;separator=/t|/s|&amp;lt;character&amp;gt;&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;/t&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;设置字段分隔符，默认为/t，可以指定/s，即单个空格，或者自定义的其它字符&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;occurrence=f|l|a&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;a&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;打印每个字段的第一次(f)/最后一次(l)/或所有出现的内容(a)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;aggregator=,|/s|&amp;lt;character&amp;gt;&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;,&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;设置用于每个字段内的分割字符&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;quote=d|s|n&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;n&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;设置用于环绕字段的引号字符&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;mark&gt;&lt;strong&gt;n是null，无设置&lt;/strong&gt;&lt;/mark&gt;&lt;/p&gt;
&lt;p&gt;&lt;span style=&#34;font-size:30px;color:#FF8800&#34;&gt;&lt;strong&gt;eg:&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tshark -n -r file.pcap  -E &lt;span style=&#34;color:#e06c75&#34;&gt;header&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;y -E &lt;span style=&#34;color:#e06c75&#34;&gt;occurrence&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;l -Y &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;icmp.seq==21&amp;#39;&lt;/span&gt; -e &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;icmp.seq&amp;#39;&lt;/span&gt; ...  -T fields |column -t
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;//    -E &lt;span style=&#34;color:#e06c75&#34;&gt;occurrence&lt;/span&gt;&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;l：包通过IPIP封装，occurrence&lt;span style=&#34;color:#56b6c2&#34;&gt;=&lt;/span&gt;l指定输出外层IP
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;//    -Y &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;icmp.seq==21&amp;#39;&lt;/span&gt;：指定icmp.seq等于21的ICMP包
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;//    | column -t：将输出通过管道传输给 column 命令，使结果以表格的形式对齐
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;icmp.seq                          ip.src                            ip.dst                                ip     
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;21&lt;/span&gt;                                    114.132.116.32            113.145.123.23                 Internet Protocol Version 4，Src:，Dst:
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;-2--二次依赖分析&#34;&gt;&lt;span style=&#34;color:red&#34;&gt;-2&lt;/span&gt; &amp;ndash; 二次依赖分析
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;&lt;mark&gt;没有2以外的参数&lt;/mark&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;tshark会根据上下文报文的依赖关系（tshark称之为&lt;strong&gt;two-pass&lt;/strong&gt;，即进行两次分析），来显示相关报文关联信息，如：&lt;code&gt;response in frame #&lt;/code&gt;、&lt;code&gt;reply in frame&lt;/code&gt;、&lt;code&gt;TCP Port numbers reused&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;-i--指定要捕获数据的网络接口&#34;&gt;&lt;span style=&#34;color:red&#34;&gt;-i&lt;/span&gt; &amp;ndash; 指定要捕获数据的网络接口
&lt;/h2&gt;&lt;p&gt;**&lt;code&gt;-i eth0&lt;/code&gt;：**表示从 &lt;code&gt;eth0&lt;/code&gt; 网络接口捕获数据包&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;-i wlan0&lt;/code&gt;：**表示从无线网卡 &lt;code&gt;wlan0&lt;/code&gt; 捕获数据包&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;-i any&lt;/code&gt;：**表示捕获所有接口的流量&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;-&lt;/code&gt;：**表示从标准输入（stdin）捕获数据流&lt;/p&gt;
&lt;h2 id=&#34;-f--应用捕获过滤器只捕获特定的流量&#34;&gt;&lt;span style=&#34;color:red&#34;&gt;-f&lt;/span&gt; &amp;ndash; 应用捕获过滤器，只捕获特定的流量
&lt;/h2&gt;&lt;p&gt;**&lt;code&gt;-f &amp;quot;tcp&amp;quot;&lt;/code&gt;：**只捕获 TCP 流量&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;-f &amp;quot;port 80&amp;quot;&lt;/code&gt;：**只捕获端口为 80（HTTP）的流量&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;-f &amp;quot;src host 192.168.1.1&amp;quot;&lt;/code&gt;：**只捕获源地址为 &lt;code&gt;192.168.1.1&lt;/code&gt; 的流量&lt;/p&gt;
&lt;h2 id=&#34;-w--将捕获的数据包写入到文件中&#34;&gt;&lt;span style=&#34;color:red&#34;&gt;-w&lt;/span&gt; &amp;ndash; 将捕获的数据包写入到文件中
&lt;/h2&gt;&lt;p&gt;**&lt;code&gt;-w output.pcap&lt;/code&gt;：**将捕获的数据包保存到 &lt;code&gt;output.pcap&lt;/code&gt; 文件&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;-&lt;/code&gt;：**将捕获的内容输出到标准输出（stdout）&lt;/p&gt;
&lt;h2 id=&#34;options--其他可选参数&#34;&gt;&lt;span style=&#34;color:aqua&#34;&gt;options&lt;/span&gt; &amp;ndash; 其他可选参数
&lt;/h2&gt;&lt;p&gt;**&lt;code&gt;-V&lt;/code&gt;：**显示详细的包信息&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;-c &amp;lt;count&amp;gt;&lt;/code&gt;：**捕获指定数量的包后停止&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;-n&lt;/code&gt;：**禁止域名解析，使用 IP 地址而不是主机名显示&lt;/p&gt;
&lt;h2 id=&#34;filter指定显示过滤器&#34;&gt;&lt;span style=&#34;color:aqua&#34;&gt;&amp;lt;filter&amp;gt; &lt;/span&gt;指定显示过滤器
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;&lt;mark&gt;如果要用过滤器，一定要放到最后&lt;/mark&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;ip.addr == 192.168.1.1&lt;/code&gt;：**仅显示源或目标地址为 &lt;code&gt;192.168.1.1&lt;/code&gt; 的包。&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;tcp.port == 443&lt;/code&gt;：**仅显示端口为 443 的 TCP 数据包（通常用于 HTTPS 流量）。&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;http&lt;/code&gt;：**仅显示 HTTP 协议的数据包&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Vim编辑器完全使用教程</title>
        <link>https://blog.928330.xyz/p/vim%E7%BC%96%E8%BE%91%E5%99%A8%E5%AE%8C%E5%85%A8%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</link>
        <pubDate>Thu, 08 May 2025 15:28:02 +0800</pubDate>
        
        <guid>https://blog.928330.xyz/p/vim%E7%BC%96%E8%BE%91%E5%99%A8%E5%AE%8C%E5%85%A8%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</guid>
        <description>&lt;img src="http://picture.928330.xyz/typora/DeWatermark.ai_1756040226707.jpeg" alt="Featured image of post Vim编辑器完全使用教程" /&gt;&lt;h1 id=&#34;vim使用方式&#34;&gt;VIM使用方式
&lt;/h1&gt;&lt;h2 id=&#34;vim键盘图&#34;&gt;vim键盘图
&lt;/h2&gt;&lt;img src=&#34;http://picture.928330.xyz/typora/vi-vim-cheat-sheet-sch.gif&#34; alt=&#34;img&#34; style=&#34;zoom: 80%;&#34; /&gt;
&lt;h2 id=&#34;vim操作文件基本方式&#34;&gt;vim操作文件基本方式
&lt;/h2&gt;&lt;h3 id=&#34;打开文件&#34;&gt;打开文件
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;单个文件&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vim file1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;多个文件&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vim file1 file2 ... filen
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;该方式打开文件，显示屏默认显示第一个文件也就是 file1&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;文件之间的切换&#34;&gt;文件之间的切换
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;:ls&lt;/strong&gt; &amp;ndash; 列出 VIM 打开的所有文件&lt;/li&gt;
&lt;/ul&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250309200724231.png&#34; alt=&#34;image-20250309200724231&#34; style=&#34;zoom: 67%;&#34; /&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;:bn&lt;/strong&gt; &amp;ndash; 显示屏上显示第n个文件&lt;/li&gt;
&lt;/ul&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250309200823642.png&#34; alt=&#34;image-20250309200823642&#34; style=&#34;zoom: 67%;&#34; /&gt;
&lt;h3 id=&#34;显示多个文件&#34;&gt;显示多个文件
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;左右分屏&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vim -On file1 file2 ... filen
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这里的 n 是代表有几个文件需要分屏，从左至右依次显示 n 个文件&lt;/p&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250309201414346.png&#34; alt=&#34;image-20250309201414346&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;上下分屏&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vim -on file1 file2 ... filen
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;跟上一个命令不同的是 -on 中的 &lt;strong&gt;o 是小写&lt;/strong&gt;，这样将会上下依次显示 n 个文件&lt;/p&gt;
&lt;img src=&#34;C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20250309201606096.png&#34; alt=&#34;image-20250309201606096&#34; style=&#34;zoom:50%;&#34; /&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;分屏操作ctrlw系列&#34;&gt;分屏操作（ctrl+w系列）
&lt;/h3&gt;&lt;h4 id=&#34;左右分屏&#34;&gt;左右分屏
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Ctrl+w+s&lt;/strong&gt;  &amp;ndash; 上下分割当前打开的文件&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;:sp file&lt;/strong&gt; &amp;ndash; 上下分割当前文件和新打开的 file&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;上下分屏&#34;&gt;上下分屏
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Ctrl+w+v&lt;/strong&gt;  &amp;ndash; 左右分割当前打开的文件&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;:vsp file&lt;/strong&gt; &amp;ndash; 左右分割当前文件和新打开的 file&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;移动分屏&#34;&gt;移动分屏
&lt;/h4&gt;&lt;p&gt;&lt;mark&gt;&lt;strong&gt;大写字母&lt;/strong&gt;&lt;/mark&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Ctrl+w+H&lt;/strong&gt;  &amp;ndash; 将当前的分屏移动到左边&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ctrl+w+L&lt;/strong&gt;  &amp;ndash; 将当前的分屏移动到右边&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ctrl+w+J&lt;/strong&gt;  &amp;ndash; 将当前的分屏移动到上边&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ctrl+w+K&lt;/strong&gt;  &amp;ndash; 将当前的分屏移动到下边&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;在文件间切换光标&#34;&gt;在文件间切换光标
&lt;/h4&gt;&lt;p&gt;&lt;mark&gt;&lt;strong&gt;小写字母&lt;/strong&gt;&lt;/mark&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Ctrl+w+h&lt;/strong&gt;  &amp;ndash; 将当前光标定位到左边的屏幕&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ctrl+w+l&lt;/strong&gt;  &amp;ndash; 将当前光标定位到左边的屏幕&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ctrl+w+j&lt;/strong&gt;  &amp;ndash; 将当前光标定位到左边的屏幕&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ctrl+w+k&lt;/strong&gt;  &amp;ndash; 将当前光标定位到左边的屏幕&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;关闭分屏&#34;&gt;关闭分屏
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Ctrl+w+c&lt;/strong&gt;  &amp;ndash; 关闭当前的分屏(多个分屏就只关闭光标所在的分屏)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ctrl+w+q&lt;/strong&gt;  &amp;ndash; 关闭当前的分屏，如果是最后一个分屏将会退出 VIM&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;vim五大模式&#34;&gt;vim五大模式
&lt;/h2&gt;&lt;h3 id=&#34;普通模式&#34;&gt;普通模式
&lt;/h3&gt;&lt;p&gt;&lt;mark&gt;&lt;strong&gt;用户刚刚启动 vi/vim，便进入了普通模式&lt;/strong&gt;&lt;/mark&gt;&lt;/p&gt;
&lt;p&gt;&lt;mark&gt;&lt;strong&gt;此状态下敲击键盘动作会被 Vim 识别为命令，而非输入字符&lt;/strong&gt;&lt;/mark&gt;&lt;/p&gt;
&lt;h4 id=&#34;普通模式移动光标&#34;&gt;普通模式移动光标
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;快速移动光标&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;mark&gt;&lt;strong&gt;输入[数字n＋方向]，代表向某个方向移动n&lt;/strong&gt;&lt;/mark&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;h / ← / [backspace]&lt;/strong&gt;：向左移动光标&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;j / ↓&lt;/strong&gt;：向下移动光标&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;k / ↑&lt;/strong&gt;：向上移动光标&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;l / → / [space]&lt;/strong&gt;：向右移动光标&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;在当前行上移动光标&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;0 或功能键[Home]&lt;/strong&gt; &amp;ndash; 移动到行头&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;^&lt;/strong&gt; &amp;ndash; 移动到本行的第一个不是 blank 字符&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;$ 或功能键[End]&lt;/strong&gt; &amp;ndash; 移动到行尾&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;g_&lt;/strong&gt; &amp;ndash; 移动到本行最后一个不是 blank 字符的位置&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;w&lt;/strong&gt; &amp;ndash; 光标移动到下一个单词的开头&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;e&lt;/strong&gt; &amp;ndash; 光标移动到下一个单词的结尾&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;fa&lt;/strong&gt; &amp;ndash; 移动到本行下一个为 a 的字符处&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;nfa&lt;/strong&gt; &amp;ndash; 移动到本行光标处开始的第 n 个 字符为 a 的地方&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Fa&lt;/strong&gt; &amp;ndash; 同fa一样，光标移动方向同fa相反&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;nFa&lt;/strong&gt; &amp;ndash; 同 nfa 类似，光标移动方向同 nfa相反&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ta&lt;/strong&gt; &amp;ndash; 移动光标至 a 字符的前一个字符&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;nta&lt;/strong&gt; &amp;ndash; 移动到第n个 a 字符的前一个字符处&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ta&lt;/strong&gt; &amp;ndash; 同ta移动光标方向相反&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;nTa&lt;/strong&gt; &amp;ndash; 同 nta 移动光标方向相反&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;; &amp;amp; ,&lt;/strong&gt; &amp;ndash; 当使用 f, F, t ,T, 关键字指定字符跳转的时候，使用**；&lt;strong&gt;可以快速跳转到&lt;/strong&gt;下一个&lt;strong&gt;指定的字符，&lt;/strong&gt;,** 是跳到&lt;strong&gt;前一个&lt;/strong&gt;指定的字符&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;跨行移动光标&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;nG&lt;/strong&gt; &amp;ndash; 光标定位到第 n 行的行首&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;gg&lt;/strong&gt; &amp;ndash; 光标定位到第一行的行首&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;G&lt;/strong&gt; &amp;ndash; 光标定位到最后一行的行首&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;H&lt;/strong&gt; &amp;ndash; 光标定位到&lt;strong&gt;当前屏幕&lt;/strong&gt;的第一行行首&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;M&lt;/strong&gt; &amp;ndash; 光标移动到&lt;strong&gt;当前屏幕&lt;/strong&gt;的中间&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;L&lt;/strong&gt; &amp;ndash; 光标移动到&lt;strong&gt;当前屏幕&lt;/strong&gt;的尾部&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;zt&lt;/strong&gt; &amp;ndash; 把当前行移动到&lt;strong&gt;当前屏幕&lt;/strong&gt;的最上方，也就是第一行&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;zz&lt;/strong&gt; &amp;ndash; 把当前行移动到&lt;strong&gt;当前屏幕&lt;/strong&gt;的中间&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;zb&lt;/strong&gt; &amp;ndash; 把当前行移动到&lt;strong&gt;当前屏幕&lt;/strong&gt;的尾部&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;%&lt;/strong&gt; &amp;ndash; 匹配括号移动，包括 ( , { , [ 需要把光标先移动到括号上&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;* &amp;amp; #&lt;/strong&gt; &amp;ndash; 匹配光标当前所在的单词， ***** 是下一个，&lt;strong&gt;#&lt;/strong&gt; 是上一个&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;翻页操作&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ctrl+u&lt;/strong&gt; &amp;ndash; 向&lt;strong&gt;上&lt;/strong&gt;滚动&lt;strong&gt;半&lt;/strong&gt;页&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ctrl+b&lt;/strong&gt; &amp;ndash; 向&lt;strong&gt;上&lt;/strong&gt;滚动&lt;strong&gt;一&lt;/strong&gt;页&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ctrl+d&lt;/strong&gt; &amp;ndash; 向&lt;strong&gt;下&lt;/strong&gt;滚动&lt;strong&gt;半&lt;/strong&gt;页&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ctrl+f&lt;/strong&gt; &amp;ndash; 向&lt;strong&gt;下&lt;/strong&gt;滚动&lt;strong&gt;一&lt;/strong&gt;页&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;普通模式操作文本&#34;&gt;普通模式操作文本
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;删除&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;mark&gt;&lt;strong&gt;d 是删除的意思，通常搭配一个字符 ( 删除范围 ) 实现删除功能，常用的如下：&lt;/strong&gt;&lt;/mark&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;dw&lt;/strong&gt; &amp;ndash; 删除一个单词&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;dnw&lt;/strong&gt; &amp;ndash; 删除 n 个单词，&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;dfa&lt;/strong&gt; &amp;ndash; 删除光标处到下一个 a 的字符处（ fa 定位光标到 a 处 ）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;dnfa&lt;/strong&gt; &amp;ndash; 删除光标处到第 n 个 a 的字符处&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;dd&lt;/strong&gt; &amp;ndash; 删除一整行&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ndd&lt;/strong&gt; &amp;ndash; 删除光标处开始的 n 行&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;d$&lt;/strong&gt; &amp;ndash; 删除光标到本行的结尾&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;d0&lt;/strong&gt; &amp;ndash; 删除游标所在处到该行的最前面一个字符&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;dH&lt;/strong&gt; &amp;ndash; 删除屏幕显示的第一行文本到光标所在的行&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;d1G&lt;/strong&gt; &amp;ndash; 删除光标&lt;strong&gt;所在到第一行&lt;/strong&gt;的所有数据&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;dG&lt;/strong&gt; &amp;ndash; 删除光标&lt;strong&gt;所在到最后一行&lt;/strong&gt;的所有数据&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;x&lt;/strong&gt; &amp;ndash; 删除光标&lt;strong&gt;当前所在的&lt;/strong&gt;字符**(delete)**&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;X&lt;/strong&gt; &amp;ndash; 删除光标&lt;strong&gt;前面的一个&lt;/strong&gt;字符**(backspace)**&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;nx&lt;/strong&gt; &amp;ndash; 向后连续删除n个字符&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;复制&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;mark&gt;&lt;strong&gt;y 是复制的意思，通常搭配一个字符（复制范围）实现复制的功能，常用的如下：&lt;/strong&gt;&lt;/mark&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;yw&lt;/strong&gt; &amp;ndash; 复制一个单词，还有ynw&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;yfa&lt;/strong&gt; &amp;ndash; 复制光标到下一个 a 的字符处,还有ynfa&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;yy&lt;/strong&gt; &amp;ndash; 复制一行，还有nyy&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;y$&lt;/strong&gt; &amp;ndash; 复制光标到本号的结尾&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;yH&lt;/strong&gt; &amp;ndash; 复制屏幕显示的第一行文本到光标所在的行&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;y1G&lt;/strong&gt; &amp;ndash; 复制&lt;strong&gt;光标所在行到第一行&lt;/strong&gt;的所有数据&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;yG&lt;/strong&gt; &amp;ndash; 复制&lt;strong&gt;光标所在行到最后一行&lt;/strong&gt;的所有数据&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;粘贴&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;mark&gt;&lt;strong&gt;p是黏贴的意思，当执行完复制或者黏贴的命令以后，VIM 会把文本寄存起来&lt;/strong&gt;&lt;/mark&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;p(小写)&lt;/strong&gt; &amp;ndash; 在光标后开始黏贴&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;P(大写)&lt;/strong&gt; &amp;ndash; 在光标前开始粘贴&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;撤销操作和恢复&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;u&lt;/strong&gt; &amp;ndash; 撤销刚才的操作&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ctrl+r&lt;/strong&gt; &amp;ndash; 恢复撤销操作&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;大小写转换&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;~&lt;/strong&gt; &amp;ndash; 将光标下的字母改变大小写&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;3~&lt;/strong&gt; &amp;ndash; 将光标位置开始的3个字母改变其大小写&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;g~~&lt;/strong&gt; &amp;ndash; 改变当前行字母的大小写&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;gUU&lt;/strong&gt; &amp;ndash; 将当前行的字母改成大写&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;guu&lt;/strong&gt; &amp;ndash; 将当前行的字母全改成小写&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;3gUU&lt;/strong&gt; &amp;ndash; 将从光标开始到下面3行字母改成大写&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;gUw&lt;/strong&gt; &amp;ndash; 将光标下的单词改成大写&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;guw&lt;/strong&gt; &amp;ndash; 将光标下的单词改成小写&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;重复操作&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;.&lt;/strong&gt; &amp;ndash; 重复上一个操作的命令&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;n&amp;lt;command&amp;gt;&lt;/strong&gt; &amp;ndash; 重复某个命令 n 次，如 10p复制 10 次，10dd 删除十次&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;其他&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;J&lt;/strong&gt; &amp;ndash; 将光标所在行与下一行的数据结合成同一行&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;c&lt;/strong&gt; &amp;ndash; 重复删除多个数据，例如向下删除 10 行，10cj&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;插入模式&#34;&gt;插入模式
&lt;/h3&gt;&lt;h4 id=&#34;进入插入模式&#34;&gt;进入插入模式
&lt;/h4&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;命令&lt;/th&gt;
          &lt;th style=&#34;text-align: left&#34;&gt;说明&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;i, I&lt;/strong&gt;&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;i &amp;ndash; 从目前光标所在处输入&lt;br /&gt;I &amp;ndash; 在目前所在行的第一个非空格符处开始输入&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;a, A&lt;/strong&gt;&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;a &amp;ndash; 从目前光标所在的下一个字符处开始输入&lt;br /&gt;A &amp;ndash; 从光标所在行的最后一个字符处开始输入&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;o, O&lt;/strong&gt;&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;o &amp;ndash; 在目前光标所在的下一行处输入新的一行&lt;br /&gt;O &amp;ndash; 在目前光标所在的上一行处输入新的一行&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;s，S&lt;/strong&gt;&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;s &amp;ndash; 删除光标所在处的字符然后插入需要录入的文本&lt;br /&gt;S &amp;ndash; 删除光标所在行，在当前行的行首开始插入需要录入的文本&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;cw&lt;/strong&gt;&lt;/td&gt;
          &lt;td style=&#34;text-align: left&#34;&gt;删除&lt;strong&gt;从光标处开始到该单词结束&lt;/strong&gt;的所有字符，然后插入需要录入的文本&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;插入模式的命令&#34;&gt;插入模式的命令
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;&lt;mark&gt;必须知道的：&lt;code&gt;#&lt;/code&gt;是vim中的注释符号&lt;/mark&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;在输入模式中，可以使用以下按键：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;字符按键以及Shift组合&lt;/strong&gt;，输入字符&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ENTER&lt;/strong&gt;，回车键，换行&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;BACK SPACE&lt;/strong&gt;，退格键，删除光标前一个字符&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;DEL&lt;/strong&gt;，删除键，删除光标后一个字符&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;方向键&lt;/strong&gt;，在文本中移动光标&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;HOME&lt;/strong&gt;/&lt;strong&gt;END&lt;/strong&gt;，移动光标到行首/行尾&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Page Up&lt;/strong&gt;/&lt;strong&gt;Page Down&lt;/strong&gt;，上/下翻页&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Insert&lt;/strong&gt;，切换光标为输入/替换模式，光标将变成竖线/下划线&lt;/li&gt;
&lt;li&gt;&lt;span style=&#34;color:red&#34;&gt;&lt;strong&gt;ESC&lt;/strong&gt;，&lt;strong&gt;退出输入模式，切换到命令模式&lt;/strong&gt;&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;替换模式&#34;&gt;替换模式
&lt;/h3&gt;&lt;h4 id=&#34;进入替换模式&#34;&gt;进入替换模式
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;R&lt;/strong&gt; &amp;ndash; 进入&lt;strong&gt;替换模式&lt;/strong&gt;，此时新输入的文本将直接替代/覆盖已经存在的内容，点击ESC键返回常规模式&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;r&lt;/strong&gt; &amp;ndash; 进入&lt;strong&gt;单字符替换模式&lt;/strong&gt;，此时新输入的字符将替代光标之下的当前字符，然后自动返回到常规模式&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;gR&lt;/strong&gt; &amp;ndash; 进入&lt;strong&gt;虚拟替换模式&lt;/strong&gt;，其与替换模式最主要的区别在于，对&amp;lt;Tab&amp;gt;键和换行符的不同处理方式&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;gr&lt;/strong&gt; &amp;ndash; 进入&lt;strong&gt;单字符虚拟替换模式&lt;/strong&gt;，在替换光标下的当前字符之后，将自动返回到常规模式&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;虚拟替换模式&#34;&gt;虚拟替换模式
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&amp;lt;Tab&amp;gt;键&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;替换模式（REPLACE）下，在原有&amp;lt;Tab&amp;gt;键处输入字母&amp;rsquo;a&amp;rsquo;，将&lt;strong&gt;直接替代&amp;lt;Tab&amp;gt;键所占用的所有空格的位置&lt;/strong&gt;&lt;/p&gt;
&lt;center class=&#34;half&#34;&gt;    &lt;img src=&#34;https://picx.zhimg.com/v2-ecdbd6903e53640aa3375ecd30287665_b.jpg&#34; width=&#34;300&#34;/&gt;    &lt;img src=&#34;http://picture.928330.xyz/typora/image-20250309213229157.png&#34; width=&#34;300&#34;/&gt; &lt;/center&gt;
&lt;p&gt;虚拟替换模式（VREPLACE）下，在原有&amp;lt;Tab&amp;gt;键处输入字母&amp;rsquo;a&amp;rsquo;，将&lt;strong&gt;仅仅替代单个空格&lt;/strong&gt;&lt;/p&gt;
&lt;center class=&#34;half&#34;&gt;    &lt;img src=&#34;https://picx.zhimg.com/v2-ecdbd6903e53640aa3375ecd30287665_b.jpg&#34; width=&#34;300&#34;/&gt;    &lt;img src=&#34;http://picture.928330.xyz/typora/image-20250310190903275.png&#34; width=&#34;300&#34;/&gt; &lt;/center&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&amp;lt;NL&amp;gt;换行&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;替换模式（REPLACE）下，输入&amp;lt;Enter&amp;gt;回车键将&lt;strong&gt;增加新行&lt;/strong&gt;：&lt;/p&gt;
&lt;center class=&#34;half&#34;&gt;    &lt;img src=&#34;http://picture.928330.xyz/typora/image-20250309214135754.png&#34; width=&#34;300&#34;/&gt;    &lt;img src=&#34;http://picture.928330.xyz/typora/image-20250309214201236.png&#34; width=&#34;300&#34;/&gt; &lt;/center&gt;
&lt;p&gt;虚拟替换模式（VREPLACE）下，输入&amp;lt;Enter&amp;gt;回车键将&lt;strong&gt;用新行替代当前行内容&lt;/strong&gt;（即清空当前行）：&lt;/p&gt;
&lt;center class=&#34;half&#34;&gt;    &lt;img src=&#34;http://picture.928330.xyz/typora/image-20250309214135754.png&#34; width=&#34;300&#34;/&gt;    &lt;img src=&#34;http://picture.928330.xyz/typora/image-20250309215042518.png&#34; width=&#34;300&#34;/&gt; &lt;/center&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;命令模式&#34;&gt;命令模式
&lt;/h3&gt;&lt;p&gt;&lt;mark&gt;&lt;strong&gt;在命令模式下按下 :（英文冒号）就进入了底线命令模式&lt;/strong&gt;&lt;/mark&gt;&lt;/p&gt;
&lt;p&gt;&lt;mark&gt;&lt;strong&gt;有的命令要输入 / 执行&lt;/strong&gt;&lt;/mark&gt;&lt;/p&gt;
&lt;h4 id=&#34;命令模式常用命令&#34;&gt;命令模式常用命令
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;:w&lt;/strong&gt; &amp;ndash; 保存文件&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;:q&lt;/strong&gt; &amp;ndash; 退出 Vim 编辑器&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;:wq&lt;/strong&gt; &amp;ndash; 保存文件并退出 Vim 编辑器&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;:q!&lt;/strong&gt; &amp;ndash; 强制退出Vim编辑器，不保存修改&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;:set nu&lt;/strong&gt; &amp;ndash; 显示行号&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;:set nonu&lt;/strong&gt; &amp;ndash; 取消行号&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;:n&lt;/strong&gt; &amp;ndash; 定位到第n行&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;:n1,n2d&lt;/strong&gt; &amp;ndash; 删除行号n1至n2之间的内容（n1和n2都代表数字）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span style=&#34;color:red&#34;&gt;&lt;strong&gt;按 ESC 键可随时退出底线命令模式&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;h4 id=&#34;命令模式处理文件&#34;&gt;命令模式处理文件
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;:w [filename]&lt;/strong&gt; &amp;ndash; 将编辑的数据储存成另一个文件（类似另存新档）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;:r [filename]&lt;/strong&gt; &amp;ndash; 在编辑的数据中，读入另一个档案的数据，即将filenam的内容加到光标所在行后面&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;:n1,n2 w [filename]&lt;/strong&gt; &amp;ndash; 将 n1 到 n2 的内容储存成 filename&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;命令模式搜索文本&#34;&gt;命令模式搜索文本
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;?{目标字符串}&lt;/strong&gt; &amp;ndash; 向光标之&lt;strong&gt;上&lt;/strong&gt;寻找一个目标字符串&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;/{目标字符串}&lt;/strong&gt; &amp;ndash; 向光标之&lt;strong&gt;下&lt;/strong&gt;寻找一个目标字符串&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;n&lt;/strong&gt; &amp;ndash; 重复前一个搜寻的动作&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;N&lt;/strong&gt; &amp;ndash; &lt;strong&gt;反向&lt;/strong&gt;进行前一个搜寻动作&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;:set ic&lt;/strong&gt; &amp;ndash; 编辑器将不会区分大小写&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;:set noic&lt;/strong&gt; &amp;ndash; 编辑器将区分大小写&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;命令模式替换文本&#34;&gt;命令模式替换文本
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;格式：&lt;/strong&gt;&lt;mark&gt;&lt;strong&gt;:(作用范围)s/{目标}/{替换}(/替换的标志)&lt;/strong&gt;&lt;/mark&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;替换的作用范围&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;标志&lt;/th&gt;
          &lt;th&gt;作用&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;s&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;当前行替换&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;%s&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;全文替换&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;n1,n2s&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;指定行替换，替换n1到n2间所有行的目标，&lt;strong&gt;n2可以是$，代指最后一行&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&amp;rsquo;&amp;lt;,&amp;rsquo;&amp;gt;s&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;指定区域替换&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;替换的标志&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;标志&lt;/th&gt;
          &lt;th&gt;作用&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;[无]&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;只替换作用范围内，&lt;strong&gt;每行第一次出现&lt;/strong&gt;的目标&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;g&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;一次性替换所有&lt;/strong&gt;作用范围内所有的目标&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;i&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;大小写不敏感查找&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;I&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;大小写敏感查找&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;c&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;对作用范围内的目标&lt;strong&gt;逐个替换&lt;/strong&gt;，替换前需进行确认&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;mark&gt;&lt;strong&gt;替换标志可以使用多个，比如/gic&lt;/strong&gt;&lt;/mark&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;命令模式执行linux命令&#34;&gt;命令模式执行linux命令
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;:![command]&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;打开终端窗口并打印执行命令的结果，不会改变当前编辑的文件的内容&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;mark&gt;&lt;strong&gt;可以使用&lt;code&gt;:!bash&lt;/code&gt;打开bash shell并执行命令&lt;/strong&gt;&lt;/mark&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;:!date		//执行 date 命令显示时间，执行完命令以后按下键盘上的 Enter 就会返回到文件
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;:r ![command]&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;将shell命令command的结果插入到当前行的下一行&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;:r !date		//读取系统时间并插入到当前行的下一行
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;n1,n2 ![command]&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;将n1至n2行范围内的内容交给命令command处理，并将处理结果替换起始行号和结束行号指定范围中的内容&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;:1,4 !sort		//将第1行到第4行的内容进行排序
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;可以只指定起始行&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;:1 !tr &lt;span style=&#34;color:#56b6c2&#34;&gt;[&lt;/span&gt;a-z&lt;span style=&#34;color:#56b6c2&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;[&lt;/span&gt;A-Z&lt;span style=&#34;color:#56b6c2&#34;&gt;]&lt;/span&gt;		//将第1行的小写字母转为大写字母
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;可以用.表示当前光标所在行&lt;/strong&gt;  &lt;strong&gt;(输入&lt;code&gt;!!&lt;/code&gt;会变成&lt;code&gt;:.!&lt;/code&gt;)&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;:. !tr &lt;span style=&#34;color:#56b6c2&#34;&gt;[&lt;/span&gt;a-z&lt;span style=&#34;color:#56b6c2&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color:#56b6c2&#34;&gt;[&lt;/span&gt;A-Z&lt;span style=&#34;color:#56b6c2&#34;&gt;]&lt;/span&gt;		//将当前行的小写转为大写
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;n1,n2 w ![command]&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;将起始行号和结束行号所指定范围的内容作为命令command的输入，不会改变当前编辑的文件的内容&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;mark&gt;&lt;strong&gt;可以使用&lt;code&gt;:1 w !bash&lt;/code&gt;，将会把第1行的内容作为bash命令来执行并显示结果，而且不会改变当前编辑的文件的内容&lt;/strong&gt;&lt;/mark&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;mark&gt;同样的 &lt;code&gt;: . w !bash&lt;/code&gt;将当前行的内容作为bash命令来执行&lt;/mark&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;!!&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;重新执行最近一次运行过的命令&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;:shell&lt;/strong&gt; / &lt;strong&gt;:terminal&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;打开命令终端（输入exit结束并返回vim）&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;使用&lt;code&gt;:version&lt;/code&gt;命令（按&lt;code&gt;q&lt;/code&gt;退出），查看是否包含+terminal关键字，以确认是否能使用 &lt;code&gt;:terminal&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;命令模式定义快捷键&#34;&gt;命令模式定义快捷键
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;基本格式&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;模式&lt;/th&gt;
          &lt;th&gt;基本格式&lt;/th&gt;
          &lt;th&gt;描述&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;普通模式&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;:nmap &amp;lt;key&amp;gt; &amp;lt;command&amp;gt;&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;仅在普通模式下有效，定义普通模式下的快捷键&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;插入模式&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;:imap &amp;lt;key&amp;gt; &amp;lt;command&amp;gt;&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;用于定义插入模式下的快捷键&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;可视模式&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;:vmap &amp;lt;key&amp;gt; &amp;lt;command&amp;gt;&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;用于定义可视模式下的快捷键&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;命令行模式&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;:cmap &amp;lt;key&amp;gt; &amp;lt;command&amp;gt;&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;用于定义命令行模式下的快捷键&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;总体映射&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;:map &amp;lt;key&amp;gt; &amp;lt;command&amp;gt;&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;定义快捷键，适用于普通、可视、操作和选择模式，但不建议用于有冲突的情况。&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;总体不可递归映射&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;:noremap &amp;lt;key&amp;gt; &amp;lt;command&amp;gt;&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;类似&lt;code&gt;:map&lt;/code&gt;，但是不会递归地扩展已经存在的映射，避免意外行为。&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;普通模式不可递归&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;:nnoremap &amp;lt;key&amp;gt; &amp;lt;command&amp;gt;&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;在普通模式下使用，避免递归映射&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;插入模式不可递归&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;:inoremap &amp;lt;key&amp;gt; &amp;lt;command&amp;gt;&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;在插入模式下使用，避免递归映射&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;可视模式不可递归&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;:vnoremap &amp;lt;key&amp;gt; &amp;lt;command&amp;gt;&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;在可视模式下使用，避免递归映射&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;缩写&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;:ab [缩写] [完整文本]&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;输入缩写后空格，自动扩展为完整文本&lt;/strong&gt;。例如：&lt;code&gt;:ab email xxxx@gmail.com&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;mark&gt;&lt;strong&gt;什么是&amp;lt;key&amp;gt;？&lt;/strong&gt;&lt;/mark&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&amp;lt;key&amp;gt; 对应的是 ^[A-Z] ， 定义快捷键时使用ctrl+v+[a-z]，使用快捷键时用对应的ctrl+[a-z]&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;mark&gt;什么是递归映射？&lt;/mark&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;:nmap j gg
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;:nmap Q j
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;如果已经做了以上映射，那么按下Q，执行的将是gg而不是j&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;为了避免以上问题，应该这样定义：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;:nnoremap j gg
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;:nnoremap Q j
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;几个例子&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;:map ^D Ahelloworld&amp;lt;ESC&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;在文件的光标所在行的行尾，添加 helloworld 字符串，按住组合键 ctrl + d 就会执行操作&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;:map ^M I#&amp;lt;ESC&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;在文件光标处所在行的行首插入#，按住组合键 ctrl + m 就会执行操作&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;:ab email xxxx@gmail.com
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;输入 email+空格 会把输入的 email 自动替换成 xxxx @gmail.com&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;可视化模式&#34;&gt;可视化模式
&lt;/h3&gt;&lt;h4 id=&#34;进入可视化模式&#34;&gt;进入可视化模式
&lt;/h4&gt;&lt;p&gt;&lt;mark&gt;&lt;strong&gt;可视化模式可以分为以下三种：&lt;/strong&gt;&lt;/mark&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;v&lt;/strong&gt; &amp;ndash; &lt;strong&gt;字符可视化模式&lt;/strong&gt;，文本选择是以&lt;strong&gt;字符&lt;/strong&gt;为单位的&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;V&lt;/strong&gt; &amp;ndash; &lt;strong&gt;行可视化模式&lt;/strong&gt;，文本选择是&lt;strong&gt;以行&lt;/strong&gt;为单位的&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ctrl-V&lt;/strong&gt; &amp;ndash; &lt;strong&gt;块可视化模式&lt;/strong&gt;，可以选择一个&lt;strong&gt;矩形内&lt;/strong&gt;的文本&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span style=&#34;color:red&#34;&gt;&lt;strong&gt;在任意可视化模式下使用以上命令，将会切换到对应模式&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span style=&#34;color:red&#34;&gt;&lt;strong&gt;在任意可视化模式下使用I（大写i），将会切换到插入模式&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;gv&lt;/strong&gt; &amp;ndash; 进入上一次的可视化模式，并选中当时选中的文本**（命令模式也能用此命令）**&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span style=&#34;color:red&#34;&gt;&lt;strong&gt;按 ESC 键可随时退出可视化模式&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;h4 id=&#34;可视化模式下移动光标&#34;&gt;可视化模式下移动光标
&lt;/h4&gt;&lt;p&gt;&lt;mark&gt;&lt;strong&gt;命令模式下的光标移动方法仍然适用&lt;/strong&gt;&lt;/mark&gt;&lt;/p&gt;
&lt;p&gt;&lt;mark&gt;&lt;strong&gt;进入任意可视化模式，移动光标，会从当前位置开始，以相应方式高亮选中字符&lt;/strong&gt;&lt;/mark&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;o&lt;/strong&gt; &amp;ndash;  移动光标到已经选取的文本的&lt;strong&gt;结尾处&lt;/strong&gt;或者&lt;strong&gt;开头处&lt;/strong&gt;（根据现在光标所在位置确定）&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;如果是块可视化模式，移动光标到对角处
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;O&lt;/strong&gt; &amp;ndash; 在&lt;strong&gt;块可视化&lt;/strong&gt;模式下，移动光标到&lt;strong&gt;同一行的结尾处或者开头处&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;可视化模式下编辑&#34;&gt;可视化模式下编辑
&lt;/h4&gt;&lt;p&gt;&lt;mark&gt;&lt;strong&gt;大部分命令模式对内容操作的命令都能在可视化模式下使用，比如：&lt;/strong&gt;&lt;/mark&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;d&lt;/strong&gt; &amp;ndash; 删除高亮文本&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;D&lt;/strong&gt; &amp;ndash; 删除一整行文本，&lt;strong&gt;即使只有一部分被选中了&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;c&lt;/strong&gt; &amp;ndash; 删除高亮文本并进入插入模式&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;y&lt;/strong&gt; &amp;ndash; 复制高亮文本&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Y&lt;/strong&gt; &amp;ndash; 复制一整行文本&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;p&lt;/strong&gt; &amp;ndash; 黏贴复制的文本&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;~&lt;/strong&gt; &amp;ndash; 对高亮文本进行&lt;strong&gt;大小写转换&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&amp;gt; / &amp;lt;&lt;/strong&gt; &amp;ndash; 对高亮文本增加/减少缩进，幅度为&lt;strong&gt;一个Tab键&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;r&lt;/strong&gt; &amp;ndash; 输入单个字符，把高亮文本所有字符逐个替换为该字符&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;vim宏录制&#34;&gt;vim宏录制
&lt;/h2&gt;&lt;h3 id=&#34;宏录制的录制操作&#34;&gt;宏录制的录制操作
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;假设需要将文本的每一行的行首插入入一个 tab 键&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;先将光标移动到第一行，在普通模式下按下 q 键（&lt;strong&gt;宏录制是 q 键启动的&lt;/strong&gt;)&lt;/li&gt;
&lt;li&gt;按一个 a （字母随意）,表示该宏注册为 a&lt;/li&gt;
&lt;li&gt;按下 I 在行首插入一个 tab 键&lt;/li&gt;
&lt;li&gt;按下ESC退出编辑模式&lt;/li&gt;
&lt;li&gt;按下 j 将光标移动到下一行行首&lt;/li&gt;
&lt;li&gt;按下 q 键完成录制操作（&lt;strong&gt;宏录制是 q 键结束的&lt;/strong&gt;）&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;mark&gt;主要步骤：&lt;strong&gt;q(开始）&lt;/strong&gt;-&amp;gt; &lt;strong&gt;a(命名)&lt;/strong&gt; -&amp;gt; &lt;strong&gt;操作&lt;/strong&gt; -&amp;gt; &lt;strong&gt;q(结束)&lt;/strong&gt;&lt;/mark&gt;&lt;/p&gt;
&lt;h3 id=&#34;宏录制的使用&#34;&gt;宏录制的使用
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;@a&lt;/strong&gt; &amp;ndash; 执行a宏录制的一系列动作，注意&lt;strong&gt;a是录制的操作名称&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;n@a&lt;/strong&gt; &amp;ndash; 执行&lt;strong&gt;n次&lt;/strong&gt;a宏&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;@@&lt;/strong&gt; &amp;ndash; 重复上一次使用的宏操作&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;vim相关案例&#34;&gt;VIM相关案例
&lt;/h1&gt;&lt;h2 id=&#34;vim缓存泄露&#34;&gt;vim缓存泄露
&lt;/h2&gt;&lt;h3 id=&#34;vim交换文件&#34;&gt;vim交换文件
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;在使用vim时会创建临时缓存文件，关闭vim时缓存文件则会被删除，当vim异常退出后，因为未处理缓存文件，导致可以通过缓存文件恢复原始文件内容&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;现在用vim打开文件1.txt，直接关闭终端，再次试图用vim打开1.txt时会出现如下提示：&lt;/p&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250311194714710.png&#34; alt=&#34;image-20250311194714710&#34; style=&#34;zoom: 67%;&#34; /&gt;
&lt;p&gt;选择恢复（R），弹出如下提示：&lt;/p&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250311195430374.png&#34; style=&#34;zoom: 67%;&#34; /&gt;
&lt;p&gt;&lt;strong&gt;Vim 中，当处理同一个文件发生多次异常退出时，它会依次使用不同的后缀来命名交换文件。按照你给出的模式，首次产生的交换文件名为 &lt;code&gt;.index.php.swp&lt;/code&gt;，再次意外退出后产生 &lt;code&gt;.index.php.swo&lt;/code&gt;，第三次产生的交换文件为 &lt;code&gt;.index.php.swn&lt;/code&gt;。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;从第四次开始及之后的交换文件，Vim 会循环使用这三个后缀（.swp, .swo, .swn）&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;例题&#34;&gt;例题
&lt;/h3&gt;&lt;img src=&#34;http://picture.928330.xyz/typora/4b76d009d10ed0cb65aaad6f5f85d2cc.png&#34; alt=&#34;在这里插入图片描述&#34; style=&#34;zoom:80%;&#34; /&gt;
&lt;p&gt;使用以下命令获取网站中的vim文件缓存：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wget http://xxx/.index.php.swp -P /home       //-P指定下载位置
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;使用vim -r恢复文件并打开:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vim -r .index.php.swp
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;获取到网站源码后，进行代码审计即可&lt;/p&gt;
</description>
        </item>
        
    </channel>
</rss>
