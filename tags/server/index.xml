<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Server on kakahuote</title>
        <link>https://blog.928330.xyz/tags/server/</link>
        <description>Recent content in Server on kakahuote</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>zh-cn</language>
        <copyright>Example Person</copyright>
        <lastBuildDate>Sun, 24 Aug 2025 21:42:35 +0800</lastBuildDate><atom:link href="https://blog.928330.xyz/tags/server/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>Apache入门</title>
        <link>https://blog.928330.xyz/p/apache%E5%85%A5%E9%97%A8/</link>
        <pubDate>Sat, 23 Aug 2025 19:26:25 +0800</pubDate>
        
        <guid>https://blog.928330.xyz/p/apache%E5%85%A5%E9%97%A8/</guid>
        <description>&lt;img src="http://picture.928330.xyz/typora/66d1339d8d7af.jpg" alt="Featured image of post Apache入门" /&gt;&lt;p&gt;时隔一个月，又来学服务器了&lt;/p&gt;
&lt;p&gt;其实是因为美亚杯做到了apache相关内容啦&lt;/p&gt;
&lt;p&gt;猜你喜欢：&lt;a class=&#34;link&#34; href=&#34;http://blog.928330.xyz/p/nginx%E5%85%A5%E9%97%A8/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Nginx入门
    
    &lt;span style=&#34;white-space: nowrap;&#34;&gt;&lt;svg width=&#34;.7em&#34;
        height=&#34;.7em&#34; viewBox=&#34;0 0 21 21&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;
        &lt;path d=&#34;m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z&#34; fill=&#34;currentColor&#34; /&gt;
        &lt;path d=&#34;M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z&#34;
            fill=&#34;currentColor&#34;&gt;
    &lt;/svg&gt;&lt;/span&gt;
    
&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;何为apache&#34;&gt;何为Apache
&lt;/h1&gt;&lt;p&gt;Apache HTTP Server（简称Apache，或httpd，使用时为Apache2）是Apache软件基金会的一个开源网页服务器项目&lt;/p&gt;
&lt;p&gt;自1995年发布以来，它凭借其稳定性、强大的功能、丰富的模块和跨平台特性，一度成为全球使用最广泛的Web服务器&lt;/p&gt;
&lt;p&gt;它的核心优势在于其高度模块化的设计，几乎所有功能，从SSL加密(&lt;code&gt;mod_ssl&lt;/code&gt;)、URL重写(&lt;code&gt;mod_rewrite&lt;/code&gt;)到与各种后端语言（如PHP的&lt;code&gt;mod_php&lt;/code&gt;）的集成，都是通过模块实现的，这使得Apache具有极高的灵活性和可扩展性&lt;/p&gt;
&lt;h2 id=&#34;nginx-vs-apache&#34;&gt;Nginx vs Apache
&lt;/h2&gt;&lt;p&gt;在之前，我们介绍了如何使用nginx：&lt;a class=&#34;link&#34; href=&#34;http://blog.928330.xyz/p/nginx%E5%85%A5%E9%97%A8/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Nginx入门
    
    &lt;span style=&#34;white-space: nowrap;&#34;&gt;&lt;svg width=&#34;.7em&#34;
        height=&#34;.7em&#34; viewBox=&#34;0 0 21 21&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;
        &lt;path d=&#34;m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z&#34; fill=&#34;currentColor&#34; /&gt;
        &lt;path d=&#34;M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z&#34;
            fill=&#34;currentColor&#34;&gt;
    &lt;/svg&gt;&lt;/span&gt;
    
&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;那么它和apache之间究竟有什么区别？&lt;/p&gt;
&lt;h3 id=&#34;核心架构&#34;&gt;核心架构
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;这是两者最根本的区别&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;apache&#34;&gt;Apache
&lt;/h4&gt;&lt;p&gt;采用基于进程或线程的模型，它有多种工作模式（MPM），如&lt;code&gt;prefork&lt;/code&gt;（每个请求一个进程）和&lt;code&gt;worker&lt;/code&gt;/&lt;code&gt;event&lt;/code&gt;（每个请求一个线程）&lt;/p&gt;
&lt;p&gt;这种模型对于每个连接都会消耗一定的系统资源，在高并发下内存占用较高&lt;/p&gt;
&lt;h4 id=&#34;nginx&#34;&gt;Nginx
&lt;/h4&gt;&lt;p&gt;采用事件驱动的异步非阻塞架构&lt;/p&gt;
&lt;p&gt;它用极少数的工作进程就能处理成千上万的并发连接，资源消耗极低，特别擅长应对高并发和处理静态资源&lt;/p&gt;
&lt;h3 id=&#34;功能与生态&#34;&gt;功能与生态
&lt;/h3&gt;&lt;h4 id=&#34;apache-1&#34;&gt;Apache
&lt;/h4&gt;&lt;p&gt;历史悠久，功能模块极其丰富，生态系统成熟&lt;/p&gt;
&lt;p&gt;对于动态内容（如PHP），其&lt;code&gt;mod_php&lt;/code&gt;模块直接在Apache进程内执行，处理流程简单直接&lt;/p&gt;
&lt;p&gt;它的&lt;code&gt;.htaccess&lt;/code&gt;文件提供了强大的目录级配置能力，让开发者无需修改主配置就能调整行为&lt;/p&gt;
&lt;h4 id=&#34;nginx-1&#34;&gt;Nginx
&lt;/h4&gt;&lt;p&gt;核心功能是高性能的HTTP服务和反向代理&lt;/p&gt;
&lt;p&gt;它的模块化设计虽然也很强大，但通常更侧重于性能和网络层面&lt;/p&gt;
&lt;p&gt;它不支持&lt;code&gt;.htaccess&lt;/code&gt;，所有配置集中管理，性能更高，也更符合现代运维理念&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;总的来说：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Apache稳定、功能全面，对动态内容支持极佳&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Nginx轻量、高效，在高并发、静态资源和反向代理场景下更好用&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;在现代架构中两者常常协同工作，用Nginx处理静态资源和代理，后端再由Apache处理复杂的动态业务逻辑&lt;/strong&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;apache的主要用法&#34;&gt;Apache的主要用法
&lt;/h2&gt;&lt;h3 id=&#34;web服务器&#34;&gt;Web服务器
&lt;/h3&gt;&lt;p&gt;直接向客户端提供静态（HTML, CSS, 图片）和动态（PHP, Perl, Python）内容的服务&lt;/p&gt;
&lt;p&gt;Apache对动态内容的原生支持非常出色，是许多传统Web应用（如WordPress, Joomla）的首选平台&lt;/p&gt;
&lt;h3 id=&#34;反向代理服务器&#34;&gt;反向代理服务器
&lt;/h3&gt;&lt;p&gt;通过&lt;code&gt;mod_proxy&lt;/code&gt;模块，Apache可以作为客户端和后端应用服务器之间的中间人，实现请求转发、负载均衡，并隐藏后端服务细节&lt;/p&gt;
&lt;h3 id=&#34;负载均衡器&#34;&gt;负载均衡器
&lt;/h3&gt;&lt;p&gt;配合&lt;code&gt;mod_proxy_balancer&lt;/code&gt;模块，Apache可以将接收到的请求分发到后端的多台服务器上，从而提高网站的可用性和处理能力&lt;/p&gt;
&lt;h3 id=&#34;访问控制与url重写&#34;&gt;访问控制与URL重写
&lt;/h3&gt;&lt;p&gt;强大的&lt;code&gt;.htaccess&lt;/code&gt;和&lt;code&gt;mod_rewrite&lt;/code&gt;功能，使其在URL美化（伪静态）、访问权限控制等方面表现非常灵活&lt;/p&gt;
&lt;h1 id=&#34;目录结构&#34;&gt;目录结构
&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;和nginx一样，不同发行版和安装方式的apache的目录结构有差异，只不过apache的差异更为显著&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;与nginx不同，apache官方一般只提供二进制编译安装的文件，&lt;code&gt;.deb&lt;/code&gt;文件更多是交给第三方打包&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;源码编译安装&#34;&gt;源码编译安装
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;名称为apache2&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;自定义程度最高，所有文件通常都集中在指定的前缀下（默认为&lt;code&gt;/usr/local/apache2&lt;/code&gt;）&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/                                                  &lt;span style=&#34;color:#7f848e&#34;&gt;# 根目录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;└── usr/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    └── local/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        └── apache2/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── bin/                         &lt;span style=&#34;color:#7f848e&#34;&gt;# 可执行文件 (httpd, apachectl, ab等)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── build/                      &lt;span style=&#34;color:#7f848e&#34;&gt;# 编译时使用的脚本和工具&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── cgi-bin/                   &lt;span style=&#34;color:#7f848e&#34;&gt;# CGI脚本示例目录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── conf/                       &lt;span style=&#34;color:#7f848e&#34;&gt;# 配置文件目录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            │   ├── httpd.&lt;span style=&#34;color:#e5c07b&#34;&gt;conf&lt;/span&gt;         # 主配置文件
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            │   ├── extra/                 &lt;span style=&#34;color:#7f848e&#34;&gt;# 额外的配置文件 (vhosts.conf, ssl.conf等)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            │   └── mime.&lt;span style=&#34;color:#e5c07b&#34;&gt;types&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── htdocs/                    # 默认 Web 根目录
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            │   └── index.&lt;span style=&#34;color:#e5c07b&#34;&gt;html&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── icons/                       # Apache默认图标目录
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── include/                    &lt;span style=&#34;color:#7f848e&#34;&gt;# C/C++头文件，用于开发模块&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── logs/                         &lt;span style=&#34;color:#7f848e&#34;&gt;# 日志文件目录 (access_log, error_log)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            └── modules/                  &lt;span style=&#34;color:#7f848e&#34;&gt;# 动态加载的模块 (.so 文件)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;debianubuntu官方仓库-通过apt安装&#34;&gt;Debian/Ubuntu官方仓库 (通过apt安装)
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;名称为apache2&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;目录结构遵循Debian的策略，将配置文件、模块和站点配置分拆到不同目录，便于管理&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/                                                       &lt;span style=&#34;color:#7f848e&#34;&gt;# 根目录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── etc/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   └── apache2/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       ├── apache2.&lt;span style=&#34;color:#e5c07b&#34;&gt;conf&lt;/span&gt;                  # 主配置文件，主要包含全局设置
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       ├── conf-available/                &lt;span style=&#34;color:#7f848e&#34;&gt;# 可用的配置片段目录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       ├── conf-enabled/                 &lt;span style=&#34;color:#7f848e&#34;&gt;# 已启用的配置片段 (符号链接)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       ├── mods-available/              &lt;span style=&#34;color:#7f848e&#34;&gt;# 可用的模块配置文件 (.load, .conf)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       ├── mods-enabled/               &lt;span style=&#34;color:#7f848e&#34;&gt;# 已启用的模块 (符号链接)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       ├── sites-available/                &lt;span style=&#34;color:#7f848e&#34;&gt;# 可用的虚拟主机配置文件&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       │   └── 000-default.&lt;span style=&#34;color:#e5c07b&#34;&gt;conf&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       └── sites-enabled/                 # 已启用的虚拟主机配置 (符号链接)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│           └── 000-default.&lt;span style=&#34;color:#e5c07b&#34;&gt;conf&lt;/span&gt; -&amp;gt; ../sites-available/000-default.conf
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── usr/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── sbin/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   │   └── &lt;span style=&#34;color:#e5c07b&#34;&gt;apache2ctl&lt;/span&gt;                     # Apache 控制脚本
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   └── lib/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       └── apache2/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│           └── modules/                    &lt;span style=&#34;color:#7f848e&#34;&gt;# 模块二进制文件 (.so)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── var/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── www/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   │   └── html/                             &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认 Web 根目录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   │       └── index.&lt;span style=&#34;color:#e5c07b&#34;&gt;html&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   └── log/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       └── apache2/                         &lt;span style=&#34;color:#7f848e&#34;&gt;# 日志文件目录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│           ├── access.&lt;span style=&#34;color:#e5c07b&#34;&gt;log&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│           └── &lt;span style=&#34;color:#c678dd&#34;&gt;error&lt;/span&gt;.log
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;└── lib/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    └── systemd/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        └── system/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            └── apache2.&lt;span style=&#34;color:#e5c07b&#34;&gt;service&lt;/span&gt; # Systemd 服务单元
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;centosrhel官方仓库-通过yumdnf安装&#34;&gt;CentOS/RHEL官方仓库 (通过yum/dnf安装)
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;名称为httpd&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;目录结构与Debian系有所不同，但同样遵循系统规范&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;关于systemd位置的问题，可以查看&lt;/strong&gt;：&lt;a class=&#34;link&#34; href=&#34;http://blog.928330.xyz/p/nginx%E5%85%A5%E9%97%A8/#systemd%E7%9A%84%E4%BD%8D%E7%BD%AE&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;nginx入门 — systemd
    
    &lt;span style=&#34;white-space: nowrap;&#34;&gt;&lt;svg width=&#34;.7em&#34;
        height=&#34;.7em&#34; viewBox=&#34;0 0 21 21&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;
        &lt;path d=&#34;m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z&#34; fill=&#34;currentColor&#34; /&gt;
        &lt;path d=&#34;M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z&#34;
            fill=&#34;currentColor&#34;&gt;
    &lt;/svg&gt;&lt;/span&gt;
    
&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/                                                                     &lt;span style=&#34;color:#7f848e&#34;&gt;# 根目录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── etc/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   └── httpd/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       ├── conf/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       │   └── httpd.&lt;span style=&#34;color:#e5c07b&#34;&gt;conf&lt;/span&gt;                              # 主配置文件
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       ├── conf.d/                                         &lt;span style=&#34;color:#7f848e&#34;&gt;# 子配置目录，所有 .conf 文件会被自动加载&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       │   └── welcome.&lt;span style=&#34;color:#e5c07b&#34;&gt;conf&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       └── conf.modules.d/                           # 模块加载配置目录
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── usr/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── sbin/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   │   └── &lt;span style=&#34;color:#e5c07b&#34;&gt;httpd&lt;/span&gt;                                           # 主程序二进制文件
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   └── lib64/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       └── httpd/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│           └── modules/                                  &lt;span style=&#34;color:#7f848e&#34;&gt;# 模块二进制文件 (.so)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;├── var/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   ├── www/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   │   ├── html/                                            &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认 Web 根目录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   │   └── cgi-bin/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│   └── log/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│       └── httpd/                                            &lt;span style=&#34;color:#7f848e&#34;&gt;# 日志文件目录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│           ├── &lt;span style=&#34;color:#e5c07b&#34;&gt;access_log&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│           └── error_log
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;│
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;└── usr/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    └── lib/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        └── systemd/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            └── system/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                └── httpd.&lt;span style=&#34;color:#e5c07b&#34;&gt;service&lt;/span&gt;                            # Systemd 服务单元
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;docker镜像官方-httpd&#34;&gt;Docker镜像（官方 httpd）
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;docker镜像目录结构取决于镜像的制作者，没有自己的专属结构&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;以官方的&lt;code&gt;httpd&lt;/code&gt;镜像为例，它是基于Debian或Alpine Linux构建的，其内部结构通常类似于源码编译安装&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/                                           &lt;span style=&#34;color:#7f848e&#34;&gt;# 根目录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;└── usr/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    └── local/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        └── apache2/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── bin/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── cgi-bin/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── conf/                &lt;span style=&#34;color:#7f848e&#34;&gt;# 配置文件目录 (可挂载)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── htdocs/            &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认 Web 根目录 (可挂载)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── icons/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── include/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            ├── logs/                 &lt;span style=&#34;color:#7f848e&#34;&gt;# 日志文件目录 (符号链接)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            └── modules/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;唯一要注意的是日志文件：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Docker容器的httpd的日志输出到标准输出(stdout)和标准错误(stderr)，而不是写入文件&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;执行如下命令：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;grep -E &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;ErrorLog|CustomLog&amp;#34;&lt;/span&gt; /usr/local/apache2/conf/httpd.conf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;输出中会有这样两行：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;ErrorLog&lt;/span&gt; /&lt;span style=&#34;color:#e06c75&#34;&gt;proc&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;self&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;fd&lt;/span&gt;/&lt;span style=&#34;color:#d19a66&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;CustomLog&lt;/span&gt; /&lt;span style=&#34;color:#e06c75&#34;&gt;proc&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;self&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;fd&lt;/span&gt;/&lt;span style=&#34;color:#d19a66&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;common&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;也就是说，访问日志和错误日志不会被写入文件，而是重定向到标准输入和标准错误&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;我们可以通过docker的命令来查看它们：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;docker&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;logs&lt;/span&gt; &amp;lt;&lt;span style=&#34;color:#e06c75&#34;&gt;容器ID&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;常用命令&#34;&gt;常用命令
&lt;/h1&gt;&lt;h2 id=&#34;使用systemctl管理apache&#34;&gt;使用systemctl管理Apache
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;适用于通过系统包管理器安装的Apache服务，比如&lt;code&gt;apache2&lt;/code&gt;或&lt;code&gt;httpd&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;下文以&lt;code&gt;apache2&lt;/code&gt;为例&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;启动&#34;&gt;启动
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl start apache2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;停止&#34;&gt;停止
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl stop apache2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;重启&#34;&gt;重启
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl restart apache2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;重新加载配置&#34;&gt;重新加载配置
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;不会中断现有连接&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;systemctl reload apache2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;查看状态&#34;&gt;查看状态
&lt;/h3&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;systemctl status apache2  # 或 httpd
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;使用apachectl或-apache2ctl&#34;&gt;使用apachectl（或 apache2ctl）
&lt;/h2&gt;&lt;p&gt;这是Apache自带的控制工具，适合调试、配置检查&lt;/p&gt;
&lt;p&gt;它其实就是对&lt;code&gt;httpd&lt;/code&gt;可执行程序的一个封装，方便管理Apache&lt;/p&gt;
&lt;h3 id=&#34;启动-1&#34;&gt;启动
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;apachectl start
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;停止-1&#34;&gt;停止
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;apachectl start
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;重新加载配置-1&#34;&gt;重新加载配置
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;不会中断现有连接&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;apachectl graceful
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;查看版本&#34;&gt;查看版本
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;apachectl -v
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;检查配置文件语法&#34;&gt;检查配置文件语法
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;apachectl -t
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;debianubuntu专属工具a2en--a2dis&#34;&gt;Debian/Ubuntu专属工具：a2en* / a2dis*
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;这些工具主要管理站点配置和模块，对&lt;code&gt;/etc/apache2/&lt;/code&gt;下的文件进行操作&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;启用：在&lt;code&gt;*-available&lt;/code&gt; → &lt;code&gt;*-enabled&lt;/code&gt;创建符号链接&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;禁用：删除对应链接&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;操作之后要记得重启（&lt;code&gt;reload&lt;/code&gt; / &lt;code&gt;graceful&lt;/code&gt;）&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;管理站点虚拟主机--site&#34;&gt;管理站点（虚拟主机） —— site
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;/etc/apache2/sites-enabled/site.conf&lt;/code&gt; -&amp;gt; &lt;code&gt;/etc/apache2/sites-available/site.conf&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;启用站点&#34;&gt;启用站点
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;a2ensite site.conf 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;site.conf&lt;/code&gt;是要启用的虚拟主机配置文件，它定义了一个网站在Apache上的访问方式，包括域名、网站目录、日志路径等&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;禁用站点&#34;&gt;禁用站点
&lt;/h4&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;a2dissite site.conf
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;管理模块--mod&#34;&gt;管理模块 —— mod
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;/etc/apache2/mods-enabled/module_name.load&lt;/code&gt; -&amp;gt; &lt;code&gt;/etc/apache2/mods-available/module_name.load&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;/etc/apache2/mods-enabled/module_name.os&lt;/code&gt; -&amp;gt; &lt;code&gt;/etc/apache2/mods-available/module_name.os&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;部分模块会有配置文件：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;/etc/apache2/mods-enabled/module_name.conf&lt;/code&gt; -&amp;gt; &lt;code&gt;/etc/apache2/mods-available/module_name.conf&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;启用模块&#34;&gt;启用模块
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;a2enmod module_name
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;module_name&lt;/code&gt;是要启动的模块名称，不用带后缀名&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;禁用模块&#34;&gt;禁用模块
&lt;/h4&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;a2dismod module_name
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;管理配置文件--conf&#34;&gt;管理配置文件 —— conf
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;/etc/apache2/conf-enabled/config_name.conf&lt;/code&gt; -&amp;gt; &lt;code&gt;/etc/apache2/conf-available/config_name.conf&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;启用配置&#34;&gt;启用配置
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;a2enconf config_name
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;config_name&lt;/code&gt;是要加载的配置文件名称，不用带后缀名&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;禁用配置&#34;&gt;禁用配置
&lt;/h4&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;a2disconf file.conf
&lt;/code&gt;&lt;/pre&gt;&lt;h1 id=&#34;主配置文件-httpdconf&#34;&gt;主配置文件 (httpd.conf)
&lt;/h1&gt;&lt;p&gt;主配置文件在各个不同系统的路径不同：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;在RHEL/CentOS上通常是&lt;code&gt;/etc/httpd/conf/httpd.conf&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;在Debian/Ubuntu上是&lt;code&gt;/etc/apache2/apache2.conf&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;它定义了服务器的全局行为、加载的模块、默认设置以及如何包含其他配置文件&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;不同系统配置文件使用的语法也差不多，以下是一个典型的&lt;code&gt;httpd.conf&lt;/code&gt;（RHEL/CentOS风格）文件的结构：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# -------------------- 全局配置 --------------------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;ServerRoot&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/etc/httpd&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;Listen&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;80&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;User&lt;/span&gt; apache
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;Group&lt;/span&gt; apache
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;PidFile&lt;/span&gt; run/httpd.pid
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;Timeout&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;60&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;KeepAlive&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;On&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;MaxKeepAliveRequests&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;100&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;KeepAliveTimeout&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# -------------------- 模块加载与条件判断 --------------------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 直接加载关键模块&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LoadModule&lt;/span&gt; mpm_event_module modules/mod_mpm_event.so
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LoadModule&lt;/span&gt; authz_core_module modules/mod_authz_core.so
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 包含其他模块配置文件&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;Include&lt;/span&gt; conf.modules.d/*.conf
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# -------------------- 主服务器配置 --------------------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;ServerAdmin&lt;/span&gt; root@localhost
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# ServerName www.example.com:80&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 使用&amp;lt;IfModule&amp;gt;确保模块存在时才应用指令&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;IfModule&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;dir_module&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;DirectoryIndex&lt;/span&gt; index.html index.php
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/IfModule&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;DocumentRoot&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/var/www/html&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# -------------------- 目录与文件访问控制 --------------------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 限URL需要认证&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/admin&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;AuthType&lt;/span&gt; Basic
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;AuthName&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;Admin Area&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;AuthUserFile&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/etc/httpd/.htpasswd&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; valid-user
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Location&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 默认禁止访问所有文件系统&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Directory&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;AllowOverride&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;none&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;all&lt;/span&gt; denied
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Directory&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 开放 Web 根目录的访问权限&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Directory&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/var/www/html&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Options&lt;/span&gt; Indexes FollowSymLinks
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;AllowOverride&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;None&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;all&lt;/span&gt; granted
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Directory&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 使用&amp;lt;Files&amp;gt;块保护敏感文件&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Files&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;.ht*&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;all&lt;/span&gt; denied
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Files&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# -------------------- 日志配置 --------------------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;ErrorLog&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;logs/error_log&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LogLevel&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;warn&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LogFormat&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;%h %l %u %t \&amp;#34;%r\&amp;#34; %&amp;gt;s %b \&amp;#34;%{Referer}i\&amp;#34; \&amp;#34;%{User-Agent}i\&amp;#34;&amp;#34;&lt;/span&gt; combined
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;CustomLog&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;logs/access_log&amp;#34;&lt;/span&gt; combined
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# -------------------- 包含其他配置文件 --------------------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;IncludeOptional&lt;/span&gt; conf.d/*.conf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;全局配置&#34;&gt;全局配置
&lt;/h2&gt;&lt;p&gt;这部分指令定义了Apache服务器的底层运行参数，影响服务器的整体性能和安全&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;ServerRoot&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/etc/httpd&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;Listen&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;80&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;User&lt;/span&gt; apache
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;Group&lt;/span&gt; apache
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;PidFile&lt;/span&gt; run/httpd.pid
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;Timeout&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;60&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;KeepAlive&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;On&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;MaxKeepAliveRequests&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;100&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;KeepAliveTimeout&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ServerRoot&lt;/code&gt;：指定Apache的安装根目录&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;配置文件中的所有相对路径（如&lt;code&gt;PidFile&lt;/code&gt;, &lt;code&gt;ErrorLog&lt;/code&gt;）都将基于此目录进行解析&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Listen&lt;/code&gt;：指定服务器监听的网络地址和端口&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;若不指定IP地址，则监听所有网络接口&lt;/p&gt;
&lt;p&gt;可以配置多个&lt;code&gt;Listen&lt;/code&gt;指令来监听不同的端口或地址，例如&lt;code&gt;Listen 80&lt;/code&gt;和&lt;code&gt;Listen 127.0.0.1:8080&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;User&lt;/code&gt; &amp;amp; &lt;code&gt;Group&lt;/code&gt;：设置运行Apache工作进程的系统用户和用户组&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;主进程（master process）以root身份启动以绑定低位端口（&amp;lt;1024），但子进程会切换到此处的低权限用户，这是关键的安全措施&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;PidFile&lt;/code&gt;：指定于存放Apache主进程的进程ID（PID）的文件&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这个文件被&lt;code&gt;apachectl&lt;/code&gt;等控制脚本用来向主进程发送信号（如stop, restart, reload）&lt;/p&gt;
&lt;p&gt;路径通常是相对于&lt;code&gt;ServerRoot&lt;/code&gt;的，如果没写，Apache 会用编译时的默认路径：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Debian/Ubuntu&lt;/strong&gt;：&lt;code&gt;/var/run/apache2/apache2.pid&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;RHEL/CentOS&lt;/strong&gt;：&lt;code&gt;/var/run/httpd/httpd.pid&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;源码安装&lt;/strong&gt;：&lt;code&gt;logs/httpd.pid&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Timeout&lt;/code&gt;：服务器在各种网络操作中等待的秒数，包括等待接收GET请求、在TCP包发送之间等待ACK等&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;如果超过此时长，连接将被视为超时并关闭&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;KeepAlive&lt;/code&gt;：启用HTTP持久连接&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;开启后，客户端可以在同一个TCP连接上发送多个请求，极大减少了TCP握手和慢启动的开销，显著提升网站加载速度，特别是对于包含大量小资源的页面&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;MaxKeepAliveRequests&lt;/code&gt;：在&lt;code&gt;KeepAlive&lt;/code&gt;开启时，限制单个持久连接上允许处理的最大请求数&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;达到此数目后，连接会自动关闭，有助于防止某个客户端长时间占用连接，并能周期性地回收资源&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;KeepAliveTimeout&lt;/code&gt;：在&lt;code&gt;KeepAlive&lt;/code&gt;开启时，设置服务器完成请求后等待下次请求的最长时间（秒）&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;如果超时仍未收到新请求，连接将关闭&lt;/p&gt;
&lt;p&gt;合理的设置（通常是2-5秒）可以在性能和服务器资源消耗之间取得平衡&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;模块加载与条件判断&#34;&gt;模块加载与条件判断
&lt;/h2&gt;&lt;p&gt;Apache的功能是高度模块化的，使用任何高级功能（如SSL、重写、代理）前，必须先加载对应的模块&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LoadModule&lt;/span&gt; mpm_event_module modules/mod_mpm_event.so
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LoadModule&lt;/span&gt; authz_core_module modules/mod_authz_core.so
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;Include&lt;/span&gt; conf.modules.d/*.conf
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;IfModule&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;dir_module&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;DirectoryIndex&lt;/span&gt; index.html index.php
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/IfModule&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;LoadModule&lt;/code&gt;：在服务器启动时动态加载指定的模块，使其提供的功能和指令在配置中可用&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;语法为：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LoadModule&lt;/span&gt; &amp;lt;模块名&amp;gt; &amp;lt;模块文件路径&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;模块名是模块内部定义的标识符，路径通常是相对于&lt;code&gt;ServerRoot&lt;/code&gt;的&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Include&lt;/code&gt;：把其它配置文件包含进来&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Apache（httpd）的模块配置通常被拆分放在&lt;code&gt;conf.modules.d/&lt;/code&gt;目录下，每个模块一个配置文件：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;etc&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;httpd&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;conf&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;modules&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;d&lt;/span&gt;/&lt;span style=&#34;color:#d19a66&#34;&gt;00&lt;/span&gt;-&lt;span style=&#34;color:#e06c75&#34;&gt;base&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;conf&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;etc&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;httpd&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;conf&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;modules&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;d&lt;/span&gt;/&lt;span style=&#34;color:#d19a66&#34;&gt;00&lt;/span&gt;-&lt;span style=&#34;color:#e06c75&#34;&gt;mpm&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;conf&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;etc&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;httpd&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;conf&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;modules&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;d&lt;/span&gt;/&lt;span style=&#34;color:#d19a66&#34;&gt;01&lt;/span&gt;-&lt;span style=&#34;color:#e06c75&#34;&gt;cgi&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;conf&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这些&lt;code&gt;.conf&lt;/code&gt;文件里一般只有一两行&lt;code&gt;LoadModule&lt;/code&gt; 指令：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LoadModule&lt;/span&gt; mpm_prefork_module modules/mod_mpm_prefork.so
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LoadModule&lt;/span&gt; rewrite_module modules/mod_rewrite.so
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LoadModule&lt;/span&gt; ssl_module modules/mod_ssl.so
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;那么主配置文件（&lt;code&gt;httpd.conf&lt;/code&gt;）里只要写下面的&lt;code&gt;include&lt;/code&gt;命令：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;Include&lt;/span&gt; conf.modules.d/*.conf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这样就能把这些模块加载指令全部引入，模块配置更加独立，更好管理&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;&amp;lt;IfModule&amp;gt;&lt;/code&gt;块：条件容器块，其内部的指令仅在指定的模块被加载时才会被处理&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这使得配置文件具有更好的可移植性，如果将配置文件部署到一个没有加载特定模块的服务器上，Apache不会因为无法识别模块内的指令而启动失败，而是会忽略整个&lt;code&gt;&amp;lt;IfModule&amp;gt;&lt;/code&gt;块&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;IfModule&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;dir_module&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;DirectoryIndex&lt;/span&gt; index.html index.php
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/IfModule&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在上面的例子，&lt;code&gt;DirectoryIndex&lt;/code&gt;指令只有&lt;code&gt;mod_dir&lt;/code&gt;模块（在配置文件里显示为&lt;code&gt;dir_module&lt;/code&gt;）存在时才生效&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;主服务器配置&#34;&gt;主服务器配置
&lt;/h2&gt;&lt;p&gt;这部分指令定义了“默认服务器”的行为&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;当一个请求的&lt;code&gt;Host&lt;/code&gt;头没有匹配到任何&lt;code&gt;&amp;lt;VirtualHost&amp;gt;&lt;/code&gt;块时，Apache会使用这里的配置来处理该请求&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;ServerAdmin&lt;/span&gt; root@localhost
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;ServerName&lt;/span&gt; www.example.com:80
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;DocumentRoot&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/var/www/html&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;IfModule&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;dir_module&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;DirectoryIndex&lt;/span&gt; index.html index.php
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/IfModule&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ServerAdmin&lt;/code&gt;：设置了服务器管理员的电子邮件地址&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这个地址会显示在Apache生成的错误页面中，方便用户报告问题&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ServerName&lt;/code&gt;：为服务器设置一个规范的域名&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;如果未设置，Apache会尝试通过反向DNS查找来确定，这可能导致启动缓慢或结果不准确&lt;/p&gt;
&lt;p&gt;在全局配置中，它主要用于服务器自我识别和生成重定向URL&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;DocumentRoot&lt;/code&gt;：该指令指定了存放网页文件的根目录&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;当收到一个请求时，Apache会在此目录下查找对应的文件&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;DirectoryIndex&lt;/code&gt;：当客户端请求一个目录（URL以&lt;code&gt;/&lt;/code&gt;结尾）时，Apache会在此目录中查找的文件列表&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这是Apache模块&lt;code&gt;dir_module&lt;/code&gt;里的命令&lt;/p&gt;
&lt;p&gt;它会按照指令中列出的顺序查找，并返回第一个找到的文件作为响应&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;DirectoryIndex&lt;/span&gt; index.html index.php
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;比如上面的命令，如果用户访问&lt;code&gt;http://www.example.com/docs/&lt;/code&gt;（这是个目录），Apache会依次查找：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;/var/www/example/docs/index.html&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/var/www/example/docs/index.php&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;然后将找到的第一个存在的文件返回&lt;/p&gt;
&lt;p&gt;如果都没有，可能报403Forbidden，或者交给&lt;code&gt;mod_autoindex&lt;/code&gt;显示目录列表&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;目录与文件访问控制&#34;&gt;目录与文件访问控制
&lt;/h2&gt;&lt;p&gt;这是Apache安全配置的核心，它允许对文件系统中的路径和特定文件名进行精细的访问控制&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/admin&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;AuthType&lt;/span&gt; Basic
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;AuthName&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;Admin Area&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;AuthUserFile&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/etc/httpd/.htpasswd&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; valid-user
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Location&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Directory&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;AllowOverride&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;none&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;all&lt;/span&gt; denied
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Directory&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Directory&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/var/www/html&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Options&lt;/span&gt; Indexes FollowSymLinks
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;AllowOverride&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;None&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;all&lt;/span&gt; granted
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Directory&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Files&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;.ht*&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;all&lt;/span&gt; denied
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Files&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Apache通过&lt;code&gt;&amp;lt;Directory&amp;gt;&lt;/code&gt;、&lt;code&gt;&amp;lt;Files&amp;gt;&lt;/code&gt;、&lt;code&gt;&amp;lt;Location&amp;gt;&lt;/code&gt;这三种核心容器块，提供了对服务器资源精细化的访问控制&lt;/p&gt;
&lt;p&gt;他们的语法格式十分相似，大部分内部指令也通用，只有小部分不同&lt;/p&gt;
&lt;h3 id=&#34;directory--directorymatch块--物理路径匹配&#34;&gt;&amp;lt;Directory&amp;gt; / &amp;lt;DirectoryMatch&amp;gt;块 —— 物理路径匹配
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;将其中的指令应用于服务器文件系统上的物理目录以及这些目录下的所有文件和子目录&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;格式：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Directory&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;物理路径&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Directory&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;精确路径：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Directory&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/var/www/html&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Directory&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;通配符路径：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Directory&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/var/www/users/*/public_html&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Directory&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;正则有两种写法，效果相同：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;正则表达式路径（使用&amp;lt;Directory&amp;gt;，以 ~ 开头）：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Directory&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;~ &amp;#34;^/var/www/project-(a|b)/src&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Directory&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;正则表达式路径（使用&amp;lt;DirectoryMatch&amp;gt;）：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;DirectoryMatch&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;^/var/www/project-(a|b)/src&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/DirectoryMatch&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;files--filesmatch-块---文件名匹配&#34;&gt;&amp;lt;Files&amp;gt; / &amp;lt;FilesMatch&amp;gt; 块  —— 文件名匹配
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;将其中的指令应用于特定文件名的文件，而不考虑这些文件位于哪个目录下&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&amp;lt;Files&amp;gt;格式：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Files&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;文件名&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Files&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;具体格式参考&amp;lt;Directory&amp;gt;块&lt;/p&gt;
&lt;h3 id=&#34;location--locationmatch块--url路径匹配&#34;&gt;&amp;lt;Location&amp;gt; / &amp;lt;LocationMatch&amp;gt;块 —— URL路径匹配
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;将其中的指令应用于客户端请求的URL路径&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;它不关心这个URL最终对应到哪个文件，甚至这个URL可能根本不对应任何文件（例如由模块动态生成的内容或代理的请求）&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&amp;lt;Location&amp;gt;格式：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Files&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;文件名&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Files&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;具体格式参考&amp;lt;Location&amp;gt;块&lt;/p&gt;
&lt;h3 id=&#34;常用指令&#34;&gt;常用指令
&lt;/h3&gt;&lt;p&gt;以下是在上述容器块中常用的指令，我们会详细说明每个指令的格式、参数和用法&lt;/p&gt;
&lt;h4 id=&#34;require访问授权&#34;&gt;Require：访问授权
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;用于定义谁可以访问资源&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;格式&lt;/strong&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; [not] &amp;lt;授权类型&amp;gt; [参数]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;not&lt;/code&gt;是一个可选的修饰符，用来取反&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;授权类型：&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;授权类型&lt;/th&gt;
          &lt;th&gt;参数&lt;/th&gt;
          &lt;th&gt;说明&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;all&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;granted&lt;/code&gt; / &lt;code&gt;denied&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;无条件允许或拒绝所有请求&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;ip&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;IP地址, 子网掩码, 网段&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;匹配客户端的IP地址&lt;/strong&gt;&lt;br /&gt;例如&lt;code&gt;192.168.1.1&lt;/code&gt;、&lt;code&gt;10.0.0.0/8&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;host&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;主机名, 域名&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;匹配客户端的主机名&lt;/strong&gt;&lt;br /&gt;例如&lt;code&gt;example.org&lt;/code&gt;&lt;br /&gt;&lt;strong&gt;注意&lt;/strong&gt;：这需要进行DNS查询，可能影响性能&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;valid-user&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;(无)&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;要求用户必须通过身份认证&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;user&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;用户名列表&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;要求用户必须是已认证的指定用户之一&lt;/strong&gt;&lt;br /&gt;例如&lt;code&gt;Require user admin john&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;group&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;用户组列表&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;要求用户必须属于已认证的指定用户组之一&lt;/strong&gt;&lt;br /&gt;例如&lt;code&gt;Require group administrators&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;使用Require后，在外层还可以嵌套逻辑容器：&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;逻辑容器&lt;/th&gt;
          &lt;th&gt;逻辑关系&lt;/th&gt;
          &lt;th&gt;说明&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;&amp;lt;RequireAny&amp;gt;&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;OR&lt;/td&gt;
          &lt;td&gt;只要有一条&lt;code&gt;Require&lt;/code&gt;满足就允许访问&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;&amp;lt;RequireAll&amp;gt;&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;AND&lt;/td&gt;
          &lt;td&gt;必须所有&lt;code&gt;Require&lt;/code&gt;条件都满足才允许访问&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;&amp;lt;RequireNone&amp;gt;&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;NOT&lt;/td&gt;
          &lt;td&gt;如果里面任意一条&lt;code&gt;Require&lt;/code&gt;满足，就拒绝访问（取反）&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;示例：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Directory&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/var/www/private&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;RequireAny&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;RequireAll&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; ip &lt;span style=&#34;color:#d19a66&#34;&gt;192.168.0.0/16&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;group&lt;/span&gt; admins
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/RequireAll&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;user&lt;/span&gt; superadmin
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/RequireAny&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Directory&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;意思是IP在&lt;code&gt;192.168&lt;/code&gt;网段且用户属于&lt;code&gt;admins&lt;/code&gt;组，或者用户名是&lt;code&gt;superadmin&lt;/code&gt;的，允许访问&lt;code&gt;/var/www/private&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&#34;options特性控制&#34;&gt;Options：特性控制
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;控制目录中可用的服务器功能和服务，只用于&lt;code&gt;&amp;lt;Directory&amp;gt;&lt;/code&gt;块&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;格式&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;Options&lt;/span&gt; [+-]关键字1 [+-]关键字2 ...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;可以列出多个关键字，使用&lt;code&gt;+&lt;/code&gt;或&lt;code&gt;-&lt;/code&gt;前缀可以在现有选项基础上添加或移除单个选项&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;参数字段&lt;/strong&gt;:&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;关键字&lt;/th&gt;
          &lt;th&gt;说明&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;Indexes&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;如果目录中缺少索引文件（如 &lt;code&gt;index.html&lt;/code&gt;），则&lt;strong&gt;允许服务器生成并显示该目录的文件列表&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;FollowSymLinks&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;允许服务器跟随符号链接访问其指向的文件或目录&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;SymLinksIfOwnerMatch&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;一个更安全的&lt;code&gt;FollowSymLinks&lt;/code&gt;版本，&lt;strong&gt;仅当符号链接和目标文件的所有者相同时才跟随&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;ExecCGI&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;允许在该目录中执行CGI脚本&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;MultiViews&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;启用内容协商功能，&lt;strong&gt;当用户请求的URL没有扩展名时，服务器可以根据客户端偏好（如语言）自动选择最合适的文件&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;All&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;启用除&lt;code&gt;MultiViews&lt;/code&gt;之外的所有选项&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;None&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;禁用所有选项&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;示例：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Apache的&lt;code&gt;Options&lt;/code&gt;指令有两种使用方式：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;覆盖式（没有&lt;code&gt;+&lt;/code&gt;/&lt;code&gt;-&lt;/code&gt;）&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Options Indexes FollowSymLinks
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这一行会清空继承的配置，然后只启用&lt;code&gt;Indexes&lt;/code&gt;和&lt;code&gt;FollowSymLinks&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;增量式（有&lt;code&gt;+&lt;/code&gt;/&lt;code&gt;-&lt;/code&gt;）&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Options -Indexes -ExecCGI +FollowSymLinks
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这一行会在继承父级Options的基础上修改：去掉&lt;code&gt;Indexes&lt;/code&gt;，去掉&lt;code&gt;ExecCGI&lt;/code&gt;，加上&lt;code&gt;FollowSymLinks&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;allowoverride覆盖控制&#34;&gt;AllowOverride：覆盖控制
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;决定目录中的&lt;code&gt;.htaccess&lt;/code&gt;文件是否可以覆盖主配置文件中的设置，仅能在&lt;code&gt;&amp;lt;Directory&amp;gt;&lt;/code&gt;块中使用&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;下文会详细说明&lt;code&gt;.htaccess&lt;/code&gt;文件：&lt;a class=&#34;link&#34; href=&#34;#.htaccess%e6%96%87%e4%bb%b6&#34; &gt;.htaccess文件
    
&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;格式&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;AllowOverride&lt;/span&gt; 关键字1 关键字2 ...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;参数字段&lt;/strong&gt;:&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;关键字&lt;/th&gt;
          &lt;th&gt;说明&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;None&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;完全忽略&lt;code&gt;.htaccess&lt;/code&gt;文件&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;All&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;允许&lt;code&gt;.htaccess&lt;/code&gt;中的所有指令生效&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;AuthConfig&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;允许使用认证相关的指令&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;FileInfo&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;允许使用MIME类型、重写、头信息相关的指令&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;Indexes&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;允许使用索引相关的指令&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;Limit&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;允许使用访问控制指令&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;Options&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;允许在&lt;code&gt;.htaccess&lt;/code&gt;中使用&lt;code&gt;Options&lt;/code&gt; 指令&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;示例&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Directory&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/var/www/wordpress&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;AllowOverride&lt;/span&gt; FileInfo AuthConfig Limit
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Directory&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;auth身份认证系列&#34;&gt;Auth*：身份认证系列
&lt;/h4&gt;&lt;p&gt;这一系列指令共同工作，为资源设置基于用户名和密码的保护&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;指令&lt;/th&gt;
          &lt;th&gt;作用&lt;/th&gt;
          &lt;th&gt;格式&lt;/th&gt;
          &lt;th&gt;说明&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;AuthType&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;设置认证类型&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;`AuthType Basic&lt;/td&gt;
          &lt;td&gt;Digest`&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;AuthName&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;设置认证区域名称&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;AuthName &amp;quot;提示信息&amp;quot;&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;浏览器密码输入框会显示该提示信息&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;AuthUserFile&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;指定用户及密码文件&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;AuthUserFile &amp;quot;/path/to/.htpasswd&amp;quot;&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;文件由 &lt;code&gt;htpasswd&lt;/code&gt; 工具创建，存储用户名和加密密码&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;AuthGroupFile&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;指定用户组文件&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;AuthGroupFile &amp;quot;/path/to/.htgroups&amp;quot;&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;文件定义用户组及其成员，配合 &lt;code&gt;Require group&lt;/code&gt; 使用&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;示例：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/admin&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;AuthType&lt;/span&gt;        Basic
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;AuthName&lt;/span&gt;        &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;Admin Area&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;AuthUserFile&lt;/span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/etc/httpd/.htpasswd&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt;         valid-user
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Location&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;用户访问 &lt;code&gt;http://example.com/admin&lt;/code&gt;后：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;要求客户端进行Basic认证&lt;/li&gt;
&lt;li&gt;浏览器弹出登录框，显示&lt;code&gt;Admin Area&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;用户输入用户名/密码，Apache 从&lt;code&gt;/etc/httpd/.htpasswd&lt;/code&gt; 验证&lt;/li&gt;
&lt;li&gt;验证成功 → 允许访问&lt;code&gt;/admin&lt;/code&gt;
验证失败 → 返回401 Unauthorized&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;sethandler处理器指定&#34;&gt;SetHandler：处理器指定
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;指定服务器遇到某个资源时，交给哪种处理器来处理请求&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;格式：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;SetHandler&lt;/span&gt; &amp;lt;处理器名称&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;参数字段&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;处理器&lt;/th&gt;
          &lt;th&gt;说明&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;server-status&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;由&lt;code&gt;mod_status&lt;/code&gt;模块处理，&lt;strong&gt;生成服务器状态报告&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;server-info&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;由&lt;code&gt;mod_info&lt;/code&gt;模块处理，&lt;strong&gt;生成服务器详细配置信息&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;application/x-httpd-php&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;强制由PHP处理器执行&lt;/strong&gt;（使用&lt;code&gt;mod_php&lt;/code&gt;时）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;cgi-script&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;由&lt;code&gt;mod_cgi&lt;/code&gt;或&lt;code&gt;mod_cgid&lt;/code&gt;处理，&lt;strong&gt;执行CGI脚本&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;cgi&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;由&lt;code&gt;mod_cgi&lt;/code&gt;处理，&lt;strong&gt;通常和&lt;code&gt;cgi-script&lt;/code&gt;等价&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;perl-script&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;由&lt;code&gt;mod_perl&lt;/code&gt;处理，&lt;strong&gt;执行Perl脚本&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;proxy-server&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;由&lt;code&gt;mod_proxy&lt;/code&gt;处理，&lt;strong&gt;将请求代理到后端服务器&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;dav&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;由&lt;code&gt;mod_dav&lt;/code&gt;处理，&lt;strong&gt;实现WebDAV功能&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;imap-file&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;由&lt;code&gt;mod_imap&lt;/code&gt;处理，&lt;strong&gt;用于访问邮件文件&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;示例：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/server-status&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;SetHandler&lt;/span&gt; server-status
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; ip &lt;span style=&#34;color:#d19a66&#34;&gt;127.0.0.1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Location&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这段配置开启了Apache的服务器状态监控页面&lt;code&gt;/server-status&lt;/code&gt;，但只允许本机访问，常用于管理员调试和性能监控&lt;/p&gt;
&lt;h4 id=&#34;headerhttp头控制&#34;&gt;Header：HTTP头控制
&lt;/h4&gt;&lt;p&gt;来自&lt;code&gt;mod_headers&lt;/code&gt;模块，用于添加、修改或删除HTTP响应头&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;格式：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;Header&lt;/span&gt; [condition] action 头部名称 &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;值&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;条件参数：&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;条件 (&lt;code&gt;condition&lt;/code&gt;)&lt;/th&gt;
          &lt;th&gt;说明&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;early&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;在响应生成的早期阶段设置头部&lt;/strong&gt;（比默认阶段更早）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;expr=&amp;quot;表达式&amp;quot;&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;只有当表达式为真时才执行该Header动作&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;always&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;无论响应状态码或其他限制，&lt;strong&gt;强制应用该Header&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;动作参数：&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;动作 (&lt;code&gt;action&lt;/code&gt;)&lt;/th&gt;
          &lt;th&gt;说明&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;set&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;设置HTTP响应头&lt;/strong&gt;，如果同名头已存在，则覆盖它&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;add&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;添加HTTP响应头&lt;/strong&gt;，即使同名头已存在，也会再添加一个&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;append&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;将值附加到已存在的同名头值的末尾&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;unset&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;从响应中&lt;strong&gt;移除指定的HTTP头&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;echo&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;仅用于调试，&lt;strong&gt;输出指定头的值&lt;/strong&gt;（很少用）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;edit&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;修改已存在头的值&lt;/strong&gt;，基于正则替换&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;merge&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;合并多个值为同一个头&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;示例&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;FilesMatch&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;\.(css|js)$&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Header&lt;/span&gt; set X-Content-Type-Options &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;nosniff&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e5c07b&#34;&gt;Header&lt;/span&gt; set X-Frame-Options &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;DENY&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e5c07b&#34;&gt;Header&lt;/span&gt; append X-Powered-By &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;Apache&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e5c07b&#34;&gt;Header&lt;/span&gt; set Cache-Control &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;max-age=3600&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;expr=%{REQUEST_STATUS} == 200&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#e5c07b&#34;&gt;Header&lt;/span&gt; always set Strict-Transport-Security &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;max-age=31536000; includeSubDomains&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/FilesMatch&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;对&lt;code&gt;.css&lt;/code&gt;和&lt;code&gt;.js&lt;/code&gt;文件设置响应头，防止MIME嗅探和被嵌入iframe，添加服务器标识，同时控制缓存和强制HTTPS&lt;/p&gt;
&lt;h2 id=&#34;日志配置&#34;&gt;日志配置
&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;ErrorLog&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;logs/error_log&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LogLevel&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;warn&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LogFormat&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;%h %l %u %t \&amp;#34;%r\&amp;#34; %&amp;gt;s %b \&amp;#34;%{Referer}i\&amp;#34; \&amp;#34;%{User-Agent}i\&amp;#34;&amp;#34;&lt;/span&gt; combined
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;CustomLog&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;logs/access_log&amp;#34;&lt;/span&gt; combined
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ErrorLog&lt;/code&gt;：错误日志文件的路径&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;服务器启动、运行中的错误、模块的诊断信息都会记录在其中&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;LogLevel&lt;/code&gt;：记录在错误日志中的信息的详细程度&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;每条错误日志条目都会带有一个严重性等级，这些等级是代码里写死的，作为用户无法改变某个错误属于什么等级&lt;/p&gt;
&lt;p&gt;Apache支持的日志级别（从高到低）如下：&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;级别&lt;/th&gt;
          &lt;th&gt;描述&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;debug&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;记录所有信息，主要用于开发或调试，信息量极大，通常需编译时启用&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;info&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;普通信息，如配置加载成功、进程启动、连接创建等&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;notice&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;正常但重要的事件，如配置文件重载、进程关闭等&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;warn&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;警告信息，非致命错误，比如配置中存在问题但可以忽略或继续运行&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;error&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;运行过程中出现的错误，如连接失败、服务不可达等&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;crit&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;严重错误，Nginx可能无法继续运行&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;alert&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;必须立刻处理的严重问题&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;emerg&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;紧急状态，比如系统崩溃，Nginx无法启动&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;是否写入日志文件取决于&lt;code&gt;LogLevel&lt;/code&gt;设置的阈值，只会写入大于等于当前设置等级的错误事件&lt;/p&gt;
&lt;p&gt;生产环境通常设置为&lt;code&gt;warn&lt;/code&gt;以捕捉重要问题，同时避免日志泛滥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;LogFormat&lt;/code&gt;：指定访问日志的格式和名称&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;LogFormat &amp;quot;...&amp;quot; combined&lt;/code&gt;表示把这个格式命名为&lt;code&gt;combined&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;格式字符串由固定的文本和&lt;code&gt;%&lt;/code&gt;开头的变量组成，例如 &lt;code&gt;%h&lt;/code&gt; (客户端IP), &lt;code&gt;%&amp;gt;s&lt;/code&gt; (HTTP状态码), &lt;code&gt;%D&lt;/code&gt; (处理请求的时间，单位微秒)，后面日志分析部分会详细说明&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;CustomLog&lt;/code&gt;：设置日志文件位置，并指定使用的格式&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;CustomLog &amp;quot;logs/access_log&amp;quot; combined&lt;/code&gt;表示使用名为&lt;code&gt;combined&lt;/code&gt;的格式（也就是上一行定义的格式）记录访问信息到&lt;code&gt;logs/access_log&lt;/code&gt;文件中&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;虚拟主机配置文件&#34;&gt;虚拟主机配置文件
&lt;/h1&gt;&lt;p&gt;虚拟主机是一种技术，它允许一台物理服务器托管多个独立的网站&lt;/p&gt;
&lt;p&gt;与Nginx的一个server块就是一台虚拟主机不同，Apache一般将虚拟主机配置文件单独存放&lt;/p&gt;
&lt;p&gt;通常，我们会为每个网站创建一个独立的配置文件，在RHEL/CentOS中通常存放在&lt;code&gt;conf.d/&lt;/code&gt;或&lt;code&gt;conf/vhosts.d/&lt;/code&gt; 目录下，而在Debian/Ubuntu中则存放在 &lt;code&gt;sites-available/&lt;/code&gt; 目录中&lt;/p&gt;
&lt;h2 id=&#34;virtualhost块&#34;&gt;&amp;lt;VirtualHost&amp;gt;块
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;&amp;lt;VirtualHost&amp;gt;&lt;/code&gt;块是定义一个虚拟主机所有配置的容器，它通过监听的IP地址和端口号来区分不同的虚拟主机&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;VirtualHost&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;[ip-address]:[port]&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/VirtualHost&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;[ip-address]&lt;/code&gt;&lt;/strong&gt;: 虚拟主机将响应的IP地址。&lt;code&gt;*&lt;/code&gt;代表所有IP地址&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;[port]&lt;/code&gt;&lt;/strong&gt;: 虚拟主机将监听的端口号。通常是&lt;code&gt;80&lt;/code&gt;（HTTP）或&lt;code&gt;443&lt;/code&gt;（HTTPS）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在一个虚拟主机配置文件中，我们可以配置与主配置文件中类似的指令，但范围仅限于这个特定的虚拟主机&lt;/p&gt;
&lt;p&gt;以下是一个完整的的虚拟主机配置文件示例，它处理了HTTPS服务的配置：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# HTTPS 虚拟主机配置&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;VirtualHost&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;*:443&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 定义该虚拟主机响应的域名&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ServerName&lt;/span&gt; www.example.com
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ServerAlias&lt;/span&gt; example.com
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 为该虚拟主机指定独立的Web根目录&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;DocumentRoot&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/var/www/example.com&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 配置独立的日志文件，便于分析&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ErrorLog&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/var/log/httpd/example.com-error.log&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;CustomLog&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/var/log/httpd/example.com-access.log&amp;#34;&lt;/span&gt; combined
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 开启HTTPS并指定证书文件&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;SSLEngine&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;on&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;SSLCertificateFile&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/etc/pki/tls/certs/example.com.crt&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;SSLCertificateKeyFile&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/etc/pki/tls/private/example.com.key&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;SSLCertificateChainFile&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/etc/pki/tls/certs/chain.crt&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 为该站点的目录设置权限&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Directory&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/var/www/example.com&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e5c07b&#34;&gt;Options&lt;/span&gt; -Indexes +FollowSymLinks
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e5c07b&#34;&gt;AllowOverride&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;All&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;all&lt;/span&gt; granted
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Directory&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/VirtualHost&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ServerName&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;为该虚拟主机指定一个唯一的域名，当客户端的请求头中的&lt;code&gt;Host&lt;/code&gt;字段与此处的&lt;code&gt;ServerName&lt;/code&gt;或&lt;code&gt;ServerAlias&lt;/code&gt;匹配时，该请求就会由这个虚拟主机处理&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ServerAlias&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;为虚拟主机设置一个或多个别名，例如&lt;code&gt;example.com&lt;/code&gt;可以作为&lt;code&gt;www.example.com&lt;/code&gt;的别名&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;HTTPS 相关的指令：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;SSLEngine on&lt;/code&gt;&lt;/strong&gt;: 开启SSL/TLS加密引擎&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;SSLCertificateFile&lt;/code&gt;&lt;/strong&gt;: 指定SSL证书文件的路径（公钥，通常是&lt;code&gt;.crt&lt;/code&gt;或&lt;code&gt;.pem&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;SSLCertificateKeyFile&lt;/code&gt;&lt;/strong&gt;: 指定与证书匹配的私钥文件路径（&lt;code&gt;.key&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;SSLCertificateChainFile&lt;/code&gt;&lt;/strong&gt;: 如果证书需要中间证书链才能被浏览器信任，则需要指定此文件&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;http到https跳转&#34;&gt;HTTP到HTTPS跳转
&lt;/h2&gt;&lt;p&gt;下面是一个经典的例子，它唯一的目的就是利用&lt;code&gt;mod_rewrite&lt;/code&gt;模块将所有HTTP请求重定向到对应的HTTPS URL，以确保用户无论如何访问，都会被安全地引导至加密连接&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 将所有 HTTP 请求永久重定向到 HTTPS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;VirtualHost&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;*:80&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 定义该虚拟主机响应的域名&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ServerName&lt;/span&gt; www.example.com
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ServerAlias&lt;/span&gt; example.com
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 启用URL重写引擎&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;RewriteEngine&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;On&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 定义重定向规则&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;RewriteRule&lt;/span&gt; ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/VirtualHost&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;&amp;lt;VirtualHost *:80&amp;gt;&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;*&lt;/code&gt;表示该虚拟主机将响应服务器上任何IP地址的请求，&lt;code&gt;80&lt;/code&gt;指定了它只监听来自标准HTTP端口&lt;code&gt;80&lt;/code&gt;的请求&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ServerName&lt;/code&gt; 和 &lt;code&gt;ServerAlias&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;当一个请求的&lt;code&gt;Host&lt;/code&gt;头（域名）与&lt;code&gt;www.example.com&lt;/code&gt;或&lt;code&gt;example.com&lt;/code&gt;匹配时，就由该虚拟主机来处理&lt;/p&gt;
&lt;p&gt;这确保了即使服务器上托管了多个网站，这条重定向规则也只会应用于&lt;code&gt;example.com&lt;/code&gt;这个域名的HTTP请求，而不会影响到其他网站&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;RewriteEngine On&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这是启用Apache &lt;code&gt;mod_rewrite&lt;/code&gt;模块重写的开关，必须先开启，其下的&lt;code&gt;RewriteRule&lt;/code&gt;指令才能生效&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这是整个重定向逻辑的核心，它定义了一条具体的重写规则&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;^(.\*)$&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;它捕获了请求路径的全部内容，例如 &lt;code&gt;/about/&lt;/code&gt; 或 &lt;code&gt;/images/logo.png?id=123&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;https://%{HTTP_HOST}%{REQUEST_URI}&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这是重定向的目标URL&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;https://&lt;/code&gt;：**将协议从HTTP改为HTTPS&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;%{HTTP_HOST}&lt;/code&gt;：**这是一个Apache服务器变量，它会动态地获取客户端请求头中的&lt;code&gt;Host&lt;/code&gt;字段值&lt;/p&gt;
&lt;p&gt;**&lt;code&gt;%{REQUEST_URI}&lt;/code&gt;：**另一个服务器变量，它会动态地获取请求的完整URI路径，包括查询字符串&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;[R=301,L]&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这些是控制重写行为的标志&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;R=301&lt;/code&gt;：&lt;/strong&gt;&lt;code&gt;R&lt;/code&gt;代表&lt;code&gt;redirect&lt;/code&gt;（重定向），&lt;code&gt;301&lt;/code&gt;指定了HTTP状态码为301 Moved Permanently，这个状态码告诉浏览器和搜索引擎这个跳转是永久性的，确保SEO权重不丢失&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;L&lt;/code&gt;：&lt;/strong&gt;&lt;code&gt;last&lt;/code&gt;，指示Apache一旦这条规则被匹配并执行，就停止处理任何后续的重写规则&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;当一个用户访问&lt;code&gt;http://www.example.com/login&lt;/code&gt;时，整个流程如下：&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;客户端向服务器的&lt;code&gt;80&lt;/code&gt;端口发送一个HTTP请求&lt;/li&gt;
&lt;li&gt;Apache接收到请求，根据&lt;code&gt;Host&lt;/code&gt;头匹配到这个&lt;code&gt;&amp;lt;VirtualHost *:80&amp;gt;&lt;/code&gt;块&lt;/li&gt;
&lt;li&gt;&lt;code&gt;RewriteEngine On&lt;/code&gt;生效，Apache开始检查&lt;code&gt;RewriteRule&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;RewriteRule&lt;/code&gt;匹配到请求路径&lt;code&gt;/login&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Apache根据规则，动态构建出目标URL：&lt;code&gt;https://www.example.com/login&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;R=301,L&lt;/code&gt;标志告诉Apache向客户端发送一个&lt;code&gt;301&lt;/code&gt;重定向响应&lt;/li&gt;
&lt;li&gt;客户端浏览器接收到&lt;code&gt;301&lt;/code&gt;响应后，会自动向&lt;code&gt;https://www.example.com/login&lt;/code&gt;发起一个新的请求，这个请求将由服务器上监听&lt;code&gt;443&lt;/code&gt;端口的虚拟主机（即HTTPS配置）来处理&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;htaccess文件&#34;&gt;.htaccess文件
&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;.htaccess&lt;/code&gt;文件（分布式配置文件）是一个目录级配置片段，只应用于&amp;lt;Directory&amp;gt;块&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;它允许开发者或非root用户在不修改主配置文件的情况下，对特定目录及其子目录进行配置&lt;/p&gt;
&lt;h2 id=&#34;工作原理&#34;&gt;工作原理
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;Apach 在读取配置时并不会一次性加载&lt;code&gt;.htaccess&lt;/code&gt;，而是每次处理请求时才去磁盘查找并应用它&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;比如，当Apache收到一个对&lt;code&gt;/var/www/site/dir/file.html&lt;/code&gt;的请求时，它会依次查找以下文件：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;/var/www/site/dir/.htaccess&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/var/www/site/.htaccess&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/var/www/.htaccess&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;每找到一个&lt;code&gt;.htaccess&lt;/code&gt;，就解析并应用里面的配置写在对应&amp;lt;Directory&amp;gt;块中&lt;/p&gt;
&lt;p&gt;这种递归查找机制对性能有显著影响，因为它增加了文件系统的I/O开销&lt;/p&gt;
&lt;p&gt;因此，除非必要，通常不建议广泛使用&lt;code&gt;.htaccess&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;.htaccess&lt;/code&gt;文件中的指令是否生效，完全取决于前文提到过主文件配置的&lt;code&gt;AllowOverride&lt;/code&gt;指令：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;#AllowOverride%ef%bc%9a%e8%a6%86%e7%9b%96%e6%8e%a7%e5%88%b6&#34; &gt;AllowOverride：覆盖控制
    
&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;典型用例与指令&#34;&gt;典型用例与指令
&lt;/h2&gt;&lt;p&gt;下面是一个典型的&lt;code&gt;.htaccess&lt;/code&gt;文件内容：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 启用重写引擎&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;RewriteEngine&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;On&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 将所有以.html结尾的请求重定向到不带.html的URL&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 例如：/about.html -&amp;gt; /about&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;RewriteRule&lt;/span&gt; ^(.*)\.html$ /$1 [R=301,L]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 为目录设置访问密码保护&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;AuthType&lt;/span&gt; Basic
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;AuthName&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;Restricted Area&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;AuthUserFile&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/var/www/site/dir/.htpasswd&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; valid-user
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 强制将目录索引文件设置为index.php&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;DirectoryIndex&lt;/span&gt; index.php
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 在响应头中添加自定义信息&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;IfModule&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;mod_headers.c&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Header&lt;/span&gt; set X-Custom-Header &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;My Website&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/IfModule&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在上面的例子中，我们使用了以下指令：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;RewriteEngine&lt;/code&gt;和&lt;code&gt;RewriteRule&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;URL重写，这在构建“伪静态”URL或实现SEO友好的链接时非常有用&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Auth*&lt;/code&gt;系列指令&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;用于对整个目录进行密码保护。这在&lt;code&gt;/admin&lt;/code&gt;或&lt;code&gt;/private&lt;/code&gt;等需要认证的目录中非常常见&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;DirectoryIndex&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;用于覆盖主配置文件中定义的索引文件顺序&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Header&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;添加或修改HTTP响应头&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;这些指令与主配置文件中的用法相同，但其作用范围仅限于&lt;code&gt;.htaccess&lt;/code&gt;文件所在的目录&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;事实上，&amp;lt;Directory&amp;gt;块能够使用的指令，在&lt;code&gt;.htaccess&lt;/code&gt;文件大多都能使用，只是范围受制于&lt;code&gt;AllowOverride&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;这使得它非常灵活，尤其是在共享主机环境中&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id=&#34;常用模块&#34;&gt;常用模块
&lt;/h1&gt;&lt;p&gt;Apache的核心优势在于其高度模块化的设计，几乎所有高级功能都由特定的模块提供。这些模块必须在主配置文件（通常是&lt;code&gt;httpd.conf&lt;/code&gt;或&lt;code&gt;apache2.conf&lt;/code&gt;）中通过&lt;code&gt;LoadModule&lt;/code&gt;指令加载后才能使用。&lt;/p&gt;
&lt;p&gt;本章节将详细介绍几个Apache最常用且功能强大的模块，并讲解它们的配置方法。&lt;/p&gt;
&lt;h2 id=&#34;mod_rewriteurl重写&#34;&gt;mod_rewrite：URL重写
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;mod_rewrite&lt;/code&gt;允许服务器根据正则表达式和规则集来重写请求的URL&lt;/p&gt;
&lt;p&gt;这通常用于实现伪静态、URL美化、HTTP重定向等&lt;/p&gt;
&lt;p&gt;使用之前，我们要确保在主配置文件中启用了&lt;code&gt;mod_rewrite&lt;/code&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;在Debian/Ubuntu中：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;a2enmod&lt;/span&gt; rewrite
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;在RHEL/CentOS中：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LoadModule&lt;/span&gt; rewrite_module modules/mod_rewrite.so
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;核心指令&#34;&gt;核心指令
&lt;/h3&gt;&lt;h4 id=&#34;rewriteengine&#34;&gt;RewriteEngine
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;该指令用于在特定配置上下文中开启或关闭重写引擎&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;开启：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;RewriteEngine&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;On&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;关闭：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;RewriteEngine&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;Off&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;rewriterule&#34;&gt;RewriteRule
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;这是定义重写规则的指令，其格式为：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;RewriteRule&lt;/span&gt; 模式 替代 [标志]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;参数&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;模式&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;用于匹配请求的URI路径（不包含域名和协议）的正则表达式&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;替代&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;匹配成功后，用于构建新URL的字符串或路径&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;标志&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;可选，用于控制重写规则的行为（如外部重定向、停止处理等）&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;常用标志：&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;标志&lt;/th&gt;
          &lt;th&gt;缩写&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;L&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;last&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;停止处理当前规则集中的其他规则&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;R&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;redirect&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;执行外部重定向&lt;/strong&gt;（发送&lt;code&gt;302&lt;/code&gt;状态码给浏览器）可指定状态码，如&lt;code&gt;R=301&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;NC&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;nocase&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;使模式匹配不区分大小写&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;P&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;proxy&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;将请求代理到指定的替代URL，需要&lt;code&gt;mod_proxy&lt;/code&gt;模块&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;QSA&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;qsappend&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;将原始请求的查询字符串（URL中&lt;code&gt;?&lt;/code&gt;之后的部分）附加到替代URL后&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;NE&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;noescape&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;禁止对重写后的URL进行特殊字符转义&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;CO&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;cookie&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;设置一个Cookie&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;E&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;env&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;设置环境变量&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;G&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;gone&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;返回410 Gone状态码&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;F&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;forbidden&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;返回403 Forbidden状态码&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;NC&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;nocase&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;匹配不区分大小写&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;L&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;last&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;停止后续规则处理&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;多个标志可以使用逗号,隔开，比如&lt;code&gt;[R=301,L]&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;rewritecond&#34;&gt;RewriteCond
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;用于设置条件，当条件满足时才执行紧随其后的RewriteRule&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;RewriteCond&lt;/span&gt; 字段 模式 [标志]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;参数&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;字段&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;待测试的字符串，比如主机名&lt;code&gt;%{HTTP_HOST}&lt;/code&gt;等&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;模式&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;条件模式，支持正则表达式匹配&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;标志&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;可选标志，如 &lt;code&gt;NC&lt;/code&gt;、&lt;code&gt;OR&lt;/code&gt; 等&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;常用标志：&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;标志&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;NC&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;No Case&lt;/strong&gt;，匹配时忽略大小写&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;OR&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;Logical OR&lt;/strong&gt;，与下一条 RewriteCond 条件做“或”逻辑（默认是“与” AND）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;AND&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;Logical AND&lt;/strong&gt;，与下一条条件做“与”逻辑（默认可省略）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;GT&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;Greater Than&lt;/strong&gt;，仅对数值比较有效&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;LT&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;Less Than&lt;/strong&gt;，仅对数值比较有效&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;EQ&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;Equal&lt;/strong&gt;，数值比较等于&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;NE&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;Not Equal&lt;/strong&gt;，数值比较不等于&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;示例&#34;&gt;示例
&lt;/h3&gt;&lt;h4 id=&#34;示例1实现伪静态url&#34;&gt;示例1：实现伪静态URL
&lt;/h4&gt;&lt;p&gt;将&lt;code&gt;https://example.com/article.php?id=123&lt;/code&gt;重写为&lt;code&gt;https://example.com/article/123&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 启用重写引擎&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;RewriteEngine&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;On&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 编写规则&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;RewriteRule&lt;/span&gt; ^article/([0-9]+)$ &lt;span style=&#34;color:#98c379&#34;&gt;/article.php&lt;/span&gt;?id=$1 [NC,L]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;示例2强制所有请求到www子域名&#34;&gt;示例2：强制所有请求到www子域名
&lt;/h4&gt;&lt;p&gt;将&lt;code&gt;example.com&lt;/code&gt;重定向到&lt;code&gt;www.example.com&lt;/code&gt;，这有助于避免重复内容问题&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 使用RewriteCond指令添加条件&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;RewriteEngine&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;On&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;RewriteCond&lt;/span&gt; %{HTTP_HOST} ^example.com [NC]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;RewriteRule&lt;/span&gt; ^(.*)$ https://www.example.com/$1 [R=301,L]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;mod_proxy代理模块&#34;&gt;mod_proxy：代理模块
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;mod_proxy&lt;/code&gt;允许服务器将客户端的请求转发到其他后端服务器&lt;/p&gt;
&lt;p&gt;它使得Apache能够作为前端网关，对后端服务进行路由、负载均衡和安全保护&lt;/p&gt;
&lt;p&gt;要使用反向代理功能，必须加载&lt;code&gt;mod_proxy&lt;/code&gt;及其子模块&lt;/p&gt;
&lt;p&gt;最常用的子模块是&lt;code&gt;mod_proxy_http&lt;/code&gt;，用于代理HTTP协议的流量&lt;/p&gt;
&lt;p&gt;在Debian/Ubuntu上：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;a2enmod&lt;/span&gt; proxy proxy_http
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在RHEL/CentOS上：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LoadModule&lt;/span&gt; proxy_module modules/mod_proxy.so
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LoadModule&lt;/span&gt; proxy_http_module modules/mod_proxy_http.so
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;反向代理&#34;&gt;反向代理
&lt;/h3&gt;&lt;h4 id=&#34;proxypass&#34;&gt;ProxyPass
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;用于将匹配路径的请求代理到指定的后端 URL&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyPass&lt;/span&gt; [路径] [URL] [可选参数]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;参数&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;路径&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;代理匹配的本地 URI 前缀，例如 &lt;code&gt;/app&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;URL&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;目标服务器地址，例如 &lt;code&gt;http://127.0.0.1:8080/&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;可选参数&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;retry=&lt;/code&gt;, &lt;code&gt;timeout=&lt;/code&gt;, &lt;code&gt;keepalive=on/off&lt;/code&gt; 等，用于控制代理行为&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;常用参数：&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;参数&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;retry=N&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;后端服务器失败时重试次数（默认 0，表示不重试）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;timeout=N&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;代理请求超时时间（秒），控制连接或响应等待时间&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;acquire=N&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;获取连接的超时时间（秒）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;keepalive=on/off&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;是否启用与后端的持久连接（HTTP Keep-Alive）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;disablereuse=on/off&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;禁止复用已建立的后端连接&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;max=number&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;最大并发连接数（可与 &lt;code&gt;mod_proxy_balancer&lt;/code&gt; 配合）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;ttl=N&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;连接在连接池中存活的时间（秒）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;timeout=N&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;请求超时，连接超时&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;flushpackets=on/off&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;每次写数据包时立即刷新到客户端&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;lbmethod=byrequests/bytraffic/...&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;仅在负载均衡时使用，选择负载均衡策略&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;keepalive=on/off&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;控制是否启用HTTP持久连接&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;proxypassreverse&#34;&gt;ProxyPassReverse
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;用于修改后端服务器响应头中的重定向地址，使客户端看到的URL正确&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyPassReverse&lt;/span&gt; [路径] [URL]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;参数&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;路径&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;客户端访问的本地URI前缀&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;URL&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;后端服务器的URL，对响应头进行重写&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;基本上写法和ProxyPass保持一致，也就是把url改回去，改成对应域名&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;比如我们写下配置：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyPass&lt;/span&gt;        &lt;span style=&#34;color:#98c379&#34;&gt;/app&lt;/span&gt;  http://127.0.0.1:8080/myapp
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyPassReverse&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/app&lt;/span&gt;  http://127.0.0.1:8080/myapp
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;客户端请求：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;GET&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/app/&lt;/span&gt; HTTP/1.1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Host: www.example.&lt;span style=&#34;color:#e5c07b&#34;&gt;com&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Apache转发给后端：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;GET&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/myapp/&lt;/span&gt; HTTP/1.1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Host: 127.0.0.1:8080
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;后端响应：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;HTTP/1.1 302 &lt;span style=&#34;color:#e5c07b&#34;&gt;Found&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Location: http://127.0.0.1:8080/myapp/login
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;如果没有&lt;code&gt;ProxyPassReverse&lt;/code&gt;，客户端会收到真实后端地址，绕过了代理&lt;/p&gt;
&lt;p&gt;有&lt;code&gt;ProxyPassReverse&lt;/code&gt;时，Apache会把返回的&lt;code&gt;Location&lt;/code&gt;改写成：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;HTTP/1.1 302 &lt;span style=&#34;color:#e5c07b&#34;&gt;Found&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Location: http://www.example.com/app/login
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;客户端依然通过代理访问，保持一致性&lt;/p&gt;
&lt;h4 id=&#34;proxypreservehost&#34;&gt;ProxyPreserveHost
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;用来控制在反向代理时，是否保留客户端原始请求中的&lt;code&gt;Host&lt;/code&gt;头信息&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyPreserveHost&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;On&lt;/span&gt;|Off
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;On&lt;/strong&gt;：Apache 转发请求时，保留客户端原始&lt;code&gt;Host&lt;/code&gt;头&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Off（默认）&lt;/strong&gt;：Apache会把&lt;code&gt;Host&lt;/code&gt;头改成后端服务器的地址&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;示例-1&#34;&gt;示例
&lt;/h4&gt;&lt;p&gt;假设有一个Node.js应用在&lt;code&gt;http://127.0.0.1:3000&lt;/code&gt;上运行，我们希望通过Apache的&lt;code&gt;/api/&lt;/code&gt;路径来访问它&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;VirtualHost&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;*:80&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ServerName&lt;/span&gt; api.example.com
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 禁用正向代理，后面会提到&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyRequests&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;Off&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 保留客户端原始Host头&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyPreserveHost&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;On&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 定义代理规则：将所有 /api/ 请求代理到后端服务器&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyPass&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/api/&lt;/span&gt; http://127.0.0.1:3000/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 重写响应头：将后端返回的 http://127.0.0.1:3000/ 地址重写为 http://api.example.com/api/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyPassReverse&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/api/&lt;/span&gt; http://127.0.0.1:3000/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/VirtualHost&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;当用户访问&lt;code&gt;http://api.example.com/api/users&lt;/code&gt;时，Apache会接收请求，&lt;code&gt;ProxyPass&lt;/code&gt;规则会将该请求转发到后端&lt;code&gt;http://127.0.0.1:3000/users&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;如果后端服务器返回了一个重定向响应（例如，&lt;code&gt;Location: http://127.0.0.1:3000/auth&lt;/code&gt;），&lt;code&gt;ProxyPassReverse&lt;/code&gt;会修改该头信息，将其替换为&lt;code&gt;http://api.example.com/api/auth&lt;/code&gt;，确保用户的浏览器能够正确地跳转&lt;/p&gt;
&lt;h3 id=&#34;proxy块&#34;&gt;&amp;lt;Proxy&amp;gt;块
&lt;/h3&gt;&lt;h4 id=&#34;proxy&#34;&gt;&amp;lt;Proxy&amp;gt;
&lt;/h4&gt;&lt;p&gt;&lt;code&gt;&amp;lt;Proxy&amp;gt;&lt;/code&gt;块是一个容器指令，用于对特定的代理URL或一组代理URL应用细粒度的配置&lt;/p&gt;
&lt;p&gt;它的使用类似于&lt;code&gt;&amp;lt;Directory&amp;gt;&lt;/code&gt;或&lt;code&gt;&amp;lt;Location&amp;gt;&lt;/code&gt;，但针对的是代理目标而不是本地文件系统&lt;/p&gt;
&lt;p&gt;虽然&lt;code&gt;ProxyPass&lt;/code&gt;指令支持在行内附加参数，但使用&lt;code&gt;&amp;lt;Proxy&amp;gt;&lt;/code&gt;块配合&lt;code&gt;ProxySet&lt;/code&gt;指令，可以使配置更加清晰&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;格式：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;&lt;span style=&#34;color:#e06c75&#34;&gt;Proxy&lt;/span&gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;URL&lt;/span&gt;]&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#56b6c2&#34;&gt;..&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;/&lt;span style=&#34;color:#e06c75&#34;&gt;Proxy&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;[URL]&lt;/code&gt;可以是一个完整的URL，一个协议（如&lt;code&gt;http://&lt;/code&gt;），或使用通配符&lt;code&gt;*&lt;/code&gt;（匹配所有代理目标）&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;也可以使用&lt;code&gt;&amp;lt;ProxyMatch&amp;gt;&lt;/code&gt;进行正则表达式匹配，就像之前的访问控制块一样&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;proxyset&#34;&gt;ProxySet
&lt;/h4&gt;&lt;p&gt;&lt;code&gt;&amp;lt;Proxy&amp;gt;&lt;/code&gt;容器和&lt;code&gt;&amp;lt;Location&amp;gt;&lt;/code&gt;等容器一样，可以使用访问控制相关指令（比如 &lt;code&gt;Require&lt;/code&gt;）&lt;/p&gt;
&lt;p&gt;但它还额外支持一些和代理相关的指令 —— &lt;code&gt;ProxySet&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ProxySet&lt;/code&gt;允许我们为特定的代理目标设置详细的控制参数&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;格式：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;ProxySet&lt;/span&gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;参数名&lt;/span&gt;]=[&lt;span style=&#34;color:#e06c75&#34;&gt;值&lt;/span&gt;] [&lt;span style=&#34;color:#e06c75&#34;&gt;参数名&lt;/span&gt;]=[&lt;span style=&#34;color:#e06c75&#34;&gt;值&lt;/span&gt;]&lt;span style=&#34;color:#56b6c2&#34;&gt;..&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;参数&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;retry=N&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;后端服务器失败时重试次数（默认 0，表示不重试）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;timeout=N&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;代理请求超时时间（秒），控制连接或响应等待时间&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;acquire=N&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;获取连接的超时时间（秒）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;keepalive=on/off&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;是否启用与后端的持久连接（HTTP Keep-Alive）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;disablereuse=on/off&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;禁止复用已建立的后端连接&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;max=number&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;最大并发连接数（可与 &lt;code&gt;mod_proxy_balancer&lt;/code&gt; 配合）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;ttl=N&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;连接在连接池中存活的时间（秒）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;flushpackets=on/off&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;每次写数据包时立即刷新到客户端&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;示例-2&#34;&gt;示例
&lt;/h4&gt;&lt;p&gt;假设我们要代理到两个后端服务：一个API和一个博客，并希望为它们设置不同的超时时间&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;VirtualHost&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;*:80&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ServerName&lt;/span&gt; example.com
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyRequests&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;Off&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyPreserveHost&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;On&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 代理API服务，设置15秒超时，并启用持久连接&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Proxy&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;http://127.0.0.1:8080&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e5c07b&#34;&gt;ProxySet&lt;/span&gt; timeout=15 keepalive=on
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Proxy&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyPass&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/api/&lt;/span&gt; http://127.0.0.1:8080/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyPassReverse&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/api/&lt;/span&gt; http://127.0.0.1:8080/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 代理博客服务，不设置特定超时，使用默认配置&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Proxy&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;http://127.0.0.1:9000&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#7f848e&#34;&gt;# 可以在此处添加特定配置&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Proxy&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyPass&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/blog/&lt;/span&gt; http://127.0.0.1:9000/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyPassReverse&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/blog/&lt;/span&gt; http://127.0.0.1:9000/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/VirtualHost&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;此配置比在&lt;code&gt;ProxyPass&lt;/code&gt;中添加参数更清晰，且允许对每个后端应用独特的代理行为&lt;/p&gt;
&lt;h3 id=&#34;正向代理&#34;&gt;正向代理
&lt;/h3&gt;&lt;p&gt;在正向代理模式下，Apache扮演客户端的代理&lt;/p&gt;
&lt;p&gt;当客户端请求外部资源时，请求会首先发送给Apache，由Apache代为访问外部网络&lt;/p&gt;
&lt;h4 id=&#34;配置&#34;&gt;配置
&lt;/h4&gt;&lt;p&gt;正向代理的配置非常简单：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyRequests&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;On&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这是开启正向代理功能的指令&lt;/p&gt;
&lt;h4 id=&#34;示例-3&#34;&gt;示例
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;# 开启正向代理功能&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;ProxyRequests&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;On&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;Proxy&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 允许来自特定IP的请求通过此代理&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; ip &lt;span style=&#34;color:#d19a66&#34;&gt;192.168.1.0/24&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 禁止所有其他请求&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Require&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;all&lt;/span&gt; denied
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/Proxy&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这里&lt;code&gt;&amp;lt;Proxy *&amp;gt;&lt;/code&gt;匹配所有目标地址，启用正向代理后，Apache会接受客户端发来的完整URL请求，然后去请求目标站点，再把响应转发回来，目标站点只会看到Apache的IP，不会看到客户端的真实IP&lt;/p&gt;
&lt;h2 id=&#34;mod_sslssltls加密模块&#34;&gt;mod_ssl：SSL/TLS加密模块
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;mod_ssl&lt;/code&gt;是Apache实现HTTPS加密服务的模块，它使用OpenSSL库来处理加密和解密&lt;/p&gt;
&lt;p&gt;其配置通常在&lt;code&gt;443&lt;/code&gt;端口的&lt;code&gt;&amp;lt;VirtualHost&amp;gt;&lt;/code&gt;块中完成&lt;/p&gt;
&lt;h3 id=&#34;使用之前&#34;&gt;使用之前
&lt;/h3&gt;&lt;p&gt;大多数现代Linux发行版在安装Apache时，&lt;code&gt;mod_ssl&lt;/code&gt;默认已经被加载，如果没有，我们需要手动启用它&lt;/p&gt;
&lt;p&gt;在Debian/Ubuntu上：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;a2enmod&lt;/span&gt; ssl
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在RHEL/CentOS上：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LoadModule&lt;/span&gt; ssl_module modules/mod_ssl.so
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;核心指令-1&#34;&gt;核心指令
&lt;/h3&gt;&lt;p&gt;这些指令定义了HTTPS服务所需的证书和密钥文件&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;指令&lt;/th&gt;
          &lt;th&gt;格式&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;SSLEngine&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;SSLEngine on&lt;/code&gt;或&lt;code&gt;SSLEngine off&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;开启或关闭该虚拟主机上的SSL/TLS引擎&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;SSLCertificateFile&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;SSLCertificateFile /path/to/fullchain.crt&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;指定SSL证书文件（公钥）&lt;/strong&gt;&lt;br /&gt;推荐使用包含服务器证书和所有中间证书的完整链文件&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;SSLCertificateKeyFile&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;SSLCertificateKeyFile /path/to/private.key&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;指定与证书配对的私钥文件&lt;/strong&gt;&lt;br /&gt;此文件必须严格保密&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;SSLCertificateChainFile&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;SSLCertificateChainFile /path/to/chain.crt&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;指定中间证书链文件&lt;/strong&gt;&lt;br /&gt;如果&lt;code&gt;SSLCertificateFile&lt;/code&gt;已包含完整链，则此指令可选&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;Protocols&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;Protocols h2 http/1.1&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;指定服务器支持的协议版本，可写多个&lt;/strong&gt;&lt;br /&gt;&lt;code&gt;h2&lt;/code&gt;代表HTTP/2&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;SSLCipherSuite&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;SSLCipherSuite [套件列表]&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;指定服务器支持的加密套件列表&lt;/strong&gt;&lt;br /&gt;增强安全性&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;示例-4&#34;&gt;示例
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;VirtualHost&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;*:443&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ServerName&lt;/span&gt; secure.example.com
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;DocumentRoot&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/var/www/secure.example.com&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;ErrorLog&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;logs/secure.example.com-error.log&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;CustomLog&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;logs/secure.example.com-access.log&amp;#34;&lt;/span&gt; combined
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 开启SSL/TLS引擎&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;SSLEngine&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;on&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 指定证书文件和私钥文件&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;SSLCertificateFile&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/etc/pki/tls/certs/secure.example.com.crt&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;SSLCertificateKeyFile&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/etc/pki/tls/private/secure.example.com.key&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;SSLCertificateChainFile&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/etc/pki/tls/certs/chain.crt&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#7f848e&#34;&gt;# 推荐的安全性设置&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;Protocols&lt;/span&gt; h2 http/1.1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;SSLHonorCipherOrder&lt;/span&gt; &lt;span style=&#34;color:#c678dd&#34;&gt;on&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e5c07b&#34;&gt;SSLCipherSuite&lt;/span&gt; EECDH+AESGCM:EDH+AESGCM
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;lt;/VirtualHost&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;该配置块定义了一个监听443端口的虚拟主机&lt;/p&gt;
&lt;p&gt;它通过&lt;code&gt;SSLEngine on&lt;/code&gt;指令开启了HTTPS服务，并使用&lt;code&gt;SSLCertificateFile&lt;/code&gt;、&lt;code&gt;SSLCertificateKeyFile&lt;/code&gt;和&lt;code&gt;SSLCertificateChainFile&lt;/code&gt;指令指定了相应的证书和密钥&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Protocols&lt;/code&gt;和&lt;code&gt;SSLCipherSuite&lt;/code&gt;指令则用于限制协议版本和加密算法，以确保安全性和性能&lt;/p&gt;
&lt;h1 id=&#34;日志分析&#34;&gt;日志分析
&lt;/h1&gt;&lt;h2 id=&#34;访问日志access_log&#34;&gt;访问日志（&lt;code&gt;access_log&lt;/code&gt;）
&lt;/h2&gt;&lt;p&gt;访问日志记录了所有客户端对服务器的请求&lt;/p&gt;
&lt;h3 id=&#34;日志格式&#34;&gt;日志格式
&lt;/h3&gt;&lt;p&gt;Apache默认使用&lt;code&gt;combined&lt;/code&gt;格式，它是一种全面且常用的格式，记录了请求的方方面面&lt;/p&gt;
&lt;p&gt;日志格式通过&lt;code&gt;LogFormat&lt;/code&gt;指令定义，并由&lt;code&gt;CustomLog&lt;/code&gt;指令引用：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Apache&#34; data-lang=&#34;Apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;LogFormat&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;%h %l %u %t \&amp;#34;%r\&amp;#34; %&amp;gt;s %b \&amp;#34;%{Referer}i\&amp;#34; \&amp;#34;%{User-Agent}i\&amp;#34;&amp;#34;&lt;/span&gt; combined
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e5c07b&#34;&gt;CustomLog&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;logs/access_log&amp;#34;&lt;/span&gt; combined
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;格式字段&#34;&gt;格式字段
&lt;/h3&gt;&lt;p&gt;下表详细解释了&lt;code&gt;combined&lt;/code&gt;日志格式中的每个字段&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;字段标识符&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
          &lt;th&gt;示例&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;%h&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;远程主机&lt;/strong&gt;&lt;br /&gt;客户端的IP地址&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;123.123.123.123&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;%l&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;远程登录名&lt;/strong&gt;&lt;br /&gt;由&lt;code&gt;identd&lt;/code&gt;确定，通常为&lt;code&gt;-&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;-&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;%u&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;远程用户&lt;/strong&gt;&lt;br /&gt;由HTTP认证确定的用户名&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;用户名&lt;/code&gt; (如果进行了认证)，否则为 &lt;code&gt;-&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;%t&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;时间&lt;/strong&gt;&lt;br /&gt;服务器收到请求的本地时间&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;[10/Oct/2000:13:55:36 -0700]&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;\&amp;quot;%r\&amp;quot;&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;请求行&lt;/strong&gt;&lt;br /&gt;完整的HTTP请求行，包括方法、路径和协议&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;&amp;quot;GET /apache_pb.gif HTTP/1.0&amp;quot;&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;%&amp;gt;s&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;状态码&lt;/strong&gt;&lt;br /&gt;返回给客户端的HTTP状态码&lt;br /&gt;&lt;strong&gt;&lt;code&gt;%s&lt;/code&gt;：最初请求的状态码&lt;/strong&gt;&lt;br /&gt;&lt;strong&gt;&lt;code&gt;%&amp;gt;s&lt;/code&gt;：最终响应状态码&lt;/strong&gt;（如果有内部重定向，记录重定向后的状态码）&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;200&lt;/code&gt;、&lt;code&gt;404&lt;/code&gt;、&lt;code&gt;301&lt;/code&gt;、&lt;code&gt;500&lt;/code&gt;等&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;%b&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;响应体大小&lt;/strong&gt;&lt;br /&gt;响应体的大小（字节），不包括响应头&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;2326&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;\&amp;quot;%{Referer}i\&amp;quot;&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;来源&lt;/strong&gt;&lt;br /&gt;请求的来源URL&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;&amp;quot;http://www.example.com/start.html&amp;quot;&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;\&amp;quot;%{User-Agent}i\&amp;quot;&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;用户代理&lt;/strong&gt;&lt;br /&gt;客户端浏览器或设备信息&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;&amp;quot;Mozilla/4.08 [en] (Win98; I ;Nav)&amp;quot;&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;实际示例&#34;&gt;实际示例
&lt;/h3&gt;&lt;p&gt;下面是一些常见的日志条目：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;成功请求 (&lt;code&gt;200 OK&lt;/code&gt;)&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;10.0.0.5 - - [20/Aug/2025:10:30:01 +0800] &amp;#34;&lt;span style=&#34;color:#e5c07b&#34;&gt;GET&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/index.html&lt;/span&gt; HTTP/1.1&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34; 200 450 &amp;#34;&lt;/span&gt;http://example.com/home&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt;Mozilla/5.0 (Windows NT &lt;span style=&#34;color:#d19a66&#34;&gt;10&lt;/span&gt;.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;来自内网IP&lt;code&gt;10.0.0.5&lt;/code&gt;的客户端，使用Chrome浏览器访问&lt;code&gt;http://example.com/home&lt;/code&gt;成功请求了根目录下的&lt;code&gt;index.html&lt;/code&gt;文件，服务器返回了&lt;code&gt;200&lt;/code&gt;状态码，响应体大小为&lt;code&gt;450&lt;/code&gt;字节&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;文件未找到 (&lt;code&gt;404 Not Found&lt;/code&gt;)&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;8.8.4.4 - - [20/Aug/2025:10:30:15 +0800] &amp;#34;&lt;span style=&#34;color:#e5c07b&#34;&gt;GET&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/robots.txt&lt;/span&gt; HTTP/1.1&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34; 404 213 &amp;#34;&lt;/span&gt;https://www.google.com/search?q=site:example.com&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt;Googlebot/2.1 (+http://www.google.com/bot.html)&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Google爬虫（&lt;code&gt;Googlebot&lt;/code&gt;）从搜索引擎结果页进入，请求了&lt;code&gt;robots.txt&lt;/code&gt;文件，但服务器返回了 &lt;code&gt;404&lt;/code&gt; 错误，表示该文件不存在，响应体大小为&lt;code&gt;213&lt;/code&gt;字节，通常是Apache默认的&lt;code&gt;404&lt;/code&gt;错误页面&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;永久重定向 (&lt;code&gt;301 Moved Permanently&lt;/code&gt;)&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;123.123.123.123 - - [20/Aug/2025:10:30:20 +0800] &amp;#34;&lt;span style=&#34;color:#e5c07b&#34;&gt;GET&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/old-page&lt;/span&gt; HTTP/1.1&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34; 301 245 &amp;#34;&lt;/span&gt;-&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt;Mozilla/5.0 (iPhone; CPU iPhone &lt;span style=&#34;color:#c678dd&#34;&gt;OS&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;16&lt;/span&gt;_0 like Mac &lt;span style=&#34;color:#c678dd&#34;&gt;OS&lt;/span&gt; X) AppleWebKit/605.1.15 (KHTML, like Gecko) CriOS/106.0.5249.101 Mobile/15E148 Safari/604.1&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;来自IP&lt;code&gt;123.123.123.123&lt;/code&gt;的iPhone客户端请求了&lt;code&gt;/old-page&lt;/code&gt;，但服务器配置了&lt;code&gt;301&lt;/code&gt;重定向，将请求永久指向了新地址，浏览器从HTTPS页面跳转到HTTP页面时，出于安全考虑，默认不会发送Referer，故而referer字段为空&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;服务器内部错误 (&lt;code&gt;500 Internal Server Error&lt;/code&gt;)&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-apache&#34; data-lang=&#34;apache&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;192.168.1.10 - - [20/Aug/2025:10:30:35 +0800] &amp;#34;&lt;span style=&#34;color:#e5c07b&#34;&gt;GET&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/api/data&lt;/span&gt; HTTP/1.1&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34; 500 503 &amp;#34;&lt;/span&gt;-&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt;curl/7.68.0&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;内网IP&lt;code&gt;192.168.1.10&lt;/code&gt;请求&lt;code&gt;http://example.com/dashboard&lt;/code&gt;页面（可能是一个脚本或API调用）返回了&lt;code&gt;500&lt;/code&gt;内部服务器错误，这通常意味着后端脚本（如PHP或Python）执行失败，要排查具体原因，必须查看错误日志&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;错误日志error_log&#34;&gt;错误日志（&lt;code&gt;error_log&lt;/code&gt;）
&lt;/h2&gt;&lt;p&gt;错误日志记录了服务器启动、运行、关闭过程中的所有诊断信息和错误&lt;/p&gt;
&lt;h3 id=&#34;格式与字段&#34;&gt;格式与字段
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;error.log&lt;/code&gt;条目的通用格式如下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;[时间戳]&lt;/span&gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;模块&lt;/span&gt;:&lt;span style=&#34;color:#e06c75&#34;&gt;日志级别&lt;/span&gt;] [&lt;span style=&#34;color:#e06c75&#34;&gt;pid&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;进程ID&lt;/span&gt;:&lt;span style=&#34;color:#e06c75&#34;&gt;tid&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;线程ID&lt;/span&gt;] [&lt;span style=&#34;color:#e06c75&#34;&gt;client&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;客户端IP&lt;/span&gt;:&lt;span style=&#34;color:#e06c75&#34;&gt;端口&lt;/span&gt;] &lt;span style=&#34;color:#e06c75&#34;&gt;错误描述&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;[时间戳]&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;日志事件发生的时间&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;[模块:日志级别]&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;指明产生日志的Apache模块（如&lt;code&gt;core&lt;/code&gt;、&lt;code&gt;proxy_http&lt;/code&gt;等）以及该事件的严重程度，具体看：&lt;a class=&#34;link&#34; href=&#34;#%e6%97%a5%e5%bf%97%e9%85%8d%e7%bd%ae&#34; &gt;日志配置
    
&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;[pid 进程ID:tid 线程ID]&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;指明是哪个Apache进程和线程产生了该日志，这在调试多进程或多线程问题时很有用&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;[client 客户端IP:端口]&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;指明导致错误的客户端IP地址和端口&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;示例-5&#34;&gt;示例
&lt;/h3&gt;&lt;p&gt;下面是一些常见的错误日志条目：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;文件权限问题&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;[Wed Aug 20 10:30:00.123456 2025]&lt;/span&gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;core&lt;/span&gt;:&lt;span style=&#34;color:#e06c75&#34;&gt;crit&lt;/span&gt;] [&lt;span style=&#34;color:#e06c75&#34;&gt;pid&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;12345&lt;/span&gt;] (&lt;span style=&#34;color:#d19a66&#34;&gt;13&lt;/span&gt;)&lt;span style=&#34;color:#e06c75&#34;&gt;Permission&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;denied&lt;/span&gt;: &lt;span style=&#34;color:#e06c75&#34;&gt;AH00035&lt;/span&gt;: &lt;span style=&#34;color:#e06c75&#34;&gt;Unable&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;to&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;change&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;to&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;root&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;directory&lt;/span&gt;: /&lt;span style=&#34;color:#c678dd&#34;&gt;var&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;www&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;site&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;dir&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这是一个严重的错误（&lt;code&gt;crit&lt;/code&gt;），通常发生在Apache启动时，它表明Apache进程（PID为12345）没有权限访问或切换到&lt;code&gt;/var/www/site/dir&lt;/code&gt;目录，通常是由于文件或目录权限设置不正确所致，需要检查该目录的用户和组是否与&lt;code&gt;httpd.conf&lt;/code&gt;中定义的&lt;code&gt;User&lt;/code&gt;和&lt;code&gt;Group&lt;/code&gt;匹配&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;配置文件语法错误&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;[Wed Aug 20 10:31:00.987654 2025]&lt;/span&gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;core&lt;/span&gt;:&lt;span style=&#34;color:#e06c75&#34;&gt;warn&lt;/span&gt;] [&lt;span style=&#34;color:#e06c75&#34;&gt;pid&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;12345&lt;/span&gt;] &lt;span style=&#34;color:#e06c75&#34;&gt;AH00547&lt;/span&gt;: &lt;span style=&#34;color:#e06c75&#34;&gt;The&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;document&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;root&lt;/span&gt; /&lt;span style=&#34;color:#c678dd&#34;&gt;var&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;www&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;example&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;com&lt;/span&gt;/&lt;span style=&#34;color:#c678dd&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;does&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;not&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;exist&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这是一个警告（&lt;code&gt;warn&lt;/code&gt;），服务器尝试启动，但发现&lt;code&gt;DocumentRoot&lt;/code&gt;指令中指定的 &lt;code&gt;/var/www/example.com/public&lt;/code&gt;目录不存在，Apache虽然可以启动，但网站将无法正常访问&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;后端连接失败&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;[Wed Aug 20 10:32:00.123456 2025]&lt;/span&gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;proxy&lt;/span&gt;:&lt;span style=&#34;color:#e06c75&#34;&gt;error&lt;/span&gt;] [&lt;span style=&#34;color:#e06c75&#34;&gt;pid&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;12345&lt;/span&gt;:&lt;span style=&#34;color:#e06c75&#34;&gt;tid&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;67890&lt;/span&gt;] [&lt;span style=&#34;color:#e06c75&#34;&gt;client&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;192.168&lt;/span&gt;.&lt;span style=&#34;color:#d19a66&#34;&gt;1.50&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;12345&lt;/span&gt;] &lt;span style=&#34;color:#e06c75&#34;&gt;AH00959&lt;/span&gt;: &lt;span style=&#34;color:#e06c75&#34;&gt;ap_proxy_connect_backend&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;disabling&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;connection&lt;/span&gt;: (&lt;span style=&#34;color:#d19a66&#34;&gt;111&lt;/span&gt;)&lt;span style=&#34;color:#e06c75&#34;&gt;Connection&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;refused&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这是一个错误（&lt;code&gt;error&lt;/code&gt;），&lt;code&gt;proxy&lt;/code&gt;模块无法连接到后端服务器，因为它返回了“连接被拒绝”（&lt;code&gt;Connection refused&lt;/code&gt;）的错误，这通常意味着后端应用服务没有运行，或者防火墙阻止了连接&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;mod_rewrite&lt;/code&gt; 调试信息&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;[Wed Aug 20 10:33:00.789012 2025]&lt;/span&gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;rewrite&lt;/span&gt;:&lt;span style=&#34;color:#e06c75&#34;&gt;trace1&lt;/span&gt;] [&lt;span style=&#34;color:#e06c75&#34;&gt;pid&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;12345&lt;/span&gt;] (&lt;span style=&#34;color:#d19a66&#34;&gt;2&lt;/span&gt;) &lt;span style=&#34;color:#c678dd&#34;&gt;init&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;rewrite&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;engine&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;with&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;requested&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;uri&lt;/span&gt; /&lt;span style=&#34;color:#e06c75&#34;&gt;about&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;[Wed Aug 20 10:33:00.789012 2025]&lt;/span&gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;rewrite&lt;/span&gt;:&lt;span style=&#34;color:#e06c75&#34;&gt;trace3&lt;/span&gt;] [&lt;span style=&#34;color:#e06c75&#34;&gt;pid&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;12345&lt;/span&gt;] &lt;span style=&#34;color:#e06c75&#34;&gt;applying&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;pattern&lt;/span&gt; &amp;#39;^(.*)$&amp;#39; &lt;span style=&#34;color:#e06c75&#34;&gt;to&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;uri&lt;/span&gt; &amp;#39;/&lt;span style=&#34;color:#e06c75&#34;&gt;about&lt;/span&gt;&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这些是级别为&lt;code&gt;trace1&lt;/code&gt;和&lt;code&gt;trace3&lt;/code&gt;的调试信息，它们在 &lt;code&gt;LogLevel&lt;/code&gt; 设置为 &lt;code&gt;trace&lt;/code&gt; 时才会出现，这对于排查复杂的&lt;code&gt;mod_rewrite&lt;/code&gt;规则非常有用，可以逐行跟踪规则的匹配和处理过程&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;docker环境中日志的特殊格式&#34;&gt;Docker环境中日志的特殊格式
&lt;/h2&gt;&lt;p&gt;有时，在使用官方&lt;code&gt;httpd&lt;/code&gt;Docker镜像时，通过&lt;code&gt;docker logs&lt;/code&gt;命令看到的日志格式与直接查看文件日志略有不同&lt;/p&gt;
&lt;p&gt;根据设置，Docker的日志驱动程序在将容器的&lt;code&gt;stdout&lt;/code&gt;和&lt;code&gt;stderr&lt;/code&gt;流捕获并输出时，可能会给每一行日志加上额外的前缀信息，这个前缀通常包含&lt;strong&gt;时间戳&lt;/strong&gt;和&lt;strong&gt;日志流的来源&lt;/strong&gt;（&lt;code&gt;stdout&lt;/code&gt;或&lt;code&gt;stderr&lt;/code&gt;），其标准格式为：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;[时间戳]&lt;/span&gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;日志流&lt;/span&gt;] [&lt;span style=&#34;color:#e06c75&#34;&gt;原始日志内容&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;字段&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
          &lt;th&gt;示例&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;时间戳&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;Docker记录该日志的时间，精确到纳秒&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;2025-08-20T02:30:00.123456789Z&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;日志流&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;指明日志来源：&lt;br /&gt;标准输出：&lt;code&gt;stdout&lt;/code&gt;，对应访问日志&lt;br /&gt;标准错误：stderr`，对应错误日志&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;stdout&lt;/code&gt;或&lt;code&gt;stderr&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;示例-6&#34;&gt;示例
&lt;/h3&gt;&lt;p&gt;一个完整的&lt;code&gt;docker logs&lt;/code&gt;访问日志条目看起来像这样：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;2025&lt;/span&gt;-&lt;span style=&#34;color:#d19a66&#34;&gt;08&lt;/span&gt;-&lt;span style=&#34;color:#d19a66&#34;&gt;20&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;T02&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;30&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;00.123456789&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;Z&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;stdout&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;172.17&lt;/span&gt;.&lt;span style=&#34;color:#d19a66&#34;&gt;0.3&lt;/span&gt; - - [&lt;span style=&#34;color:#d19a66&#34;&gt;20&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;Aug&lt;/span&gt;/&lt;span style=&#34;color:#d19a66&#34;&gt;2025&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;02&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;30&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;00&lt;/span&gt; +&lt;span style=&#34;color:#d19a66&#34;&gt;0000&lt;/span&gt;] &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;GET / HTTP/1.1&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;200&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;45&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;curl/7.64.1&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;一个完整的错误日志条目看起来像这样：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;2025&lt;/span&gt;-&lt;span style=&#34;color:#d19a66&#34;&gt;08&lt;/span&gt;-&lt;span style=&#34;color:#d19a66&#34;&gt;20&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;T02&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;30&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;05.987654321&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;Z&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;stderr&lt;/span&gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;Wed&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;Aug&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;20&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;02&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;30&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;05.987654&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;2025&lt;/span&gt;] [&lt;span style=&#34;color:#e06c75&#34;&gt;core&lt;/span&gt;:&lt;span style=&#34;color:#e06c75&#34;&gt;error&lt;/span&gt;] [&lt;span style=&#34;color:#e06c75&#34;&gt;pid&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#e06c75&#34;&gt;AH00037&lt;/span&gt;: &lt;span style=&#34;color:#e06c75&#34;&gt;File&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;not&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;found&lt;/span&gt;: /&lt;span style=&#34;color:#e06c75&#34;&gt;usr&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;local&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;apache2&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;htdocs&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;non&lt;/span&gt;-&lt;span style=&#34;color:#e06c75&#34;&gt;existent&lt;/span&gt;-&lt;span style=&#34;color:#c678dd&#34;&gt;file&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;html&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;分析技巧&#34;&gt;分析技巧
&lt;/h2&gt;&lt;p&gt;以下命令示例均基于&lt;code&gt;access.log&lt;/code&gt;文件&lt;/p&gt;
&lt;h3 id=&#34;统计访问量最多的ip地址&#34;&gt;统计访问量最多的IP地址
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cut -d &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39; &amp;#39;&lt;/span&gt; -f &lt;span style=&#34;color:#d19a66&#34;&gt;1&lt;/span&gt; access.log | sort | uniq -c | sort -rn | head -10
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;cut -d &#39; &#39; -f 1 access.log&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;使用 &lt;code&gt;cut&lt;/code&gt; 命令以空格为分隔符（&lt;code&gt;-d &#39; &#39;&lt;/code&gt;），提取每行的第一个字段（&lt;code&gt;-f 1&lt;/code&gt;），即客户端 IP 地址&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;sort&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;对提取出的所有 IP 地址进行排序，这是&lt;code&gt;uniq&lt;/code&gt;命令去重和计数的前提&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;uniq -c&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;统计每个 IP 地址出现的次数（&lt;code&gt;-c&lt;/code&gt; 表示计数）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;sort -rn&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;对上一步的结果进行再次排序&lt;/p&gt;
&lt;p&gt;&lt;code&gt;-r&lt;/code&gt;表示降序排序，&lt;code&gt;-n&lt;/code&gt;表示按数值大小排序（而不是按字典顺序），确保最高的访问次数排在最前面&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;head -10&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;输出排序后的前10行，即访问次数最多的前10个IP地址及其次数&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;统计特定页面或文件的访问次数&#34;&gt;统计特定页面或文件的访问次数
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;grep -c &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;/index.php&amp;#34;&lt;/span&gt; access.log
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;grep &amp;quot;/index.php&amp;quot; access.log&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;在&lt;code&gt;access.log&lt;/code&gt;文件中搜索所有包含&lt;code&gt;/index.php&lt;/code&gt;字符串的行&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;-c&lt;/code&gt;选项&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;告诉&lt;code&gt;grep&lt;/code&gt;只输出匹配的行数，而不显示匹配的行本身&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;统计特定ip地址的访问总次数&#34;&gt;统计特定IP地址的访问总次数
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;grep -w &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;192.168.200.2&amp;#34;&lt;/span&gt; access.log | wc -l
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;grep -w &amp;quot;192.168.200.2&amp;quot; access.log&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;使用&lt;code&gt;grep&lt;/code&gt;搜索 IP 地址&lt;/p&gt;
&lt;p&gt;&lt;code&gt;-w&lt;/code&gt;选项确保只匹配一个完整的“单词”，即只匹配&lt;code&gt;192.168.200.2&lt;/code&gt;这个完整的IP地址&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;|&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;管道符，将&lt;code&gt;grep&lt;/code&gt;命令的输出作为&lt;code&gt;wc&lt;/code&gt;命令的输入&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;wc -l&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;统计来自管道的行数（&lt;code&gt;-l&lt;/code&gt;表示行）&lt;/p&gt;
&lt;p&gt;每行代表一次访问，因此行数即为总访问次数&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;统计特定时间段内的独立ip访问数&#34;&gt;统计特定时间段内的独立IP访问数
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;grep &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;03/Aug/2023:08:&amp;#34;&lt;/span&gt; access.log | awk &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;{print $1}&amp;#39;&lt;/span&gt; | sort | uniq | wc -l
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;grep &amp;quot;03/Aug/2023:08:&amp;quot; access.log&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;根据日志中的时间戳格式，筛选出所有在 2023年8月03日8时这个小时段内的访问记录&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;awk &#39;{print $1}&#39;&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;awk&lt;/code&gt;命令默认以空格分隔字段，&lt;code&gt;{print $1}&lt;/code&gt;提取每行的第一个字段，即IP地址&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;sort&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;对所有提取出的IP地址进行排序&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;uniq&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;去重，只保留唯一的IP地址&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;wc -l&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;统计去重后剩下的行数，即独立IP地址的数量&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;查找特定ip地址的详细访问记录&#34;&gt;查找特定IP地址的详细访问记录
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;grep &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;192.168.200.2&amp;#34;&lt;/span&gt; access.log | more
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;grep &amp;quot;192.168.200.2&amp;quot; access.log&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;搜索包含该IP地址的所有日志行&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;| more&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;如果匹配的行数太多，&lt;code&gt;more&lt;/code&gt;命令会进行分页显示，方便逐页查看，按空格键翻页，按&lt;code&gt;q&lt;/code&gt;键退出&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;文章至此告一段落，笔者使用的也不多，之后边学边更新吧&lt;/p&gt;
</description>
        </item>
        <item>
        <title>Nginx入门</title>
        <link>https://blog.928330.xyz/p/nginx%E5%85%A5%E9%97%A8/</link>
        <pubDate>Thu, 24 Jul 2025 22:15:30 +0800</pubDate>
        
        <guid>https://blog.928330.xyz/p/nginx%E5%85%A5%E9%97%A8/</guid>
        <description>&lt;img src="http://picture.928330.xyz/typora/94b5f0d5aceb41498d7d03bcff81ecf5.jpeg" alt="Featured image of post Nginx入门" /&gt;&lt;p&gt;开玩笑的，其实nginx和apache一样好用&lt;/p&gt;
&lt;p&gt;apache移步：&lt;a class=&#34;link&#34; href=&#34;http://blog.928330.xyz/p/apache%E5%85%A5%E9%97%A8/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Apache入门
    
    &lt;span style=&#34;white-space: nowrap;&#34;&gt;&lt;svg width=&#34;.7em&#34;
        height=&#34;.7em&#34; viewBox=&#34;0 0 21 21&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;
        &lt;path d=&#34;m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z&#34; fill=&#34;currentColor&#34; /&gt;
        &lt;path d=&#34;M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z&#34;
            fill=&#34;currentColor&#34;&gt;
    &lt;/svg&gt;&lt;/span&gt;
    
&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;什么是nginx&#34;&gt;什么是Nginx
&lt;/h1&gt;&lt;p&gt;Nginx（发音为 &amp;ldquo;engine-X&amp;rdquo;）是一款开源的、高性能的HTTP和反向代理服务器&lt;/p&gt;
&lt;p&gt;它的设计哲学是提供极致的性能、稳定性、丰富的功能、简单的配置和低资源消耗，看上去就很厉害&lt;/p&gt;
&lt;p&gt;Nginx采用事件驱动的异步非阻塞架构&lt;/p&gt;
&lt;p&gt;与传统的Apache等服务器为每个请求创建一个新进程或线程不同，Nginx使用一个主进程和少数几个工作进程&lt;/p&gt;
&lt;p&gt;主进程负责读取配置、管理工作进程，而真正处理网络请求的是工作进程&lt;/p&gt;
&lt;p&gt;每个工作进程都是单线程的，异步地处理成千上万个并发连接&lt;/p&gt;
&lt;p&gt;这种模型避免了创建和销毁进程/线程的开销以及上下文切换的成本，因此能以极低的内存占用应对高并发场景&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;接下来我们会介绍直接安装的Nginx，也会顺带介绍通过Docker容器启动的Nginx&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;二者在活动状态控制和日志方面有些区别，配置基本一致&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id=&#34;主要用法&#34;&gt;主要用法
&lt;/h1&gt;&lt;h2 id=&#34;web服务器&#34;&gt;Web服务器
&lt;/h2&gt;&lt;p&gt;直接向客户端提供静态资源（如HTML、CSS、图片）的服务&lt;/p&gt;
&lt;p&gt;由于其高效的文件读取和网络传输能力，Nginx在处理静态内容方面表现极其出色,&lt;del&gt;适合搭建博客&lt;/del&gt;&lt;/p&gt;
&lt;h2 id=&#34;反向代理服务器&#34;&gt;反向代理服务器
&lt;/h2&gt;&lt;p&gt;它是是客户端和后端真实服务器之间的中间人&lt;/p&gt;
&lt;p&gt;它可以将客户端请求转发到后端的应用服务器（如Node.js、Java、Python应用），并将后端响应返回给客户端，从而实现请求分发、负载均衡，并能隐藏后端服务的真实IP和端口，提升安全性&lt;/p&gt;
&lt;h2 id=&#34;负载均衡器&#34;&gt;负载均衡器
&lt;/h2&gt;&lt;p&gt;当后端有多台服务器时，Nginx可以根据预设的策略将请求分发到这些服务器上，从而分担单一服务器的压力&lt;/p&gt;
&lt;h2 id=&#34;api网关&#34;&gt;API网关
&lt;/h2&gt;&lt;p&gt;在微服务架构中，Nginx可以作为所有API请求的统一入口，执行如身份验证、速率限制、日志记录、服务发现等通用功能&lt;/p&gt;
&lt;h1 id=&#34;目录结构&#34;&gt;目录结构
&lt;/h1&gt;&lt;h2 id=&#34;不同来源&#34;&gt;不同来源
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;通过不同方式安装的nginx的默认目录结构都会有所差别&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;官方nginx包从-nginxorg&#34;&gt;官方Nginx包（从 nginx.org）
&lt;/h3&gt;&lt;p&gt;从Nginx下载官方提供的&lt;code&gt;.rpm/.deb&lt;/code&gt;包安装&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;/&lt;/span&gt;                                                                 &lt;span style=&#34;color:#7f848e&#34;&gt;# 根目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;etc/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx/&lt;/span&gt;                                           &lt;span style=&#34;color:#7f848e&#34;&gt;# 配置文件目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx.conf&lt;/span&gt;                                &lt;span style=&#34;color:#7f848e&#34;&gt;# 主配置文件（Nginx 的核心配置）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;mime.types&lt;/span&gt;                              &lt;span style=&#34;color:#7f848e&#34;&gt;# MIME类型映射表
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;conf.d/&lt;/span&gt;                                     &lt;span style=&#34;color:#7f848e&#34;&gt;# 子配置目录（用于虚拟主机）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;           &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;default.conf&lt;/span&gt;                          &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认网站配置文件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;usr/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;sbin/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx&lt;/span&gt;                                       &lt;span style=&#34;color:#7f848e&#34;&gt;# 主程序二进制文件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;share/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;           &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;html/&lt;/span&gt;                                  &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认 Web 根目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;               &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;index.html&lt;/span&gt;                      &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认欢迎页面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;               &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;50x.html&lt;/span&gt;                        &lt;span style=&#34;color:#7f848e&#34;&gt;# 服务器错误页面（如 500、502）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;var/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;log/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx/&lt;/span&gt;                                    &lt;span style=&#34;color:#7f848e&#34;&gt;# 日志文件目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;           &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;access.log&lt;/span&gt;                           &lt;span style=&#34;color:#7f848e&#34;&gt;# 访问日志
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;           &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;error.log&lt;/span&gt;                             &lt;span style=&#34;color:#7f848e&#34;&gt;# 错误日志
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;lib/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;systemd/&lt;/span&gt;                                    &lt;span style=&#34;color:#7f848e&#34;&gt;# 服务管理相关
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;system/&lt;/span&gt;                                   &lt;span style=&#34;color:#7f848e&#34;&gt;# Nginx systemd 配置
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;              &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx.service&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;源码编译安装&#34;&gt;源码编译安装
&lt;/h3&gt;&lt;p&gt;从Nginx官方下载源码&lt;code&gt;.tar.gz&lt;/code&gt;，自己编译安装&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;/&lt;/span&gt;                                                               &lt;span style=&#34;color:#7f848e&#34;&gt;# 根目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;usr/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;local/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;sbin/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx&lt;/span&gt;                              &lt;span style=&#34;color:#7f848e&#34;&gt;# 主程序二进制文件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;conf/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx.conf&lt;/span&gt;                       &lt;span style=&#34;color:#7f848e&#34;&gt;# 主配置文件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;mime.types&lt;/span&gt;                     &lt;span style=&#34;color:#7f848e&#34;&gt;# MIME类型映射表
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;conf.d/&lt;/span&gt;                            &lt;span style=&#34;color:#7f848e&#34;&gt;# 子配置目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;default.conf&lt;/span&gt;                &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认网站配置文件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;html/&lt;/span&gt;                                    &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认 Web 根目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;index.html&lt;/span&gt;                       &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认欢迎页面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;50x.html&lt;/span&gt;                          &lt;span style=&#34;color:#7f848e&#34;&gt;# 服务器错误页面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;logs/&lt;/span&gt;                                     &lt;span style=&#34;color:#7f848e&#34;&gt;# 日志文件目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;                &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;access.log&lt;/span&gt;                         &lt;span style=&#34;color:#7f848e&#34;&gt;# 访问日志
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;                &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;error.log&lt;/span&gt;                            &lt;span style=&#34;color:#7f848e&#34;&gt;# 错误日志
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;debianubuntu官方仓库&#34;&gt;Debian/Ubuntu官方仓库
&lt;/h3&gt;&lt;p&gt;通过&lt;code&gt;apt&lt;/code&gt;安装&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;虽然&lt;code&gt;apt&lt;/code&gt;也是调用&lt;code&gt;dpkg&lt;/code&gt;安装&lt;code&gt;.deb&lt;/code&gt;包，但debian/ubuntu维护的&lt;code&gt;.deb&lt;/code&gt;包和官方打包的不太一样，因此web根目录等等路径和直接使用官方包安装会有所差别&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;/&lt;/span&gt;                                                                 &lt;span style=&#34;color:#7f848e&#34;&gt;# 根目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;etc/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx/&lt;/span&gt;                                           &lt;span style=&#34;color:#7f848e&#34;&gt;# 配置文件目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx.conf&lt;/span&gt;                                &lt;span style=&#34;color:#7f848e&#34;&gt;# 主配置文件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;mime.types&lt;/span&gt;                              &lt;span style=&#34;color:#7f848e&#34;&gt;# MIME类型映射表
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;conf.d/&lt;/span&gt;                                     &lt;span style=&#34;color:#7f848e&#34;&gt;# 子配置目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;           &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;default.conf&lt;/span&gt;                         &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认网站配置文件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;usr/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;sbin/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx&lt;/span&gt;                                       &lt;span style=&#34;color:#7f848e&#34;&gt;# 主程序二进制文件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;var/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;www/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;html/&lt;/span&gt;                                      &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认 Web 根目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;index.html&lt;/span&gt;                          &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认欢迎页面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;50x.html&lt;/span&gt;                             &lt;span style=&#34;color:#7f848e&#34;&gt;# 服务器错误页面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;log/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx/&lt;/span&gt;                                      &lt;span style=&#34;color:#7f848e&#34;&gt;# 日志文件目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;           &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;access.log&lt;/span&gt;                            &lt;span style=&#34;color:#7f848e&#34;&gt;# 访问日志
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;           &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;error.log&lt;/span&gt;                              &lt;span style=&#34;color:#7f848e&#34;&gt;# 错误日志
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;lib/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;systemd/&lt;/span&gt;                                     &lt;span style=&#34;color:#7f848e&#34;&gt;# 服务管理相关
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;system/&lt;/span&gt;                                   &lt;span style=&#34;color:#7f848e&#34;&gt;# Nginx systemd 配置
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;              &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx.service&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;centosrhel官方仓库&#34;&gt;CentOS/RHEL官方仓库
&lt;/h3&gt;&lt;p&gt;通过&lt;code&gt;yum&lt;/code&gt;/&lt;code&gt;dnf&lt;/code&gt;安装&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;路径、配置和布局就是官方Nginx提供的.rmp包规范的结构，所以和第一种很像&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;/&lt;/span&gt;                                                               &lt;span style=&#34;color:#7f848e&#34;&gt;# 根目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;etc/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx/&lt;/span&gt;                                         &lt;span style=&#34;color:#7f848e&#34;&gt;# 配置文件目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx.conf&lt;/span&gt;                               &lt;span style=&#34;color:#7f848e&#34;&gt;# 主配置文件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;mime.types&lt;/span&gt;                             &lt;span style=&#34;color:#7f848e&#34;&gt;# MIME类型映射表
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;conf.d/&lt;/span&gt;                                    &lt;span style=&#34;color:#7f848e&#34;&gt;# 子配置目录（用于虚拟主机）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;           &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;default.conf&lt;/span&gt;                        &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认网站配置文件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;usr/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;sbin/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx&lt;/span&gt;                                      &lt;span style=&#34;color:#7f848e&#34;&gt;# 主程序二进制文件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;usr/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;share/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;           &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;html/&lt;/span&gt;                                 &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认 Web 根目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;               &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;index.html&lt;/span&gt;                     &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认欢迎页面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;               &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;50x.html&lt;/span&gt;                        &lt;span style=&#34;color:#7f848e&#34;&gt;# 服务器错误页面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;var/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;log/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx/&lt;/span&gt;                                    &lt;span style=&#34;color:#7f848e&#34;&gt;# 日志文件目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;           &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;access.log&lt;/span&gt;                          &lt;span style=&#34;color:#7f848e&#34;&gt;# 访问日志
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;           &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;error.log&lt;/span&gt;                             &lt;span style=&#34;color:#7f848e&#34;&gt;# 错误日志
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;usr/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;lib/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;systemd/&lt;/span&gt;                                 &lt;span style=&#34;color:#7f848e&#34;&gt;# 服务管理相关
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;            &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;system/&lt;/span&gt;                               &lt;span style=&#34;color:#7f848e&#34;&gt;# Nginx systemd 配置
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;                &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx.service&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;docker镜像官方-nginx&#34;&gt;Docker镜像（官方 Nginx）
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;没有固定结构&lt;/strong&gt;，因为Docker镜像只是一个文件系统的快照，完全取决于镜像制作者，具体看上面四种&lt;/p&gt;
&lt;p&gt;这里以官方镜像为例，也就是&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;/&lt;/span&gt;                                                  &lt;span style=&#34;color:#7f848e&#34;&gt;# 根目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;etc/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx/&lt;/span&gt;                            &lt;span style=&#34;color:#7f848e&#34;&gt;# 配置文件目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx.conf&lt;/span&gt;                  &lt;span style=&#34;color:#7f848e&#34;&gt;# 主配置文件（Nginx 的核心配置）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;mime.types&lt;/span&gt;                &lt;span style=&#34;color:#7f848e&#34;&gt;# MIME类型映射表
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;conf.d/&lt;/span&gt;                       &lt;span style=&#34;color:#7f848e&#34;&gt;# 子配置目录（用于虚拟主机）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;           &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;default.conf&lt;/span&gt;           &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认网站配置文件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;usr/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;share/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;      &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;html/&lt;/span&gt;                     &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认的 Web 根目录
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;           &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;index.html&lt;/span&gt;        &lt;span style=&#34;color:#7f848e&#34;&gt;# 默认欢迎页面
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;           &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;50x.html&lt;/span&gt;           &lt;span style=&#34;color:#7f848e&#34;&gt;# 服务器错误页面（如 500、502）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;sbin/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx&lt;/span&gt;                         &lt;span style=&#34;color:#7f848e&#34;&gt;# 主程序二进制文件
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;│&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;var/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;     &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;log/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;nginx/&lt;/span&gt;                       &lt;span style=&#34;color:#7f848e&#34;&gt;# 日志文件目录（部分精简镜像无日志输出）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;             &lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;access.log&lt;/span&gt;             &lt;span style=&#34;color:#7f848e&#34;&gt;# 访问日志（默认可能未启用）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;             &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;error.log&lt;/span&gt;                &lt;span style=&#34;color:#7f848e&#34;&gt;# 错误日志（默认可能未启用）
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;一些问题&#34;&gt;一些问题
&lt;/h2&gt;&lt;h3 id=&#34;日志文件&#34;&gt;日志文件
&lt;/h3&gt;&lt;p&gt;&lt;span style=&#34;color:red;font-size:20px&#34;&gt;&lt;strong&gt;Docker镜像的Nginx日志默认输出到标准输出/错误，而不是文件中&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;在编译安装（&lt;code&gt;make install&lt;/code&gt;）的传统方式中，Nginx日志会记录在：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;usr&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;local&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;nginx&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;logs&lt;/span&gt;/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;在&lt;code&gt;.deb&lt;/code&gt;包和系统包安装（&lt;code&gt;apt/yum&lt;/code&gt;）的方式中，Nginx日志会记录在：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/&lt;span style=&#34;color:#c678dd&#34;&gt;var&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;log&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;nginx&lt;/span&gt;/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;而在Docker官方镜像中，日志默认不写入上面的文件，而是输出到标准输出和标准错误&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;执行以下命令：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ls -l /var/log/nginx/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;我们可以看到如下输出：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;lrwxrwxrwx &lt;span style=&#34;color:#d19a66&#34;&gt;1&lt;/span&gt; root root &lt;span style=&#34;color:#d19a66&#34;&gt;11&lt;/span&gt; Jul &lt;span style=&#34;color:#d19a66&#34;&gt;15&lt;/span&gt; 01:14 access.log -&amp;gt; /dev/stdout
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;lrwxrwxrwx &lt;span style=&#34;color:#d19a66&#34;&gt;1&lt;/span&gt; root root &lt;span style=&#34;color:#d19a66&#34;&gt;11&lt;/span&gt; Jul &lt;span style=&#34;color:#d19a66&#34;&gt;15&lt;/span&gt; 01:14 error.log -&amp;gt; /dev/stderr
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;虽然&lt;code&gt;nginx.conf&lt;/code&gt;配置的是&lt;code&gt;/var/log/nginx/access.log&lt;/code&gt;，但由于它是个符号链接，等于就是输出到了标准输出&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;这些输出会被记录到docker容器的日志里，docker中查看日志的方式&lt;/strong&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;docker&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;logs&lt;/span&gt; &amp;lt;&lt;span style=&#34;color:#e06c75&#34;&gt;容器ID&lt;/span&gt;&amp;gt;/&amp;lt;&lt;span style=&#34;color:#e06c75&#34;&gt;名称&lt;/span&gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;配置文件&#34;&gt;配置文件
&lt;/h3&gt;&lt;p&gt;&lt;span style=&#34;color:red;font-size:20px&#34;&gt;&lt;strong&gt;&lt;code&gt;/etc/nginx/conf.d/&lt;/code&gt;是主配置目录，&lt;code&gt;/etc/nginx/nginx.conf&lt;/code&gt;是主配置文件&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Nginx的主配置文件是&lt;code&gt;/etc/nginx/nginx.conf&lt;/code&gt;，在这个文件中有这样一行代码：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;include&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;/etc/nginx/conf.d/*.conf&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;include&lt;/code&gt;是Nginx配置语言中的指令，用于包含其他配置文件&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;也就是说，&lt;code&gt;/etc/nginx/nginx.conf&lt;/code&gt;默认会包含&lt;code&gt;/etc/nginx/conf.d/&lt;/code&gt;这个子目录中的所有配置（.conf）&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;web-根目录&#34;&gt;Web 根目录
&lt;/h3&gt;&lt;p&gt;&lt;span style=&#34;color:red;font-size:20px&#34;&gt;&lt;strong&gt;不同安装方式下，Nginx的默认Web根目录不同&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;在编译安装（&lt;code&gt;make install&lt;/code&gt;）的传统方式中，Web根目录在：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;usr&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;local&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;nginx&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;html&lt;/span&gt;/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;默认包含以下文件：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;index&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;html&lt;/span&gt;   # &lt;span style=&#34;color:#e06c75&#34;&gt;默认欢迎页面&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;x&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;html&lt;/span&gt;     # &lt;span style=&#34;color:#e06c75&#34;&gt;服务器错误页面&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;在Debian/Ubuntu系统包安装方式中，Web根目录在：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/&lt;span style=&#34;color:#c678dd&#34;&gt;var&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;www&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;html&lt;/span&gt;/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;在官方包和CentOS/RHEL系统包安装方式中，Web根目录在：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;usr&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;share&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;nginx&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;html&lt;/span&gt;/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;可以通过修改Nginx配置文件中的&lt;code&gt;root&lt;/code&gt;指令来改变Web根目录：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;listen&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;80&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;server_name&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;localhost&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;root&lt;/span&gt; /&lt;span style=&#34;color:#e06c75&#34;&gt;path&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;to&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;your&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;webroot&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e06c75&#34;&gt;index&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;index&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;html&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;关于server块我们后面会细讲&lt;/p&gt;
&lt;h3 id=&#34;systemd的位置&#34;&gt;systemd的位置
&lt;/h3&gt;&lt;p&gt;其实这个不是nginx的问题，而是一个历史问题 —— linux文件系统的演进&lt;/p&gt;
&lt;p&gt;**FHS，全称Filesystem Hierarchy Standard（文件系统层次结构标准）**是 Linux 系统的一个标准，规定了 目录结构、文件存放位置及用途，让不同 Linux 发行版在文件布局上保持一致性&lt;/p&gt;
&lt;p&gt;在早期，FHS规定&lt;code&gt;/lib/&lt;/code&gt;用于存放核心库文件和与系统启动紧密相关的可执行文件（比如init系统所需的库、二进制），而&lt;code&gt;/usr/lib/&lt;/code&gt;用于存放非核心、额外安装的软件库&lt;/p&gt;
&lt;p&gt;但在systemd出现后，由于systemd的服务单元文件属于系统服务配置，与系统启动密切相关，但又不是二进制程序本身，于是他的位置有了一些不同：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Debian/Ubuntu：选择&lt;code&gt;/lib/systemd/system/&lt;/code&gt;放置核心包的单元文件（比如nginx、sshd），保证系统启动时总能找到&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;CentOS/RHEL/Fedora：更倾向使用&lt;code&gt;/usr/lib/systemd/system/&lt;/code&gt;，虽然&lt;code&gt;/lib/systemd/system/&lt;/code&gt;也存在，但它通常是指向前者的符号链接&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;现在&lt;code&gt;/lib/&lt;/code&gt;和&lt;code&gt;/usr/lib/&lt;/code&gt;往往通过软链接或包管理器自动管理，保证旧路径和新路径都能访问到服务单元文件，所以你会看到同样的 Nginx 服务在不同发行版或者不同安装方式下，路径可能不同&lt;/p&gt;
&lt;h1 id=&#34;常用命令&#34;&gt;常用命令
&lt;/h1&gt;&lt;p&gt;Nginx直接安装在本机时，使用&lt;code&gt;systemctl&lt;/code&gt;或者&lt;code&gt;service&lt;/code&gt;命令控制&lt;/p&gt;
&lt;p&gt;通过Docker容器使用时，就按照Docker容器的使用方法（没用过看这里：&lt;a class=&#34;link&#34; href=&#34;http://blog.928330.xyz/p/%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8Bdocker/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;快速上手Docker
    
    &lt;span style=&#34;white-space: nowrap;&#34;&gt;&lt;svg width=&#34;.7em&#34;
        height=&#34;.7em&#34; viewBox=&#34;0 0 21 21&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;
        &lt;path d=&#34;m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z&#34; fill=&#34;currentColor&#34; /&gt;
        &lt;path d=&#34;M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z&#34;
            fill=&#34;currentColor&#34;&gt;
    &lt;/svg&gt;&lt;/span&gt;
    
&lt;/a&gt;）&lt;/p&gt;
&lt;p&gt;下面介绍一些Nginx本身的命令：&lt;/p&gt;
&lt;h2 id=&#34;查看版本&#34;&gt;查看版本
&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;nginx -v
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;输出当前安装的Nginx版本号，用于确认是否正确安装Nginx及其版本信息&lt;/p&gt;
&lt;h2 id=&#34;检查配置文件语法&#34;&gt;检查配置文件语法
&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;nginx -t
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;在每次修改配置文件后必须执行&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;使用后，主进程会fork一个临时子进程，子进程尝试解析所有配置文件，但不会绑定端口或真正启动服务&lt;/p&gt;
&lt;p&gt;若语法无误，会提示&lt;code&gt;syntax is ok&lt;/code&gt;和 &lt;code&gt;test is successful&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;若有错误，会明确指出是哪一行、哪个文件配置有误&lt;/p&gt;
&lt;p&gt;
&lt;div class=&#34;post-img-view&#34;&gt;
&lt;a data-fancybox=&#34;gallery&#34; data-caption=&#34;image-20250724132842292&#34; href=&#34;http://picture.928330.xyz/typora/image-20250724132842292.png&#34;&gt;
&lt;img src=&#34;http://picture.928330.xyz/typora/image-20250724132842292.png&#34; alt=&#34;image-20250724132842292&#34;  /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;h2 id=&#34;重新加载配置文件&#34;&gt;重新加载配置文件
&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;nginx -s reload
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;强制停止&#34;&gt;强制停止
&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;nginx -s stop
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;配置文件-1&#34;&gt;配置文件
&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;Nginx的所有功能都是通过配置文件&lt;code&gt;nginx.conf&lt;/code&gt;来驱动的&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;该文件主要由多个配置块组成，这些块由花括号&lt;code&gt;{}&lt;/code&gt;界定，可以嵌套，形成了层级分明的结构&lt;/p&gt;
&lt;p&gt;一个典型的&lt;code&gt;nginx.conf&lt;/code&gt;结构如下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;nginx.conf&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;全局块&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;├──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;events块&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;http块&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;server块（可多个）&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#98c379&#34;&gt;└──&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;location块（可多个）&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;具体示例如下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;user&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;nginx&lt;/span&gt;; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;worker_processes&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;auto&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;error_log&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;/var/log/nginx/error.log&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;warn&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;pid&lt;/span&gt;        &lt;span style=&#34;color:#98c379&#34;&gt;/var/run/nginx.pid&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;events&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;worker_connections&lt;/span&gt;  &lt;span style=&#34;color:#d19a66&#34;&gt;1024&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;http&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;include&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;/etc/nginx/mime.types&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;default_type&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;application/octet-stream&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;log_format&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;main&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$remote_addr&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$remote_user&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$time_local]&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$request&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                      &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$status&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$body_bytes_sent&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$http_referer&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                      &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$http_user_agent&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$http_x_forwarded_for&amp;#34;&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;access_log&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;/var/log/nginx/access.log&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;main&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;sendfile&lt;/span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;on&lt;/span&gt;; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;tcp_nopush&lt;/span&gt;      &lt;span style=&#34;color:#e06c75&#34;&gt;on&lt;/span&gt;; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;keepalive_timeout&lt;/span&gt;  &lt;span style=&#34;color:#d19a66&#34;&gt;65&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;listen&lt;/span&gt;       &lt;span style=&#34;color:#d19a66&#34;&gt;80&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;server_name&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;localhost&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#c678dd&#34;&gt;root&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;/usr/share/nginx/html&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#c678dd&#34;&gt;index&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;index.html&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;index.htm&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;全局块&#34;&gt;全局块
&lt;/h2&gt;&lt;p&gt;位于配置文件顶部，未嵌套于任何块中&lt;/p&gt;
&lt;p&gt;用于配置Nginx整体运行环境，影响所有子模块&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;user&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;nginx&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;worker_processes&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;auto&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;error_log&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;/var/log/nginx/error.log&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;warn&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;pid&lt;/span&gt;        &lt;span style=&#34;color:#98c379&#34;&gt;/var/run/nginx.pid&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;user&lt;/code&gt;：指定运行工作进程的用户和用户组&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;worker_processes&lt;/code&gt;：指定工作进程数量&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;auto&lt;/code&gt;表示自动与 CPU 核心数一致&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;error_log&lt;/code&gt;：设置错误日志的路径和日志级别&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;每条错误日志条目都会带有一个严重性等级，这些等级是代码里写死的，作为用户无法改变某个错误属于什么等级&lt;/p&gt;
&lt;p&gt;Nginx支持的日志级别（从高到低）如下：&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;级别&lt;/th&gt;
          &lt;th&gt;描述&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;debug&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;记录所有信息，主要用于开发或调试，信息量极大，通常需编译时启用&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;info&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;普通信息，如配置加载成功、进程启动、连接创建等&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;notice&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;正常但重要的事件，如配置文件重载、进程关闭等&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;warn&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;警告信息，非致命错误，比如配置中存在问题但可以忽略或继续运行&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;error&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;运行过程中出现的错误，如连接失败、服务不可达等&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;crit&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;严重错误，Nginx可能无法继续运行&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;alert&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;必须立刻处理的严重问题&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;emerg&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;紧急状态，比如系统崩溃，Nginx无法启动&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;是否写入日志文件取决于&lt;code&gt;LogLevel&lt;/code&gt;设置的阈值，只会写入大于等于当前设置等级的错误事件&lt;/p&gt;
&lt;p&gt;生产环境通常设置为&lt;code&gt;warn&lt;/code&gt;以捕捉重要问题，同时避免日志泛滥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;pid&lt;/code&gt;：指定记录主进程PID的文件路径&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;events块&#34;&gt;events块
&lt;/h2&gt;&lt;p&gt;紧随全局块之后，一级块&lt;/p&gt;
&lt;p&gt;用于配置与网络连接处理相关的指令，影响工作进程的并发性能&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;events&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;worker_connections&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;1024&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;worker_connections&lt;/code&gt;：每个工作进程可同时处理的最大连接数&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;总并发连接数约为&lt;code&gt;worker_processes * worker_connections&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;http块&#34;&gt;http块
&lt;/h2&gt;&lt;p&gt;紧随events块之后，一级块&lt;/p&gt;
&lt;p&gt;用于配置HTTP协议相关的指令，是配置Web服务的核心部分&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;http&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;include&lt;/span&gt;       &lt;span style=&#34;color:#98c379&#34;&gt;/etc/nginx/mime.types&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;default_type&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;application/octet-stream&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;log_format&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;main&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$remote_addr&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$remote_user&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$time_local]&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$request&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                      &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$status&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$body_bytes_sent&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$http_referer&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                      &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$http_user_agent&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$http_x_forwarded_for&amp;#34;&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;access_log&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;/var/log/nginx/access.log&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;main&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;sendfile&lt;/span&gt;        &lt;span style=&#34;color:#e06c75&#34;&gt;on&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;tcp_nopush&lt;/span&gt;      &lt;span style=&#34;color:#e06c75&#34;&gt;on&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;keepalive_timeout&lt;/span&gt;  &lt;span style=&#34;color:#d19a66&#34;&gt;65&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;include&lt;/code&gt;：引入外部文件&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这里&lt;code&gt;/etc/nginx/mime.types&lt;/code&gt;用于MIME类型配置&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;default_type&lt;/code&gt;：未明确 MIME 类型时的默认类型&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;log_format&lt;/code&gt;：定义日志名称与格式&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;access_log&lt;/code&gt;：指定访问日志的输出路径及格式&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;sendfile&lt;/code&gt;：启用高效文件传输方式&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;tcp_nopush&lt;/code&gt;：优化网络传输性能，避免频繁发送小包&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;keepalive_timeout&lt;/code&gt;：设置长连接超时时间&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;server块&#34;&gt;server块
&lt;/h2&gt;&lt;p&gt;嵌套于http块内部，二级块，可存在多个，用于配置多个虚拟主机&lt;/p&gt;
&lt;p&gt;用于定义单个虚拟主机的配置，通过监听端口和服务器名称对请求进行分发&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;listen&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;80&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server_name&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;localhost&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;listen&lt;/code&gt;：设置监听的端口&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;只有访问主机该端口的请求才会被接受&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;不过得注意，如果使用docker，docker容器一般会把这个端口转发到主机的某个端口上&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;基本用法：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;listen&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;lt;地址&amp;gt;:&amp;lt;端口&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;[参数]&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;地址&lt;/code&gt;&lt;/strong&gt;（可选）：指定绑定的 IP（默认是所有IP）&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;端口&lt;/code&gt;&lt;/strong&gt;：监听的端口&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;参数&lt;/code&gt;&lt;/strong&gt;（可选）：例如&lt;code&gt;default_server&lt;/code&gt;、&lt;code&gt;ssl&lt;/code&gt;、&lt;code&gt;http2&lt;/code&gt; 等（我们后面都会提到）&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;有一个比较特殊的参数：&lt;code&gt;default_server&lt;/code&gt;，用来指定默认的server块，当Nginx收到请求但找不到任何&lt;code&gt;server_name&lt;/code&gt;匹配时，就会使用这个默认配置来处理请求&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span style=&#34;color:yellow;&#34;&gt;&lt;strong&gt;介绍几种常见&lt;code&gt;listen&lt;/code&gt;字段写法：&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;80&lt;/code&gt;：监听所有IP的80端口（80是默认HTTP端口），相当于&lt;code&gt;0.0.0.0:8080&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;127.0.0.1:8080&lt;/code&gt;：仅监听本地回环地址的8080端口&lt;/p&gt;
&lt;p&gt;&lt;code&gt;[::]:80&lt;/code&gt;：IPv6地址监听80端口&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;server_name&lt;/code&gt;：匹配请求的主机名或域名&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;只有请求头中的Host字段符合，Nginx才会把请求交给这个&lt;code&gt;server&lt;/code&gt;块处理&lt;/p&gt;
&lt;p&gt;可以在&lt;code&gt;server_name&lt;/code&gt;中写多个值，也支持通配符&lt;code&gt;*&lt;/code&gt;，也可以使用&lt;code&gt;_&lt;/code&gt;表示任何Host值&lt;/p&gt;
&lt;p&gt;如果不写这个字段，http块又只有一个server，那么这个server块会所有请求都匹配（包括 IP）&lt;/p&gt;
&lt;p&gt;如果不写这个字段，http块又有多个server，那么这个server块会作为默认server，处理未匹配的请求&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;location块&#34;&gt;location块
&lt;/h2&gt;&lt;p&gt;嵌套于server块内部，三级块&lt;/p&gt;
&lt;p&gt;用于对URI（注意不是URL）进行匹配，制定请求的处理方式，如资源路径、代理规则等&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;root&lt;/span&gt;   &lt;span style=&#34;color:#98c379&#34;&gt;/usr/share/nginx/html&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;index&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;index.html&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;index.htm&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;location&lt;/code&gt;：用于匹配客户端请求的URI&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;示例这里是匹配以&lt;code&gt;/&lt;/code&gt;开头的URI（实际上就是匹配所有请求，因为URI就是以&lt;code&gt;/&lt;/code&gt;开头的）&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;此外，Nginx提供多种匹配方式，优先级不同：&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;类型&lt;/th&gt;
          &lt;th&gt;语法&lt;/th&gt;
          &lt;th&gt;示例&lt;/th&gt;
          &lt;th&gt;说明&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;精确匹配&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;=&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;location = /login {}&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;仅匹配 URI 等于 &lt;code&gt;/login&lt;/code&gt; 的请求&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;前缀匹配&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;/&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;location /images/ {}&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;匹配以 &lt;code&gt;/images/&lt;/code&gt; 开头的 URI&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;正则匹配&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;~&lt;/code&gt;（区分大小写）&lt;br /&gt;&lt;code&gt;~*&lt;/code&gt;（不区分大小写）&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;location ~ \.php$ {}&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;使用正则表达式匹配 URI&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;优先匹配&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;^~&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;location ^~ /static/ {}&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;前缀匹配优先于正则匹配&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;root&lt;/code&gt;：设置请求资源的根目录路径&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;当一个请求到达时，Nginx会将请求的URI拼接到这个路径后面，以确定文件的具体位置&lt;/p&gt;
&lt;p&gt;如果客户端访问&lt;code&gt;/index.html&lt;/code&gt;，那么实际访问的是服务器上的&lt;code&gt;/usr/share/nginx/html/index.html&lt;/code&gt;文件&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;index&lt;/code&gt;：指定访问目录时的默认文件名称&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;如果用户访问的是目录而不是具体文件，Nginx会在&lt;code&gt;/usr/share/nginx/html/&lt;/code&gt;目录下按顺序查找：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;index.html&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;index.htm&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;只要找到其中一个文件，就立即返回该文件作为响应；如果都找不到，会返回403（禁止访问）或404（未找到），视配置而定&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;root&lt;/code&gt;和&lt;code&gt;index&lt;/code&gt;也可以直接写在server块里面，作为所有location块的默认值&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span style=&#34;color:yellow;font-size:18px&#34;&gt;&lt;strong&gt;说了这么多，我们最后总结一下&lt;code&gt;listen&lt;/code&gt;、&lt;code&gt;server_name&lt;/code&gt;、&lt;code&gt;location&lt;/code&gt; 三者是如何配合工作的：&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;用户访问浏览器输入：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-url&#34; data-lang=&#34;url&#34;&gt;http://localhost/images/logo.png
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Nginx内部处理流程如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;看端口：&lt;/strong&gt;
该请求是发给哪个端口，是80，那就匹配所有listen 80的server&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;看Host头：&lt;/strong&gt;
Host是localhost，找哪个server_name匹配上了，进入该server块&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;看URI：&lt;/strong&gt;
URI是/images/logo.png，在这个server中找哪个location匹配得最好，执行该location的规则&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;核心功能--web服务&#34;&gt;核心功能 —— Web服务
&lt;/h1&gt;&lt;p&gt;Web 服务是 Nginx 最基础，也是最核心的功能，它能够高效地处理客户端对静态资源的请求&lt;/p&gt;
&lt;p&gt;这主要通过&lt;code&gt;server&lt;/code&gt;块中的&lt;code&gt;root&lt;/code&gt;、&lt;code&gt;index&lt;/code&gt;、&lt;code&gt;location&lt;/code&gt;来协同完成&lt;/p&gt;
&lt;h2 id=&#34;部署静态资源&#34;&gt;部署静态资源
&lt;/h2&gt;&lt;p&gt;可以把Nginx作为静态资源服务器，当用户请求时，Nginx从服务器的指定文件路径中查找并返回对应的文件：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;listen&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;80&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server_name&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;example.com&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;root&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/var/www/my-project/public&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;index&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;index.html&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;index.htm&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;try_files&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$uri&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$uri/&lt;/span&gt; =&lt;span style=&#34;color:#d19a66&#34;&gt;404&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;location&lt;/span&gt; ~&lt;span style=&#34;color:#98c379&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;\.(jpg|jpeg|gif|png|css|js|ico|webp)&lt;/span&gt;$ {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;expires&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;30d&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;try_files $uri $uri/ =404&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这是一个非常强大的指令，常用于处理单页应用（SPA）的路由，它的语法是：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Nginx&#34; data-lang=&#34;Nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;try_files&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;file1&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;file2&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;...&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;final_action&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;file1, file2, ...&lt;/code&gt;：依次判断路径（支持变量），是否存在有效文件或目录&lt;/li&gt;
&lt;li&gt;&lt;code&gt;final_action&lt;/code&gt;：如果前面都没找到，则执行的动作，常用的有：
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;=404&lt;/code&gt;：返回404错误&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@named_location&lt;/code&gt;：跳转到命名的location块&lt;/li&gt;
&lt;li&gt;&lt;code&gt;uri&lt;/code&gt;：重定向到指定URI&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;现在我们看看示例里面的是什么意思：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Nginx&#34; data-lang=&#34;Nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;try_files&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$uri&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$uri/&lt;/span&gt; =&lt;span style=&#34;color:#d19a66&#34;&gt;404&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;$uri&lt;/code&gt;：尝试将URI直接作为文件名进行查找&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;$uri/&lt;/code&gt;：如果上一步失败，则尝试将URI作为一个目录名，并在该目录下查找由&lt;code&gt;index&lt;/code&gt;指令定义的文件&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;=404&lt;/code&gt;：如果前两步都失败，则返回一个404 Not Found错误&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;location ~* \.(jpg|jpeg|gif|png|css|js|ico|webp)$&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这是一个正则匹配，&lt;code&gt;~*&lt;/code&gt;表示不区分大小写的正则，它会匹配所有以上述后缀结尾的请求&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;expires 30d&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;用于设置HTTP响应头中的&lt;code&gt;Expires&lt;/code&gt;和&lt;code&gt;Cache-Control&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;告诉客户端浏览器可以将这些静态资源缓存30天，从而减少不必要的请求，提升后续访问速度&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;url重写与跳转&#34;&gt;URL重写与跳转
&lt;/h2&gt;&lt;p&gt;Nginx支持在&lt;code&gt;location&lt;/code&gt;块内实现URL重写和跳转，常用于：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;伪静态（SEO优化）&lt;/li&gt;
&lt;li&gt;页面重定向&lt;/li&gt;
&lt;li&gt;接口调整兼容&lt;/li&gt;
&lt;li&gt;HTTPS 强制跳转等场景&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;rewrite&#34;&gt;rewrite
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;rewrite&lt;/code&gt;是Nginx实现伪静态、内部跳转的主要方式&lt;/p&gt;
&lt;p&gt;它的本质是把用户请求的路径改写成另一个内部路径，再由Nginx重新处理&lt;/p&gt;
&lt;h4 id=&#34;基本语法&#34;&gt;基本语法
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;rewrite&lt;/span&gt; &amp;lt;&lt;span style=&#34;color:#e06c75&#34;&gt;正则匹配&lt;/span&gt;&amp;gt; &amp;lt;&lt;span style=&#34;color:#e06c75&#34;&gt;重写路径&lt;/span&gt;&amp;gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;flag&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;正则匹配&lt;/strong&gt;：对当前请求URI进行匹配（不包含域名）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;重写路径&lt;/strong&gt;：替换匹配url的新URI，可引用正则中的子表达式&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;flag 可选标志&lt;/strong&gt;：&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;重写方式&lt;/th&gt;
          &lt;th&gt;用法&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;last&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;使用新URI，从头开始匹配&lt;code&gt;location&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;用于常规重写，不会改变浏览器地址栏&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;break&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;使用新URI，但不再重新匹配&lt;code&gt;location&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;跳出&lt;code&gt;rewrite&lt;/code&gt;，在当前&lt;code&gt;location&lt;/code&gt;内继续执行&lt;br /&gt;不会改变浏览器地址栏&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;permanent&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;返回301，永久重定向&lt;/td&gt;
          &lt;td&gt;会改变浏览器地址栏&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;redirect&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;返回302，临时重定向&lt;/td&gt;
          &lt;td&gt;会改变浏览器地址栏&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;伪静态处理&#34;&gt;伪静态处理
&lt;/h4&gt;&lt;p&gt;将 &lt;code&gt;/product/123.html&lt;/code&gt; 重写为 &lt;code&gt;/product.php?id=123&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;rewrite&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;^/product/([0-9]+)\.html&lt;/span&gt;$ &lt;span style=&#34;color:#98c379&#34;&gt;/product.php?id=&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$1&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;last&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;隐藏真实路径&#34;&gt;隐藏真实路径
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/user/&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;rewrite&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;^/user/([a-z]+)&lt;/span&gt;$ &lt;span style=&#34;color:#98c379&#34;&gt;/profile.php?name=&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$1&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;last&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;return&#34;&gt;return
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;return&lt;/code&gt;用于向客户端返回一个特定的状态码和内容，它不会再走&lt;code&gt;rewrite&lt;/code&gt;的内部处理流程&lt;/p&gt;
&lt;p&gt;比起&lt;code&gt;rewrite&lt;/code&gt;，它更适合用于明确的重定向、报错处理等&lt;/p&gt;
&lt;h4 id=&#34;基本语法-1&#34;&gt;基本语法
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;return&lt;/span&gt; &amp;lt;&lt;span style=&#34;color:#e06c75&#34;&gt;状态码&lt;/span&gt;&amp;gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;文本&lt;/span&gt;|&lt;span style=&#34;color:#e06c75&#34;&gt;URL&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;状态码&lt;/strong&gt;：如301（永久重定向）、302（临时重定向）、403（禁止访问）、404（页面不存在）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;文本或URL&lt;/strong&gt;：可返回跳转地址，也可直接返回文本内容（仅在状态码为200时有效）&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;http强制跳转https&#34;&gt;HTTP强制跳转HTTPS
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;listen&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;80&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server_name&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;example.com&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;301&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;https://&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$server_name$request_uri&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这一点我们下面会详细说明&lt;/p&gt;
&lt;h4 id=&#34;禁止访问某个目录&#34;&gt;禁止访问某个目录
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/private/&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;403&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;简洁跳转到首页&#34;&gt;简洁跳转到首页
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;location&lt;/span&gt; = &lt;span style=&#34;color:#98c379&#34;&gt;/&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;301&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/home/index.html&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;纯文本响应&#34;&gt;纯文本响应
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;location&lt;/span&gt; = &lt;span style=&#34;color:#98c379&#34;&gt;/test&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;200&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;Hello.&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;配置https服务&#34;&gt;配置HTTPS服务
&lt;/h2&gt;&lt;p&gt;为网站启用HTTPS可以对客户端和服务器之间的传输数据进行加密，确保数据安全&lt;/p&gt;
&lt;p&gt;配置前，我们需要从证书颁发机构（CA）获取SSL/TLS证书文件和私钥文件&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Nginx&#34; data-lang=&#34;Nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;listen&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;443&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;ssl&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;http2&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server_name&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;yourdomain.com&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;ssl_certificate&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/path/to/fullchain.pem&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;ssl_certificate_key&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/path/to/privkey.pem&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;ssl_session_cache&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;shared:SSL:10m&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;ssl_session_timeout&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;10m&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;ssl_protocols&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;TLSv1.2&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;TLSv1.3&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;ssl_ciphers&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;ssl_prefer_server_ciphers&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;off&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;root&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/var/www/my-project/public&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;index&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;index.html&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;try_files&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$uri&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$uri/&lt;/span&gt; =&lt;span style=&#34;color:#d19a66&#34;&gt;404&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;listen&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;80&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server_name&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;yourdomain.com&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;301&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;https://&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$server_name$request_uri&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;listen 443 ssl http2&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;443&lt;/code&gt;是HTTPS的标准端口&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;ssl&lt;/code&gt;参数表示在此端口上启用SSL/TLS加密&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;http2&lt;/code&gt;参数表示同时启用HTTP/2协议，它可以显著提升页面加载性能&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ssl_certificate&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;指定证书文件的路径，这通常是&lt;code&gt;.pem&lt;/code&gt;或&lt;code&gt;.crt&lt;/code&gt;格式的公钥证书链文件&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ssl_certificate_key&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;指定与证书配对的私钥文件的路径，通常是&lt;code&gt;.key&lt;/code&gt;格式&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ssl_session_cache&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;开启SSL会话缓存，用于复用TLS握手过程，提升性能&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ssl_session_timeout&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;设置SSL会话的有效时间&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ssl_protocols TLSv1.2 TLSv1.3&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;指定只使用安全的TLS协议版本，废弃老旧且不安全的SSLv3, TLSv1.0, TLSv1.1&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ssl_ciphers&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;指定加密时使用的加密套件列表，配置安全的套件可以防止降级攻击&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;ssl_prefer_server_ciphers&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;是否优先使用服务器端指定的加密套件，&lt;code&gt;off&lt;/code&gt;表示客户端优先&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;return 301 https://$server_name$request_uri&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;发送一个永久重定向的HTTP状态码&lt;/p&gt;
&lt;p&gt;&lt;code&gt;$server_name&lt;/code&gt;和&lt;code&gt;$request_uri&lt;/code&gt;是Nginx变量，分别代表当前请求的域名和完整的 URI（包含参数）&lt;/p&gt;
&lt;p&gt;这能确保用户访问任何HTTP页面时都能被准确地重定向到对应的HTTPS版本&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;核心功能--反向代理&#34;&gt;核心功能 —— 反向代理
&lt;/h1&gt;&lt;p&gt;反向代理是Nginx的一个核心功能&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Nginx作为一个中间层，接收客户端的请求，再将请求转发给后端服务器处理，然后将响应返回给客户端&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这种方式的好处包括：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;可以隐藏后端服务器的真实地址和结构&lt;/li&gt;
&lt;li&gt;可以统一对外的入口，便于安全控制和运维管理&lt;/li&gt;
&lt;li&gt;可以实现负载均衡、高可用等复杂功能（后续再讲）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;下面是一个最简单的Nginx配置示例，只实现把请求转发到后端服务器的功能：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;listen&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;80&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server_name&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;www.example.com&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_pass&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;http://127.0.0.1:3000&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;proxy_pass http://127.0.0.1:3000;&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span style=&#34;color:red;&#34;&gt;&lt;strong&gt;这是反向代理的核心语句，即将匹配到的请求转发到本机的3000端口，由本地某个服务来实际处理请求&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;默认情况下，Nginx把请求转发给后端时，不会携带原始客户端的信息&lt;/p&gt;
&lt;p&gt;&lt;span style=&#34;color:yellow;&#34;&gt;&lt;strong&gt;如果后端服务要获取用户的真实IP、请求协议、原始域名等信息，就需要使用&lt;code&gt;proxy_set_header&lt;/code&gt;来手动设置&lt;/strong&gt;：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;listen&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;80&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server_name&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;www.example.com&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_pass&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;http://127.0.0.1:3000&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_set_header&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;Host&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$host&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_set_header&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;X-Real-IP&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$remote_addr&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_set_header&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;X-Forwarded-For&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$proxy_add_x_forwarded_for&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_set_header&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;X-Forwarded-Proto&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$scheme&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这些&lt;code&gt;proxy_set_header&lt;/code&gt;是给后端应用用的：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;Host $host&lt;/code&gt;&lt;/strong&gt;：原始请求中的主机名&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;X-Real-IP $remote_addr&lt;/code&gt;&lt;/strong&gt;：客户端的真实 IP&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;X-Forwarded-For $proxy_add_x_forwarded_for&lt;/code&gt;&lt;/strong&gt;：经过的所有代理 IP 列表&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;X-Forwarded-Proto $scheme&lt;/code&gt;&lt;/strong&gt;：原始请求的协议（http 或 https）&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span style=&#34;color:yellow;&#34;&gt;&lt;strong&gt;如果我们有多个后端服务（比如多个进程、多个机器），可以用&lt;code&gt;upstream&lt;/code&gt;来统一管理后端服务器组&lt;/strong&gt;：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;upstream&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;backend&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;127.0.0.1&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;3000&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#7f848e&#34;&gt;# server 127.0.0.1:3001;     #可以添加多个
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;listen&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;80&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server_name&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;www.example.com&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_pass&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;http://backend&lt;/span&gt;;   &lt;span style=&#34;color:#7f848e&#34;&gt;#&amp;lt;--这里不一样了，使用的是upstream
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#7f848e&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_set_header&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;Host&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$host&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_set_header&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;X-Real-IP&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$remote_addr&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_set_header&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;X-Forwarded-For&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$proxy_add_x_forwarded_for&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_set_header&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;X-Forwarded-Proto&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$scheme&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;现在，我们只需要在&lt;code&gt;proxy_pass&lt;/code&gt;中写 &lt;code&gt;http://backend&lt;/code&gt;即可&lt;/p&gt;
&lt;p&gt;具体的地址都集中写在&lt;code&gt;upstream backend&lt;/code&gt;块中，方便管理和负载均衡&lt;/p&gt;
&lt;h1 id=&#34;核心功能--负载均衡&#34;&gt;核心功能 —— 负载均衡
&lt;/h1&gt;&lt;p&gt;当&lt;code&gt;upstream&lt;/code&gt;块中定义了多台&lt;code&gt;server&lt;/code&gt;时，Nginx就自然地成为了一个负载均衡器&lt;/p&gt;
&lt;p&gt;它会根据指定的策略将请求分发到不同的服务器，以分担流量压力&lt;/p&gt;
&lt;h2 id=&#34;http负载均衡配置&#34;&gt;HTTP负载均衡配置
&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Nginx&#34; data-lang=&#34;Nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;upstream&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;backend_cluster&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;backend1.example.com&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;weight=5&lt;/span&gt;; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;backend2.example.com&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;backend3.example.com&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;backup&lt;/span&gt;; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;backend4.example.com&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;down&lt;/span&gt;;   
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;listen&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;80&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;location&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_pass&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;http://backend_cluster&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_connect_timeout&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;5s&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_read_timeout&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;10s&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;weight=5&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;为服务器设置权重，在默认的轮询策略下，权重越高的服务器接收到的请求比例就越高&lt;/p&gt;
&lt;p&gt;这里&lt;code&gt;backend1&lt;/code&gt;的请求量大约是&lt;code&gt;backend2&lt;/code&gt;的5倍&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;backup&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;将服务器标记为备用服务器&lt;/p&gt;
&lt;p&gt;只有当所有非备用的主服务器都无法访问时，Nginx才会将请求转发给它&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;down&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;将服务器标记为永久下线，Nginx不会向它转发任何请求&lt;/p&gt;
&lt;p&gt;这通常用于服务器维护&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;proxy_connect_timeout&lt;/code&gt; &amp;amp; &lt;code&gt;proxy_read_timeout&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;设置Nginx与后端服务器建立连接的超时时间和读取响应的超时时间&lt;/p&gt;
&lt;p&gt;可以防止因个别后端服务响应缓慢而导致请求长时间挂起&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;负载均衡策略&#34;&gt;负载均衡策略
&lt;/h3&gt;&lt;h3 id=&#34;轮询&#34;&gt;轮询
&lt;/h3&gt;&lt;p&gt;默认策略，无需任何指令&lt;/p&gt;
&lt;p&gt;请求被按顺序、轮流分发到每台服务器，并考虑权重&lt;/p&gt;
&lt;h3 id=&#34;权重weight&#34;&gt;权重（weight）
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;就像我们之前提到过的例子，&lt;code&gt;weight&lt;/code&gt;越高，分配的请求越多&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;此策略适合后端性能不一致的情况（强机多干活）&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;upstream&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;backend_cluster&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;192.168.0.1&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;weight=3&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;192.168.0.2&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;weight=1&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;上例中，第一个服务器将获得大约75%的请求，第二个约25%&lt;/p&gt;
&lt;h3 id=&#34;ip哈希ip_hash&#34;&gt;IP哈希（ip_hash）
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;根据客户端IP地址的哈希值来选择服务器&lt;/strong&gt;，这能确保来自同一个客户端的请求始终被定向到同一台后端服务器&lt;/p&gt;
&lt;p&gt;此策略对于需要保持用户会话状态的应用非常重要&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Nginx&#34; data-lang=&#34;Nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;upstream&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;backend_cluster&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;ip_hash&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;backend1.example.com&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;backend2.example.com&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;最少连接-least_conn&#34;&gt;最少连接 (least_conn)
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;将新请求发送到当前活动连接数最少的服务器&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;此策略在处理耗时不同或长连接较多的请求时，能使负载分布得更加均匀&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Nginx&#34; data-lang=&#34;Nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;upstream&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;backend_cluster&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;least_conn&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;backend1.example.com&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;backend2.example.com&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;核心功能--tcpudp代理&#34;&gt;核心功能 —— TCP/UDP代理
&lt;/h1&gt;&lt;p&gt;Nginx不仅能代理HTTP，还能通过&lt;code&gt;stream&lt;/code&gt;模块在更底层的传输层（TCP/UDP）进行代理&lt;/p&gt;
&lt;p&gt;例如代理数据库连接、游戏服务器、DNS 查询等&lt;/p&gt;
&lt;p&gt;&lt;code&gt;stream&lt;/code&gt;块必须配置在&lt;code&gt;http&lt;/code&gt;块之外，位于主配置文件的顶层，和&lt;code&gt;http&lt;/code&gt;是平级的&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Nginx&#34; data-lang=&#34;Nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;stream&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;upstream&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;mysql_cluster&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;192.168.1.101&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;3306&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;weight=2&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;192.168.1.102&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;3306&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;listen&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;3307&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_pass&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;mysql_cluster&lt;/span&gt;; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_timeout&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;20s&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#c678dd&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;listen&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;53&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;udp&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#c678dd&#34;&gt;proxy_pass&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;8.8.8.8&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;53&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;你可以看到，stream块和http块的写法基本上是一样的，但是细节上还是有些不同：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;stream&lt;/code&gt;块不支持&lt;code&gt;location&lt;/code&gt;，没有路径匹配&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;stream&lt;/code&gt;块不解析协议内容，没有&lt;code&gt;proxy_set_header&lt;/code&gt;，只转发原始TCP/UDP数据流&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;stream&lt;/code&gt;块不支持&lt;code&gt;ip_hash&lt;/code&gt;的负载均衡策略&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;日志分析&#34;&gt;日志分析
&lt;/h1&gt;&lt;h2 id=&#34;为何要分析nginx日志&#34;&gt;为何要分析Nginx日志
&lt;/h2&gt;&lt;p&gt;在现代 Web 架构中，Nginx 作为流量的入口，记录着大量有用的信息&lt;/p&gt;
&lt;p&gt;虽然ELK等日志平台功能强大，但并非所有环境都配备&lt;/p&gt;
&lt;p&gt;掌握底层的命令行分析技巧，能让我们在任何服务器上快速、灵活地定位问题&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;注意&lt;/strong&gt;：&lt;/p&gt;
&lt;p&gt;在处理大型日志文件（如 &amp;gt;1GB）时，应避免直接使用&lt;code&gt;cat&lt;/code&gt;读取整个文件，这会消耗大量内存&lt;/p&gt;
&lt;p&gt;应使用&lt;code&gt;head&lt;/code&gt;,&lt;code&gt;tail&lt;/code&gt;,&lt;code&gt;grep&lt;/code&gt;,&lt;code&gt;sed&lt;/code&gt;,&lt;code&gt;awk&lt;/code&gt;等可以流式处理的工具进行查看修改，或先对日志进行切割&lt;/p&gt;
&lt;p&gt;实在想要看全部，也应该选择使用&lt;code&gt;less&lt;/code&gt;或&lt;code&gt;more&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;日志类型与格式&#34;&gt;日志类型与格式
&lt;/h2&gt;&lt;h3 id=&#34;访问日志accesslog&#34;&gt;访问日志（access.log）
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;access.log&lt;/code&gt;记录了每一个对Nginx服务器的HTTP请求的详细信息&lt;/p&gt;
&lt;h4 id=&#34;默认格式combined--main&#34;&gt;默认格式：combined / main
&lt;/h4&gt;&lt;p&gt;Nginx官方默认格式是&lt;code&gt;combined&lt;/code&gt;，不过现在常见的更多是&lt;code&gt;main&lt;/code&gt;（包括之前我们给出的docker容器的nginx）&lt;/p&gt;
&lt;p&gt;其实&lt;code&gt;main&lt;/code&gt;只是自定义的名字，本质和&lt;code&gt;combined&lt;/code&gt;是类似的，甚至很多公司就是直接copy默认的&lt;code&gt;combined&lt;/code&gt;格式起个名叫&lt;code&gt;main&lt;/code&gt;，但更多的则是增加了一些字段（比如新增&lt;code&gt;$http_x_forwarded_for&lt;/code&gt;字段）&lt;/p&gt;
&lt;p&gt;我们就以上文提到的配置文件示例里的&lt;code&gt;main&lt;/code&gt;格式为例，这也是最为常见的格式之一，理解了就行&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Nginx&#34; data-lang=&#34;Nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;log_format&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;main&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$remote_addr&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$remote_user&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$time_local]&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$request&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$status&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$body_bytes_sent&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$http_referer&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$http_user_agent&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$http_x_forwarded_for&amp;#34;&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;access_log&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;/var/log/nginx/access.log&lt;/span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;main&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;变量名是Nginx内置的变量&lt;/strong&gt;，&lt;strong&gt;不能随意改名字&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;变量&lt;/th&gt;
          &lt;th&gt;解释&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;$remote_addr&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;客户端IP地址&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;$remote_user&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;客户端用户名称&lt;/strong&gt;（用于HTTP认证，通常为&lt;code&gt;-&lt;/code&gt;）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;[$time_local]&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;服务器本地的请求处理完成时间&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;&amp;quot;$request&amp;quot;&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;完整的原始请求行&lt;/strong&gt;，如 &lt;code&gt;&amp;quot;GET /index.html HTTP/1.1&amp;quot;&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;$status&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;HTTP响应状态码&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;$body_bytes_sent&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;发送给客户端的响应体大小&lt;/strong&gt;（字节）&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;&amp;quot;$http_referer&amp;quot;&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;请求的来源页面URL&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;&amp;quot;$http_user_agent&amp;quot;&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;客户端的浏览器、操作系统等信息&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;&lt;code&gt;&amp;quot;$http_x_forwarded_for&amp;quot;&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;（重要）&lt;/strong&gt; 记录了&lt;strong&gt;通过代理服务器访问的客户端真实IP地址&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;来看一个实际的main格式的access.log的条目：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;111.111&lt;/span&gt;.&lt;span style=&#34;color:#d19a66&#34;&gt;111.111&lt;/span&gt; - - [&lt;span style=&#34;color:#d19a66&#34;&gt;28&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;Apr&lt;/span&gt;/&lt;span style=&#34;color:#d19a66&#34;&gt;2021&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;14&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;44&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;11&lt;/span&gt; +&lt;span style=&#34;color:#d19a66&#34;&gt;0800&lt;/span&gt;] &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;GET /api/channel/unread.jsp HTTP/1.1&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;200&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;65&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;https://www.xxxx.cn/&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;Mozilla/5.0...&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;123.123.123.123&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$remote_addr&lt;/code&gt;&lt;/strong&gt;：&lt;code&gt;111.111.111.111&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;这是Nginx看到的客户端IP，可能是负载均衡/代理的IP，不一定是真实用户的IP&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$remote_user&lt;/code&gt;&lt;/strong&gt;：&lt;code&gt;- -&lt;/code&gt;
如果客户端经过了HTTP认证，这里会记录认证用户名，否则为&lt;code&gt;-&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;第一个 &lt;code&gt;-&lt;/code&gt;：远程用户名（几乎不用，常为空）&lt;/li&gt;
&lt;li&gt;第二个 &lt;code&gt;-&lt;/code&gt;：认证用户名（如果用 Basic Auth 才会有）&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$time_local&lt;/code&gt;&lt;/strong&gt;：&lt;code&gt;28/Apr/2021:14:44:11 +0800&lt;/code&gt;
这是Nginx记录的本地时间，时区为+0800（北京时间）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$request&lt;/code&gt;&lt;/strong&gt;：&lt;code&gt;GET /api/channel/unread.jsp HTTP/1.1&lt;/code&gt;
包含请求方法、URL路径和HTTP协议版本&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$status&lt;/code&gt;&lt;/strong&gt;：&lt;code&gt;200&lt;/code&gt;
HTTP状态码，表示请求成功&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$body_bytes_sent&lt;/code&gt;&lt;/strong&gt;：&lt;code&gt;65&lt;/code&gt;
响应体大小（字节数），不包含响应头&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$http_referer&lt;/code&gt;&lt;/strong&gt;：&lt;code&gt;https://www.xxxx.cn/&lt;/code&gt;
请求来源页面，如果用户是从某个页面跳转过来的，这里会显示该页面URL，若没有则为&lt;code&gt;-&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$http_user_agent&lt;/code&gt;&lt;/strong&gt;：&lt;code&gt;Mozilla/5.0...&lt;/code&gt;
客户端的User-Agent，表示浏览器或客户端的标识信息&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$http_x_forwarded_for&lt;/code&gt;&lt;/strong&gt;：&lt;code&gt;123.123.123.123&lt;/code&gt;
代理服务器通过HTTP头传递的真实客户端IP，用来识别经过代理时的原始用户地址&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;这条日志告诉我们：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;在北京时间&lt;code&gt;021-04-28 14:44:11&lt;/code&gt;，有一个客户端访问了接口&lt;code&gt;/api/channel/unread.jsp&lt;/code&gt;，使用的是&lt;code&gt;GET&lt;/code&gt;请求，HTTP版本是&lt;code&gt;1.1&lt;/code&gt;，返回状态码&lt;code&gt;200&lt;/code&gt;（成功），响应大小&lt;code&gt;65&lt;/code&gt;字节，请求来自页面&lt;code&gt;https://www.xxxx.cn/&lt;/code&gt;，使用的客户端是某个&lt;code&gt;Mozilla浏览器/模拟器&lt;/code&gt;，其真实IP是&lt;code&gt;123.123.123.123&lt;/code&gt;，但请求是经过代理，Nginx看到的源IP是&lt;code&gt;111.111.111.111&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&#34;增强的自定义格式json&#34;&gt;增强的自定义格式：JSON
&lt;/h4&gt;&lt;p&gt;为了便于程序（如 Logstash, Fluentd）解析，JSON格式也是目前的主流选择，属于典型的非默认格式&lt;/p&gt;
&lt;p&gt;它的结构清晰，键值对明确，机器解析友好，避免了&lt;code&gt;awk&lt;/code&gt;和&lt;code&gt;cut&lt;/code&gt;对字段位置的强依赖&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;log_format&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;json_analytics&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;escape=json&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;{&lt;span style=&#34;color:#c678dd&#34;&gt;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&amp;#34;timestamp&amp;#34;:&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$time_iso8601&amp;#34;,&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&amp;#34;client_ip&amp;#34;:&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$remote_addr&amp;#34;,&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&amp;#34;request&amp;#34;:&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$request&amp;#34;,&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&amp;#34;status&amp;#34;:&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$status,&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&amp;#34;bytes_sent&amp;#34;:&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$body_bytes_sent,&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&amp;#34;http_referer&amp;#34;:&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$http_referer&amp;#34;,&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&amp;#34;http_user_agent&amp;#34;:&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$http_user_agent&amp;#34;,&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&amp;#34;real_ip&amp;#34;:&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$http_x_forwarded_for&amp;#34;,&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&amp;#34;request_time&amp;#34;:&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;$request_time,&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&amp;#34;upstream_time&amp;#34;:&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;$upstream_response_time&amp;#34;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;}&lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#c678dd&#34;&gt;access_log&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;/var/log/nginx/access.log&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;json_analytics&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;新增字段&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$request_time&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Nginx从接收到请求第一个字节到发送完最后一个字节的总时长（秒），性能指标&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$upstream_response_time&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;从Nginx连接到上游后端服务到接收完响应头的时长，用于判断是 Nginx 慢还是后端服务慢&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;上面一个例子的JSON格式示例如下&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-JSON&#34; data-lang=&#34;JSON&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{&lt;span style=&#34;color:#e06c75&#34;&gt;&amp;#34;timestamp&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;2025-08-16T14:30:00+09:00&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;#34;client_ip&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;111.111.111.111&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;#34;request&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;GET /api/users HTTP/1.1&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;#34;status&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#d19a66&#34;&gt;200&lt;/span&gt;, &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;#34;bytes_sent&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#d19a66&#34;&gt;1500&lt;/span&gt;, &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;#34;http_referer&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;#34;http_user_agent&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;curl/7.68.0&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;#34;real_ip&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;123.123.123.123&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;#34;request_time&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#d19a66&#34;&gt;0.025&lt;/span&gt;, &lt;span style=&#34;color:#e06c75&#34;&gt;&amp;#34;upstream_time&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;0.024&amp;#34;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;JSON日志使用&lt;code&gt;jq&lt;/code&gt;工具可以轻松解析：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;统计状态码为500的请求数量:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cat access.log | jq &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;select(.status == 500)&amp;#39;&lt;/span&gt; | wc -l
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;找出请求时间最长的10个请求：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cat access.log | jq &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;.request_time&amp;#39;&lt;/span&gt; | sort -nr | head -n &lt;span style=&#34;color:#d19a66&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;docker环境下的日志&#34;&gt;Docker环境下的日志
&lt;/h4&gt;&lt;p&gt;上文已经提到过，在Docker中，nginx日志输出到标准输出和标准错误，记录在docker的日志中&lt;/p&gt;
&lt;p&gt;虽然日志本身的格式不会变，但Docker的日志驱动可能（取决于设置）会在每行日志前添加额外信息：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;[时间戳]&lt;/span&gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;日志流&lt;/span&gt;] [&lt;span style=&#34;color:#e06c75&#34;&gt;原始日志内容&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;字段&lt;/th&gt;
          &lt;th&gt;含义&lt;/th&gt;
          &lt;th&gt;示例&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;时间戳&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;Docker记录该日志的时间，精确到纳秒&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;2025-08-20T02:30:00.123456789Z&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;日志流&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;指明日志来源：&lt;br /&gt;标准输出：&lt;code&gt;stdout&lt;/code&gt;，对应访问日志&lt;br /&gt;标准错误：stderr`，对应错误日志&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;stdout&lt;/code&gt;或&lt;code&gt;stderr&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;实际Docker日志示例（还是上面的例子）&lt;/strong&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;2025&lt;/span&gt;-&lt;span style=&#34;color:#d19a66&#34;&gt;08&lt;/span&gt;-&lt;span style=&#34;color:#d19a66&#34;&gt;16&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;T05&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;45&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;01.123456789&lt;/span&gt;&lt;span style=&#34;color:#e06c75&#34;&gt;Z&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;stdout&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;F&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;111.111&lt;/span&gt;.&lt;span style=&#34;color:#d19a66&#34;&gt;111.111&lt;/span&gt; - - [&lt;span style=&#34;color:#d19a66&#34;&gt;28&lt;/span&gt;/&lt;span style=&#34;color:#e06c75&#34;&gt;Apr&lt;/span&gt;/&lt;span style=&#34;color:#d19a66&#34;&gt;2021&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;14&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;44&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;11&lt;/span&gt; +&lt;span style=&#34;color:#d19a66&#34;&gt;0800&lt;/span&gt;] &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;GET /api/channel/unread.jsp HTTP/1.1&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;200&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;65&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;https://www.xxxx.cn/&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;Mozilla/5.0...&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;123.123.123.123&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;2025-08-16T05:45:01.123456789Z&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Docker捕获日志的UTC时间（纳秒精度）&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;stdout F&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;日志来源是stdout，并且标记为F，表示一行完整日志&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;此外还有P标记，示这是多行日志的一部分，被拆分了，需要和后续/前面的片段合并&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;可以直接通过管道分析&lt;code&gt;docker logs&lt;/code&gt;的输出，但通常会配置Docker的日志驱动将这些日志流自动转发到集中的日志管理平台进行统一分析&lt;/p&gt;
&lt;p&gt;比如，&lt;strong&gt;统计客户端IP出现次数的前10：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker logs nginx | awk &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;{print $4}&amp;#39;&lt;/span&gt; | sort | uniq -c | sort -nr | head -n &lt;span style=&#34;color:#d19a66&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;错误日志errorlog&#34;&gt;错误日志（error.log）
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;error.log&lt;/code&gt; 记录 Nginx 启动和运行过程中的诊断信息，是排查问题的关键。&lt;/p&gt;
&lt;h4 id=&#34;一般格式&#34;&gt;一般格式
&lt;/h4&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;时间戳 [错误级别] pid#tid: *cid 错误描述, client: 客户端IP, server: 服务端, request: &amp;#34;请求行&amp;#34;, host: &amp;#34;Host&amp;#34;
&lt;/code&gt;&lt;/pre&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;字段&lt;/th&gt;
          &lt;th&gt;说明&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;时间戳&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;错误发生时间&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;[错误级别]&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;当前条目错误的错误等级，具体看：&lt;a class=&#34;link&#34; href=&#34;#%e5%85%a8%e5%b1%80%e5%9d%97&#34; &gt;错误等级
    
&lt;/a&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;pid#tid&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;Nginx工作进程ID和线程ID&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;*&lt;strong&gt;cid&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;客户端连接序列号&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;错误描述&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;具体的错误信息，例如&lt;code&gt;connect() to 127.0.0.1:9000 failed (13: Permission denied)&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;client&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;发生错误的客户端IP&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;server&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;请求的服务端&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;request&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;请求行，如&amp;quot;GET /api HTTP/1.1&amp;quot;`&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;host&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;客户端请求的目标主机名&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;具体示例：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-kotlin&#34; data-lang=&#34;kotlin&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#d19a66&#34;&gt;2025&lt;/span&gt;/&lt;span style=&#34;color:#d19a66&#34;&gt;08&lt;/span&gt;/&lt;span style=&#34;color:#d19a66&#34;&gt;16&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;14&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;35&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;00&lt;/span&gt; [&lt;span style=&#34;color:#e06c75&#34;&gt;crit&lt;/span&gt;] &lt;span style=&#34;color:#d19a66&#34;&gt;12345&lt;/span&gt;#&lt;span style=&#34;color:#d19a66&#34;&gt;12345&lt;/span&gt;: *&lt;span style=&#34;color:#d19a66&#34;&gt;6789&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;connect&lt;/span&gt;() &lt;span style=&#34;color:#e06c75&#34;&gt;to&lt;/span&gt; &lt;span style=&#34;color:#d19a66&#34;&gt;127.0&lt;/span&gt;.&lt;span style=&#34;color:#d19a66&#34;&gt;0.1&lt;/span&gt;:&lt;span style=&#34;color:#d19a66&#34;&gt;9000&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;failed&lt;/span&gt; (&lt;span style=&#34;color:#d19a66&#34;&gt;13&lt;/span&gt;: &lt;span style=&#34;color:#e06c75&#34;&gt;Permission&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;denied&lt;/span&gt;) &lt;span style=&#34;color:#c678dd&#34;&gt;while&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;connecting&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;to&lt;/span&gt; &lt;span style=&#34;color:#e06c75&#34;&gt;upstream&lt;/span&gt;, &lt;span style=&#34;color:#e06c75&#34;&gt;client&lt;/span&gt;: &lt;span style=&#34;color:#d19a66&#34;&gt;192.168&lt;/span&gt;.&lt;span style=&#34;color:#d19a66&#34;&gt;1.10&lt;/span&gt;, &lt;span style=&#34;color:#e06c75&#34;&gt;server&lt;/span&gt;: &lt;span style=&#34;color:#e06c75&#34;&gt;example&lt;/span&gt;.&lt;span style=&#34;color:#e06c75&#34;&gt;com&lt;/span&gt;, &lt;span style=&#34;color:#e06c75&#34;&gt;request&lt;/span&gt;: &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;GET /api HTTP/1.1&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e06c75&#34;&gt;host&lt;/span&gt;: &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;example.com&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;时间戳&lt;/strong&gt;：&lt;code&gt;2025/08/16 14:35:00&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;错误级别&lt;/strong&gt;：&lt;code&gt;crit&lt;/code&gt;（严重错误）&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;pid#tid&lt;/strong&gt;：&lt;code&gt;12345#12345&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;*&lt;strong&gt;cid&lt;/strong&gt;：&lt;code&gt;*6789&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;错误描述&lt;/strong&gt;：&lt;code&gt;connect() to 127.0.0.1:9000 failed (13: Permission denied) while connecting to upstream&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;客户端&lt;/strong&gt;：&lt;code&gt;192.168.1.10&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;服务端&lt;/strong&gt;：&lt;code&gt;example.com&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;请求&lt;/strong&gt;：&lt;code&gt;&amp;quot;GET /api HTTP/1.1&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Host&lt;/strong&gt;：&lt;code&gt;example.com&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;分析&lt;/strong&gt;：&lt;/p&gt;
&lt;p&gt;客户端&lt;code&gt;192.168.1.10&lt;/code&gt;请求 &lt;code&gt;/api&lt;/code&gt;接口时，Nginx尝试连接上游服务&lt;code&gt;127.0.0.1:9000&lt;/code&gt;失败，原因是权限被拒绝（&lt;code&gt;Permission denied&lt;/code&gt;）。日志级别为 &lt;code&gt;crit&lt;/code&gt;，说明这是严重错误，需要检查Nginx或上游服务的权限设置&lt;/p&gt;
&lt;h2 id=&#34;分析技巧&#34;&gt;分析技巧
&lt;/h2&gt;&lt;h3 id=&#34;网站流量核心指标分析-pv--uv&#34;&gt;网站流量核心指标分析 (PV &amp;amp; UV)
&lt;/h3&gt;&lt;p&gt;PV (Page View，页面浏览量) 和 UV (Unique Visitor，独立访客) 是衡量网站价值和用户行为趋势的重要指标&lt;/p&gt;
&lt;h4 id=&#34;统计总uv-根据ip&#34;&gt;统计总UV (根据IP)
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;提取第1个字段(IP)，排序，去重，最后统计独立IP总数：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;awk &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;{print $1}&amp;#39;&lt;/span&gt; access.log | sort | uniq | wc -l
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;统计总pv&#34;&gt;统计总PV
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;直接统计日志总行数即为PV：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wc -l access.log
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;统计某时间段的uv--pv&#34;&gt;统计某时间段的UV / PV
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;统计2021年4月28日14:00-14:59的UV：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;grep &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;28/Apr/2021:14&amp;#34;&lt;/span&gt; access.log | awk &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;{print $1}&amp;#39;&lt;/span&gt; | sort | uniq | wc -l
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;使用sed进行更精确的时间段筛选 (14点到20点)：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sed -n &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;/28\/Apr\/2021:14/,/28\/Apr\/2021:20/p&amp;#39;&lt;/span&gt; access.log | awk &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;{print $1}&amp;#39;&lt;/span&gt; | sort | uniq | wc -l
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;访问来源与异常排查-ip--url&#34;&gt;访问来源与异常排查 (IP &amp;amp; URL)
&lt;/h3&gt;&lt;p&gt;用于判断是否被攻击、接口是否存在Bug或排查流量报警&lt;/p&gt;
&lt;h4 id=&#34;查询访问最频繁的top-10-url&#34;&gt;查询访问最频繁的Top 10 URL
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;提取第7字段(URL)，排序，去重并计数，按计数值倒序排列:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;awk &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;{print $7}&amp;#39;&lt;/span&gt; access.log | sort | uniq -c | sort -k1 -nr | head -n &lt;span style=&#34;color:#d19a66&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;查询访问最频繁的top-10-ip&#34;&gt;查询访问最频繁的Top 10 IP
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;awk &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;{print $1}&amp;#39;&lt;/span&gt; access.log | sort | uniq -c | sort -k1 -nr | head -n &lt;span style=&#34;color:#d19a66&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;查看指定ip在某天访问了哪些-url-top-10&#34;&gt;查看指定IP在某天访问了哪些 URL (Top 10)
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;grep &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;111.111.111.111&amp;#34;&lt;/span&gt; access.log | grep &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#34;28/Apr/2021&amp;#34;&lt;/span&gt; | awk &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;{print $7}&amp;#39;&lt;/span&gt; | sort | uniq -c | sort -nr | head -n &lt;span style=&#34;color:#d19a66&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;性能与爬虫分析&#34;&gt;性能与爬虫分析
&lt;/h3&gt;&lt;h4 id=&#34;统计爬取次数&#34;&gt;统计爬取次数
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;grep -i &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;spider\|bot&amp;#39;&lt;/span&gt; access.log | wc -l
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;统计每分钟每秒的请求数-top-20&#34;&gt;统计每分钟/每秒的请求数 (Top 20)
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;每分钟: 截取时间字段($4)的第2到18位(到分钟)&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;awk &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;{print $4}&amp;#39;&lt;/span&gt; access.log | cut -c 2-18 | sort | uniq -c | sort -nr | head -n &lt;span style=&#34;color:#d19a66&#34;&gt;20&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;每秒: 截取时间字段($4)的第2到21位(到秒)&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;awk &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;{print $4}&amp;#39;&lt;/span&gt; access.log | cut -c 2-21 | sort | uniq -c | sort -nr | head -n &lt;span style=&#34;color:#d19a66&#34;&gt;20&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;分析请求响应时间-需自定义日志格式&#34;&gt;分析请求响应时间 (需自定义日志格式)
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;前提&lt;/strong&gt;: 确保&lt;code&gt;log_format&lt;/code&gt;中包含了&lt;code&gt;$request_time&lt;/code&gt;，我们假设它在最后一个字段&lt;/p&gt;
&lt;h4 id=&#34;列出传输时间超过3秒的top10请求&#34;&gt;列出传输时间超过3秒的Top10请求
&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;$NF代表最后一个字段，此命令筛选出最后一个字段值大于3的行：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-Bash&#34; data-lang=&#34;Bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;awk &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;$NF &amp;gt; 3 {print $NF, $7}&amp;#39;&lt;/span&gt; access.log | sort -k1 -nr | head -n &lt;span style=&#34;color:#d19a66&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;列出最耗时的top10请求&#34;&gt;列出最耗时的Top10请求
&lt;/h4&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;awk &lt;span style=&#34;color:#98c379&#34;&gt;&amp;#39;{print $NF, $7}&amp;#39;&lt;/span&gt; access.log | sort -k1 -nr | head -n &lt;span style=&#34;color:#d19a66&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;p&gt;暂时就先讲到这，毕竟只是入个门，详细使用就在实践里面学习吧&lt;/p&gt;
&lt;p&gt;如果之后我需要更加深入使用，这篇文章也会更新的~&lt;/p&gt;
</description>
        </item>
        
    </channel>
</rss>
