<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="还是apache好用">
<title>Nginx入门</title>

<link rel='canonical' href='https://blog.928330.xyz/p/nginx%E5%85%A5%E9%97%A8/'>

<link rel="stylesheet" href="/scss/style.min.60a81f0594ef6ff2fa30e499c69cfabbd0c1852d103f3dade10926efce182fdb.css"><meta property='og:title' content="Nginx入门">
<meta property='og:description' content="还是apache好用">
<meta property='og:url' content='https://blog.928330.xyz/p/nginx%E5%85%A5%E9%97%A8/'>
<meta property='og:site_name' content='kakahuote'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='web' /><meta property='article:tag' content='server' /><meta property='article:published_time' content='2025-07-24T22:15:30&#43;08:00'/><meta property='article:modified_time' content='2025-08-24T21:42:35&#43;08:00'/><meta property='og:image' content='http://picture.928330.xyz/typora/94b5f0d5aceb41498d7d03bcff81ecf5.jpeg' />
<meta name="twitter:title" content="Nginx入门">
<meta name="twitter:description" content="还是apache好用"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='http://picture.928330.xyz/typora/94b5f0d5aceb41498d7d03bcff81ecf5.jpeg' />
    <link rel="shortcut icon" href="/favicon.ico" />
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>加载动画</title>
    <style>
        .loading {
            position: fixed;
            display: flex;
            flex-direction: column;  
            justify-content: center;
            align-items: center;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 99;
            background-color: #f5f5fa;
            transition: transform 1.5s, opacity 1.5s;
            transform: scale(1);
            opacity: 1;
        }

        .loader-bars {
            display: flex;  
            align-items: flex-end;  
            gap: 3px;  
            margin-bottom: 20px;  
        }

        .bar {
            height: 5px;
            width: 12px;
            animation-duration: 0.45s;
            animation-name: changeHeight;
            animation-iteration-count: infinite;
            animation-direction: alternate;
        }

        .red {
            background-color: #E50000;
            box-shadow: 1px 1px 10px #E50000;
            animation-delay: 0.10s;
        }

        .orange {
            background-color: #FF8D00;
            box-shadow: 1px 1px 10px #FF8D00;
            animation-delay: 0.20s;
        }

        .yellow {
            background-color: #FFEE00;
            box-shadow: 1px 1px 10px #FFEE00;
            animation-delay: 0.25s;
        }

        .green {
            background-color: #008121;
            box-shadow: 1px 1px 10px #008121;
            animation-delay: 0.30s;
        }

        .blue {
            background-color: #004CFF;
            box-shadow: 1px 1px 10px #004CFF;
            animation-delay: 0.35s;
        }

        .violet {
            background-color: #760188;
            box-shadow: 1px 1px 10px #760188;
            animation-delay: 0.40s;
        }

        @keyframes changeHeight {
            from {
                height: 5px;
            }

            to {
                height: 40px;
            }
        }

        .scaleAndFadeout {
            transform: scale(1.5);
            opacity: 0;
        }

         
        .loading-text {
            color: #333;  
            font-size: 16px;  
        }
    </style>
</head>
<body>

    <div class="loading">
        <div class="loader-bars">
            <div class="red bar"></div>
            <div class="orange bar"></div>
            <div class="yellow bar"></div>
            <div class="green bar"></div>
            <div class="blue bar"></div>
            <div class="violet bar"></div>
        </div>
        <div class="loading-text">loading...</div>
    </div>

    <script>
        function initLoading() {
            let loading = document.querySelector(".loading");
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(() => {
                    loading.classList.add("scaleAndFadeout");
                    setTimeout(() => {
                        loading.style.display = "none";
                    }, 1500);
                }, 50);
            });
        }

        initLoading();
    </script>

</body>
</html>
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/" id="avatar-link">
                
                    
                    
                    
                        
                        <img class="site-logo original-logo" src="/img/avatar_hu_4804467f7cda2058.png" width="300" height="300" loading="lazy" alt="原始头像">
                    
                    
                        
                        <img class="site-logo hover-logo" src="/img/avatar-hover_hu_f231304c77e946da.png" width="300" height="300" loading="lazy" alt="悬停头像">
                    
                
                </a>
                
                    <span class="emoji">🤝</span>
                
            </figure>
            
        

        <div class="site-meta">
            <h1 class="site-name"><a href="/">kakahuote</a></h1>
            <h2 class="site-description">靡不有初，鲜克有终</h2>
        </div>
    </header>

    <ol class="menu-social">
                <li>
                    <a
                        href='https://bilibili.com'
                        target="_blank"
                        title="bilibili"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-brand-bilibili"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 10a4 4 0 0 1 4 -4h10a4 4 0 0 1 4 4v6a4 4 0 0 1 -4 4h-10a4 4 0 0 1 -4 -4v-6z" /><path d="M8 3l2 3" /><path d="M16 3l-2 3" /><path d="M9 13v-2" /><path d="M15 11v2" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a
                        href='https://github.com'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            </ol>

    <ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>主页</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>归档</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>搜索</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%8F%8B%E9%93%BE/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>友链</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>暗色模式</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>
    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#什么是nginx">什么是Nginx</a></li>
    <li><a href="#主要用法">主要用法</a>
      <ol>
        <li><a href="#web服务器">Web服务器</a></li>
        <li><a href="#反向代理服务器">反向代理服务器</a></li>
        <li><a href="#负载均衡器">负载均衡器</a></li>
        <li><a href="#api网关">API网关</a></li>
      </ol>
    </li>
    <li><a href="#目录结构">目录结构</a>
      <ol>
        <li><a href="#不同来源">不同来源</a>
          <ol>
            <li><a href="#官方nginx包从-nginxorg">官方Nginx包（从 nginx.org）</a></li>
            <li><a href="#源码编译安装">源码编译安装</a></li>
            <li><a href="#debianubuntu官方仓库">Debian/Ubuntu官方仓库</a></li>
            <li><a href="#centosrhel官方仓库">CentOS/RHEL官方仓库</a></li>
            <li><a href="#docker镜像官方-nginx">Docker镜像（官方 Nginx）</a></li>
          </ol>
        </li>
        <li><a href="#一些问题">一些问题</a>
          <ol>
            <li><a href="#日志文件">日志文件</a></li>
            <li><a href="#配置文件">配置文件</a></li>
            <li><a href="#web-根目录">Web 根目录</a></li>
            <li><a href="#systemd的位置">systemd的位置</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#常用命令">常用命令</a>
      <ol>
        <li><a href="#查看版本">查看版本</a></li>
        <li><a href="#检查配置文件语法">检查配置文件语法</a></li>
        <li><a href="#重新加载配置文件">重新加载配置文件</a></li>
        <li><a href="#强制停止">强制停止</a></li>
      </ol>
    </li>
    <li><a href="#配置文件-1">配置文件</a>
      <ol>
        <li><a href="#全局块">全局块</a></li>
        <li><a href="#events块">events块</a></li>
        <li><a href="#http块">http块</a></li>
        <li><a href="#server块">server块</a></li>
        <li><a href="#location块">location块</a></li>
      </ol>
    </li>
    <li><a href="#核心功能--web服务">核心功能 —— Web服务</a>
      <ol>
        <li><a href="#部署静态资源">部署静态资源</a></li>
        <li><a href="#url重写与跳转">URL重写与跳转</a>
          <ol>
            <li><a href="#rewrite">rewrite</a>
              <ol>
                <li><a href="#基本语法">基本语法</a></li>
                <li><a href="#伪静态处理">伪静态处理</a></li>
                <li><a href="#隐藏真实路径">隐藏真实路径</a></li>
              </ol>
            </li>
            <li><a href="#return">return</a>
              <ol>
                <li><a href="#基本语法-1">基本语法</a></li>
                <li><a href="#http强制跳转https">HTTP强制跳转HTTPS</a></li>
                <li><a href="#禁止访问某个目录">禁止访问某个目录</a></li>
                <li><a href="#简洁跳转到首页">简洁跳转到首页</a></li>
                <li><a href="#纯文本响应">纯文本响应</a></li>
              </ol>
            </li>
          </ol>
        </li>
        <li><a href="#配置https服务">配置HTTPS服务</a></li>
      </ol>
    </li>
    <li><a href="#核心功能--反向代理">核心功能 —— 反向代理</a></li>
    <li><a href="#核心功能--负载均衡">核心功能 —— 负载均衡</a>
      <ol>
        <li><a href="#http负载均衡配置">HTTP负载均衡配置</a>
          <ol>
            <li><a href="#负载均衡策略">负载均衡策略</a></li>
            <li><a href="#轮询">轮询</a></li>
            <li><a href="#权重weight">权重（weight）</a></li>
            <li><a href="#ip哈希ip_hash">IP哈希（ip_hash）</a></li>
            <li><a href="#最少连接-least_conn">最少连接 (least_conn)</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#核心功能--tcpudp代理">核心功能 —— TCP/UDP代理</a></li>
    <li><a href="#日志分析">日志分析</a>
      <ol>
        <li><a href="#为何要分析nginx日志">为何要分析Nginx日志</a></li>
        <li><a href="#日志类型与格式">日志类型与格式</a>
          <ol>
            <li><a href="#访问日志accesslog">访问日志（access.log）</a>
              <ol>
                <li><a href="#默认格式combined--main">默认格式：combined / main</a></li>
                <li><a href="#增强的自定义格式json">增强的自定义格式：JSON</a></li>
                <li><a href="#docker环境下的日志">Docker环境下的日志</a></li>
              </ol>
            </li>
            <li><a href="#错误日志errorlog">错误日志（error.log）</a>
              <ol>
                <li><a href="#一般格式">一般格式</a></li>
              </ol>
            </li>
          </ol>
        </li>
        <li><a href="#分析技巧">分析技巧</a>
          <ol>
            <li><a href="#网站流量核心指标分析-pv--uv">网站流量核心指标分析 (PV &amp; UV)</a>
              <ol>
                <li><a href="#统计总uv-根据ip">统计总UV (根据IP)</a></li>
                <li><a href="#统计总pv">统计总PV</a></li>
                <li><a href="#统计某时间段的uv--pv">统计某时间段的UV / PV</a></li>
              </ol>
            </li>
            <li><a href="#访问来源与异常排查-ip--url">访问来源与异常排查 (IP &amp; URL)</a>
              <ol>
                <li><a href="#查询访问最频繁的top-10-url">查询访问最频繁的Top 10 URL</a></li>
                <li><a href="#查询访问最频繁的top-10-ip">查询访问最频繁的Top 10 IP</a></li>
                <li><a href="#查看指定ip在某天访问了哪些-url-top-10">查看指定IP在某天访问了哪些 URL (Top 10)</a></li>
              </ol>
            </li>
            <li><a href="#性能与爬虫分析">性能与爬虫分析</a>
              <ol>
                <li><a href="#统计爬取次数">统计爬取次数</a></li>
                <li><a href="#统计每分钟每秒的请求数-top-20">统计每分钟/每秒的请求数 (Top 20)</a></li>
              </ol>
            </li>
            <li><a href="#分析请求响应时间-需自定义日志格式">分析请求响应时间 (需自定义日志格式)</a>
              <ol>
                <li><a href="#列出传输时间超过3秒的top10请求">列出传输时间超过3秒的Top10请求</a></li>
                <li><a href="#列出最耗时的top10请求">列出最耗时的Top10请求</a></li>
              </ol>
            </li>
          </ol>
        </li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/nginx%E5%85%A5%E9%97%A8/">
                
                    <img src="http://picture.928330.xyz/typora/94b5f0d5aceb41498d7d03bcff81ecf5.jpeg" loading="lazy" alt="Featured image of post Nginx入门" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/" >
                工具使用
            </a>
        
    </header>
    

    <div class="article-title-wrapper">


        <h2 class="article-title">
            <a href="/p/nginx%E5%85%A5%E9%97%A8/">Nginx入门</a>
        </h2>
        
        <h3 class="article-subtitle">
            还是apache好用
        </h3>
        

    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">
                    发布时间：2025-07-24</time>
            </div>
        

        

        <div class="article-lastmod">
               <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



               <time>
                   更新时间：2025-08-24
               </time>
           </div>
        <div>
            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-eye"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" /><path d="M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6" /></svg>
            <time class="article-time--published">
                浏览量：<span class="waline-pageview-count" data-waline-pageview-count="0">0</span>
            </time>
        </div>
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p>开玩笑的，其实nginx和apache一样好用</p>
<p>apache移步：<a class="link" href="http://blog.928330.xyz/p/apache%E5%85%A5%E9%97%A8/"  target="_blank" rel="noopener"
    >Apache入门
    
    <span style="white-space: nowrap;"><svg width=".7em"
        height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
        <path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
        <path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
            fill="currentColor">
    </svg></span>
    
</a></p>
<h1 id="什么是nginx">什么是Nginx
</h1><p>Nginx（发音为 &ldquo;engine-X&rdquo;）是一款开源的、高性能的HTTP和反向代理服务器</p>
<p>它的设计哲学是提供极致的性能、稳定性、丰富的功能、简单的配置和低资源消耗，看上去就很厉害</p>
<p>Nginx采用事件驱动的异步非阻塞架构</p>
<p>与传统的Apache等服务器为每个请求创建一个新进程或线程不同，Nginx使用一个主进程和少数几个工作进程</p>
<p>主进程负责读取配置、管理工作进程，而真正处理网络请求的是工作进程</p>
<p>每个工作进程都是单线程的，异步地处理成千上万个并发连接</p>
<p>这种模型避免了创建和销毁进程/线程的开销以及上下文切换的成本，因此能以极低的内存占用应对高并发场景</p>
<p><strong>接下来我们会介绍直接安装的Nginx，也会顺带介绍通过Docker容器启动的Nginx</strong></p>
<p><strong>二者在活动状态控制和日志方面有些区别，配置基本一致</strong></p>
<h1 id="主要用法">主要用法
</h1><h2 id="web服务器">Web服务器
</h2><p>直接向客户端提供静态资源（如HTML、CSS、图片）的服务</p>
<p>由于其高效的文件读取和网络传输能力，Nginx在处理静态内容方面表现极其出色,<del>适合搭建博客</del></p>
<h2 id="反向代理服务器">反向代理服务器
</h2><p>它是是客户端和后端真实服务器之间的中间人</p>
<p>它可以将客户端请求转发到后端的应用服务器（如Node.js、Java、Python应用），并将后端响应返回给客户端，从而实现请求分发、负载均衡，并能隐藏后端服务的真实IP和端口，提升安全性</p>
<h2 id="负载均衡器">负载均衡器
</h2><p>当后端有多台服务器时，Nginx可以根据预设的策略将请求分发到这些服务器上，从而分担单一服务器的压力</p>
<h2 id="api网关">API网关
</h2><p>在微服务架构中，Nginx可以作为所有API请求的统一入口，执行如身份验证、速率限制、日志记录、服务发现等通用功能</p>
<h1 id="目录结构">目录结构
</h1><h2 id="不同来源">不同来源
</h2><p><strong>通过不同方式安装的nginx的默认目录结构都会有所差别</strong></p>
<h3 id="官方nginx包从-nginxorg">官方Nginx包（从 nginx.org）
</h3><p>从Nginx下载官方提供的<code>.rpm/.deb</code>包安装</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#c678dd">/</span>                                                                 <span style="color:#7f848e"># 根目录
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">├──</span> <span style="color:#98c379">etc/</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">│</span>   <span style="color:#98c379">└──</span> <span style="color:#98c379">nginx/</span>                                           <span style="color:#7f848e"># 配置文件目录
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>       <span style="color:#98c379">├──</span> <span style="color:#98c379">nginx.conf</span>                                <span style="color:#7f848e"># 主配置文件（Nginx 的核心配置）
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>       <span style="color:#98c379">├──</span> <span style="color:#98c379">mime.types</span>                              <span style="color:#7f848e"># MIME类型映射表
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>       <span style="color:#98c379">└──</span> <span style="color:#98c379">conf.d/</span>                                     <span style="color:#7f848e"># 子配置目录（用于虚拟主机）
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>           <span style="color:#98c379">└──</span> <span style="color:#98c379">default.conf</span>                          <span style="color:#7f848e"># 默认网站配置文件
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">├──</span> <span style="color:#98c379">usr/</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">│</span>   <span style="color:#98c379">├──</span> <span style="color:#98c379">sbin/</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">│</span>   <span style="color:#98c379">│</span>   <span style="color:#98c379">└──</span> <span style="color:#98c379">nginx</span>                                       <span style="color:#7f848e"># 主程序二进制文件
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>   <span style="color:#98c379">└──</span> <span style="color:#98c379">share/</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">│</span>       <span style="color:#98c379">└──</span> <span style="color:#98c379">nginx/</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">│</span>           <span style="color:#98c379">└──</span> <span style="color:#98c379">html/</span>                                  <span style="color:#7f848e"># 默认 Web 根目录
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>               <span style="color:#98c379">├──</span> <span style="color:#98c379">index.html</span>                      <span style="color:#7f848e"># 默认欢迎页面
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>               <span style="color:#98c379">└──</span> <span style="color:#98c379">50x.html</span>                        <span style="color:#7f848e"># 服务器错误页面（如 500、502）
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">├──</span> <span style="color:#98c379">var/</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">│</span>   <span style="color:#98c379">└──</span> <span style="color:#98c379">log/</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">│</span>       <span style="color:#98c379">└──</span> <span style="color:#98c379">nginx/</span>                                    <span style="color:#7f848e"># 日志文件目录
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>           <span style="color:#98c379">├──</span> <span style="color:#98c379">access.log</span>                           <span style="color:#7f848e"># 访问日志
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>           <span style="color:#98c379">└──</span> <span style="color:#98c379">error.log</span>                             <span style="color:#7f848e"># 错误日志
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">└──</span> <span style="color:#98c379">lib/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#98c379">└──</span> <span style="color:#98c379">systemd/</span>                                    <span style="color:#7f848e"># 服务管理相关
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>        <span style="color:#98c379">└──</span> <span style="color:#98c379">system/</span>                                   <span style="color:#7f848e"># Nginx systemd 配置
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>              <span style="color:#98c379">└──</span> <span style="color:#98c379">nginx.service</span>
</span></span></code></pre></div><h3 id="源码编译安装">源码编译安装
</h3><p>从Nginx官方下载源码<code>.tar.gz</code>，自己编译安装</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#c678dd">/</span>                                                               <span style="color:#7f848e"># 根目录
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">└──</span> <span style="color:#98c379">usr/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#98c379">└──</span> <span style="color:#98c379">local/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#98c379">└──</span> <span style="color:#98c379">nginx/</span>
</span></span><span style="display:flex;"><span>            <span style="color:#98c379">├──</span> <span style="color:#98c379">sbin/</span>
</span></span><span style="display:flex;"><span>            <span style="color:#98c379">│</span>   <span style="color:#98c379">└──</span> <span style="color:#98c379">nginx</span>                              <span style="color:#7f848e"># 主程序二进制文件
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>            <span style="color:#98c379">├──</span> <span style="color:#98c379">conf/</span>
</span></span><span style="display:flex;"><span>            <span style="color:#98c379">│</span>   <span style="color:#98c379">├──</span> <span style="color:#98c379">nginx.conf</span>                       <span style="color:#7f848e"># 主配置文件
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>            <span style="color:#98c379">│</span>   <span style="color:#98c379">├──</span> <span style="color:#98c379">mime.types</span>                     <span style="color:#7f848e"># MIME类型映射表
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>            <span style="color:#98c379">│</span>   <span style="color:#98c379">└──</span> <span style="color:#98c379">conf.d/</span>                            <span style="color:#7f848e"># 子配置目录
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>            <span style="color:#98c379">│</span>       <span style="color:#98c379">└──</span> <span style="color:#98c379">default.conf</span>                <span style="color:#7f848e"># 默认网站配置文件
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>            <span style="color:#98c379">├──</span> <span style="color:#98c379">html/</span>                                    <span style="color:#7f848e"># 默认 Web 根目录
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>            <span style="color:#98c379">│</span>   <span style="color:#98c379">├──</span> <span style="color:#98c379">index.html</span>                       <span style="color:#7f848e"># 默认欢迎页面
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>            <span style="color:#98c379">│</span>   <span style="color:#98c379">└──</span> <span style="color:#98c379">50x.html</span>                          <span style="color:#7f848e"># 服务器错误页面
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>            <span style="color:#98c379">└──</span> <span style="color:#98c379">logs/</span>                                     <span style="color:#7f848e"># 日志文件目录
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>                <span style="color:#98c379">├──</span> <span style="color:#98c379">access.log</span>                         <span style="color:#7f848e"># 访问日志
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>                <span style="color:#98c379">└──</span> <span style="color:#98c379">error.log</span>                            <span style="color:#7f848e"># 错误日志
</span></span></span></code></pre></div><h3 id="debianubuntu官方仓库">Debian/Ubuntu官方仓库
</h3><p>通过<code>apt</code>安装</p>
<p><strong>虽然<code>apt</code>也是调用<code>dpkg</code>安装<code>.deb</code>包，但debian/ubuntu维护的<code>.deb</code>包和官方打包的不太一样，因此web根目录等等路径和直接使用官方包安装会有所差别</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#c678dd">/</span>                                                                 <span style="color:#7f848e"># 根目录
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">├──</span> <span style="color:#98c379">etc/</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">│</span>   <span style="color:#98c379">└──</span> <span style="color:#98c379">nginx/</span>                                           <span style="color:#7f848e"># 配置文件目录
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>       <span style="color:#98c379">├──</span> <span style="color:#98c379">nginx.conf</span>                                <span style="color:#7f848e"># 主配置文件
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>       <span style="color:#98c379">├──</span> <span style="color:#98c379">mime.types</span>                              <span style="color:#7f848e"># MIME类型映射表
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>       <span style="color:#98c379">└──</span> <span style="color:#98c379">conf.d/</span>                                     <span style="color:#7f848e"># 子配置目录
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>           <span style="color:#98c379">└──</span> <span style="color:#98c379">default.conf</span>                         <span style="color:#7f848e"># 默认网站配置文件
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">├──</span> <span style="color:#98c379">usr/</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">│</span>   <span style="color:#98c379">└──</span> <span style="color:#98c379">sbin/</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">│</span>       <span style="color:#98c379">└──</span> <span style="color:#98c379">nginx</span>                                       <span style="color:#7f848e"># 主程序二进制文件
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span> 
</span></span><span style="display:flex;"><span><span style="color:#98c379">├──</span> <span style="color:#98c379">var/</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">│</span>   <span style="color:#98c379">├──</span> <span style="color:#98c379">www/</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">│</span>   <span style="color:#98c379">│</span>   <span style="color:#98c379">└──</span> <span style="color:#98c379">html/</span>                                      <span style="color:#7f848e"># 默认 Web 根目录
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>   <span style="color:#98c379">│</span>       <span style="color:#98c379">├──</span> <span style="color:#98c379">index.html</span>                          <span style="color:#7f848e"># 默认欢迎页面
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>   <span style="color:#98c379">│</span>       <span style="color:#98c379">└──</span> <span style="color:#98c379">50x.html</span>                             <span style="color:#7f848e"># 服务器错误页面
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>   <span style="color:#98c379">└──</span> <span style="color:#98c379">log/</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">│</span>       <span style="color:#98c379">└──</span> <span style="color:#98c379">nginx/</span>                                      <span style="color:#7f848e"># 日志文件目录
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>           <span style="color:#98c379">├──</span> <span style="color:#98c379">access.log</span>                            <span style="color:#7f848e"># 访问日志
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>           <span style="color:#98c379">└──</span> <span style="color:#98c379">error.log</span>                              <span style="color:#7f848e"># 错误日志
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">└──</span> <span style="color:#98c379">lib/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#98c379">└──</span> <span style="color:#98c379">systemd/</span>                                     <span style="color:#7f848e"># 服务管理相关
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>        <span style="color:#98c379">└──</span> <span style="color:#98c379">system/</span>                                   <span style="color:#7f848e"># Nginx systemd 配置
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>              <span style="color:#98c379">└──</span> <span style="color:#98c379">nginx.service</span>
</span></span></code></pre></div><h3 id="centosrhel官方仓库">CentOS/RHEL官方仓库
</h3><p>通过<code>yum</code>/<code>dnf</code>安装</p>
<p><strong>路径、配置和布局就是官方Nginx提供的.rmp包规范的结构，所以和第一种很像</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#c678dd">/</span>                                                               <span style="color:#7f848e"># 根目录
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">├──</span> <span style="color:#98c379">etc/</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">│</span>   <span style="color:#98c379">└──</span> <span style="color:#98c379">nginx/</span>                                         <span style="color:#7f848e"># 配置文件目录
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>       <span style="color:#98c379">├──</span> <span style="color:#98c379">nginx.conf</span>                               <span style="color:#7f848e"># 主配置文件
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>       <span style="color:#98c379">├──</span> <span style="color:#98c379">mime.types</span>                             <span style="color:#7f848e"># MIME类型映射表
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>       <span style="color:#98c379">└──</span> <span style="color:#98c379">conf.d/</span>                                    <span style="color:#7f848e"># 子配置目录（用于虚拟主机）
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>           <span style="color:#98c379">└──</span> <span style="color:#98c379">default.conf</span>                        <span style="color:#7f848e"># 默认网站配置文件
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">├──</span> <span style="color:#98c379">usr/</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">│</span>   <span style="color:#98c379">└──</span> <span style="color:#98c379">sbin/</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">│</span>       <span style="color:#98c379">└──</span> <span style="color:#98c379">nginx</span>                                      <span style="color:#7f848e"># 主程序二进制文件
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">├──</span> <span style="color:#98c379">usr/</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">│</span>   <span style="color:#98c379">└──</span> <span style="color:#98c379">share/</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">│</span>       <span style="color:#98c379">└──</span> <span style="color:#98c379">nginx/</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">│</span>           <span style="color:#98c379">└──</span> <span style="color:#98c379">html/</span>                                 <span style="color:#7f848e"># 默认 Web 根目录
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>               <span style="color:#98c379">├──</span> <span style="color:#98c379">index.html</span>                     <span style="color:#7f848e"># 默认欢迎页面
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>               <span style="color:#98c379">└──</span> <span style="color:#98c379">50x.html</span>                        <span style="color:#7f848e"># 服务器错误页面
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">├──</span> <span style="color:#98c379">var/</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">│</span>   <span style="color:#98c379">└──</span> <span style="color:#98c379">log/</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">│</span>       <span style="color:#98c379">└──</span> <span style="color:#98c379">nginx/</span>                                    <span style="color:#7f848e"># 日志文件目录
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>           <span style="color:#98c379">├──</span> <span style="color:#98c379">access.log</span>                          <span style="color:#7f848e"># 访问日志
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>           <span style="color:#98c379">└──</span> <span style="color:#98c379">error.log</span>                             <span style="color:#7f848e"># 错误日志
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">└──</span> <span style="color:#98c379">usr/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#98c379">└──</span> <span style="color:#98c379">lib/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#98c379">└──</span> <span style="color:#98c379">systemd/</span>                                 <span style="color:#7f848e"># 服务管理相关
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>            <span style="color:#98c379">└──</span> <span style="color:#98c379">system/</span>                               <span style="color:#7f848e"># Nginx systemd 配置
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>                <span style="color:#98c379">└──</span> <span style="color:#98c379">nginx.service</span>
</span></span></code></pre></div><h3 id="docker镜像官方-nginx">Docker镜像（官方 Nginx）
</h3><p><strong>没有固定结构</strong>，因为Docker镜像只是一个文件系统的快照，完全取决于镜像制作者，具体看上面四种</p>
<p>这里以官方镜像为例，也就是</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#c678dd">/</span>                                                  <span style="color:#7f848e"># 根目录
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">├──</span> <span style="color:#98c379">etc/</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">│</span>   <span style="color:#98c379">└──</span> <span style="color:#98c379">nginx/</span>                            <span style="color:#7f848e"># 配置文件目录
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>       <span style="color:#98c379">├──</span> <span style="color:#98c379">nginx.conf</span>                  <span style="color:#7f848e"># 主配置文件（Nginx 的核心配置）
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>       <span style="color:#98c379">├──</span> <span style="color:#98c379">mime.types</span>                <span style="color:#7f848e"># MIME类型映射表
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>       <span style="color:#98c379">└──</span> <span style="color:#98c379">conf.d/</span>                       <span style="color:#7f848e"># 子配置目录（用于虚拟主机）
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>           <span style="color:#98c379">└──</span> <span style="color:#98c379">default.conf</span>           <span style="color:#7f848e"># 默认网站配置文件
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">├──</span> <span style="color:#98c379">usr/</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">│</span>   <span style="color:#98c379">├──</span> <span style="color:#98c379">share/</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">│</span>   <span style="color:#98c379">│</span>   <span style="color:#98c379">└──</span> <span style="color:#98c379">nginx/</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">│</span>   <span style="color:#98c379">│</span>      <span style="color:#98c379">└──</span> <span style="color:#98c379">html/</span>                     <span style="color:#7f848e"># 默认的 Web 根目录
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>   <span style="color:#98c379">│</span>           <span style="color:#98c379">├──</span> <span style="color:#98c379">index.html</span>        <span style="color:#7f848e"># 默认欢迎页面
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>   <span style="color:#98c379">│</span>           <span style="color:#98c379">└──</span> <span style="color:#98c379">50x.html</span>           <span style="color:#7f848e"># 服务器错误页面（如 500、502）
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span>   <span style="color:#98c379">└──</span> <span style="color:#98c379">sbin/</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">│</span>       <span style="color:#98c379">└──</span> <span style="color:#98c379">nginx</span>                         <span style="color:#7f848e"># 主程序二进制文件
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span><span style="color:#98c379">│</span> 
</span></span><span style="display:flex;"><span><span style="color:#98c379">└──</span> <span style="color:#98c379">var/</span>
</span></span><span style="display:flex;"><span>     <span style="color:#98c379">└──</span> <span style="color:#98c379">log/</span>
</span></span><span style="display:flex;"><span>          <span style="color:#98c379">└──</span> <span style="color:#98c379">nginx/</span>                       <span style="color:#7f848e"># 日志文件目录（部分精简镜像无日志输出）
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>             <span style="color:#98c379">├──</span> <span style="color:#98c379">access.log</span>             <span style="color:#7f848e"># 访问日志（默认可能未启用）
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>             <span style="color:#98c379">└──</span> <span style="color:#98c379">error.log</span>                <span style="color:#7f848e"># 错误日志（默认可能未启用）
</span></span></span></code></pre></div><h2 id="一些问题">一些问题
</h2><h3 id="日志文件">日志文件
</h3><p><span style="color:red;font-size:20px"><strong>Docker镜像的Nginx日志默认输出到标准输出/错误，而不是文件中</strong></span></p>
<p><strong>在编译安装（<code>make install</code>）的传统方式中，Nginx日志会记录在：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span>/<span style="color:#e06c75">usr</span>/<span style="color:#e06c75">local</span>/<span style="color:#e06c75">nginx</span>/<span style="color:#e06c75">logs</span>/
</span></span></code></pre></div><p><strong>在<code>.deb</code>包和系统包安装（<code>apt/yum</code>）的方式中，Nginx日志会记录在：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span>/<span style="color:#c678dd">var</span>/<span style="color:#e06c75">log</span>/<span style="color:#e06c75">nginx</span>/
</span></span></code></pre></div><p><strong>而在Docker官方镜像中，日志默认不写入上面的文件，而是输出到标准输出和标准错误</strong></p>
<p>执行以下命令：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>ls -l /var/log/nginx/
</span></span></code></pre></div><p>我们可以看到如下输出：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>lrwxrwxrwx <span style="color:#d19a66">1</span> root root <span style="color:#d19a66">11</span> Jul <span style="color:#d19a66">15</span> 01:14 access.log -&gt; /dev/stdout
</span></span><span style="display:flex;"><span>lrwxrwxrwx <span style="color:#d19a66">1</span> root root <span style="color:#d19a66">11</span> Jul <span style="color:#d19a66">15</span> 01:14 error.log -&gt; /dev/stderr
</span></span></code></pre></div><p>虽然<code>nginx.conf</code>配置的是<code>/var/log/nginx/access.log</code>，但由于它是个符号链接，等于就是输出到了标准输出</p>
<p><strong>这些输出会被记录到docker容器的日志里，docker中查看日志的方式</strong>：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#e06c75">docker</span> <span style="color:#e06c75">logs</span> &lt;<span style="color:#e06c75">容器ID</span>&gt;/&lt;<span style="color:#e06c75">名称</span>&gt;
</span></span></code></pre></div><h3 id="配置文件">配置文件
</h3><p><span style="color:red;font-size:20px"><strong><code>/etc/nginx/conf.d/</code>是主配置目录，<code>/etc/nginx/nginx.conf</code>是主配置文件</strong></span></p>
<p>Nginx的主配置文件是<code>/etc/nginx/nginx.conf</code>，在这个文件中有这样一行代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#c678dd">include</span> <span style="color:#e06c75">/etc/nginx/conf.d/*.conf</span>;
</span></span></code></pre></div><p><strong><code>include</code>是Nginx配置语言中的指令，用于包含其他配置文件</strong></p>
<p><strong>也就是说，<code>/etc/nginx/nginx.conf</code>默认会包含<code>/etc/nginx/conf.d/</code>这个子目录中的所有配置（.conf）</strong></p>
<h3 id="web-根目录">Web 根目录
</h3><p><span style="color:red;font-size:20px"><strong>不同安装方式下，Nginx的默认Web根目录不同</strong></span></p>
<p><strong>在编译安装（<code>make install</code>）的传统方式中，Web根目录在：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span>/<span style="color:#e06c75">usr</span>/<span style="color:#e06c75">local</span>/<span style="color:#e06c75">nginx</span>/<span style="color:#e06c75">html</span>/
</span></span></code></pre></div><p>默认包含以下文件：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#e06c75">index</span>.<span style="color:#e06c75">html</span>   # <span style="color:#e06c75">默认欢迎页面</span>
</span></span><span style="display:flex;"><span><span style="color:#d19a66">50</span><span style="color:#e06c75">x</span>.<span style="color:#e06c75">html</span>     # <span style="color:#e06c75">服务器错误页面</span>
</span></span></code></pre></div><p><strong>在Debian/Ubuntu系统包安装方式中，Web根目录在：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span>/<span style="color:#c678dd">var</span>/<span style="color:#e06c75">www</span>/<span style="color:#e06c75">html</span>/
</span></span></code></pre></div><p><strong>在官方包和CentOS/RHEL系统包安装方式中，Web根目录在：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span>/<span style="color:#e06c75">usr</span>/<span style="color:#e06c75">share</span>/<span style="color:#e06c75">nginx</span>/<span style="color:#e06c75">html</span>/
</span></span></code></pre></div><p><strong>可以通过修改Nginx配置文件中的<code>root</code>指令来改变Web根目录：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#e06c75">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">listen</span> <span style="color:#d19a66">80</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">server_name</span> <span style="color:#e06c75">localhost</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">root</span> /<span style="color:#e06c75">path</span>/<span style="color:#e06c75">to</span>/<span style="color:#e06c75">your</span>/<span style="color:#e06c75">webroot</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">index</span> <span style="color:#e06c75">index</span>.<span style="color:#e06c75">html</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>关于server块我们后面会细讲</p>
<h3 id="systemd的位置">systemd的位置
</h3><p>其实这个不是nginx的问题，而是一个历史问题 —— linux文件系统的演进</p>
<p>**FHS，全称Filesystem Hierarchy Standard（文件系统层次结构标准）**是 Linux 系统的一个标准，规定了 目录结构、文件存放位置及用途，让不同 Linux 发行版在文件布局上保持一致性</p>
<p>在早期，FHS规定<code>/lib/</code>用于存放核心库文件和与系统启动紧密相关的可执行文件（比如init系统所需的库、二进制），而<code>/usr/lib/</code>用于存放非核心、额外安装的软件库</p>
<p>但在systemd出现后，由于systemd的服务单元文件属于系统服务配置，与系统启动密切相关，但又不是二进制程序本身，于是他的位置有了一些不同：</p>
<ul>
<li><strong>Debian/Ubuntu：选择<code>/lib/systemd/system/</code>放置核心包的单元文件（比如nginx、sshd），保证系统启动时总能找到</strong></li>
<li><strong>CentOS/RHEL/Fedora：更倾向使用<code>/usr/lib/systemd/system/</code>，虽然<code>/lib/systemd/system/</code>也存在，但它通常是指向前者的符号链接</strong></li>
</ul>
<p>现在<code>/lib/</code>和<code>/usr/lib/</code>往往通过软链接或包管理器自动管理，保证旧路径和新路径都能访问到服务单元文件，所以你会看到同样的 Nginx 服务在不同发行版或者不同安装方式下，路径可能不同</p>
<h1 id="常用命令">常用命令
</h1><p>Nginx直接安装在本机时，使用<code>systemctl</code>或者<code>service</code>命令控制</p>
<p>通过Docker容器使用时，就按照Docker容器的使用方法（没用过看这里：<a class="link" href="http://blog.928330.xyz/p/%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8Bdocker/"  target="_blank" rel="noopener"
    >快速上手Docker
    
    <span style="white-space: nowrap;"><svg width=".7em"
        height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
        <path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
        <path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
            fill="currentColor">
    </svg></span>
    
</a>）</p>
<p>下面介绍一些Nginx本身的命令：</p>
<h2 id="查看版本">查看版本
</h2><div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>nginx -v
</span></span></code></pre></div><p>输出当前安装的Nginx版本号，用于确认是否正确安装Nginx及其版本信息</p>
<h2 id="检查配置文件语法">检查配置文件语法
</h2><div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>nginx -t
</span></span></code></pre></div><p><strong>在每次修改配置文件后必须执行</strong></p>
<p>使用后，主进程会fork一个临时子进程，子进程尝试解析所有配置文件，但不会绑定端口或真正启动服务</p>
<p>若语法无误，会提示<code>syntax is ok</code>和 <code>test is successful</code></p>
<p>若有错误，会明确指出是哪一行、哪个文件配置有误</p>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" data-caption="image-20250724132842292" href="http://picture.928330.xyz/typora/image-20250724132842292.png">
<img src="http://picture.928330.xyz/typora/image-20250724132842292.png" alt="image-20250724132842292"  />
</a>
</div>
</p>
<h2 id="重新加载配置文件">重新加载配置文件
</h2><div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>nginx -s reload
</span></span></code></pre></div><h2 id="强制停止">强制停止
</h2><div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>nginx -s stop
</span></span></code></pre></div><h1 id="配置文件-1">配置文件
</h1><p><strong>Nginx的所有功能都是通过配置文件<code>nginx.conf</code>来驱动的</strong></p>
<p>该文件主要由多个配置块组成，这些块由花括号<code>{}</code>界定，可以嵌套，形成了层级分明的结构</p>
<p>一个典型的<code>nginx.conf</code>结构如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#c678dd">nginx.conf</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">├──</span> <span style="color:#98c379">全局块</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">├──</span> <span style="color:#98c379">events块</span>
</span></span><span style="display:flex;"><span><span style="color:#98c379">└──</span> <span style="color:#98c379">http块</span>
</span></span><span style="display:flex;"><span>    <span style="color:#98c379">└──</span> <span style="color:#98c379">server块（可多个）</span>
</span></span><span style="display:flex;"><span>        <span style="color:#98c379">└──</span> <span style="color:#98c379">location块（可多个）</span>
</span></span></code></pre></div><p>具体示例如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#c678dd">user</span>  <span style="color:#98c379">nginx</span>; 
</span></span><span style="display:flex;"><span><span style="color:#c678dd">worker_processes</span>  <span style="color:#98c379">auto</span>;
</span></span><span style="display:flex;"><span><span style="color:#c678dd">error_log</span>  <span style="color:#98c379">/var/log/nginx/error.log</span> <span style="color:#98c379">warn</span>;
</span></span><span style="display:flex;"><span><span style="color:#c678dd">pid</span>        <span style="color:#98c379">/var/run/nginx.pid</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#c678dd">events</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">worker_connections</span>  <span style="color:#d19a66">1024</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#c678dd">http</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">include</span>       <span style="color:#98c379">/etc/nginx/mime.types</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">default_type</span>  <span style="color:#98c379">application/octet-stream</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">log_format</span>  <span style="color:#98c379">main</span>  <span style="color:#98c379">&#39;</span><span style="color:#e06c75">$remote_addr</span> <span style="color:#98c379">-</span> <span style="color:#e06c75">$remote_user</span> <span style="color:#98c379">[</span><span style="color:#e06c75">$time_local]</span> <span style="color:#98c379">&#34;</span><span style="color:#e06c75">$request&#34;</span> <span style="color:#98c379">&#39;</span>
</span></span><span style="display:flex;"><span>                      <span style="color:#98c379">&#39;</span><span style="color:#e06c75">$status</span> <span style="color:#e06c75">$body_bytes_sent</span> <span style="color:#98c379">&#34;</span><span style="color:#e06c75">$http_referer&#34;</span> <span style="color:#98c379">&#39;</span>
</span></span><span style="display:flex;"><span>                      <span style="color:#98c379">&#39;&#34;</span><span style="color:#e06c75">$http_user_agent&#34;</span> <span style="color:#98c379">&#34;</span><span style="color:#e06c75">$http_x_forwarded_for&#34;&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">access_log</span>  <span style="color:#98c379">/var/log/nginx/access.log</span>  <span style="color:#98c379">main</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">sendfile</span>        <span style="color:#e06c75">on</span>; 
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">tcp_nopush</span>      <span style="color:#e06c75">on</span>; 
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">keepalive_timeout</span>  <span style="color:#d19a66">65</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">server</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">listen</span>       <span style="color:#d19a66">80</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">server_name</span>  <span style="color:#98c379">localhost</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">location</span> <span style="color:#98c379">/</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#c678dd">root</span>   <span style="color:#98c379">/usr/share/nginx/html</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#c678dd">index</span>  <span style="color:#98c379">index.html</span> <span style="color:#98c379">index.htm</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="全局块">全局块
</h2><p>位于配置文件顶部，未嵌套于任何块中</p>
<p>用于配置Nginx整体运行环境，影响所有子模块</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#c678dd">user</span>  <span style="color:#98c379">nginx</span>;
</span></span><span style="display:flex;"><span><span style="color:#c678dd">worker_processes</span>  <span style="color:#98c379">auto</span>;
</span></span><span style="display:flex;"><span><span style="color:#c678dd">error_log</span>  <span style="color:#98c379">/var/log/nginx/error.log</span> <span style="color:#98c379">warn</span>;
</span></span><span style="display:flex;"><span><span style="color:#c678dd">pid</span>        <span style="color:#98c379">/var/run/nginx.pid</span>;
</span></span></code></pre></div><ul>
<li>
<p><strong><code>user</code>：指定运行工作进程的用户和用户组</strong></p>
</li>
<li>
<p><strong><code>worker_processes</code>：指定工作进程数量</strong></p>
<p><code>auto</code>表示自动与 CPU 核心数一致</p>
</li>
<li>
<p><strong><code>error_log</code>：设置错误日志的路径和日志级别</strong></p>
<p>每条错误日志条目都会带有一个严重性等级，这些等级是代码里写死的，作为用户无法改变某个错误属于什么等级</p>
<p>Nginx支持的日志级别（从高到低）如下：</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>级别</th>
          <th>描述</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>debug</code></td>
          <td>记录所有信息，主要用于开发或调试，信息量极大，通常需编译时启用</td>
      </tr>
      <tr>
          <td><code>info</code></td>
          <td>普通信息，如配置加载成功、进程启动、连接创建等</td>
      </tr>
      <tr>
          <td><code>notice</code></td>
          <td>正常但重要的事件，如配置文件重载、进程关闭等</td>
      </tr>
      <tr>
          <td><code>warn</code></td>
          <td>警告信息，非致命错误，比如配置中存在问题但可以忽略或继续运行</td>
      </tr>
      <tr>
          <td><code>error</code></td>
          <td>运行过程中出现的错误，如连接失败、服务不可达等</td>
      </tr>
      <tr>
          <td><code>crit</code></td>
          <td>严重错误，Nginx可能无法继续运行</td>
      </tr>
      <tr>
          <td><code>alert</code></td>
          <td>必须立刻处理的严重问题</td>
      </tr>
      <tr>
          <td><code>emerg</code></td>
          <td>紧急状态，比如系统崩溃，Nginx无法启动</td>
      </tr>
  </tbody>
</table></div>
<p>是否写入日志文件取决于<code>LogLevel</code>设置的阈值，只会写入大于等于当前设置等级的错误事件</p>
<p>生产环境通常设置为<code>warn</code>以捕捉重要问题，同时避免日志泛滥</p>
</li>
<li>
<p><strong><code>pid</code>：指定记录主进程PID的文件路径</strong></p>
</li>
</ul>
<h2 id="events块">events块
</h2><p>紧随全局块之后，一级块</p>
<p>用于配置与网络连接处理相关的指令，影响工作进程的并发性能</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#c678dd">events</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">worker_connections</span> <span style="color:#d19a66">1024</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>
<p><strong><code>worker_connections</code>：每个工作进程可同时处理的最大连接数</strong></p>
<p>总并发连接数约为<code>worker_processes * worker_connections</code></p>
</li>
</ul>
<h2 id="http块">http块
</h2><p>紧随events块之后，一级块</p>
<p>用于配置HTTP协议相关的指令，是配置Web服务的核心部分</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#c678dd">http</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">include</span>       <span style="color:#98c379">/etc/nginx/mime.types</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">default_type</span>  <span style="color:#98c379">application/octet-stream</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">log_format</span>  <span style="color:#98c379">main</span>  <span style="color:#98c379">&#39;</span><span style="color:#e06c75">$remote_addr</span> <span style="color:#98c379">-</span> <span style="color:#e06c75">$remote_user</span> <span style="color:#98c379">[</span><span style="color:#e06c75">$time_local]</span> <span style="color:#98c379">&#34;</span><span style="color:#e06c75">$request&#34;</span> <span style="color:#98c379">&#39;</span>
</span></span><span style="display:flex;"><span>                      <span style="color:#98c379">&#39;</span><span style="color:#e06c75">$status</span> <span style="color:#e06c75">$body_bytes_sent</span> <span style="color:#98c379">&#34;</span><span style="color:#e06c75">$http_referer&#34;</span> <span style="color:#98c379">&#39;</span>
</span></span><span style="display:flex;"><span>                      <span style="color:#98c379">&#39;&#34;</span><span style="color:#e06c75">$http_user_agent&#34;</span> <span style="color:#98c379">&#34;</span><span style="color:#e06c75">$http_x_forwarded_for&#34;&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">access_log</span>  <span style="color:#98c379">/var/log/nginx/access.log</span>  <span style="color:#98c379">main</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">sendfile</span>        <span style="color:#e06c75">on</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">tcp_nopush</span>      <span style="color:#e06c75">on</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">keepalive_timeout</span>  <span style="color:#d19a66">65</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">server</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">...</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>
<p><strong><code>include</code>：引入外部文件</strong></p>
<p>这里<code>/etc/nginx/mime.types</code>用于MIME类型配置</p>
</li>
<li>
<p><strong><code>default_type</code>：未明确 MIME 类型时的默认类型</strong></p>
</li>
<li>
<p><strong><code>log_format</code>：定义日志名称与格式</strong></p>
</li>
<li>
<p><strong><code>access_log</code>：指定访问日志的输出路径及格式</strong></p>
</li>
<li>
<p><strong><code>sendfile</code>：启用高效文件传输方式</strong></p>
</li>
<li>
<p><strong><code>tcp_nopush</code>：优化网络传输性能，避免频繁发送小包</strong></p>
</li>
<li>
<p><strong><code>keepalive_timeout</code>：设置长连接超时时间</strong></p>
</li>
</ul>
<h2 id="server块">server块
</h2><p>嵌套于http块内部，二级块，可存在多个，用于配置多个虚拟主机</p>
<p>用于定义单个虚拟主机的配置，通过监听端口和服务器名称对请求进行分发</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#c678dd">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">listen</span> <span style="color:#d19a66">80</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">server_name</span>  <span style="color:#98c379">localhost</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">location</span> <span style="color:#98c379">/</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">...</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>
<p><strong><code>listen</code>：设置监听的端口</strong></p>
<p>只有访问主机该端口的请求才会被接受</p>
<p><strong>不过得注意，如果使用docker，docker容器一般会把这个端口转发到主机的某个端口上</strong></p>
<p>基本用法：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#c678dd">listen</span> <span style="color:#98c379">&lt;地址&gt;:&lt;端口&gt;</span> <span style="color:#98c379">[参数]</span>;
</span></span></code></pre></div><p><strong><code>地址</code></strong>（可选）：指定绑定的 IP（默认是所有IP）</p>
<p><strong><code>端口</code></strong>：监听的端口</p>
<p><strong><code>参数</code></strong>（可选）：例如<code>default_server</code>、<code>ssl</code>、<code>http2</code> 等（我们后面都会提到）</p>
<p><strong>有一个比较特殊的参数：<code>default_server</code>，用来指定默认的server块，当Nginx收到请求但找不到任何<code>server_name</code>匹配时，就会使用这个默认配置来处理请求</strong></p>
<p><span style="color:yellow;"><strong>介绍几种常见<code>listen</code>字段写法：</strong></span></p>
<p><code>80</code>：监听所有IP的80端口（80是默认HTTP端口），相当于<code>0.0.0.0:8080</code></p>
<p><code>127.0.0.1:8080</code>：仅监听本地回环地址的8080端口</p>
<p><code>[::]:80</code>：IPv6地址监听80端口</p>
</li>
<li>
<p><strong><code>server_name</code>：匹配请求的主机名或域名</strong></p>
<p>只有请求头中的Host字段符合，Nginx才会把请求交给这个<code>server</code>块处理</p>
<p>可以在<code>server_name</code>中写多个值，也支持通配符<code>*</code>，也可以使用<code>_</code>表示任何Host值</p>
<p>如果不写这个字段，http块又只有一个server，那么这个server块会所有请求都匹配（包括 IP）</p>
<p>如果不写这个字段，http块又有多个server，那么这个server块会作为默认server，处理未匹配的请求</p>
</li>
</ul>
<h2 id="location块">location块
</h2><p>嵌套于server块内部，三级块</p>
<p>用于对URI（注意不是URL）进行匹配，制定请求的处理方式，如资源路径、代理规则等</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#c678dd">location</span> <span style="color:#98c379">/</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">root</span>   <span style="color:#98c379">/usr/share/nginx/html</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">index</span>  <span style="color:#98c379">index.html</span> <span style="color:#98c379">index.htm</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>
<p><strong><code>location</code>：用于匹配客户端请求的URI</strong></p>
<p>示例这里是匹配以<code>/</code>开头的URI（实际上就是匹配所有请求，因为URI就是以<code>/</code>开头的）</p>
<p><strong>此外，Nginx提供多种匹配方式，优先级不同：</strong></p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>类型</th>
          <th>语法</th>
          <th>示例</th>
          <th>说明</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>精确匹配</td>
          <td><code>=</code></td>
          <td><code>location = /login {}</code></td>
          <td>仅匹配 URI 等于 <code>/login</code> 的请求</td>
      </tr>
      <tr>
          <td>前缀匹配</td>
          <td><code>/</code></td>
          <td><code>location /images/ {}</code></td>
          <td>匹配以 <code>/images/</code> 开头的 URI</td>
      </tr>
      <tr>
          <td>正则匹配</td>
          <td><code>~</code>（区分大小写）<br /><code>~*</code>（不区分大小写）</td>
          <td><code>location ~ \.php$ {}</code></td>
          <td>使用正则表达式匹配 URI</td>
      </tr>
      <tr>
          <td>优先匹配</td>
          <td><code>^~</code></td>
          <td><code>location ^~ /static/ {}</code></td>
          <td>前缀匹配优先于正则匹配</td>
      </tr>
  </tbody>
</table></div>
</li>
<li>
<p><strong><code>root</code>：设置请求资源的根目录路径</strong></p>
<p>当一个请求到达时，Nginx会将请求的URI拼接到这个路径后面，以确定文件的具体位置</p>
<p>如果客户端访问<code>/index.html</code>，那么实际访问的是服务器上的<code>/usr/share/nginx/html/index.html</code>文件</p>
</li>
<li>
<p><strong><code>index</code>：指定访问目录时的默认文件名称</strong></p>
<p>如果用户访问的是目录而不是具体文件，Nginx会在<code>/usr/share/nginx/html/</code>目录下按顺序查找：</p>
<ol>
<li><code>index.html</code></li>
<li><code>index.htm</code></li>
</ol>
<p>只要找到其中一个文件，就立即返回该文件作为响应；如果都找不到，会返回403（禁止访问）或404（未找到），视配置而定</p>
<p><strong><code>root</code>和<code>index</code>也可以直接写在server块里面，作为所有location块的默认值</strong></p>
</li>
</ul>
<p><span style="color:yellow;font-size:18px"><strong>说了这么多，我们最后总结一下<code>listen</code>、<code>server_name</code>、<code>location</code> 三者是如何配合工作的：</strong></span></p>
<p>用户访问浏览器输入：</p>
<pre tabindex="0"><code class="language-url" data-lang="url">http://localhost/images/logo.png
</code></pre><p>Nginx内部处理流程如下：</p>
<ol>
<li>
<p><strong>看端口：</strong>
该请求是发给哪个端口，是80，那就匹配所有listen 80的server</p>
</li>
<li>
<p><strong>看Host头：</strong>
Host是localhost，找哪个server_name匹配上了，进入该server块</p>
</li>
<li>
<p><strong>看URI：</strong>
URI是/images/logo.png，在这个server中找哪个location匹配得最好，执行该location的规则</p>
</li>
</ol>
<h1 id="核心功能--web服务">核心功能 —— Web服务
</h1><p>Web 服务是 Nginx 最基础，也是最核心的功能，它能够高效地处理客户端对静态资源的请求</p>
<p>这主要通过<code>server</code>块中的<code>root</code>、<code>index</code>、<code>location</code>来协同完成</p>
<h2 id="部署静态资源">部署静态资源
</h2><p>可以把Nginx作为静态资源服务器，当用户请求时，Nginx从服务器的指定文件路径中查找并返回对应的文件：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#c678dd">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">listen</span> <span style="color:#d19a66">80</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">server_name</span> <span style="color:#98c379">example.com</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">root</span> <span style="color:#98c379">/var/www/my-project/public</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">index</span> <span style="color:#98c379">index.html</span> <span style="color:#98c379">index.htm</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">location</span> <span style="color:#98c379">/</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">try_files</span> <span style="color:#e06c75">$uri</span> <span style="color:#e06c75">$uri/</span> =<span style="color:#d19a66">404</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">location</span> ~<span style="color:#98c379">*</span> <span style="color:#98c379">\.(jpg|jpeg|gif|png|css|js|ico|webp)</span>$ {
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">expires</span> <span style="color:#98c379">30d</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>
<p><strong><code>try_files $uri $uri/ =404</code></strong></p>
<p>这是一个非常强大的指令，常用于处理单页应用（SPA）的路由，它的语法是：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Nginx" data-lang="Nginx"><span style="display:flex;"><span><span style="color:#c678dd">try_files</span> <span style="color:#98c379">file1</span> <span style="color:#98c379">file2</span> <span style="color:#98c379">...</span> <span style="color:#98c379">final_action</span>;
</span></span></code></pre></div><ul>
<li><code>file1, file2, ...</code>：依次判断路径（支持变量），是否存在有效文件或目录</li>
<li><code>final_action</code>：如果前面都没找到，则执行的动作，常用的有：
<ul>
<li><code>=404</code>：返回404错误</li>
<li><code>@named_location</code>：跳转到命名的location块</li>
<li><code>uri</code>：重定向到指定URI</li>
</ul>
</li>
</ul>
<p>现在我们看看示例里面的是什么意思：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Nginx" data-lang="Nginx"><span style="display:flex;"><span><span style="color:#c678dd">try_files</span> <span style="color:#e06c75">$uri</span> <span style="color:#e06c75">$uri/</span> =<span style="color:#d19a66">404</span>
</span></span></code></pre></div><ol>
<li>
<p><code>$uri</code>：尝试将URI直接作为文件名进行查找</p>
</li>
<li>
<p><code>$uri/</code>：如果上一步失败，则尝试将URI作为一个目录名，并在该目录下查找由<code>index</code>指令定义的文件</p>
</li>
<li>
<p><code>=404</code>：如果前两步都失败，则返回一个404 Not Found错误</p>
</li>
</ol>
</li>
<li>
<p><strong><code>location ~* \.(jpg|jpeg|gif|png|css|js|ico|webp)$</code></strong></p>
<p>这是一个正则匹配，<code>~*</code>表示不区分大小写的正则，它会匹配所有以上述后缀结尾的请求</p>
</li>
<li>
<p><strong><code>expires 30d</code></strong></p>
<p>用于设置HTTP响应头中的<code>Expires</code>和<code>Cache-Control</code></p>
<p>告诉客户端浏览器可以将这些静态资源缓存30天，从而减少不必要的请求，提升后续访问速度</p>
</li>
</ul>
<h2 id="url重写与跳转">URL重写与跳转
</h2><p>Nginx支持在<code>location</code>块内实现URL重写和跳转，常用于：</p>
<ul>
<li>伪静态（SEO优化）</li>
<li>页面重定向</li>
<li>接口调整兼容</li>
<li>HTTPS 强制跳转等场景</li>
</ul>
<h3 id="rewrite">rewrite
</h3><p><code>rewrite</code>是Nginx实现伪静态、内部跳转的主要方式</p>
<p>它的本质是把用户请求的路径改写成另一个内部路径，再由Nginx重新处理</p>
<h4 id="基本语法">基本语法
</h4><div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#e06c75">rewrite</span> &lt;<span style="color:#e06c75">正则匹配</span>&gt; &lt;<span style="color:#e06c75">重写路径</span>&gt; [<span style="color:#e06c75">flag</span>];
</span></span></code></pre></div><ul>
<li>
<p><strong>正则匹配</strong>：对当前请求URI进行匹配（不包含域名）</p>
</li>
<li>
<p><strong>重写路径</strong>：替换匹配url的新URI，可引用正则中的子表达式</p>
</li>
<li>
<p><strong>flag 可选标志</strong>：</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>重写方式</th>
          <th>用法</th>
          <th>含义</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>last</code></td>
          <td>使用新URI，从头开始匹配<code>location</code></td>
          <td>用于常规重写，不会改变浏览器地址栏</td>
      </tr>
      <tr>
          <td><code>break</code></td>
          <td>使用新URI，但不再重新匹配<code>location</code></td>
          <td>跳出<code>rewrite</code>，在当前<code>location</code>内继续执行<br />不会改变浏览器地址栏</td>
      </tr>
      <tr>
          <td><code>permanent</code></td>
          <td>返回301，永久重定向</td>
          <td>会改变浏览器地址栏</td>
      </tr>
      <tr>
          <td><code>redirect</code></td>
          <td>返回302，临时重定向</td>
          <td>会改变浏览器地址栏</td>
      </tr>
  </tbody>
</table></div>
</li>
</ul>
<h4 id="伪静态处理">伪静态处理
</h4><p>将 <code>/product/123.html</code> 重写为 <code>/product.php?id=123</code>：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#c678dd">rewrite</span> <span style="color:#98c379">^/product/([0-9]+)\.html</span>$ <span style="color:#98c379">/product.php?id=</span><span style="color:#e06c75">$1</span> <span style="color:#98c379">last</span>;
</span></span></code></pre></div><h4 id="隐藏真实路径">隐藏真实路径
</h4><div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#c678dd">location</span> <span style="color:#98c379">/user/</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">rewrite</span> <span style="color:#98c379">^/user/([a-z]+)</span>$ <span style="color:#98c379">/profile.php?name=</span><span style="color:#e06c75">$1</span> <span style="color:#98c379">last</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="return">return
</h3><p><code>return</code>用于向客户端返回一个特定的状态码和内容，它不会再走<code>rewrite</code>的内部处理流程</p>
<p>比起<code>rewrite</code>，它更适合用于明确的重定向、报错处理等</p>
<h4 id="基本语法-1">基本语法
</h4><div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#c678dd">return</span> &lt;<span style="color:#e06c75">状态码</span>&gt; [<span style="color:#e06c75">文本</span>|<span style="color:#e06c75">URL</span>];
</span></span></code></pre></div><ul>
<li><strong>状态码</strong>：如301（永久重定向）、302（临时重定向）、403（禁止访问）、404（页面不存在）</li>
<li><strong>文本或URL</strong>：可返回跳转地址，也可直接返回文本内容（仅在状态码为200时有效）</li>
</ul>
<h4 id="http强制跳转https">HTTP强制跳转HTTPS
</h4><div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#c678dd">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">listen</span> <span style="color:#d19a66">80</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">server_name</span> <span style="color:#98c379">example.com</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">return</span> <span style="color:#d19a66">301</span> <span style="color:#98c379">https://</span><span style="color:#e06c75">$server_name$request_uri</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>这一点我们下面会详细说明</p>
<h4 id="禁止访问某个目录">禁止访问某个目录
</h4><div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#c678dd">location</span> <span style="color:#98c379">/private/</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">return</span> <span style="color:#d19a66">403</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="简洁跳转到首页">简洁跳转到首页
</h4><div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#c678dd">location</span> = <span style="color:#98c379">/</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">return</span> <span style="color:#d19a66">301</span> <span style="color:#98c379">/home/index.html</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="纯文本响应">纯文本响应
</h4><div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#c678dd">location</span> = <span style="color:#98c379">/test</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">return</span> <span style="color:#d19a66">200</span> <span style="color:#98c379">&#39;Hello.&#39;</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="配置https服务">配置HTTPS服务
</h2><p>为网站启用HTTPS可以对客户端和服务器之间的传输数据进行加密，确保数据安全</p>
<p>配置前，我们需要从证书颁发机构（CA）获取SSL/TLS证书文件和私钥文件</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Nginx" data-lang="Nginx"><span style="display:flex;"><span><span style="color:#c678dd">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">listen</span> <span style="color:#d19a66">443</span> <span style="color:#98c379">ssl</span> <span style="color:#98c379">http2</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">server_name</span> <span style="color:#98c379">yourdomain.com</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">ssl_certificate</span> <span style="color:#98c379">/path/to/fullchain.pem</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">ssl_certificate_key</span> <span style="color:#98c379">/path/to/privkey.pem</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">ssl_session_cache</span> <span style="color:#98c379">shared:SSL:10m</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">ssl_session_timeout</span> <span style="color:#d19a66">10m</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">ssl_protocols</span> <span style="color:#98c379">TLSv1.2</span>  <span style="color:#98c379">TLSv1.3</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">ssl_ciphers</span> <span style="color:#98c379">&#39;TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">ssl_prefer_server_ciphers</span> <span style="color:#e06c75">off</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">root</span> <span style="color:#98c379">/var/www/my-project/public</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">index</span> <span style="color:#98c379">index.html</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">location</span> <span style="color:#98c379">/</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">try_files</span> <span style="color:#e06c75">$uri</span> <span style="color:#e06c75">$uri/</span> =<span style="color:#d19a66">404</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#c678dd">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">listen</span> <span style="color:#d19a66">80</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">server_name</span> <span style="color:#98c379">yourdomain.com</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">return</span> <span style="color:#d19a66">301</span> <span style="color:#98c379">https://</span><span style="color:#e06c75">$server_name$request_uri</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>
<p><strong><code>listen 443 ssl http2</code></strong></p>
<ul>
<li>
<p><code>443</code>是HTTPS的标准端口</p>
</li>
<li>
<p><code>ssl</code>参数表示在此端口上启用SSL/TLS加密</p>
</li>
<li>
<p><code>http2</code>参数表示同时启用HTTP/2协议，它可以显著提升页面加载性能</p>
</li>
</ul>
</li>
<li>
<p><strong><code>ssl_certificate</code></strong></p>
<p>指定证书文件的路径，这通常是<code>.pem</code>或<code>.crt</code>格式的公钥证书链文件</p>
</li>
<li>
<p><strong><code>ssl_certificate_key</code></strong></p>
<p>指定与证书配对的私钥文件的路径，通常是<code>.key</code>格式</p>
</li>
<li>
<p><strong><code>ssl_session_cache</code></strong></p>
<p>开启SSL会话缓存，用于复用TLS握手过程，提升性能</p>
</li>
<li>
<p><strong><code>ssl_session_timeout</code></strong></p>
<p>设置SSL会话的有效时间</p>
</li>
<li>
<p><strong><code>ssl_protocols TLSv1.2 TLSv1.3</code></strong></p>
<p>指定只使用安全的TLS协议版本，废弃老旧且不安全的SSLv3, TLSv1.0, TLSv1.1</p>
</li>
<li>
<p><strong><code>ssl_ciphers</code></strong></p>
<p>指定加密时使用的加密套件列表，配置安全的套件可以防止降级攻击</p>
</li>
<li>
<p><strong><code>ssl_prefer_server_ciphers</code></strong></p>
<p>是否优先使用服务器端指定的加密套件，<code>off</code>表示客户端优先</p>
</li>
<li>
<p><strong><code>return 301 https://$server_name$request_uri</code></strong></p>
<p>发送一个永久重定向的HTTP状态码</p>
<p><code>$server_name</code>和<code>$request_uri</code>是Nginx变量，分别代表当前请求的域名和完整的 URI（包含参数）</p>
<p>这能确保用户访问任何HTTP页面时都能被准确地重定向到对应的HTTPS版本</p>
</li>
</ul>
<h1 id="核心功能--反向代理">核心功能 —— 反向代理
</h1><p>反向代理是Nginx的一个核心功能</p>
<p><strong>Nginx作为一个中间层，接收客户端的请求，再将请求转发给后端服务器处理，然后将响应返回给客户端</strong></p>
<p>这种方式的好处包括：</p>
<ul>
<li>可以隐藏后端服务器的真实地址和结构</li>
<li>可以统一对外的入口，便于安全控制和运维管理</li>
<li>可以实现负载均衡、高可用等复杂功能（后续再讲）</li>
</ul>
<p>下面是一个最简单的Nginx配置示例，只实现把请求转发到后端服务器的功能：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#c678dd">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">listen</span> <span style="color:#d19a66">80</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">server_name</span> <span style="color:#98c379">www.example.com</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">location</span> <span style="color:#98c379">/</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">proxy_pass</span> <span style="color:#98c379">http://127.0.0.1:3000</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>
<p><strong><code>proxy_pass http://127.0.0.1:3000;</code></strong></p>
<p><span style="color:red;"><strong>这是反向代理的核心语句，即将匹配到的请求转发到本机的3000端口，由本地某个服务来实际处理请求</strong></span></p>
</li>
</ul>
<p>默认情况下，Nginx把请求转发给后端时，不会携带原始客户端的信息</p>
<p><span style="color:yellow;"><strong>如果后端服务要获取用户的真实IP、请求协议、原始域名等信息，就需要使用<code>proxy_set_header</code>来手动设置</strong>：</span></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#c678dd">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">listen</span> <span style="color:#d19a66">80</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">server_name</span> <span style="color:#98c379">www.example.com</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">location</span> <span style="color:#98c379">/</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">proxy_pass</span> <span style="color:#98c379">http://127.0.0.1:3000</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">proxy_set_header</span> <span style="color:#98c379">Host</span> <span style="color:#e06c75">$host</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">proxy_set_header</span> <span style="color:#98c379">X-Real-IP</span> <span style="color:#e06c75">$remote_addr</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">proxy_set_header</span> <span style="color:#98c379">X-Forwarded-For</span> <span style="color:#e06c75">$proxy_add_x_forwarded_for</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">proxy_set_header</span> <span style="color:#98c379">X-Forwarded-Proto</span> <span style="color:#e06c75">$scheme</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>这些<code>proxy_set_header</code>是给后端应用用的：</p>
<ul>
<li><strong><code>Host $host</code></strong>：原始请求中的主机名</li>
<li><strong><code>X-Real-IP $remote_addr</code></strong>：客户端的真实 IP</li>
<li><strong><code>X-Forwarded-For $proxy_add_x_forwarded_for</code></strong>：经过的所有代理 IP 列表</li>
<li><strong><code>X-Forwarded-Proto $scheme</code></strong>：原始请求的协议（http 或 https）</li>
</ul>
<p><span style="color:yellow;"><strong>如果我们有多个后端服务（比如多个进程、多个机器），可以用<code>upstream</code>来统一管理后端服务器组</strong>：</span></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#c678dd">upstream</span> <span style="color:#98c379">backend</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">server</span> <span style="color:#e06c75">127.0.0.1</span>:<span style="color:#d19a66">3000</span>;
</span></span><span style="display:flex;"><span> <span style="color:#7f848e"># server 127.0.0.1:3001;     #可以添加多个
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#c678dd">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">listen</span> <span style="color:#d19a66">80</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">server_name</span> <span style="color:#98c379">www.example.com</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">location</span> <span style="color:#98c379">/</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">proxy_pass</span> <span style="color:#98c379">http://backend</span>;   <span style="color:#7f848e">#&lt;--这里不一样了，使用的是upstream
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">proxy_set_header</span> <span style="color:#98c379">Host</span> <span style="color:#e06c75">$host</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">proxy_set_header</span> <span style="color:#98c379">X-Real-IP</span> <span style="color:#e06c75">$remote_addr</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">proxy_set_header</span> <span style="color:#98c379">X-Forwarded-For</span> <span style="color:#e06c75">$proxy_add_x_forwarded_for</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">proxy_set_header</span> <span style="color:#98c379">X-Forwarded-Proto</span> <span style="color:#e06c75">$scheme</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>现在，我们只需要在<code>proxy_pass</code>中写 <code>http://backend</code>即可</p>
<p>具体的地址都集中写在<code>upstream backend</code>块中，方便管理和负载均衡</p>
<h1 id="核心功能--负载均衡">核心功能 —— 负载均衡
</h1><p>当<code>upstream</code>块中定义了多台<code>server</code>时，Nginx就自然地成为了一个负载均衡器</p>
<p>它会根据指定的策略将请求分发到不同的服务器，以分担流量压力</p>
<h2 id="http负载均衡配置">HTTP负载均衡配置
</h2><div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Nginx" data-lang="Nginx"><span style="display:flex;"><span><span style="color:#c678dd">upstream</span> <span style="color:#98c379">backend_cluster</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">server</span> <span style="color:#98c379">backend1.example.com</span> <span style="color:#98c379">weight=5</span>; 
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">server</span> <span style="color:#98c379">backend2.example.com</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">server</span> <span style="color:#98c379">backend3.example.com</span> <span style="color:#98c379">backup</span>; 
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">server</span> <span style="color:#98c379">backend4.example.com</span> <span style="color:#98c379">down</span>;   
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#c678dd">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">listen</span> <span style="color:#d19a66">80</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">location</span> <span style="color:#98c379">/</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">proxy_pass</span> <span style="color:#98c379">http://backend_cluster</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">proxy_connect_timeout</span> <span style="color:#98c379">5s</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">proxy_read_timeout</span> <span style="color:#98c379">10s</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>
<p><strong><code>weight=5</code></strong></p>
<p>为服务器设置权重，在默认的轮询策略下，权重越高的服务器接收到的请求比例就越高</p>
<p>这里<code>backend1</code>的请求量大约是<code>backend2</code>的5倍</p>
</li>
<li>
<p><strong><code>backup</code></strong></p>
<p>将服务器标记为备用服务器</p>
<p>只有当所有非备用的主服务器都无法访问时，Nginx才会将请求转发给它</p>
</li>
<li>
<p><strong><code>down</code></strong></p>
<p>将服务器标记为永久下线，Nginx不会向它转发任何请求</p>
<p>这通常用于服务器维护</p>
</li>
<li>
<p><strong><code>proxy_connect_timeout</code> &amp; <code>proxy_read_timeout</code></strong></p>
<p>设置Nginx与后端服务器建立连接的超时时间和读取响应的超时时间</p>
<p>可以防止因个别后端服务响应缓慢而导致请求长时间挂起</p>
</li>
</ul>
<h3 id="负载均衡策略">负载均衡策略
</h3><h3 id="轮询">轮询
</h3><p>默认策略，无需任何指令</p>
<p>请求被按顺序、轮流分发到每台服务器，并考虑权重</p>
<h3 id="权重weight">权重（weight）
</h3><p><strong>就像我们之前提到过的例子，<code>weight</code>越高，分配的请求越多</strong></p>
<p>此策略适合后端性能不一致的情况（强机多干活）</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#c678dd">upstream</span> <span style="color:#98c379">backend_cluster</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">server</span> <span style="color:#e06c75">192.168.0.1</span>  <span style="color:#98c379">weight=3</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">server</span> <span style="color:#e06c75">192.168.0.2</span>  <span style="color:#98c379">weight=1</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>上例中，第一个服务器将获得大约75%的请求，第二个约25%</p>
<h3 id="ip哈希ip_hash">IP哈希（ip_hash）
</h3><p><strong>根据客户端IP地址的哈希值来选择服务器</strong>，这能确保来自同一个客户端的请求始终被定向到同一台后端服务器</p>
<p>此策略对于需要保持用户会话状态的应用非常重要</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Nginx" data-lang="Nginx"><span style="display:flex;"><span><span style="color:#c678dd">upstream</span> <span style="color:#98c379">backend_cluster</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">ip_hash</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">server</span> <span style="color:#98c379">backend1.example.com</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">server</span> <span style="color:#98c379">backend2.example.com</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="最少连接-least_conn">最少连接 (least_conn)
</h3><p><strong>将新请求发送到当前活动连接数最少的服务器</strong></p>
<p>此策略在处理耗时不同或长连接较多的请求时，能使负载分布得更加均匀</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Nginx" data-lang="Nginx"><span style="display:flex;"><span><span style="color:#c678dd">upstream</span> <span style="color:#98c379">backend_cluster</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">least_conn</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">server</span> <span style="color:#98c379">backend1.example.com</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">server</span> <span style="color:#98c379">backend2.example.com</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="核心功能--tcpudp代理">核心功能 —— TCP/UDP代理
</h1><p>Nginx不仅能代理HTTP，还能通过<code>stream</code>模块在更底层的传输层（TCP/UDP）进行代理</p>
<p>例如代理数据库连接、游戏服务器、DNS 查询等</p>
<p><code>stream</code>块必须配置在<code>http</code>块之外，位于主配置文件的顶层，和<code>http</code>是平级的</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Nginx" data-lang="Nginx"><span style="display:flex;"><span><span style="color:#c678dd">stream</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">upstream</span> <span style="color:#98c379">mysql_cluster</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">server</span> <span style="color:#e06c75">192.168.1.101</span>:<span style="color:#d19a66">3306</span> <span style="color:#98c379">weight=2</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">server</span> <span style="color:#e06c75">192.168.1.102</span>:<span style="color:#d19a66">3306</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">server</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">listen</span> <span style="color:#d19a66">3307</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">proxy_pass</span> <span style="color:#98c379">mysql_cluster</span>; 
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">proxy_timeout</span> <span style="color:#98c379">20s</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">server</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">listen</span> <span style="color:#d19a66">53</span> <span style="color:#98c379">udp</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#c678dd">proxy_pass</span> <span style="color:#e06c75">8.8.8.8</span>:<span style="color:#d19a66">53</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>你可以看到，stream块和http块的写法基本上是一样的，但是细节上还是有些不同：</p>
<ul>
<li><strong><code>stream</code>块不支持<code>location</code>，没有路径匹配</strong></li>
<li><strong><code>stream</code>块不解析协议内容，没有<code>proxy_set_header</code>，只转发原始TCP/UDP数据流</strong></li>
<li><strong><code>stream</code>块不支持<code>ip_hash</code>的负载均衡策略</strong></li>
</ul>
<h1 id="日志分析">日志分析
</h1><h2 id="为何要分析nginx日志">为何要分析Nginx日志
</h2><p>在现代 Web 架构中，Nginx 作为流量的入口，记录着大量有用的信息</p>
<p>虽然ELK等日志平台功能强大，但并非所有环境都配备</p>
<p>掌握底层的命令行分析技巧，能让我们在任何服务器上快速、灵活地定位问题</p>
<p><strong>注意</strong>：</p>
<p>在处理大型日志文件（如 &gt;1GB）时，应避免直接使用<code>cat</code>读取整个文件，这会消耗大量内存</p>
<p>应使用<code>head</code>,<code>tail</code>,<code>grep</code>,<code>sed</code>,<code>awk</code>等可以流式处理的工具进行查看修改，或先对日志进行切割</p>
<p>实在想要看全部，也应该选择使用<code>less</code>或<code>more</code></p>
<h2 id="日志类型与格式">日志类型与格式
</h2><h3 id="访问日志accesslog">访问日志（access.log）
</h3><p><code>access.log</code>记录了每一个对Nginx服务器的HTTP请求的详细信息</p>
<h4 id="默认格式combined--main">默认格式：combined / main
</h4><p>Nginx官方默认格式是<code>combined</code>，不过现在常见的更多是<code>main</code>（包括之前我们给出的docker容器的nginx）</p>
<p>其实<code>main</code>只是自定义的名字，本质和<code>combined</code>是类似的，甚至很多公司就是直接copy默认的<code>combined</code>格式起个名叫<code>main</code>，但更多的则是增加了一些字段（比如新增<code>$http_x_forwarded_for</code>字段）</p>
<p>我们就以上文提到的配置文件示例里的<code>main</code>格式为例，这也是最为常见的格式之一，理解了就行</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Nginx" data-lang="Nginx"><span style="display:flex;"><span><span style="color:#c678dd">log_format</span>  <span style="color:#98c379">main</span>  <span style="color:#98c379">&#39;</span><span style="color:#e06c75">$remote_addr</span> <span style="color:#98c379">-</span> <span style="color:#e06c75">$remote_user</span> <span style="color:#98c379">[</span><span style="color:#e06c75">$time_local]</span> <span style="color:#98c379">&#34;</span><span style="color:#e06c75">$request&#34;</span> <span style="color:#98c379">&#39;</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#98c379">&#39;</span><span style="color:#e06c75">$status</span> <span style="color:#e06c75">$body_bytes_sent</span> <span style="color:#98c379">&#34;</span><span style="color:#e06c75">$http_referer&#34;</span> <span style="color:#98c379">&#39;</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#98c379">&#39;&#34;</span><span style="color:#e06c75">$http_user_agent&#34;</span> <span style="color:#98c379">&#34;</span><span style="color:#e06c75">$http_x_forwarded_for&#34;&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#c678dd">access_log</span>  <span style="color:#98c379">/var/log/nginx/access.log</span>  <span style="color:#98c379">main</span>;
</span></span></code></pre></div><p><strong>变量名是Nginx内置的变量</strong>，<strong>不能随意改名字</strong></p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>变量</th>
          <th>解释</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong><code>$remote_addr</code></strong></td>
          <td><strong>客户端IP地址</strong></td>
      </tr>
      <tr>
          <td><strong><code>$remote_user</code></strong></td>
          <td><strong>客户端用户名称</strong>（用于HTTP认证，通常为<code>-</code>）</td>
      </tr>
      <tr>
          <td><strong><code>[$time_local]</code></strong></td>
          <td><strong>服务器本地的请求处理完成时间</strong></td>
      </tr>
      <tr>
          <td><strong><code>&quot;$request&quot;</code></strong></td>
          <td><strong>完整的原始请求行</strong>，如 <code>&quot;GET /index.html HTTP/1.1&quot;</code></td>
      </tr>
      <tr>
          <td><strong><code>$status</code></strong></td>
          <td><strong>HTTP响应状态码</strong></td>
      </tr>
      <tr>
          <td><strong><code>$body_bytes_sent</code></strong></td>
          <td><strong>发送给客户端的响应体大小</strong>（字节）</td>
      </tr>
      <tr>
          <td><strong><code>&quot;$http_referer&quot;</code></strong></td>
          <td><strong>请求的来源页面URL</strong></td>
      </tr>
      <tr>
          <td><strong><code>&quot;$http_user_agent&quot;</code></strong></td>
          <td><strong>客户端的浏览器、操作系统等信息</strong></td>
      </tr>
      <tr>
          <td><strong><code>&quot;$http_x_forwarded_for&quot;</code></strong></td>
          <td><strong>（重要）</strong> 记录了<strong>通过代理服务器访问的客户端真实IP地址</strong></td>
      </tr>
  </tbody>
</table></div>
<p><strong>来看一个实际的main格式的access.log的条目：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#d19a66">111.111</span>.<span style="color:#d19a66">111.111</span> - - [<span style="color:#d19a66">28</span>/<span style="color:#e06c75">Apr</span>/<span style="color:#d19a66">2021</span>:<span style="color:#d19a66">14</span>:<span style="color:#d19a66">44</span>:<span style="color:#d19a66">11</span> +<span style="color:#d19a66">0800</span>] <span style="color:#98c379">&#34;GET /api/channel/unread.jsp HTTP/1.1&#34;</span> <span style="color:#d19a66">200</span> <span style="color:#d19a66">65</span> <span style="color:#98c379">&#34;https://www.xxxx.cn/&#34;</span> <span style="color:#98c379">&#34;Mozilla/5.0...&#34;</span> <span style="color:#98c379">&#34;123.123.123.123&#34;</span>
</span></span></code></pre></div><ul>
<li>
<p><strong><code>$remote_addr</code></strong>：<code>111.111.111.111</code></p>
<p>这是Nginx看到的客户端IP，可能是负载均衡/代理的IP，不一定是真实用户的IP</p>
</li>
<li>
<p><strong><code>$remote_user</code></strong>：<code>- -</code>
如果客户端经过了HTTP认证，这里会记录认证用户名，否则为<code>-</code></p>
<ul>
<li>第一个 <code>-</code>：远程用户名（几乎不用，常为空）</li>
<li>第二个 <code>-</code>：认证用户名（如果用 Basic Auth 才会有）</li>
</ul>
</li>
<li>
<p><strong><code>$time_local</code></strong>：<code>28/Apr/2021:14:44:11 +0800</code>
这是Nginx记录的本地时间，时区为+0800（北京时间）</p>
</li>
<li>
<p><strong><code>$request</code></strong>：<code>GET /api/channel/unread.jsp HTTP/1.1</code>
包含请求方法、URL路径和HTTP协议版本</p>
</li>
<li>
<p><strong><code>$status</code></strong>：<code>200</code>
HTTP状态码，表示请求成功</p>
</li>
<li>
<p><strong><code>$body_bytes_sent</code></strong>：<code>65</code>
响应体大小（字节数），不包含响应头</p>
</li>
<li>
<p><strong><code>$http_referer</code></strong>：<code>https://www.xxxx.cn/</code>
请求来源页面，如果用户是从某个页面跳转过来的，这里会显示该页面URL，若没有则为<code>-</code></p>
</li>
<li>
<p><strong><code>$http_user_agent</code></strong>：<code>Mozilla/5.0...</code>
客户端的User-Agent，表示浏览器或客户端的标识信息</p>
</li>
<li>
<p><strong><code>$http_x_forwarded_for</code></strong>：<code>123.123.123.123</code>
代理服务器通过HTTP头传递的真实客户端IP，用来识别经过代理时的原始用户地址</p>
</li>
</ul>
<p><strong>这条日志告诉我们：</strong></p>
<p>在北京时间<code>021-04-28 14:44:11</code>，有一个客户端访问了接口<code>/api/channel/unread.jsp</code>，使用的是<code>GET</code>请求，HTTP版本是<code>1.1</code>，返回状态码<code>200</code>（成功），响应大小<code>65</code>字节，请求来自页面<code>https://www.xxxx.cn/</code>，使用的客户端是某个<code>Mozilla浏览器/模拟器</code>，其真实IP是<code>123.123.123.123</code>，但请求是经过代理，Nginx看到的源IP是<code>111.111.111.111</code></p>
<h4 id="增强的自定义格式json">增强的自定义格式：JSON
</h4><p>为了便于程序（如 Logstash, Fluentd）解析，JSON格式也是目前的主流选择，属于典型的非默认格式</p>
<p>它的结构清晰，键值对明确，机器解析友好，避免了<code>awk</code>和<code>cut</code>对字段位置的强依赖</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#c678dd">log_format</span> <span style="color:#98c379">json_analytics</span> <span style="color:#98c379">escape=json</span>
</span></span><span style="display:flex;"><span>  <span style="color:#98c379">&#39;</span>{<span style="color:#c678dd">&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#98c379">&#39;&#34;timestamp&#34;:</span> <span style="color:#98c379">&#34;</span><span style="color:#e06c75">$time_iso8601&#34;,&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#98c379">&#39;&#34;client_ip&#34;:</span> <span style="color:#98c379">&#34;</span><span style="color:#e06c75">$remote_addr&#34;,&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#98c379">&#39;&#34;request&#34;:</span> <span style="color:#98c379">&#34;</span><span style="color:#e06c75">$request&#34;,&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#98c379">&#39;&#34;status&#34;:</span> <span style="color:#e06c75">$status,&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#98c379">&#39;&#34;bytes_sent&#34;:</span> <span style="color:#e06c75">$body_bytes_sent,&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#98c379">&#39;&#34;http_referer&#34;:</span> <span style="color:#98c379">&#34;</span><span style="color:#e06c75">$http_referer&#34;,&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#98c379">&#39;&#34;http_user_agent&#34;:</span> <span style="color:#98c379">&#34;</span><span style="color:#e06c75">$http_user_agent&#34;,&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#98c379">&#39;&#34;real_ip&#34;:</span> <span style="color:#98c379">&#34;</span><span style="color:#e06c75">$http_x_forwarded_for&#34;,&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#98c379">&#39;&#34;request_time&#34;:</span> <span style="color:#e06c75">$request_time,&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#98c379">&#39;&#34;upstream_time&#34;:</span> <span style="color:#98c379">&#34;</span><span style="color:#e06c75">$upstream_response_time&#34;&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#98c379">&#39;</span>}<span style="color:#98c379">&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#c678dd">access_log</span> <span style="color:#98c379">/var/log/nginx/access.log</span> <span style="color:#98c379">json_analytics</span>;
</span></span></code></pre></div><p><strong>新增字段</strong>:</p>
<ul>
<li>
<p><strong><code>$request_time</code></strong></p>
<p>Nginx从接收到请求第一个字节到发送完最后一个字节的总时长（秒），性能指标</p>
</li>
<li>
<p><strong><code>$upstream_response_time</code></strong></p>
<p>从Nginx连接到上游后端服务到接收完响应头的时长，用于判断是 Nginx 慢还是后端服务慢</p>
</li>
</ul>
<p><strong>上面一个例子的JSON格式示例如下</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span>{<span style="color:#e06c75">&#34;timestamp&#34;</span>: <span style="color:#98c379">&#34;2025-08-16T14:30:00+09:00&#34;</span>, <span style="color:#e06c75">&#34;client_ip&#34;</span>: <span style="color:#98c379">&#34;111.111.111.111&#34;</span>, <span style="color:#e06c75">&#34;request&#34;</span>: <span style="color:#98c379">&#34;GET /api/users HTTP/1.1&#34;</span>, <span style="color:#e06c75">&#34;status&#34;</span>: <span style="color:#d19a66">200</span>, <span style="color:#e06c75">&#34;bytes_sent&#34;</span>: <span style="color:#d19a66">1500</span>, <span style="color:#e06c75">&#34;http_referer&#34;</span>: <span style="color:#98c379">&#34;-&#34;</span>, <span style="color:#e06c75">&#34;http_user_agent&#34;</span>: <span style="color:#98c379">&#34;curl/7.68.0&#34;</span>, <span style="color:#e06c75">&#34;real_ip&#34;</span>: <span style="color:#98c379">&#34;123.123.123.123&#34;</span>, <span style="color:#e06c75">&#34;request_time&#34;</span>: <span style="color:#d19a66">0.025</span>, <span style="color:#e06c75">&#34;upstream_time&#34;</span>: <span style="color:#98c379">&#34;0.024&#34;</span>}
</span></span></code></pre></div><p><strong>JSON日志使用<code>jq</code>工具可以轻松解析：</strong></p>
<p>统计状态码为500的请求数量:</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>cat access.log | jq <span style="color:#98c379">&#39;select(.status == 500)&#39;</span> | wc -l
</span></span></code></pre></div><p>找出请求时间最长的10个请求：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>cat access.log | jq <span style="color:#98c379">&#39;.request_time&#39;</span> | sort -nr | head -n <span style="color:#d19a66">10</span>
</span></span></code></pre></div><h4 id="docker环境下的日志">Docker环境下的日志
</h4><p>上文已经提到过，在Docker中，nginx日志输出到标准输出和标准错误，记录在docker的日志中</p>
<p>虽然日志本身的格式不会变，但Docker的日志驱动可能（取决于设置）会在每行日志前添加额外信息：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#e06c75">[时间戳]</span> [<span style="color:#e06c75">日志流</span>] [<span style="color:#e06c75">原始日志内容</span>]
</span></span></code></pre></div><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>字段</th>
          <th>含义</th>
          <th>示例</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>时间戳</strong></td>
          <td>Docker记录该日志的时间，精确到纳秒</td>
          <td><code>2025-08-20T02:30:00.123456789Z</code></td>
      </tr>
      <tr>
          <td><strong>日志流</strong></td>
          <td>指明日志来源：<br />标准输出：<code>stdout</code>，对应访问日志<br />标准错误：stderr`，对应错误日志</td>
          <td><code>stdout</code>或<code>stderr</code></td>
      </tr>
  </tbody>
</table></div>
<p><strong>实际Docker日志示例（还是上面的例子）</strong>：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#d19a66">2025</span>-<span style="color:#d19a66">08</span>-<span style="color:#d19a66">16</span><span style="color:#e06c75">T05</span>:<span style="color:#d19a66">45</span>:<span style="color:#d19a66">01.123456789</span><span style="color:#e06c75">Z</span> <span style="color:#e06c75">stdout</span> <span style="color:#e06c75">F</span> <span style="color:#d19a66">111.111</span>.<span style="color:#d19a66">111.111</span> - - [<span style="color:#d19a66">28</span>/<span style="color:#e06c75">Apr</span>/<span style="color:#d19a66">2021</span>:<span style="color:#d19a66">14</span>:<span style="color:#d19a66">44</span>:<span style="color:#d19a66">11</span> +<span style="color:#d19a66">0800</span>] <span style="color:#98c379">&#34;GET /api/channel/unread.jsp HTTP/1.1&#34;</span> <span style="color:#d19a66">200</span> <span style="color:#d19a66">65</span> <span style="color:#98c379">&#34;https://www.xxxx.cn/&#34;</span> <span style="color:#98c379">&#34;Mozilla/5.0...&#34;</span> <span style="color:#98c379">&#34;123.123.123.123&#34;</span>
</span></span></code></pre></div><ul>
<li>
<p><strong><code>2025-08-16T05:45:01.123456789Z</code></strong></p>
<p><strong>Docker捕获日志的UTC时间（纳秒精度）</strong></p>
</li>
<li>
<p><strong><code>stdout F</code></strong></p>
<p><strong>日志来源是stdout，并且标记为F，表示一行完整日志</strong></p>
<p><strong>此外还有P标记，示这是多行日志的一部分，被拆分了，需要和后续/前面的片段合并</strong></p>
</li>
</ul>
<p>可以直接通过管道分析<code>docker logs</code>的输出，但通常会配置Docker的日志驱动将这些日志流自动转发到集中的日志管理平台进行统一分析</p>
<p>比如，<strong>统计客户端IP出现次数的前10：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker logs nginx | awk <span style="color:#98c379">&#39;{print $4}&#39;</span> | sort | uniq -c | sort -nr | head -n <span style="color:#d19a66">10</span>
</span></span></code></pre></div><h3 id="错误日志errorlog">错误日志（error.log）
</h3><p><code>error.log</code> 记录 Nginx 启动和运行过程中的诊断信息，是排查问题的关键。</p>
<h4 id="一般格式">一般格式
</h4><pre tabindex="0"><code>时间戳 [错误级别] pid#tid: *cid 错误描述, client: 客户端IP, server: 服务端, request: &#34;请求行&#34;, host: &#34;Host&#34;
</code></pre><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>字段</th>
          <th>说明</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>时间戳</strong></td>
          <td>错误发生时间</td>
      </tr>
      <tr>
          <td><strong>[错误级别]</strong></td>
          <td>当前条目错误的错误等级，具体看：<a class="link" href="#%e5%85%a8%e5%b1%80%e5%9d%97" >错误等级
    
</a></td>
      </tr>
      <tr>
          <td><strong>pid#tid</strong></td>
          <td>Nginx工作进程ID和线程ID</td>
      </tr>
      <tr>
          <td>*<strong>cid</strong></td>
          <td>客户端连接序列号</td>
      </tr>
      <tr>
          <td><strong>错误描述</strong></td>
          <td>具体的错误信息，例如<code>connect() to 127.0.0.1:9000 failed (13: Permission denied)</code></td>
      </tr>
      <tr>
          <td><strong>client</strong></td>
          <td>发生错误的客户端IP</td>
      </tr>
      <tr>
          <td><strong>server</strong></td>
          <td>请求的服务端</td>
      </tr>
      <tr>
          <td><strong>request</strong></td>
          <td>请求行，如&quot;GET /api HTTP/1.1&quot;`</td>
      </tr>
      <tr>
          <td><strong>host</strong></td>
          <td>客户端请求的目标主机名</td>
      </tr>
  </tbody>
</table></div>
<p><strong>具体示例：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#d19a66">2025</span>/<span style="color:#d19a66">08</span>/<span style="color:#d19a66">16</span> <span style="color:#d19a66">14</span>:<span style="color:#d19a66">35</span>:<span style="color:#d19a66">00</span> [<span style="color:#e06c75">crit</span>] <span style="color:#d19a66">12345</span>#<span style="color:#d19a66">12345</span>: *<span style="color:#d19a66">6789</span> <span style="color:#e06c75">connect</span>() <span style="color:#e06c75">to</span> <span style="color:#d19a66">127.0</span>.<span style="color:#d19a66">0.1</span>:<span style="color:#d19a66">9000</span> <span style="color:#e06c75">failed</span> (<span style="color:#d19a66">13</span>: <span style="color:#e06c75">Permission</span> <span style="color:#e06c75">denied</span>) <span style="color:#c678dd">while</span> <span style="color:#e06c75">connecting</span> <span style="color:#e06c75">to</span> <span style="color:#e06c75">upstream</span>, <span style="color:#e06c75">client</span>: <span style="color:#d19a66">192.168</span>.<span style="color:#d19a66">1.10</span>, <span style="color:#e06c75">server</span>: <span style="color:#e06c75">example</span>.<span style="color:#e06c75">com</span>, <span style="color:#e06c75">request</span>: <span style="color:#98c379">&#34;GET /api HTTP/1.1&#34;</span>, <span style="color:#e06c75">host</span>: <span style="color:#98c379">&#34;example.com&#34;</span>
</span></span></code></pre></div><ul>
<li><strong>时间戳</strong>：<code>2025/08/16 14:35:00</code></li>
<li><strong>错误级别</strong>：<code>crit</code>（严重错误）</li>
<li><strong>pid#tid</strong>：<code>12345#12345</code></li>
<li>*<strong>cid</strong>：<code>*6789</code></li>
<li><strong>错误描述</strong>：<code>connect() to 127.0.0.1:9000 failed (13: Permission denied) while connecting to upstream</code></li>
<li><strong>客户端</strong>：<code>192.168.1.10</code></li>
<li><strong>服务端</strong>：<code>example.com</code></li>
<li><strong>请求</strong>：<code>&quot;GET /api HTTP/1.1&quot;</code></li>
<li><strong>Host</strong>：<code>example.com</code></li>
</ul>
<p><strong>分析</strong>：</p>
<p>客户端<code>192.168.1.10</code>请求 <code>/api</code>接口时，Nginx尝试连接上游服务<code>127.0.0.1:9000</code>失败，原因是权限被拒绝（<code>Permission denied</code>）。日志级别为 <code>crit</code>，说明这是严重错误，需要检查Nginx或上游服务的权限设置</p>
<h2 id="分析技巧">分析技巧
</h2><h3 id="网站流量核心指标分析-pv--uv">网站流量核心指标分析 (PV &amp; UV)
</h3><p>PV (Page View，页面浏览量) 和 UV (Unique Visitor，独立访客) 是衡量网站价值和用户行为趋势的重要指标</p>
<h4 id="统计总uv-根据ip">统计总UV (根据IP)
</h4><p><strong>提取第1个字段(IP)，排序，去重，最后统计独立IP总数：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>awk <span style="color:#98c379">&#39;{print $1}&#39;</span> access.log | sort | uniq | wc -l
</span></span></code></pre></div><h4 id="统计总pv">统计总PV
</h4><p><strong>直接统计日志总行数即为PV：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wc -l access.log
</span></span></code></pre></div><h4 id="统计某时间段的uv--pv">统计某时间段的UV / PV
</h4><p><strong>统计2021年4月28日14:00-14:59的UV：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>grep <span style="color:#98c379">&#34;28/Apr/2021:14&#34;</span> access.log | awk <span style="color:#98c379">&#39;{print $1}&#39;</span> | sort | uniq | wc -l
</span></span></code></pre></div><p><strong>使用sed进行更精确的时间段筛选 (14点到20点)：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sed -n <span style="color:#98c379">&#39;/28\/Apr\/2021:14/,/28\/Apr\/2021:20/p&#39;</span> access.log | awk <span style="color:#98c379">&#39;{print $1}&#39;</span> | sort | uniq | wc -l
</span></span></code></pre></div><h3 id="访问来源与异常排查-ip--url">访问来源与异常排查 (IP &amp; URL)
</h3><p>用于判断是否被攻击、接口是否存在Bug或排查流量报警</p>
<h4 id="查询访问最频繁的top-10-url">查询访问最频繁的Top 10 URL
</h4><p><strong>提取第7字段(URL)，排序，去重并计数，按计数值倒序排列:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>awk <span style="color:#98c379">&#39;{print $7}&#39;</span> access.log | sort | uniq -c | sort -k1 -nr | head -n <span style="color:#d19a66">10</span>
</span></span></code></pre></div><h4 id="查询访问最频繁的top-10-ip">查询访问最频繁的Top 10 IP
</h4><div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>awk <span style="color:#98c379">&#39;{print $1}&#39;</span> access.log | sort | uniq -c | sort -k1 -nr | head -n <span style="color:#d19a66">10</span>
</span></span></code></pre></div><h4 id="查看指定ip在某天访问了哪些-url-top-10">查看指定IP在某天访问了哪些 URL (Top 10)
</h4><div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span>grep <span style="color:#98c379">&#34;111.111.111.111&#34;</span> access.log | grep <span style="color:#98c379">&#34;28/Apr/2021&#34;</span> | awk <span style="color:#98c379">&#39;{print $7}&#39;</span> | sort | uniq -c | sort -nr | head -n <span style="color:#d19a66">10</span>
</span></span></code></pre></div><h3 id="性能与爬虫分析">性能与爬虫分析
</h3><h4 id="统计爬取次数">统计爬取次数
</h4><div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span>grep -i <span style="color:#98c379">&#39;spider\|bot&#39;</span> access.log | wc -l
</span></span></code></pre></div><h4 id="统计每分钟每秒的请求数-top-20">统计每分钟/每秒的请求数 (Top 20)
</h4><p><strong>每分钟: 截取时间字段($4)的第2到18位(到分钟)</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>awk <span style="color:#98c379">&#39;{print $4}&#39;</span> access.log | cut -c 2-18 | sort | uniq -c | sort -nr | head -n <span style="color:#d19a66">20</span>
</span></span></code></pre></div><p><strong>每秒: 截取时间字段($4)的第2到21位(到秒)</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>awk <span style="color:#98c379">&#39;{print $4}&#39;</span> access.log | cut -c 2-21 | sort | uniq -c | sort -nr | head -n <span style="color:#d19a66">20</span>
</span></span></code></pre></div><h3 id="分析请求响应时间-需自定义日志格式">分析请求响应时间 (需自定义日志格式)
</h3><p><strong>前提</strong>: 确保<code>log_format</code>中包含了<code>$request_time</code>，我们假设它在最后一个字段</p>
<h4 id="列出传输时间超过3秒的top10请求">列出传输时间超过3秒的Top10请求
</h4><p><strong>$NF代表最后一个字段，此命令筛选出最后一个字段值大于3的行：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Bash" data-lang="Bash"><span style="display:flex;"><span>awk <span style="color:#98c379">&#39;$NF &gt; 3 {print $NF, $7}&#39;</span> access.log | sort -k1 -nr | head -n <span style="color:#d19a66">10</span>
</span></span></code></pre></div><h4 id="列出最耗时的top10请求">列出最耗时的Top10请求
</h4><div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>awk <span style="color:#98c379">&#39;{print $NF, $7}&#39;</span> access.log | sort -k1 -nr | head -n <span style="color:#d19a66">10</span>
</span></span></code></pre></div><hr>
<p>暂时就先讲到这，毕竟只是入个门，详细使用就在实践里面学习吧</p>
<p>如果之后我需要更加深入使用，这篇文章也会更新的~</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/web/">Web</a>
        
            <a href="/tags/server/">Server</a>
        
    </section>


    <section class="article-lastmod">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <span>
            最后更新于 2025-08-24
        </span>
    </section></footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">相关文章</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/apache%E5%85%A5%E9%97%A8/">
        
        
            <div class="article-image">
                
                    <img src="http://picture.928330.xyz/typora/66d1339d8d7af.jpg" loading="lazy" data-key="" data-hash="http://picture.928330.xyz/typora/66d1339d8d7af.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Apache入门</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/wiresharktshark%E7%AE%80%E6%98%93%E6%8C%87%E5%8C%97/">
        
        
            <div class="article-image">
                
                    <img src="http://picture.928330.xyz/typora/wireshark-for-cybersecurity.jpg" loading="lazy" data-key="" data-hash="http://picture.928330.xyz/typora/wireshark-for-cybersecurity.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">wireshark&amp;tshark简易指北</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8Bdocker/">
        
        
            <div class="article-image">
                
                    <img src="http://picture.928330.xyz/typora/docker.jpg" loading="lazy" data-key="" data-hash="http://picture.928330.xyz/typora/docker.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">快速上手docker</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/volatility%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E/">
        
        
            <div class="article-image">
                
                    <img src="http://picture.928330.xyz/typora/11656e3e84668fccb365afc0b917f85b.jpg" loading="lazy" data-key="" data-hash="http://picture.928330.xyz/typora/11656e3e84668fccb365afc0b917f85b.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">volatility使用说明</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/vim%E7%BC%96%E8%BE%91%E5%99%A8%E5%AE%8C%E5%85%A8%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/">
        
        
            <div class="article-image">
                
                    <img src="http://picture.928330.xyz/typora/DeWatermark.ai_1756040226707.jpeg" loading="lazy" data-key="" data-hash="http://picture.928330.xyz/typora/DeWatermark.ai_1756040226707.jpeg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Vim编辑器完全使用教程</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src='//unpkg.com/@waline/client@v2/dist/waline.js'></script>
<link href='//unpkg.com/@waline/client@v2/dist/waline.css' rel='stylesheet'/>
<div id="waline" class="waline-container"></div>
<style>
    .waline-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
        --waline-font-size: var(--article-font-size);
    }
    .waline-container .wl-count {
        color: var(--card-text-color-main);
    }
</style><script>
    
    Waline.init({"dark":"html[data-scheme=\"dark\"]","el":"#waline","emoji":["https://npm.elemecdn.com/@waline/emojis@1.1.0/bilibili","https://npm.elemecdn.com/@waline/emojis@1.1.0/bmoji","https://npm.elemecdn.com/@waline/emojis@1.1.0/weibo"],"lang":"zh-cn","locale":{"admin":"Admin","placeholder":null},"pageview":true,"placeholder":"欢迎评论，不好的评论我会删🙄💅🏻","requiredMeta":["name","email","url"],"serverURL":"https://comment.928330.xyz/"});
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 2025 - 2025 kakahuote | 引用请注明文章链接
    </section>

    <section class="running-time">
        距离小站第一行代码被置下已经过去
        <span id="runningdays" class="running-days"></span>    
    </section>  

    <section class="powerby">
        使用 <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> 构建 <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计 <br />

        
        <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
        <script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
        

        <span>...当然还有kakahuote🤓👆</span>
    </section>
</footer>

    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >
    
    <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>
<style>
   
   
   
  @font-face {
   font-family: 'yuan';
   src: url('https://blog.928330.xyz/font/round.ttf') format('truetype');
  }

   
   
   
  :root {
   --base-font-family: 'yuan';
   --code-font-family: 'yuan';
  }

   
   
   
   
   
  #backTopBtn {
   position: fixed;
   bottom: 30px;
   right: 450px;
   z-index: 99;
   cursor: pointer;
   width: 32px;
   height: 32px;
   background-image: url('/icons/backTop.svg');
   background-size: cover;
   background-color: rgba(255, 255, 255, 0.9);
   border-radius: 50%;
   box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
   transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
   transform-origin: center center;
    
   animation: gentleFloat 3s ease-in-out infinite;
    
   overflow: visible;
  }

   
  [data-scheme="dark"] #backTopBtn {
   background-image: url('/icons/backTop-dark.svg') !important;
   background-color: rgba(0, 0, 0, 0.8) !important;
   box-shadow: 0 4px 20px rgba(255, 255, 255, 0.1) !important;
  }

   
  @media (prefers-color-scheme: dark) {
    #backTopBtn {
      background-image: url('/icons/backTop-dark.svg') !important;
      background-color: rgba(0, 0, 0, 0.8) !important;
      box-shadow: 0 4px 20px rgba(255, 255, 255, 0.1) !important;
    }
    
    .button-ripple {
      background-image: url('/icons/backTop-dark.svg') !important;
       
    }
  }

   
  html[data-scheme="dark"] #backTopBtn,
  body[data-scheme="dark"] #backTopBtn,
  .dark #backTopBtn,
  .dark-mode #backTopBtn {
    background-image: url('/icons/backTop-dark.svg') !important;
    background-color: rgba(0, 0, 0, 0.8) !important;
    box-shadow: 0 4px 20px rgba(255, 255, 255, 0.1) !important;
  }

  html[data-scheme="dark"] .button-ripple,
  body[data-scheme="dark"] .button-ripple,
  .dark .button-ripple,
  .dark-mode .button-ripple {
    background-image: url('/icons/backTop-dark.svg') !important;
     
  }

   
  [data-scheme="dark"] #backTopBtn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 10px solid #ffffff;
    transform: translate(-50%, -50%);
    z-index: 1;
     
    display: var(--show-css-arrow, none);
  }

   
  #backTopBtn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 10px solid #000000;
    transform: translate(-50%, -50%);
    z-index: 1;
     
    display: var(--show-css-arrow, none);
  }

   
  @keyframes gentleFloat {
   0%, 100% { transform: translateY(0px); }
   50% { transform: translateY(-6px); }
  }

   
  .button-ripple {
   position: absolute;
   top: 0;
   left: 0;
   width: 32px;
   height: 32px;
   border-radius: 50%;
   background-image: url('/icons/backTop.svg');
   background-size: cover;
   background-repeat: no-repeat;
   background-position: center;
   pointer-events: none;
   z-index: -1;
   animation: buttonRippleExpand 2.5s linear infinite;
   transform-origin: center center;
    
   will-change: transform, opacity;
   backface-visibility: hidden;
   perspective: 1000px;
   contain: layout style;
    
   transform: translateZ(0);
    
   transition: animation-duration 0.3s ease;
    
   --show-css-arrow: none !important;
    
   opacity: var(--ripple-opacity, 0.8) !important;
  }

   
  [data-scheme="dark"] .button-ripple {
   background-image: url('/icons/backTop-dark.svg') !important;
    
    
   --show-css-arrow: none !important;
  }

   
  @media (prefers-color-scheme: dark) {
    .button-ripple {
      background-image: url('/icons/backTop-dark.svg') !important;
       
       
      --show-css-arrow: none !important;
    }
  }

   
  .button-ripple.hover-mode {
   animation-duration: 1s;
  }

  @keyframes buttonRippleExpand {
   0% {
     --ripple-opacity: 0.8;
     transform: scale(1);
   }
   2% {
     --ripple-opacity: 0.78;
     transform: scale(1.02);
   }
   4% {
     --ripple-opacity: 0.76;
     transform: scale(1.04);
   }
   6% {
     --ripple-opacity: 0.74;
     transform: scale(1.06);
   }
   8% {
     --ripple-opacity: 0.72;
     transform: scale(1.08);
   }
   10% {
     --ripple-opacity: 0.7;
     transform: scale(1.1);
   }
   12% {
     --ripple-opacity: 0.68;
     transform: scale(1.12);
   }
   14% {
     --ripple-opacity: 0.66;
     transform: scale(1.14);
   }
   16% {
     --ripple-opacity: 0.64;
     transform: scale(1.16);
   }
   18% {
     --ripple-opacity: 0.62;
     transform: scale(1.18);
   }
   20% {
     --ripple-opacity: 0.6;
     transform: scale(1.2);
   }
   22% {
     --ripple-opacity: 0.58;
     transform: scale(1.22);
   }
   24% {
     --ripple-opacity: 0.56;
     transform: scale(1.24);
   }
   26% {
     --ripple-opacity: 0.54;
     transform: scale(1.26);
   }
   28% {
     --ripple-opacity: 0.52;
     transform: scale(1.28);
   }
   30% {
     --ripple-opacity: 0.5;
     transform: scale(1.3);
   }
   32% {
     --ripple-opacity: 0.48;
     transform: scale(1.32);
   }
   34% {
     --ripple-opacity: 0.46;
     transform: scale(1.34);
   }
   36% {
     --ripple-opacity: 0.44;
     transform: scale(1.36);
   }
   38% {
     --ripple-opacity: 0.42;
     transform: scale(1.38);
   }
   40% {
     --ripple-opacity: 0.4;
     transform: scale(1.4);
   }
   42% {
     --ripple-opacity: 0.38;
     transform: scale(1.42);
   }
   44% {
     --ripple-opacity: 0.36;
     transform: scale(1.44);
   }
   46% {
     --ripple-opacity: 0.34;
     transform: scale(1.46);
   }
   48% {
     --ripple-opacity: 0.32;
     transform: scale(1.48);
   }
   50% {
     --ripple-opacity: 0.3;
     transform: scale(1.5);
   }
   52% {
     --ripple-opacity: 0.28;
     transform: scale(1.52);
   }
   54% {
     --ripple-opacity: 0.26;
     transform: scale(1.54);
   }
   56% {
     --ripple-opacity: 0.24;
     transform: scale(1.56);
   }
   58% {
     --ripple-opacity: 0.22;
     transform: scale(1.58);
   }
   60% {
     --ripple-opacity: 0.2;
     transform: scale(1.6);
   }
   62% {
     --ripple-opacity: 0.18;
     transform: scale(1.62);
   }
   64% {
     --ripple-opacity: 0.16;
     transform: scale(1.64);
   }
   66% {
     --ripple-opacity: 0.14;
     transform: scale(1.66);
   }
   68% {
     --ripple-opacity: 0.12;
     transform: scale(1.68);
   }
   70% {
     --ripple-opacity: 0.1;
     transform: scale(1.7);
   }
   72% {
     --ripple-opacity: 0.08;
     transform: scale(1.72);
   }
   74% {
     --ripple-opacity: 0.07;
     transform: scale(1.74);
   }
   76% {
     --ripple-opacity: 0.06;
     transform: scale(1.76);
   }
   78% {
     --ripple-opacity: 0.05;
     transform: scale(1.78);
   }
   80% {
     --ripple-opacity: 0.04;
     transform: scale(1.8);
   }
   82% {
     --ripple-opacity: 0.035;
     transform: scale(1.82);
   }
   84% {
     --ripple-opacity: 0.03;
     transform: scale(1.84);
   }
   86% {
     --ripple-opacity: 0.025;
     transform: scale(1.86);
   }
   88% {
     --ripple-opacity: 0.02;
     transform: scale(1.88);
   }
   90% {
     --ripple-opacity: 0.015;
     transform: scale(1.9);
   }
   92% {
     --ripple-opacity: 0.01;
     transform: scale(1.92);
   }
   94% {
     --ripple-opacity: 0.008;
     transform: scale(1.94);
   }
   96% {
     --ripple-opacity: 0.005;
     transform: scale(1.96);
   }
   98% {
     --ripple-opacity: 0.002;
     transform: scale(1.98);
   }
   100% {
     --ripple-opacity: 0;
     transform: scale(2.0);
   }
  }

   
  .button-tooltip {
   position: absolute;
   bottom: 45px;
   right: 450px;
   background: rgba(0, 0, 0, 0.8);
   color: white;
   padding: 8px 12px;
   border-radius: 6px;
   font-size: 12px;
   white-space: nowrap;
   opacity: 0;
   transform: translateY(10px);
   transition: all 0.3s ease;
   pointer-events: none;
   z-index: 100;
  }

  .button-tooltip.show {
   opacity: 1;
   transform: translateY(0);
  }

  .button-tooltip::after {
   content: '';
   position: absolute;
   top: 100%;
   left: 50%;
   transform: translateX(-50%);
   border: 5px solid transparent;
   border-top-color: rgba(0, 0, 0, 0.8);
  }

   
  .hover-ripple-effect {
   display: none;
  }

   
  #backTopBtn:hover {
   transform: translateY(-8px) scale(1.1);
   box-shadow: 0 8px 30px rgba(0, 0, 0, 0.25);
   background-color: rgba(255, 255, 255, 1);
  }

   
  #backTopBtn.sprinting {
   animation: energyBurst 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
  }

  @keyframes energyBurst {
   0% {
     transform: scale(1) rotate(0deg);
     opacity: 1;
     filter: brightness(1) hue-rotate(0deg);
     box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
   }
   15% {
     transform: scale(1.2) rotate(0deg);
     opacity: 1;
     filter: brightness(1.2) hue-rotate(0deg);
     box-shadow: 0 0 25px rgba(255, 215, 0, 0.8), 0 0 50px rgba(255, 107, 107, 0.6);
   }
   30% {
     transform: scale(1.4) rotate(0deg);
     opacity: 1;
     filter: brightness(1.4) hue-rotate(60deg);
     box-shadow: 0 0 35px rgba(255, 182, 193, 0.8), 0 0 70px rgba(255, 215, 0, 0.6);
   }
   45% {
     transform: scale(1.6) rotate(0deg);
     opacity: 1;
     filter: brightness(1.6) hue-rotate(120deg);
     box-shadow: 0 0 45px rgba(173, 216, 230, 0.8), 0 0 90px rgba(255, 182, 193, 0.6);
   }
   60% {
     transform: scale(1.4) rotate(0deg);
     opacity: 1;
     filter: brightness(1.4) hue-rotate(180deg);
     box-shadow: 0 0 35px rgba(144, 238, 144, 0.8), 0 0 70px rgba(173, 216, 230, 0.6);
   }
   75% {
     transform: scale(1.2) rotate(0deg);
     opacity: 1;
     filter: brightness(1.2) hue-rotate(240deg);
     box-shadow: 0 0 25px rgba(255, 215, 0, 0.8), 0 0 50px rgba(144, 238, 144, 0.6);
   }
   90% {
     transform: scale(1.05) rotate(0deg);
     opacity: 1;
     filter: brightness(1.05) hue-rotate(300deg);
     box-shadow: 0 0 15px rgba(255, 107, 107, 0.6), 0 0 30px rgba(255, 215, 0, 0.4);
   }
   100% {
     transform: scale(1) rotate(0deg);
     opacity: 1;
     filter: brightness(1) hue-rotate(360deg);
     box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
   }
  }

   
  #backTopBtn.reappearing {
   animation: reappear 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
  }

   
  #backTopBtn.exploding {
   animation: explosionTransition 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
    
   z-index: 1000;
  }

   
  #backTopBtn.exploding .button-ripple {
   opacity: 0;
   animation-play-state: paused;
  }

  @keyframes explosionTransition {
   0% {
     transform: scale(1.6) rotate(0deg);
     opacity: 1;
     filter: brightness(1.6) hue-rotate(0deg);
     box-shadow: 0 0 50px rgba(255, 215, 0, 0.8), 0 0 100px rgba(255, 107, 107, 0.6);
   }
   30% {
     transform: scale(1.4) rotate(5deg);
     opacity: 1;
     filter: brightness(1.4) hue-rotate(120deg);
     box-shadow: 0 0 40px rgba(255, 182, 193, 0.8), 0 0 80px rgba(255, 215, 0, 0.6);
   }

   100% {
     transform: scale(1) rotate(0deg);
     opacity: 1;
     filter: brightness(1) hue-rotate(360deg);
     box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
   }
  }

  @keyframes reappear {
   0% {
     transform: scale(0.85);
     opacity: 0.7;
   }
   50% {
     transform: scale(1.05);
     opacity: 1;
   }
   100% {
     transform: scale(1);
     opacity: 1;
   }
  }

  #backTopBtn.rotating {
   animation: rotate360 0.6s ease-in-out;
  }

  @keyframes rotate360 {
   0% { transform: rotate(0deg); }
   100% { transform: rotate(360deg); }
  }

   
  .particle {
   position: absolute;
   top: 50%;
   left: 50%;
   width: 4px;
   height: 4px;
   background: radial-gradient(circle, #fff, #ffd700, #ff69b4, #87ceeb);
   border-radius: 50%;
   pointer-events: none;
   z-index: -2;
   animation: particleExplode 1s ease-out forwards;
  }

  @keyframes particleExplode {
   0% {
     transform: translate(-50%, -50%) scale(0);
     opacity: 1;
   }
   50% {
     opacity: 1;
   }
   100% {
     transform: translate(-50%, -50%) scale(1) translate(var(--x), var(--y));
     opacity: 0;
   }
  }

   
  .energy-wave {
   position: absolute;
   top: 50%;
   left: 50%;
   width: 0;
   height: 0;
   border: 2px solid transparent;
   border-radius: 50%;
   pointer-events: none;
   z-index: -3;
   animation: energyWave 1.2s ease-out forwards;
  }

  @keyframes energyWave {
   0% {
     width: 0;
     height: 0;
     border-color: rgba(255, 215, 0, 0.8);
     opacity: 1;
   }
   100% {
     width: 120px;
     height: 120px;
     border-color: rgba(255, 215, 0, 0);
     opacity: 0;
   }
  }

   
  .hero-aura {
   position: absolute;
   top: 50%;
   left: 50%;
   width: 100%;
   height: 100%;
   border-radius: 50%;
   background: conic-gradient(from 0deg, #ffd700, #ff69b4, #87ceeb, #98fb98, #ffa07a, #ffd700);
   background-size: 200% 200%;
   pointer-events: none;
   z-index: -4;
   animation: heroAura 2s linear infinite;
   opacity: 0;
   transition: opacity 0.3s ease;
  }

  #backTopBtn.sprinting .hero-aura {
   opacity: 0.6;
  }

  @keyframes heroAura {
   0% {
     background-position: 0% 0%;
     transform: translate(-50%, -50%) rotate(0deg);
   }
   100% {
     background-position: 100% 100%;
     transform: translate(-50%, -50%) rotate(360deg);
   }
  }

   
      @media (max-width: 768px) {
     #backTopBtn {
       left: 20px !important;  
       right: auto !important;
       bottom: 20px;
       width: 28px;
       height: 28px;
     }
     
     .button-tooltip {
       left: 20px !important;  
       right: auto !important;
       bottom: 35px;
     }
    }
  
    @media (max-width: 480px) {
     #backTopBtn {
       left: 15px !important;  
       right: auto !important;
       bottom: 15px;
       width: 26px;
       height: 26px;
     }
     
     .button-tooltip {
       left: 15px !important;
       right: auto !important;
       bottom: 31px;
     }
    }

   
   
   
  .no-text-selection {
    -webkit-user-select: none;  
    -moz-user-select: none;     
    -ms-user-select: none;      
    user-select: none;          
  }

   
   
   
  #rope-container {
    position: fixed;
    top: 0;
    left: 20px;
    z-index: 10000;
    width: 50px;
    height: 480px;
    pointer-events: none;
  }
  
   
  #rope-physics-container {
    pointer-events: auto !important;
  }
  
   
  #rope-svg-container svg {
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
  }
  
  #rope-svg-container path {
    transition: all 0.1s ease-out;
  }
  
   
  #rope-svg-container path,
  #rope-path {
    stroke: #4b2b0f !important;
    stroke-width: 2.5 !important;
  }
  
   
  #rope-svg-container svg path {
    stroke: #4b2b0f !important;
    stroke-width: 2.5 !important;
  }
  


  #rope {
    position: absolute;
    top: -80px;
    left: 50%;
    width: 3px;
    height: 400px;
    background: linear-gradient(to bottom, #654321, #8B4513, #A0522D, #8B4513, #654321);
    border-radius: 1.5px;
    transform: translateX(-50%);
    pointer-events: auto;
    transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    box-shadow: 0 1px 3px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.1);
  }

  #pull-ring {
    position: absolute;
    top: 300px;
    left: 50%;
    font-size: 20px;
    color: #ffffff;
    text-shadow: 0 0 8px rgba(255, 255, 255, 0.8);
    transform: translateX(-50%);
    pointer-events: auto;
    transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
  }

  #rope:hover {
    box-shadow: 0 2px 6px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.2);
  }

  #pull-ring:hover {
    transform: translateX(-50%) scale(1.2);
    text-shadow: 0 0 12px rgba(255, 255, 255, 1);
    filter: drop-shadow(0 4px 8px rgba(0,0,0,0.5));
  }

   
   
   
  .highlight {
   max-height: 400px;
   overflow: hidden;
   position: relative;
   transition: max-height 0.3s ease-out;
  }

  .code-show {
   max-height: none !important;
  }

  .code-more-box {
   width: 100%;
   padding-top: 20px;
   background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0), #fff);
   position: absolute;
   left: 0;
   right: 0;
   bottom: 0;
   z-index: 1;
   text-align: center;
  }

  .code-more-btn {
   display: inline-block;
   padding: 5px 15px;
   background: #f0f0f5;
   border-radius: 5px;
   cursor: pointer;
   font-size: 0.9em;
  }

   
   
   
  #particles-js {
   position: fixed;
   top: 0;
   left: 0;
    width: 100vw;
    height: 100vh;
   z-index: -1;
    pointer-events: none;
  }
  
  #particles-js canvas {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
  }

   
   
   
  .toc-lock-btn {
    position: absolute;
    top: 32px;
    right: 5px;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border-radius: 50%;
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    background: rgba(0, 0, 0, 0.05);
    color: rgba(0, 0, 0, 0.7);
    z-index: 100;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }
  
  .toc-lock-btn:hover {
    background: rgba(0, 0, 0, 0.1);
    transform: scale(1.1);
    border-color: rgba(0, 0, 0, 0.2);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
  }
  
  .toc-lock-btn:active {
    transform: scale(0.95);
  }
  
   
  .toc-lock-btn:focus {
    outline: none;
    border-color: rgba(0, 0, 0, 0.4);
    box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1), 0 2px 8px rgba(0, 0, 0, 0.1);
    background: rgba(0, 0, 0, 0.08);
  }
  
  .toc-lock-btn:focus-visible {
    outline: none;
    border-color: rgba(0, 0, 0, 0.4);
    box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1), 0 2px 8px rgba(0, 0, 0, 0.1);
    background: rgba(0, 0, 0, 0.08);
  }
  
  .toc-lock-btn.locked {
    color: rgba(0, 0, 0, 0.9);
    background: rgba(0, 0, 0, 0.1);
    border-color: rgba(0, 0, 0, 0.3);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  }
  
  .toc-lock-btn.locked:hover {
    background: rgba(0, 0, 0, 0.15);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.25);
  }
  
  .toc-lock-btn.locked .lock-icon.locked {
    display: block;
  }
  
  .toc-lock-btn.locked .lock-icon.unlocked {
    display: none;
  }
  
  .toc-lock-btn .lock-icon.locked {
    display: none;
  }
  
  .toc-lock-btn .lock-icon.unlocked {
    display: block;
  }
  
  .toc-lock-btn .lock-icon {
    width: 14px;
    height: 14px;
    stroke: currentColor;
    fill: none;
    stroke-width: 2.5;
    stroke-linecap: round;
    stroke-linejoin: round;
    transition: all 0.3s ease;
  }
  
   
  .toc-lock-label {
    position: absolute;
    top: 38px;
    right: 28px;
    font-size: 16px;
    color: rgba(0, 0, 0, 0.6);
    font-weight: 700;
    z-index: 100;
    user-select: none;
    pointer-events: none;
    line-height: 1;
    display: flex;
    align-items: center;
  }

   
  [data-scheme="dark"] .toc-lock-btn {
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.7);
  }
  
  [data-scheme="dark"] .toc-lock-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
    box-shadow: 0 4px 16px rgba(255, 255, 255, 0.15);
  }
  
   
  [data-scheme="dark"] .toc-lock-btn:focus,
  [data-scheme="dark"] .toc-lock-btn:focus-visible {
    outline: none;
    border-color: rgba(255, 255, 255, 0.4);
    box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1), 0 2px 8px rgba(255, 255, 255, 0.1);
    background: rgba(255, 255, 255, 0.08);
  }
  
  [data-scheme="dark"] .toc-lock-btn.locked {
    color: rgba(255, 255, 255, 0.9);
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.3);
    box-shadow: 0 2px 8px rgba(255, 255, 255, 0.2);
  }
  
  [data-scheme="dark"] .toc-lock-btn.locked:hover {
    background: rgba(255, 255, 255, 0.15);
    box-shadow: 0 4px 16px rgba(255, 255, 255, 0.25);
  }
  
   
  [data-scheme="dark"] .toc-lock-label {
    color: rgba(255, 255, 255, 0.6);
  }

   
  #TableOfContents[data-scrollspy-disabled="true"] {
    opacity: 0.8 !important;
  }
  
  #TableOfContents[data-scrollspy-disabled="true"] .active-class {
     
    display: block !important;
    opacity: 1 !important;
  }
  
  #TableOfContents[data-scrollspy-disabled="true"] a {
    cursor: pointer !important;
  }
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

<script>
   
   
   

  let s1 = '2025-5-8 15:00:00'; 
  s1 = new Date(s1.replace(/-/g, "/"));
  let s2 = new Date();
  let timeDifference = s2.getTime() - s1.getTime();

  let days = Math.floor(timeDifference / (1000 * 60 * 60 * 24));
  let hours = Math.floor((timeDifference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  let minutes = Math.floor((timeDifference % (1000 * 60 * 60)) / (1000 * 60));

  let result = days + "天" + hours + "小时" + minutes + "分钟";
  if (document.getElementById('runningdays')) {
      document.getElementById('runningdays').innerHTML = result;
  }
  
   
   
   
  
  

  function startContinuousRipple(button) {
   
   const buttonRipple = document.createElement('div');
   buttonRipple.className = 'button-ripple';
   button.appendChild(buttonRipple);
   
   
   button.buttonRipple = buttonRipple;
  }
  
  

  function createContinuousRipple(button) {
   
   if (button.querySelector('.continuous-ripple')) {
     return;
   }
   
   
   const rippleContainer = document.createElement('div');
   rippleContainer.className = 'ripple-container continuous-ripple';
   
   
   const ripple = document.createElement('div');
   ripple.className = 'ripple';
   ripple.style.background = 'radial-gradient(circle, rgba(255, 107, 107, 0.8) 0%, rgba(255, 255, 255, 0.9) 100%)';
   
   rippleContainer.appendChild(ripple);
   button.appendChild(rippleContainer);
   
   
   setTimeout(() => {
     if (rippleContainer.parentNode) {
       rippleContainer.parentNode.removeChild(rippleContainer);
     }
   }, 800);
  }
  
  

  function createHoverRipple(button) {
   
   if (button.buttonRipple) {
     
     button.buttonRipple.style.animationDuration = '1s';
     button.buttonRipple.classList.add('hover-mode');
   }
  }
  
  

  function showTooltip(button) {
   
   hideTooltip();
   
   
   const tooltip = document.createElement('div');
   tooltip.className = 'button-tooltip';
   tooltip.textContent = '返回顶部';
   document.body.appendChild(tooltip);
   
   
   setTimeout(() => {
     tooltip.classList.add('show');
   }, 10);
   
   
   button.tooltip = tooltip;
  }
  
  

  function hideTooltip() {
   const existingTooltip = document.querySelector('.button-tooltip');
   if (existingTooltip) {
     existingTooltip.classList.remove('show');
     setTimeout(() => {
       if (existingTooltip.parentNode) {
         existingTooltip.parentNode.removeChild(existingTooltip);
       }
     }, 300);
   }
  }
  
  

  function createRippleEffect(button) {
   
   
   
   const energyWave = document.createElement('div');
   energyWave.className = 'energy-wave';
   document.body.appendChild(energyWave);
   
   
   createParticleExplosion(button);
   
   
   setTimeout(() => {
     if (energyWave.parentNode) {
       energyWave.parentNode.removeChild(energyWave);
     }
   }, 1200);
  }

  

  function createParticleExplosion(button) {
   const particleCount = 16; 
   
   
   const particleColors = [
     'radial-gradient(circle, #ff6b6b, #ffd93d, #6bcf7f, #4d96ff)',
     'radial-gradient(circle, #ff8e8e, #ffed4e, #7ddb8f, #6ba6ff)',
     'radial-gradient(circle, #ffa1a1, #fff15f, #8ee79f, #89b6ff)',
     'radial-gradient(circle, #ffb4b4, #fff570, #9ff3af, #a7c6ff)'
   ];
   
   for (let i = 0; i < particleCount; i++) {
     const particle = document.createElement('div');
     particle.className = 'particle';
     
     
     const randomColor = particleColors[Math.floor(Math.random() * particleColors.length)];
     particle.style.background = randomColor;
     
     
     const angle = (i / particleCount) * 2 * Math.PI;
     const distance = 40 + Math.random() * 30; 
     const x = Math.cos(angle) * distance;
     const y = Math.sin(angle) * distance;
     
     particle.style.setProperty('--x', `${x}px`);
     particle.style.setProperty('--y', `${y}px`);
     
     
     particle.style.animationDelay = `${Math.random() * 0.4}s`;
     
     button.appendChild(particle);
     
     
     setTimeout(() => {
       if (particle.parentNode) {
         particle.parentNode.removeChild(particle);
       }
     }, 1000);
   }
  }

   
   
   
  

  function initScrollTop() {
   let rightSideBar = document.querySelector(".right-sidebar");
   if (!rightSideBar) {
    return;
   }

   
   let btn = document.createElement("div");
   btn.id = "backTopBtn";
   let isRotating = false; 

   
   const heroAura = document.createElement('div');
   heroAura.className = 'hero-aura';
   btn.appendChild(heroAura);

   
   btn.addEventListener('mouseenter', function() {
     createHoverRipple(this);
     showTooltip(this);
   });
   
   
   btn.addEventListener('mouseleave', function() {
     if (this.buttonRipple) {
       
       this.buttonRipple.style.animationDuration = '2s';
       this.buttonRipple.classList.remove('hover-mode');
     }
     hideTooltip();
   });

   btn.onclick = function() {
    if (!isRotating) {
     isRotating = true;
     backToTop(this, () => {
      isRotating = false; 
     });
    }
   };
   rightSideBar.appendChild(btn);

   
   btn.style.display = "block";
   
   
   startContinuousRipple(btn);
  }

  

  function backToTop(button, onComplete) {
   
   button.classList.add('sprinting');
   
   
   if (button.buttonRipple) {
     button.buttonRipple.style.display = 'none';
   }
   
   
   createRippleEffect(button);
   
   
   window.scrollTo({ top: 0, behavior: "smooth" });
   
   
   const checkScrollComplete = () => {
     if (window.scrollY === 0) {
       
       button.classList.remove('sprinting');
       
       
       button.classList.add('exploding');
       
       
       createParticleExplosion(button);
       
       
       if (button.buttonRipple) {
         button.buttonRipple.style.display = 'block';
       }
       
       
       setTimeout(() => {
         button.classList.remove('exploding');
         
         
         if (button.buttonRipple) {
           
           button.buttonRipple.style.animationPlayState = 'paused';
           
           button.buttonRipple.style.animation = 'none';
           button.buttonRipple.offsetHeight; 
           button.buttonRipple.style.animation = 'buttonRippleExpand 2s steps(25, end) infinite';
           button.buttonRipple.style.animationPlayState = 'running';
         }
         
         button.classList.add('reappearing');
         
         
         setTimeout(() => {
           button.classList.remove('reappearing');
           if (onComplete) {
             onComplete();
           }
         }, 600);
       }, 800); 
       
       return;
     }
     requestAnimationFrame(checkScrollComplete);
   };
   
   checkScrollComplete();
  }

  
  initScrollTop();
  
   
   
   
  

  function initRope() {


    if (typeof Matter === 'undefined') {
      console.error('Matter.js 库未加载，无法初始化物理绳索。');
      return;
    }
    if (document.getElementById('rope-physics-container')) {

      return;
    }

    let ropeContainer = document.getElementById('rope-container');
    if (!ropeContainer) {
      console.error('#rope-container 元素未在 HTML 或 CSS 中找到。');
      return;
    }
    
    ropeContainer.innerHTML = '';
    ropeContainer.style.height = '100vh';
    ropeContainer.style.pointerEvents = 'none';

    const monthlyEmojis = [
      { month: 1, name: "一月", ring: "❄️", falling: "❄️", description: "寒冬腊月，雪花飞舞" },
      { month: 2, name: "二月", ring: "🏮", falling: "🏮", description: "新春正月，灯笼高挂" },
      { month: 3, name: "三月", ring: "🌸", falling: "🌸", description: "春暖花开，樱花绽放" },
      { month: 4, name: "四月", ring: "🌧️", falling: "🌧️", description: "清明时节，春雨绵绵" },
      { month: 5, name: "五月", ring: "🌺", falling: "🌺", description: "立夏时节，牡丹盛开" },
      { month: 6, name: "六月", ring: "🌻", falling: "🌻", description: "芒种时节，向日葵开" },
      { month: 7, name: "七月", ring: "🌿", falling: "🌿", description: "小暑时节，绿意盎然" },
      { month: 8, name: "八月", ring: "🍉", falling: "🍉", description: "七夕时节，西瓜清甜" },
      { month: 9, name: "九月", ring: "🍁", falling: "🍁", description: "白露时节，秋葉飘落" },
      { month: 10, name: "十月", ring: "🍂", falling: "🍂", description: "寒露时节，落叶纷飞" },
      { month: 11, name: "十一月", ring: "🍊", falling: "🍊", description: "霜降时节，柑橘飘香" },
      { month: 12, name: "十二月", ring: "🌨️", falling: "🌨️", description: "大雪时节，雪花纷飞" }
    ];
    window.timeEmojis = [
      { period: "morning", name: "早晨", emojis: ["☀️", "🌤️", "🌱", "🌺", "🌿"], description: "晨曦初露，万物苏醒" },
      { period: "noon", name: "中午", emojis: ["🌞", "🌻", "🦋", "🦜", "🐝"], description: "烈日当空，生机勃勃" },
      { period: "evening", name: "傍晚", emojis: ["🌙", "⭐", "🦉"], description: "夕阳西下，夜幕降临" }
    ];
    const currentMonth = new Date().getMonth() + 1;
    const currentEmoji = monthlyEmojis.find(emoji => emoji.month === currentMonth);
    
    const ropeContainerLeft = 20;
    const ropeContainerWidth = 50;
    const ropeAnchorX = ropeContainerLeft + (ropeContainerWidth / 2);

    const { Engine, World, Bodies, Composite, Constraint, Runner, Mouse, MouseConstraint, Events, Body } = Matter;

    const engine = Engine.create();
    const world = engine.world;
    
    
    
    
    engine.world.gravity.y = 0;

    
    
    
    const ropeSegments = 80; 
    const segmentRadius = 1.5; 
    const segmentRenderHeight = 6; 
    const segmentRenderWidth = 4; 
    const constraintLength = 2.5; 

    const ropeGroup = Matter.Body.nextGroup(true);
    const ropeChain = Composite.create({ label: 'Rope' });

    
    for (let i = 0; i < ropeSegments - 1; i++) {
      const segment = Bodies.circle(ropeAnchorX, i * constraintLength, segmentRadius, {
          collisionFilter: { group: ropeGroup },
          density: 0.1, 
          friction: 0.4, 
          frictionAir: 0.08, 
          restitution: 0.02 
      });
      Composite.add(ropeChain, segment);
    }

    
    const pullRingBody = Bodies.circle(
      ropeAnchorX,
      (ropeSegments - 1) * constraintLength,
      15,
      {
        collisionFilter: { group: ropeGroup },
        density: 0.01, 
        friction: 0.5,  
        frictionAir: 0.1, 
        restitution: 0.02 
      }
    );
    Composite.add(ropeChain, pullRingBody);
    World.add(world, ropeChain);

    
    Composite.addConstraint(ropeChain, Constraint.create({
      bodyB: ropeChain.bodies[0],
      pointA: { x: ropeAnchorX, y: 0 },
      stiffness: 1 
    }));

    for (let i = 0; i < ropeSegments - 1; i++) {
      Composite.addConstraint(ropeChain, Constraint.create({
        bodyA: ropeChain.bodies[i],
        bodyB: ropeChain.bodies[i + 1],
        
        
        
        stiffness: 0.8, 
        damping: 0.8,   
        length: constraintLength * 0.6, 
        
        render: {
          visible: false
        }
      }));
    }
    
    const domContainer = document.createElement('div');
    domContainer.id = 'rope-physics-container';
    domContainer.style.position = 'fixed';
    domContainer.style.top = '0';
    domContainer.style.left = '0';
    domContainer.style.pointerEvents = 'auto'; 
    domContainer.style.zIndex = '10000';
    document.body.appendChild(domContainer);

    
    const svgContainer = document.createElement('div');
    svgContainer.id = 'rope-svg-container';
    svgContainer.style.cssText = `
      position: absolute;
      top: 0;
      left: 0;
      width: 100px;
      height: 100vh;
      pointer-events: none;
      z-index: 1;
      overflow: visible;
    `;
    domContainer.appendChild(svgContainer);
    
    
    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    svg.setAttribute('width', '100');
    svg.setAttribute('height', '100vh');
    svg.setAttribute('viewBox', '0 0 100 100vh');
    svg.style.cssText = `
      position: absolute;
      top: 0;
      left: 0;
      width: 100px;
      height: 100vh;
      overflow: visible;
    `;
    svgContainer.appendChild(svg);
    
    
    const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
    const gradient = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
    gradient.setAttribute('id', 'ropeGradient');
    gradient.setAttribute('x1', '0%');
    gradient.setAttribute('y1', '0%');
    gradient.setAttribute('x2', '0%');
    gradient.setAttribute('y2', '100%');
    
    const stop1 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    stop1.setAttribute('offset', '0%');
    stop1.setAttribute('stop-color', '#654321');
    
    const stop2 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    stop2.setAttribute('offset', '25%');
    stop2.setAttribute('stop-color', '#8B4513');
    
    const stop3 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    stop3.setAttribute('offset', '50%');
    stop3.setAttribute('stop-color', '#A0522D');
    
    const stop4 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    stop4.setAttribute('offset', '75%');
    stop4.setAttribute('stop-color', '#8B4513');
    
    const stop5 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    stop5.setAttribute('offset', '100%');
    stop5.setAttribute('stop-color', '#654321');
    
    gradient.appendChild(stop1);
    gradient.appendChild(stop2);
    gradient.appendChild(stop3);
    gradient.appendChild(stop4);
    gradient.appendChild(stop5);
    defs.appendChild(gradient);
    svg.appendChild(defs);
    
    
    const ropePath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    ropePath.setAttribute('fill', 'none');
    
    ropePath.setAttribute('stroke', '#4b2b0f');
    ropePath.setAttribute('stroke-width', '2.5');
    ropePath.setAttribute('stroke-linecap', 'round');
    ropePath.setAttribute('stroke-linejoin', 'round');
    ropePath.setAttribute('id', 'rope-path'); 
    svg.appendChild(ropePath);
    
    
    ropePath.setAttribute('d', `M 50 0 L 50 400`);
    
    
    
    
    
    const pullRingDiv = document.createElement('div');
    pullRingDiv.id = 'pull-ring-physics';
    pullRingDiv.innerHTML = currentEmoji.ring;
    pullRingDiv.title = `${currentEmoji.name}: ${currentEmoji.description}`;
    pullRingDiv.style.cssText = `
      font-size: 24px; cursor: grab; pointer-events: auto;
      width: 30px; height: 30px; text-align: center;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); position: absolute;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      z-index: 2;
      transform: translate(40px, 300px); /* 初始位置，向右移动5px */
    `;
    
    
    pullRingDiv.addEventListener('mousedown', () => {
      pullRingDiv.style.cursor = 'grabbing';
    });
    
    pullRingDiv.addEventListener('mouseup', () => {
      pullRingDiv.style.cursor = 'grab';
    });
    
    domContainer.appendChild(pullRingDiv);
    
    
    const ropeElements = {
      svg: svg,
      path: ropePath,
      pullRing: pullRingDiv
    };

    const mouse = Mouse.create(document.body);
    const mouseConstraint = MouseConstraint.create(engine, {
      mouse: mouse,
      constraint: { 
        stiffness: 0.8, 
        render: { visible: false },
        
        length: 0,
        damping: 0.05 
      }
    });
    World.add(world, mouseConstraint);
    
    
    mouseConstraint.constraint.bodyB = null;
    
    
    Events.on(mouseConstraint, 'mousedown', (event) => {

    });
    
    
    mouseConstraint.mouse.element = document.body;
    
    
    let dragStartPosition = null;
    
    Events.on(mouseConstraint, 'startdrag', () => {
      document.body.classList.add('no-text-selection');
      
      
      if (mouseConstraint.body && mouseConstraint.body === pullRingBody) {
        dragStartPosition = {
          x: mouseConstraint.body.position.x,
          y: mouseConstraint.body.position.y
        };
      }
    });
    
    Events.on(mouseConstraint, 'enddrag', () => {
      document.body.classList.remove('no-text-selection');
      
      
      
      if (dragStartPosition) {
        
        const currentPosition = pullRingBody.position;
        const dragDistance = Math.sqrt(
          Math.pow(currentPosition.x - dragStartPosition.x, 2) +
          Math.pow(currentPosition.y - dragStartPosition.y, 2)
        );
        
        
        if (dragDistance > 1) {
          createSeasonalFalling(currentEmoji);
          
          
          Matter.Body.applyForce(pullRingBody, pullRingBody.position, { x: 0, y: 0.5 });
          
          
          const targetX = ropeAnchorX;
          const targetY = (ropeSegments - 1) * constraintLength;
          
          
          const dx = targetX - currentPosition.x;
          const dy = targetY - currentPosition.y;
          
          
          Matter.Body.applyForce(pullRingBody, pullRingBody.position, { 
            x: dx * 0.001, 
            y: dy * 0.001 
          });
          
        }
        
        
        dragStartPosition = null;
      }
    });
    


    
    (function render() {
      
      let pathData = '';
      
      
      const topPoint = { x: 50, y: 0 }; 
      pathData += `M ${topPoint.x} ${topPoint.y}`;
      
      
      ropeChain.bodies.forEach((body, index) => {
        if (index < ropeSegments - 1) { 
          const relativeX = body.position.x - ropeAnchorX + 50; 
          const relativeY = body.position.y;
          pathData += ` L ${relativeX} ${relativeY}`;
        }
      });
      
      
      const pullRingBody = ropeChain.bodies[ropeSegments - 1];
      if (pullRingBody) {
        const relativeX = pullRingBody.position.x - ropeAnchorX + 50; 
        const relativeY = pullRingBody.position.y;
        pathData += ` L ${relativeX} ${relativeY}`;
      }
      
      
      ropeElements.path.setAttribute('d', pathData);
      
      
      if (pullRingBody) {
        
        
        const adjustedX = pullRingBody.position.x - 15 + 3.5; 
        const adjustedY = pullRingBody.position.y - 15;
        
        ropeElements.pullRing.style.transform = `translate(
          ${adjustedX}px,
          ${adjustedY}px
        )`;
        

      }
      
      setTimeout(() => requestAnimationFrame(render), 1000 / 240); 
    })();
    
    
    
    const runner = Runner.create();
    
    runner.delta = 1000 / 240; 
    Runner.run(runner, engine);

    
    
    
    setTimeout(() => {
      engine.world.gravity.y = 1.2;
    }, 100); 

    
    
    
    
    
    ropeChain.bodies.forEach((body, index) => {
      Matter.Body.set(body, 'sleeping', false);
      
      body.sleepThreshold = Infinity;
    });
    
    
    engine.enableSleeping = false;
    
    
    mouseConstraint.constraint.bodyB = null;
    mouseConstraint.mouse.element = document.body;


  }

  

  function createSeasonalFalling(emojiConfig) {

   
   
   const fallingContainer = document.createElement('div');
   fallingContainer.id = 'falling-container';
   fallingContainer.style.cssText = `
     position: fixed;
     top: 0;
     left: 0;
     width: 100vw;
     height: 100vh;
     pointer-events: none;
     z-index: 9999;
     overflow: hidden;
   `;
   document.body.appendChild(fallingContainer);

   
   
   const currentHour = new Date().getHours();
   let currentTimePeriod;
   if (currentHour >= 5 && currentHour < 11) {
    currentTimePeriod = window.timeEmojis.find(t => t.period === "morning");
   } else if (currentHour >= 11 && currentHour < 17) {
    currentTimePeriod = window.timeEmojis.find(t => t.period === "noon");
   } else {
    currentTimePeriod = window.timeEmojis.find(t => t.period === "evening");
   }
   

   
   
   const totalElements = emojiConfig.month >= 11 || emojiConfig.month <= 2 ? 30 : 25; 
   let activeElements = 0;
   

   
   for (let i = 0; i < totalElements; i++) {
    setTimeout(() => {
     const element = document.createElement('div');
     
     
     let selectedEmoji, emojiType;
     if (Math.random() < 0.7) {
      selectedEmoji = emojiConfig.falling;
      emojiType = "monthly";
     } else {
      
      selectedEmoji = currentTimePeriod.emojis[Math.floor(Math.random() * currentTimePeriod.emojis.length)];
      emojiType = "time";
     }
     

     element.innerHTML = selectedEmoji;
     
     
     let fontSize, color, textShadow;
     if (emojiType === "time") {
      
      if (currentTimePeriod.period === "morning") {
       
       fontSize = Math.random() * 18 + 16;
       color = '#FFD700';
       textShadow = '0 0 5px rgba(255, 215, 0, 0.7)';
      } else if (currentTimePeriod.period === "noon") {
       
       fontSize = Math.random() * 18 + 16;
       color = '#FF8C00';
       textShadow = '0 0 5px rgba(255, 140, 0, 0.7)';
      } else {
       
       fontSize = Math.random() * 18 + 16;
       color = '#4B0082';
       textShadow = '0 0 5px rgba(75, 0, 130, 0.7)';
      }
     } else {
      
      if (emojiConfig.month >= 11 || emojiConfig.month <= 2) {
       
       fontSize = Math.random() * 20 + 15;
       color = 'white';
       textShadow = '0 0 5px rgba(255, 255, 255, 0.8)';
      } else if (emojiConfig.month >= 3 && emojiConfig.month <= 5) {
       
       fontSize = Math.random() * 18 + 16;
       color = '#FF69B4';
       textShadow = '0 0 5px rgba(255, 105, 180, 0.6)';
      } else if (emojiConfig.month >= 6 && emojiConfig.month <= 8) {
       
       fontSize = Math.random() * 18 + 15;
       color = '#32CD32';
       textShadow = '0 0 5px rgba(50, 205, 50, 0.6)';
      } else {
       
       fontSize = Math.random() * 18 + 15;
       color = '#FF8C00';
       textShadow = '0 0 5px rgba(255, 140, 0, 0.6)';
      }
     }
     
     element.style.cssText = `
       position: absolute;
       font-size: ${fontSize}px;
       color: ${color};
       text-shadow: ${textShadow};
       left: ${Math.random() * window.innerWidth}px;
       top: -50px;
       user-select: none;
       pointer-events: none;
       z-index: 9999;
       transition: all 0.3s ease;
     `;
     
     fallingContainer.appendChild(element);
     activeElements++;
     
     
     const duration = 4000 + Math.random() * 2000;
     const endX = parseFloat(element.style.left) + (Math.random() - 0.5) * 400;
     const endY = window.innerHeight + 50;
     
     element.style.transition = `all ${duration}ms linear`;
     
     setTimeout(() => {
      element.style.left = endX + 'px';
      element.style.top = endY + 'px';
      element.style.opacity = '0';
     }, 50);
     
     
     setTimeout(() => {
      if (element.parentNode) {
       element.parentNode.removeChild(element);
      }
      activeElements--;
      
      
      if (activeElements === 0) {
       if (fallingContainer && fallingContainer.parentNode) {
        fallingContainer.parentNode.removeChild(fallingContainer);
       }
      }
     }, duration);
    }, i * 150);
   }
  }

   
   
   
  function initCodeMoreBox() {
   let codeBlocks = document.querySelectorAll(".highlight");
   if (!codeBlocks) {
    return;
   }
   codeBlocks.forEach(codeBlock => {
    
    if (codeBlock.scrollHeight <= codeBlock.clientHeight) {
     return;
    }
    
    
    let codeMoreBox = document.createElement('div');
    codeMoreBox.classList.add('code-more-box');
    
    let codeMoreBtn = document.createElement('span');
    codeMoreBtn.classList.add('code-more-btn');
    codeMoreBtn.innerText = '显示更多'; 
    let isExpanded = false; 

    codeMoreBtn.addEventListener('click', () => {
     if (!isExpanded) {
      codeBlock.classList.add('code-show'); 
      codeMoreBtn.innerText = '折叠'; 
      isExpanded = true;
     } else {
      codeBlock.classList.remove('code-show'); 
      codeMoreBtn.innerText = '显示更多'; 
      isExpanded = false;
     }
     
     window.dispatchEvent(new Event('resize'));
    });
    
    codeMoreBox.appendChild(codeMoreBtn);
    codeBlock.appendChild(codeMoreBox);
   });
  }


  
   
   
   
  
  

  function captureScrollListeners() {
    
    setTimeout(() => {
      
      overrideScrollspy();
    }, 2000);
  }
  
  

  function overrideScrollspy() {
    
    window.tocScrollspyEnabled = true;
    
    
    setTimeout(() => {
      
      
      
      
      if (!window.originalScrollTo) {
        window.originalScrollTo = HTMLElement.prototype.scrollTo;
        
        HTMLElement.prototype.scrollTo = function(options) {
          
          if (this.id === 'TableOfContents' && window.tocScrollDisabled) {
            return;
          }
          
          
          return window.originalScrollTo.call(this, options);
        };
      }
      
      
      if (!window.originalScrollIntoView) {
        window.originalScrollIntoView = HTMLElement.prototype.scrollIntoView;
        
        HTMLElement.prototype.scrollIntoView = function(options) {
          
          if (this.closest('#TableOfContents') && window.tocScrollDisabled) {
            return;
          }
          
          
          return window.originalScrollIntoView.call(this, options);
        };
      }
    }, 3000); 
  }
  
  function initTocLock() {
    
    
    const articleToc = document.querySelector('#TableOfContents');
    if (!articleToc) {
      
      return;
    }
    
    
    const tocContainer = document.querySelector('.widget.archives');
    if (!tocContainer) {
      return;
    }
    
    
    tocContainer.style.position = 'relative';
    
    
    captureScrollListeners();
    
    
    const lockLabel = document.createElement('div');
    lockLabel.className = 'toc-lock-label';
    lockLabel.textContent = '锁定：';
    
    
    const lockBtn = document.createElement('div');
    lockBtn.className = 'toc-lock-btn';
    lockBtn.innerHTML = `
      <svg class="lock-icon unlocked" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 11H5a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2z"/>
        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
      </svg>
      <svg class="lock-icon locked" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="11" width="18" height="10" rx="2" ry="2"/>
        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
        <path d="M9 12v3a3 3 0 0 0 6 0v-3"/>
      </svg>
    `;
    
    
    lockBtn.addEventListener('click', function() {
      const isLocked = this.classList.contains('locked');
      
      if (isLocked) {
        
        this.classList.remove('locked');
        localStorage.setItem('tocLocked', 'false');
        enableTocScroll();
      } else {
        
        this.classList.add('locked');
        localStorage.setItem('tocLocked', 'true');
        disableTocScroll();
      }
    });
    
    
    tocContainer.appendChild(lockLabel);
    tocContainer.appendChild(lockBtn);
    
    
    
    lockBtn.classList.remove('locked');
    localStorage.setItem('tocLocked', 'false');
    
    
    const observer = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
          const isLocked = lockBtn.classList.contains('locked');
          if (isLocked) {
            disableTocScroll();
          } else {
            enableTocScroll();
          }
        }
      });
    });
    
    observer.observe(lockBtn, { attributes: true });
  }

  

  function disableTocScroll() {
    
    window.tocScrollDisabled = true;
    
    
    const tocContainer = document.querySelector('#TableOfContents');
    if (tocContainer) {
      
      window.savedTocScrollTop = tocContainer.scrollTop;
      
      
      const currentActive = tocContainer.querySelector('.active-class');
      if (currentActive) {
        window.savedActiveElement = currentActive;
      }
    }
    
    
    if (tocContainer) {
      tocContainer.setAttribute('data-scrollspy-disabled', 'true');
      tocContainer.title = '目录已锁定，不会自动跟随滚动';
    }
    
    
    const archivesContainer = document.querySelector('.widget.archives');
    if (archivesContainer) {
      archivesContainer.style.opacity = '0.8';
      archivesContainer.title = '目录已锁定，不会自动跟随滚动';
    }
  }

  

  function enableTocScroll() {
    
    window.tocScrollDisabled = false;
    
    
    const tocContainer = document.querySelector('#TableOfContents');
    if (tocContainer) {
      
      tocContainer.removeAttribute('data-scrollspy-disabled');
      tocContainer.title = '';
    }
    
    
    const archivesContainer = document.querySelector('.widget.archives');
    if (archivesContainer) {
      archivesContainer.style.opacity = '1';
      archivesContainer.title = '';
    }
  }

  
  
  
  document.addEventListener('DOMContentLoaded', function() {
  

    
    initCodeMoreBox();
    initRope();

    
    setTimeout(initTocLock, 1000);
  });

</script>


<div id="rope-container"></div>


<div id="particles-js"></div>

<script>

particlesJS('particles-js', {
  "particles": {
    "number": {
      "value": 80,
      "density": {
        "enable": true,
        "value_area": 800
      }
    },
    "color": {
      "value": ["#888888", "#aaaaaa", "#cccccc", "#eeeeee"]
    },
    "shape": {
      "type": "circle",
      "stroke": {
        "width": 0,
        "color": "#000000"
      },
      "polygon": {
        "nb_sides": 5
      }
    },
    "opacity": {
      "value": 0.5,
      "random": false,
      "anim": {
        "enable": false,
        "speed": 1,
        "opacity_min": 0.1,
        "sync": false
      }
    },
    "size": {
      "value": 2,
      "random": true,
      "anim": {
        "enable": false,
        "speed": 40,
        "size_min": 0.1,
        "sync": false
      }
    },
    "line_linked": {
      "enable": true,
      "distance": 150,
      "color": "#888888",
      "opacity": 0.4,
      "width": 1
    },
    "move": {
      "enable": true,
      "speed": 2,
      "direction": "none",
      "random": false,
      "straight": false,
      "out_mode": "out",
      "bounce": false,
      "attract": {
        "enable": false,
        "rotateX": 600,
        "rotateY": 1200
      }
    }
  },
  "interactivity": {
    "detect_on": "canvas",
    "events": {
      "onhover": {
        "enable": true,
        "mode": "grab"
      },
      "onclick": {
        "enable": true,
        "mode": "push"
      },
      "resize": true
    },
    "modes": {
      "grab": {
        "distance": 140,
        "line_linked": {
          "opacity": 1
        }
      },
      "bubble": {
        "distance": 400,
        "size": 40,
        "duration": 2,
        "opacity": 8,
        "speed": 3
      },
      "repulse": {
        "distance": 200,
        "duration": 0.4
      },
      "push": {
        "particles_nb": 4
      },
      "remove": {
        "particles_nb": 2
      }
    }
  },
  "retina_detect": true
});
</script>


<script>
(function() {
  'use strict';
  
  
  const categoryColors = [
    '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57',
    '#ff9ff3', '#54a0ff', '#5f27cd', '#00d2d3', '#ff9f43',
    '#10ac84', '#ff6348', '#a55eea', '#e17055', '#d63031',
    '#00b894', '#fdcb6e', '#6c5ce7', '#fd79a8', '#f39c12',
    '#e67e22', '#e74c3c', '#9b59b6', '#3498db', '#1abc9c',
    '#16a085', '#27ae60', '#2ecc71', '#f1c40f', '#e67e22'
  ];
  
  
  function hashString(str) {
    let hash = 0;
    if (str.length === 0) return hash;
    
    for (let i = 0; i < str.length; i++) {
      const char = str.charCodeAt(i);
      hash = ((hash << 5) - hash) + char;
      hash = hash & hash; 
    }
    
    return Math.abs(hash);
  }
  
  
  function assignCategoryColors() {

    
    
    const isArchivesPage = document.body.classList.contains('template-archives') ||
                          window.location.pathname.includes('/archives/');
    const isArticlePage = document.querySelector('#TableOfContents') || 
                         document.querySelector('.article-category');
    
    
    
    
    if (isArticlePage && !isArchivesPage) {
      const categoryLinks = document.querySelectorAll('.article-category a');

      
      categoryLinks.forEach((link, index) => {
        
        const href = link.getAttribute('href');
        const categoryName = href.split('/').pop() || href.split('/').slice(-2, -1)[0] || 'default';
        
        
        const hash = hashString(categoryName);
        const colorIndex = hash % categoryColors.length;
        const backgroundColor = categoryColors[colorIndex];
        
        
        
        
        link.style.setProperty('background-color', backgroundColor, 'important');
        link.style.setProperty('color', '#fff', 'important');
        
        
        link.addEventListener('mouseenter', function() {
          this.style.opacity = '0.8';
          this.style.transform = 'scale(1.05)';
        });
        
        link.addEventListener('mouseleave', function() {
          this.style.opacity = '1';
          this.style.transform = 'scale(1)';
        });
      });
    }
    
    
    if (!isArchivesPage) {
      
      const sidebarCategories = document.querySelectorAll('.widget.categories a, .widget.tagCloud a');

      
      sidebarCategories.forEach((link, index) => {
        
        const href = link.getAttribute('href');
        const categoryName = href.split('/').pop() || href.split('/').slice(-2, -1)[0] || 'default';
        
        
        const hash = hashString(categoryName);
        const colorIndex = hash % categoryColors.length;
        const backgroundColor = categoryColors[colorIndex];
        
        
        
        
        link.style.setProperty('background-color', backgroundColor, 'important');
        link.style.setProperty('color', '#fff', 'important');
        link.style.setProperty('border-radius', '6px', 'important');
        link.style.setProperty('padding', '8px 12px', 'important');
        link.style.setProperty('margin', '4px 0', 'important');
        link.style.setProperty('display', 'inline-block', 'important');
        link.style.setProperty('text-decoration', 'none', 'important');
        link.style.setProperty('transition', 'all 0.3s ease', 'important');
        
        
        link.addEventListener('mouseenter', function() {
          this.style.opacity = '0.8';
          this.style.transform = 'scale(1.05)';
          this.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.2)';
        });
        
        link.addEventListener('mouseleave', function() {
          this.style.opacity = '1';
          this.style.transform = 'scale(1)';
          this.style.boxShadow = 'none';
        });
      });
    } else {
      

    }
    

  }
  
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', assignCategoryColors);
  } else {
    assignCategoryColors();
  }
  
  
  setTimeout(assignCategoryColors, 500);
  setTimeout(assignCategoryColors, 1000);
  setTimeout(assignCategoryColors, 2000);
  
  
  const observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
        
        const hasNewCategories = Array.from(mutation.addedNodes).some(node => {
          return node.nodeType === 1 && (
            node.classList.contains('article-category') ||
            node.querySelector('.article-category') ||
            node.classList.contains('widget') ||
            node.querySelector('.widget')
          );
        });
        
        if (hasNewCategories) {
          
          setTimeout(assignCategoryColors, 100);
          setTimeout(assignCategoryColors, 500);
        }
      }
    });
  });
  
  
  observer.observe(document.body, {
    childList: true,
    subtree: true
  });
})();
</script>


<script>
(function() {
  'use strict';
  
  
  function fixDarkModeToggleText() {
    const toggleBtn = document.getElementById('dark-mode-toggle');
    if (!toggleBtn) {
      return;
    }
    
    
    toggleBtn.classList.add('dark-mode-toggle-fix');
    
    
    const span = toggleBtn.querySelector('span');
    if (!span) {
      return;
    }
    
    
    function updateText() {
      const isDark = document.documentElement.dataset.scheme === 'dark';
      span.textContent = isDark ? '亮色模式' : '暗色模式';

    }
    
    
    updateText();
    
    
    function handleThemeChange() {
      setTimeout(updateText, 100); 
    }
    
    
    window.addEventListener('onColorSchemeChange', handleThemeChange);
    
    
    const observer = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'data-scheme') {
          handleThemeChange();
        }
      });
    });
    
    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['data-scheme']
    });
    
    
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', handleThemeChange);
    
    
    toggleBtn.addEventListener('click', function() {
      
      setTimeout(updateText, 200);
    });
    

  }
  
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', fixDarkModeToggleText);
  } else {
    fixDarkModeToggleText();
  }
  
  
  setTimeout(fixDarkModeToggleText, 1000);
  setTimeout(fixDarkModeToggleText, 2000);
})();
</script>

  
  <script>
  
  if (!document.getElementById('new-theme-switch')) {
    document.write(`
      <div id="new-theme-switch" style="position: fixed; bottom: 50px; left: 50px; z-index: 1000; text-align: center;">
        <label class="theme-switch">
          <input type="checkbox" class="theme-switch__checkbox" id="theme-switch-checkbox">
          <div class="theme-switch__container">
            <div class="theme-switch__clouds"></div>
            <div class="theme-switch__stars-container">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 144 55" fill="none">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M135.831 3.00688C135.055 3.85027 134.111 4.29946 133 4.35447C134.111 4.40947 135.055 4.85867 135.831 5.71123C136.607 6.55462 136.996 7.56303 136.996 8.72727C136.996 7.95722 137.172 7.25134 137.525 6.59129C137.886 5.93124 138.372 5.39954 138.98 5.00535C139.598 4.60199 140.268 4.39114 141 4.35447C139.88 4.2903 138.936 3.85027 138.16 3.00688C137.384 2.16348 136.996 1.16425 136.996 0C136.996 1.16425 136.607 2.16348 135.831 3.00688ZM31 23.3545C32.1114 23.2995 33.0551 22.8503 33.8313 22.0069C34.6075 21.1635 34.9956 20.1642 34.9956 19C34.9956 20.1642 35.3837 21.1635 36.1599 22.0069C36.9361 22.8503 37.8798 23.2903 39 23.3545C38.2679 23.3911 37.5976 23.602 36.9802 24.0053C36.3716 24.3995 35.8864 24.9312 35.5248 25.5913C35.172 26.2513 34.9956 26.9572 34.9956 27.7273C34.9956 26.563 34.6075 25.5546 33.8313 24.7112C33.0551 23.8587 32.1114 23.4095 31 23.3545ZM0 36.3545C1.11136 36.2995 2.05513 35.8503 2.83131 35.0069C3.6075 34.1635 3.99559 33.1642 3.99559 32C3.99559 33.1642 4.38368 34.1635 5.15987 35.0069C5.93605 35.8503 6.87982 36.2903 8 36.3545C7.26792 36.3911 6.59757 36.602 5.98015 37.0053C5.37155 37.3995 4.88644 37.9312 4.52481 38.5913C4.172 39.2513 3.99559 39.9572 3.99559 40.7273C3.99559 39.563 4.38368 38.5546 2.83131 37.7112C2.05513 36.8587 1.11136 36.4095 0 36.3545ZM56.8313 24.0069C56.0551 24.8503 55.1114 25.2995 54 25.3545C55.1114 25.4095 56.0551 25.8587 56.8313 26.7112C57.6075 27.5546 57.9956 28.563 57.9956 29.7273C57.9956 28.9572 58.172 28.2513 58.5248 27.5913C58.8864 26.9312 59.3716 26.3995 59.9802 26.0053C60.5976 25.602 61.2679 25.3911 62 25.3545C60.8798 25.2903 59.9361 24.8503 59.1599 24.0069C58.3837 23.1635 57.9956 22.1642 57.9956 21C57.9956 22.1642 57.6075 23.1635 56.8313 24.0069ZM81 25.3545C82.1114 25.2995 83.0551 24.8503 83.8313 24.0069C84.6075 23.1635 84.9956 22.1642 84.9956 21C84.9956 22.1642 85.3837 23.1635 86.1599 24.0069C86.9361 24.8503 87.8798 25.2903 89 25.3545C88.2679 25.3911 87.5976 25.602 86.9802 26.0053C86.3716 26.3995 85.8864 26.9312 85.5248 27.5913C85.172 28.2513 84.9956 28.9572 84.9956 29.7273C84.9956 28.563 84.6075 27.5546 83.8313 26.7112C83.0551 25.8587 82.1114 25.4095 81 25.3545ZM136 36.3545C137.111 36.2995 138.055 35.8503 138.831 35.0069C139.607 34.1635 139.996 33.1642 139.996 32C139.996 33.1642 140.384 34.1635 141.16 35.0069C141.936 35.8503 142.88 36.2903 144 36.3545C143.268 36.3911 142.598 36.602 141.98 37.0053C141.372 37.3995 140.886 37.9312 140.525 38.5913C140.172 39.2513 139.996 39.9572 139.996 40.7273C139.996 39.563 139.607 38.5546 138.831 37.7112C138.055 36.8587 137.111 36.4095 136 36.3545ZM101.831 49.0069C101.055 49.8503 100.111 50.2995 99 50.3545C100.111 50.4095 101.055 50.8587 101.831 51.7112C102.607 52.5546 102.996 53.563 102.996 54.7273C102.996 53.9572 103.172 53.2513 103.525 52.5913C103.886 51.9312 104.372 51.3995 104.98 51.0053C105.598 50.602 106.268 50.3911 107 50.3545C105.88 50.2903 104.936 49.8503 104.16 49.0069C103.384 48.1635 102.996 47.1642 102.996 46C102.996 47.1642 102.607 48.1635 101.831 49.0069Z" fill="currentColor"></path>
              </svg>
            </div>
            <div class="theme-switch__circle-container">
              <div class="theme-switch__sun-moon-container">
                <div class="theme-switch__moon">
                  <div class="theme-switch__spot"></div>
                  <div class="theme-switch__spot"></div>
                  <div class="theme-switch__spot"></div>
                </div>
              </div>
            </div>
          </div>
        </label>
        <div id="theme-switch-text" style="color: #fff; font-size: 14px; font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,0.5); margin-top: 8px; text-align: center;">亮色模式</div>
      </div>
    `);
  }
  </script>


<style>
   
  .theme-switch {
    --toggle-size: 20px;  
    --container-width: 3.75em;
    --container-height: 1.7em;
    --container-radius: 4.2em;
    --container-light-bg: #3D7EAE;
    --container-night-bg: #1D1F2C;
    --circle-container-diameter: 2.25em;
    --sun-moon-diameter: 1.4em;
    --sun-bg: #ECCA2F;
    --moon-bg: #C4C9D1;
    --spot-color: #959DB1;
    --circle-container-offset: calc((var(--circle-container-diameter) - var(--container-height)) / 2 * -1);
    --stars-color: #fff;
    --clouds-color: #F3FDFF;
    --back-clouds-color: #AACADF;
    --transition: .5s cubic-bezier(0, -0.02, 0.4, 1.25);
    --circle-transition: .3s cubic-bezier(0, -0.02, 0.35, 1.17);
  }

  .theme-switch, .theme-switch *, .theme-switch *::before, .theme-switch *::after {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-size: var(--toggle-size);
  }

  .theme-switch__container {
    width: var(--container-width);
    height: var(--container-height);
    background-color: var(--container-light-bg);
    border-radius: var(--container-radius);
    overflow: hidden;
    cursor: pointer;
    -webkit-box-shadow: 0em -0.062em 0.062em rgba(0, 0, 0, 0.25), 0em 0.062em 0.125em rgba(255, 255, 255, 0.94);
    box-shadow: 0em -0.062em 0.062em rgba(0, 0, 0, 0.25), 0em 0.062em 0.125em rgba(255, 255, 255, 0.94);
    -webkit-transition: var(--transition);
    -o-transition: var(--transition);
    transition: var(--transition);
    position: relative;
  }

  .theme-switch__container::before {
    content: "";
    position: absolute;
    z-index: 1;
    inset: 0;
    -webkit-box-shadow: 0em 0.05em 0.187em rgba(0, 0, 0, 0.25) inset, 0em 0.05em 0.187em rgba(0, 0, 0, 0.25) inset;
    box-shadow: 0em 0.05em 0.187em rgba(0, 0, 0, 0.25) inset, 0em 0.05em 0.187em rgba(0, 0, 0, 0.25) inset;
    border-radius: var(--container-radius)
  }

  .theme-switch__checkbox {
    display: none;
  }

  .theme-switch__circle-container {
    width: var(--circle-container-diameter);
    height: var(--circle-container-diameter);
    background-color: rgba(255, 255, 255, 0.1);
    position: absolute;
    left: var(--circle-container-offset);
    top: var(--circle-container-offset);
    border-radius: var(--container-radius);
    -webkit-box-shadow: inset 0 0 0 3.375em rgba(255, 255, 255, 0.1), inset 0 0 0 3.375em rgba(255, 255, 255, 0.1), 0 0 0 0.625em rgba(255, 255, 255, 0.1), 0 0 0 1.25em rgba(255, 255, 255, 0.1);
    box-shadow: inset 0 0 0 3.375em rgba(255, 255, 255, 0.1), inset 0 0 0 3.375em rgba(255, 255, 255, 0.1), 0 0 0 0.625em rgba(255, 255, 255, 0.1), 0 0 0 1.25em rgba(255, 255, 255, 0.1);
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-transition: var(--circle-transition);
    -o-transition: var(--circle-transition);
    transition: var(--circle-transition);
    pointer-events: none;
  }

  .theme-switch__sun-moon-container {
    pointer-events: auto;
    position: relative;
    z-index: 2;
    width: var(--sun-moon-diameter);
    height: var(--sun-moon-diameter);
    margin: auto;
    border-radius: var(--container-radius);
    background-color: var(--sun-bg);
    -webkit-box-shadow: 0.062em 0.062em 0.062em 0em rgba(254, 255, 239, 0.61) inset, 0em -0.062em 0.062em 0em #a1872a inset;
    box-shadow: 0.062em 0.062em 0.062em 0em rgba(254, 255, 239, 0.61) inset, 0em -0.062em 0.062em 0em #a1872a inset;
    -webkit-filter: drop-shadow(0.062em 0.125em 0.125em rgba(0, 0, 0, 0.25)) drop-shadow(0em 0.062em 0.125em rgba(0, 0, 0, 0.25));
    filter: drop-shadow(0.062em 0.125em 0.125em rgba(0, 0, 0, 0.25)) drop-shadow(0em 0.062em 0.125em rgba(0, 0, 0, 0.25));
    overflow: hidden;
    -webkit-transition: var(--transition);
    -o-transition: var(--transition);
    transition: var(--transition);
  }

  .theme-switch__moon {
    -webkit-transform: translateX(100%);
    -ms-transform: translateX(100%);
    transform: translateX(100%);
    width: 100%;
    height: 100%;
    background-color: var(--moon-bg);
    border-radius: inherit;
    -webkit-box-shadow: 0.062em 0.062em 0.062em 0em rgba(254, 255, 239, 0.61) inset, 0em -0.062em 0.062em 0em #969696 inset;
    box-shadow: 0.062em 0.062em 0.062em 0em rgba(254, 255, 239, 0.61) inset, 0em -0.062em 0.062em 0em #969696 inset;
    -webkit-transition: var(--transition);
    -o-transition: var(--transition);
    transition: var(--transition);
    position: relative;
  }

  .theme-switch__spot {
    position: absolute;
    top: 0.75em;
    left: 0.312em;
    width: 0.75em;
    height: 0.75em;
    border-radius: var(--container-radius);
    background-color: var(--spot-color);
    -webkit-box-shadow: 0em 0.0312em 0.062em rgba(0, 0, 0, 0.25) inset;
    box-shadow: 0em 0.0312em 0.062em rgba(0, 0, 0, 0.25) inset;
  }

  .theme-switch__spot:nth-of-type(2) {
    width: 0.375em;
    height: 0.375em;
    top: 0.937em;
    left: 1.375em;
  }

  .theme-switch__spot:nth-last-of-type(3) {
    width: 0.25em;
    height: 0.25em;
    top: 0.312em;
    left: 0.812em;
  }

  .theme-switch__clouds {
    width: 1.25em;
    height: 1.25em;
    background-color: var(--clouds-color);
    border-radius: var(--container-radius);
    position: absolute;
    bottom: -0.625em;
    left: 0.312em;
    -webkit-box-shadow: 0.937em 0.312em var(--clouds-color), -0.312em -0.312em var(--back-clouds-color), 1.437em 0.375em var(--clouds-color), 0.5em -0.125em var(--back-clouds-color), 2.187em 0 var(--clouds-color), 1.25em -0.062em var(--back-clouds-color), 2.937em 0.312em var(--clouds-color), 2em -0.312em var(--back-clouds-color), 3.625em -0.062em var(--clouds-color), 2.625em 0em var(--back-clouds-color), 4.5em -0.312em var(--clouds-color), 3.375em -0.437em var(--back-clouds-color), 4.625em -1.75em 0 0.437em var(--clouds-color), 4em -0.625em var(--back-clouds-color), 4.125em -2.125em 0 0.437em var(--back-clouds-color);
    box-shadow: 0.937em 0.312em var(--clouds-color), -0.312em -0.312em var(--back-clouds-color), 1.437em 0.375em var(--clouds-color), 0.5em -0.125em var(--back-clouds-color), 2.187em 0 var(--clouds-color), 1.25em -0.062em var(--back-clouds-color), 2.937em 0.312em var(--clouds-color), 2em -0.312em var(--back-clouds-color), 3.625em -0.062em var(--clouds-color), 2.625em 0em var(--back-clouds-color), 4.5em -0.312em var(--clouds-color), 3.375em -0.437em var(--back-clouds-color), 4.625em -1.75em 0 0.437em var(--clouds-color), 4em -0.625em var(--back-clouds-color), 4.125em -2.125em 0 0.437em var(--back-clouds-color);
    -webkit-transition: 0.5s cubic-bezier(0, -0.02, 0.4, 1.25);
    -o-transition: 0.5s cubic-bezier(0, -0.02, 0.4, 1.25);
    transition: 0.5s cubic-bezier(0, -0.02, 0.4, 1.25);
  }

  .theme-switch__stars-container {
    position: absolute;
    color: var(--stars-color);
    top: -100%;
    left: 0.312em;
    width: 2.75em;
    height: auto;
    -webkit-transition: var(--transition);
    -o-transition: var(--transition);
    transition: var(--transition);
  }

   
  .theme-switch__checkbox:checked + .theme-switch__container {
    background-color: var(--container-night-bg);
  }

  .theme-switch__checkbox:checked + .theme-switch__container .theme-switch__circle-container {
    left: calc(100% - var(--circle-container-offset) - var(--circle-container-diameter));
  }

  .theme-switch__checkbox:checked + .theme-switch__container .theme-switch__circle-container:hover {
    left: calc(100% - var(--circle-container-offset) - var(--circle-container-diameter) - 0.187em)
  }

  .theme-switch__circle-container:hover {
    left: calc(var(--circle-container-offset) + 0.187em);
  }

  .theme-switch__checkbox:checked + .theme-switch__container .theme-switch__moon {
    -webkit-transform: translate(0);
    -ms-transform: translate(0);
    transform: translate(0);
    transform: translate(0);
  }

  .theme-switch__checkbox:checked + .theme-switch__container .theme-switch__clouds {
    bottom: -4.062em;
  }

  .theme-switch__checkbox:checked + .theme-switch__container .theme-switch__stars-container {
    top: 50%;
    -webkit-transform: translateY(-50%);
    -ms-transform: translateY(-50%);
    transform: translateY(-50%);
  }

   
  #dark-mode-toggle {
    display: none !important;
  }

   
  .dark-mode-toggle-fix span {
    font-size: 18px !important;
    font-weight: 600 !important;
  }
</style>


<script>
(function() {
  'use strict';
  
  
  if (window.themeSwitchInitialized) {
    console.log('主题切换开关已经初始化，跳过重复执行');
    return;
  }
  
  let isInitialized = false;
  let observer = null;
  
  function initNewThemeSwitch() {
    
    if (isInitialized) {
      return;
    }
    
    const checkbox = document.getElementById('theme-switch-checkbox');
    if (!checkbox) {
      return;
    }
    
    
    function updateCheckboxState() {
      const isDark = document.documentElement.dataset.scheme === 'dark';
      checkbox.checked = isDark;
      
      
      const textElement = document.getElementById('theme-switch-text');
      if (textElement) {
        textElement.textContent = isDark ? '暗色模式' : '亮色模式';
        console.log('更新主题切换文字:', isDark ? '暗色模式' : '亮色模式');
      }
      
      console.log('当前主题状态:', isDark ? 'dark' : 'light', 'checkbox状态:', checkbox.checked);
    }
    
    
    function waitForThemeSystem() {
      
      const schemeFromData = document.documentElement.dataset.scheme;
      const schemeFromClass = document.documentElement.className.includes('dark') ? 'dark' : 
                             document.documentElement.className.includes('light') ? 'light' : null;
      const schemeFromLocalStorage = localStorage.getItem('StackColorScheme');
      
      if (schemeFromData || schemeFromClass || schemeFromLocalStorage) {
        
        let finalScheme = schemeFromData || schemeFromClass || schemeFromLocalStorage;
        
        
        if (schemeFromData) {
          finalScheme = schemeFromData;
        }
        
        
        document.documentElement.dataset.scheme = finalScheme;
        
        
        updateCheckboxState();
        isInitialized = true;
        window.themeSwitchInitialized = true;
        
        console.log('主题系统已初始化，当前主题:', finalScheme);
      } else {
        
        setTimeout(waitForThemeSystem, 100);
      }
    }
    
    
    waitForThemeSystem();
    
    
    checkbox.addEventListener('change', function() {
      const scheme = this.checked ? 'dark' : 'light';
      document.documentElement.dataset.scheme = scheme;
      
      
      localStorage.setItem('StackColorScheme', scheme);
      
      
      document.dispatchEvent(new CustomEvent('onColorSchemeChange'));
    });
    
    
    window.addEventListener('onColorSchemeChange', updateCheckboxState);
    
    
    observer = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'data-scheme') {
          updateCheckboxState();
        }
      });
    });
    
    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['data-scheme']
    });
  }
  
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initNewThemeSwitch);
  } else {
    initNewThemeSwitch();
  }
  
  
  setTimeout(initNewThemeSwitch, 1500);
})();
</script>


<script>
(function() {
  'use strict';
  
  
  if (window.hoverEffectsInitialized) {
    console.log('悬浮效果已经初始化，跳过重复执行');
    return;
  }
  
  let isHoverEffectsInitialized = false;
  let hoverObserver = null;
  
  
  function forceCategoryHoverEffects() {
    
    if (isHoverEffectsInitialized) {
      return;
    }
    
    const articles = document.querySelectorAll('.article-list--compact article');
    if (articles.length > 0) {
      articles.forEach(article => {
        
        if (article.hasAttribute('data-hover-initialized')) {
          return;
        }
        
        
        article.style.setProperty('transition', 'all 0.3s ease', 'important');
        article.style.setProperty('will-change', 'transform, box-shadow', 'important');
        
        
        article.addEventListener('mouseenter', function() {
          this.style.setProperty('transform', 'translateY(-5px)', 'important');
          this.style.setProperty('box-shadow', '0 10px 30px rgba(0, 0, 0, 0.12)', 'important');
        });
        
        article.addEventListener('mouseleave', function() {
          this.style.setProperty('transform', 'translateY(0)', 'important');
          this.style.setProperty('box-shadow', 'none', 'important');
        });
        
        
        article.setAttribute('data-hover-initialized', 'true');
      });
      
      isHoverEffectsInitialized = true;
      window.hoverEffectsInitialized = true;
    }
  }
  
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', forceCategoryHoverEffects);
  } else {
    forceCategoryHoverEffects();
  }
  
  
  setTimeout(forceCategoryHoverEffects, 1000);
  
  
  hoverObserver = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
        
        setTimeout(forceCategoryHoverEffects, 100);
      }
    });
  });
  
  
  hoverObserver.observe(document.body, {
    childList: true,
    subtree: true
  });
})();
</script>


            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>
<style>
   
   
   
  @font-face {
   font-family: 'yuan';
   src: url('https://blog.928330.xyz/font/round.ttf') format('truetype');
  }

   
   
   
  :root {
   --base-font-family: 'yuan';
   --code-font-family: 'yuan';
  }

   
   
   
   
   
  #backTopBtn {
   position: fixed;
   bottom: 30px;
   right: 450px;
   z-index: 99;
   cursor: pointer;
   width: 32px;
   height: 32px;
   background-image: url('/icons/backTop.svg');
   background-size: cover;
   background-color: rgba(255, 255, 255, 0.9);
   border-radius: 50%;
   box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
   transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
   transform-origin: center center;
    
   animation: gentleFloat 3s ease-in-out infinite;
    
   overflow: visible;
  }

   
  [data-scheme="dark"] #backTopBtn {
   background-image: url('/icons/backTop-dark.svg') !important;
   background-color: rgba(0, 0, 0, 0.8) !important;
   box-shadow: 0 4px 20px rgba(255, 255, 255, 0.1) !important;
  }

   
  @media (prefers-color-scheme: dark) {
    #backTopBtn {
      background-image: url('/icons/backTop-dark.svg') !important;
      background-color: rgba(0, 0, 0, 0.8) !important;
      box-shadow: 0 4px 20px rgba(255, 255, 255, 0.1) !important;
    }
    
    .button-ripple {
      background-image: url('/icons/backTop-dark.svg') !important;
       
    }
  }

   
  html[data-scheme="dark"] #backTopBtn,
  body[data-scheme="dark"] #backTopBtn,
  .dark #backTopBtn,
  .dark-mode #backTopBtn {
    background-image: url('/icons/backTop-dark.svg') !important;
    background-color: rgba(0, 0, 0, 0.8) !important;
    box-shadow: 0 4px 20px rgba(255, 255, 255, 0.1) !important;
  }

  html[data-scheme="dark"] .button-ripple,
  body[data-scheme="dark"] .button-ripple,
  .dark .button-ripple,
  .dark-mode .button-ripple {
    background-image: url('/icons/backTop-dark.svg') !important;
     
  }

   
  [data-scheme="dark"] #backTopBtn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 10px solid #ffffff;
    transform: translate(-50%, -50%);
    z-index: 1;
     
    display: var(--show-css-arrow, none);
  }

   
  #backTopBtn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 10px solid #000000;
    transform: translate(-50%, -50%);
    z-index: 1;
     
    display: var(--show-css-arrow, none);
  }

   
  @keyframes gentleFloat {
   0%, 100% { transform: translateY(0px); }
   50% { transform: translateY(-6px); }
  }

   
  .button-ripple {
   position: absolute;
   top: 0;
   left: 0;
   width: 32px;
   height: 32px;
   border-radius: 50%;
   background-image: url('/icons/backTop.svg');
   background-size: cover;
   background-repeat: no-repeat;
   background-position: center;
   pointer-events: none;
   z-index: -1;
   animation: buttonRippleExpand 2.5s linear infinite;
   transform-origin: center center;
    
   will-change: transform, opacity;
   backface-visibility: hidden;
   perspective: 1000px;
   contain: layout style;
    
   transform: translateZ(0);
    
   transition: animation-duration 0.3s ease;
    
   --show-css-arrow: none !important;
    
   opacity: var(--ripple-opacity, 0.8) !important;
  }

   
  [data-scheme="dark"] .button-ripple {
   background-image: url('/icons/backTop-dark.svg') !important;
    
    
   --show-css-arrow: none !important;
  }

   
  @media (prefers-color-scheme: dark) {
    .button-ripple {
      background-image: url('/icons/backTop-dark.svg') !important;
       
       
      --show-css-arrow: none !important;
    }
  }

   
  .button-ripple.hover-mode {
   animation-duration: 1s;
  }

  @keyframes buttonRippleExpand {
   0% {
     --ripple-opacity: 0.8;
     transform: scale(1);
   }
   2% {
     --ripple-opacity: 0.78;
     transform: scale(1.02);
   }
   4% {
     --ripple-opacity: 0.76;
     transform: scale(1.04);
   }
   6% {
     --ripple-opacity: 0.74;
     transform: scale(1.06);
   }
   8% {
     --ripple-opacity: 0.72;
     transform: scale(1.08);
   }
   10% {
     --ripple-opacity: 0.7;
     transform: scale(1.1);
   }
   12% {
     --ripple-opacity: 0.68;
     transform: scale(1.12);
   }
   14% {
     --ripple-opacity: 0.66;
     transform: scale(1.14);
   }
   16% {
     --ripple-opacity: 0.64;
     transform: scale(1.16);
   }
   18% {
     --ripple-opacity: 0.62;
     transform: scale(1.18);
   }
   20% {
     --ripple-opacity: 0.6;
     transform: scale(1.2);
   }
   22% {
     --ripple-opacity: 0.58;
     transform: scale(1.22);
   }
   24% {
     --ripple-opacity: 0.56;
     transform: scale(1.24);
   }
   26% {
     --ripple-opacity: 0.54;
     transform: scale(1.26);
   }
   28% {
     --ripple-opacity: 0.52;
     transform: scale(1.28);
   }
   30% {
     --ripple-opacity: 0.5;
     transform: scale(1.3);
   }
   32% {
     --ripple-opacity: 0.48;
     transform: scale(1.32);
   }
   34% {
     --ripple-opacity: 0.46;
     transform: scale(1.34);
   }
   36% {
     --ripple-opacity: 0.44;
     transform: scale(1.36);
   }
   38% {
     --ripple-opacity: 0.42;
     transform: scale(1.38);
   }
   40% {
     --ripple-opacity: 0.4;
     transform: scale(1.4);
   }
   42% {
     --ripple-opacity: 0.38;
     transform: scale(1.42);
   }
   44% {
     --ripple-opacity: 0.36;
     transform: scale(1.44);
   }
   46% {
     --ripple-opacity: 0.34;
     transform: scale(1.46);
   }
   48% {
     --ripple-opacity: 0.32;
     transform: scale(1.48);
   }
   50% {
     --ripple-opacity: 0.3;
     transform: scale(1.5);
   }
   52% {
     --ripple-opacity: 0.28;
     transform: scale(1.52);
   }
   54% {
     --ripple-opacity: 0.26;
     transform: scale(1.54);
   }
   56% {
     --ripple-opacity: 0.24;
     transform: scale(1.56);
   }
   58% {
     --ripple-opacity: 0.22;
     transform: scale(1.58);
   }
   60% {
     --ripple-opacity: 0.2;
     transform: scale(1.6);
   }
   62% {
     --ripple-opacity: 0.18;
     transform: scale(1.62);
   }
   64% {
     --ripple-opacity: 0.16;
     transform: scale(1.64);
   }
   66% {
     --ripple-opacity: 0.14;
     transform: scale(1.66);
   }
   68% {
     --ripple-opacity: 0.12;
     transform: scale(1.68);
   }
   70% {
     --ripple-opacity: 0.1;
     transform: scale(1.7);
   }
   72% {
     --ripple-opacity: 0.08;
     transform: scale(1.72);
   }
   74% {
     --ripple-opacity: 0.07;
     transform: scale(1.74);
   }
   76% {
     --ripple-opacity: 0.06;
     transform: scale(1.76);
   }
   78% {
     --ripple-opacity: 0.05;
     transform: scale(1.78);
   }
   80% {
     --ripple-opacity: 0.04;
     transform: scale(1.8);
   }
   82% {
     --ripple-opacity: 0.035;
     transform: scale(1.82);
   }
   84% {
     --ripple-opacity: 0.03;
     transform: scale(1.84);
   }
   86% {
     --ripple-opacity: 0.025;
     transform: scale(1.86);
   }
   88% {
     --ripple-opacity: 0.02;
     transform: scale(1.88);
   }
   90% {
     --ripple-opacity: 0.015;
     transform: scale(1.9);
   }
   92% {
     --ripple-opacity: 0.01;
     transform: scale(1.92);
   }
   94% {
     --ripple-opacity: 0.008;
     transform: scale(1.94);
   }
   96% {
     --ripple-opacity: 0.005;
     transform: scale(1.96);
   }
   98% {
     --ripple-opacity: 0.002;
     transform: scale(1.98);
   }
   100% {
     --ripple-opacity: 0;
     transform: scale(2.0);
   }
  }

   
  .button-tooltip {
   position: absolute;
   bottom: 45px;
   right: 450px;
   background: rgba(0, 0, 0, 0.8);
   color: white;
   padding: 8px 12px;
   border-radius: 6px;
   font-size: 12px;
   white-space: nowrap;
   opacity: 0;
   transform: translateY(10px);
   transition: all 0.3s ease;
   pointer-events: none;
   z-index: 100;
  }

  .button-tooltip.show {
   opacity: 1;
   transform: translateY(0);
  }

  .button-tooltip::after {
   content: '';
   position: absolute;
   top: 100%;
   left: 50%;
   transform: translateX(-50%);
   border: 5px solid transparent;
   border-top-color: rgba(0, 0, 0, 0.8);
  }

   
  .hover-ripple-effect {
   display: none;
  }

   
  #backTopBtn:hover {
   transform: translateY(-8px) scale(1.1);
   box-shadow: 0 8px 30px rgba(0, 0, 0, 0.25);
   background-color: rgba(255, 255, 255, 1);
  }

   
  #backTopBtn.sprinting {
   animation: energyBurst 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
  }

  @keyframes energyBurst {
   0% {
     transform: scale(1) rotate(0deg);
     opacity: 1;
     filter: brightness(1) hue-rotate(0deg);
     box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
   }
   15% {
     transform: scale(1.2) rotate(0deg);
     opacity: 1;
     filter: brightness(1.2) hue-rotate(0deg);
     box-shadow: 0 0 25px rgba(255, 215, 0, 0.8), 0 0 50px rgba(255, 107, 107, 0.6);
   }
   30% {
     transform: scale(1.4) rotate(0deg);
     opacity: 1;
     filter: brightness(1.4) hue-rotate(60deg);
     box-shadow: 0 0 35px rgba(255, 182, 193, 0.8), 0 0 70px rgba(255, 215, 0, 0.6);
   }
   45% {
     transform: scale(1.6) rotate(0deg);
     opacity: 1;
     filter: brightness(1.6) hue-rotate(120deg);
     box-shadow: 0 0 45px rgba(173, 216, 230, 0.8), 0 0 90px rgba(255, 182, 193, 0.6);
   }
   60% {
     transform: scale(1.4) rotate(0deg);
     opacity: 1;
     filter: brightness(1.4) hue-rotate(180deg);
     box-shadow: 0 0 35px rgba(144, 238, 144, 0.8), 0 0 70px rgba(173, 216, 230, 0.6);
   }
   75% {
     transform: scale(1.2) rotate(0deg);
     opacity: 1;
     filter: brightness(1.2) hue-rotate(240deg);
     box-shadow: 0 0 25px rgba(255, 215, 0, 0.8), 0 0 50px rgba(144, 238, 144, 0.6);
   }
   90% {
     transform: scale(1.05) rotate(0deg);
     opacity: 1;
     filter: brightness(1.05) hue-rotate(300deg);
     box-shadow: 0 0 15px rgba(255, 107, 107, 0.6), 0 0 30px rgba(255, 215, 0, 0.4);
   }
   100% {
     transform: scale(1) rotate(0deg);
     opacity: 1;
     filter: brightness(1) hue-rotate(360deg);
     box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
   }
  }

   
  #backTopBtn.reappearing {
   animation: reappear 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
  }

   
  #backTopBtn.exploding {
   animation: explosionTransition 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
    
   z-index: 1000;
  }

   
  #backTopBtn.exploding .button-ripple {
   opacity: 0;
   animation-play-state: paused;
  }

  @keyframes explosionTransition {
   0% {
     transform: scale(1.6) rotate(0deg);
     opacity: 1;
     filter: brightness(1.6) hue-rotate(0deg);
     box-shadow: 0 0 50px rgba(255, 215, 0, 0.8), 0 0 100px rgba(255, 107, 107, 0.6);
   }
   30% {
     transform: scale(1.4) rotate(5deg);
     opacity: 1;
     filter: brightness(1.4) hue-rotate(120deg);
     box-shadow: 0 0 40px rgba(255, 182, 193, 0.8), 0 0 80px rgba(255, 215, 0, 0.6);
   }

   100% {
     transform: scale(1) rotate(0deg);
     opacity: 1;
     filter: brightness(1) hue-rotate(360deg);
     box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
   }
  }

  @keyframes reappear {
   0% {
     transform: scale(0.85);
     opacity: 0.7;
   }
   50% {
     transform: scale(1.05);
     opacity: 1;
   }
   100% {
     transform: scale(1);
     opacity: 1;
   }
  }

  #backTopBtn.rotating {
   animation: rotate360 0.6s ease-in-out;
  }

  @keyframes rotate360 {
   0% { transform: rotate(0deg); }
   100% { transform: rotate(360deg); }
  }

   
  .particle {
   position: absolute;
   top: 50%;
   left: 50%;
   width: 4px;
   height: 4px;
   background: radial-gradient(circle, #fff, #ffd700, #ff69b4, #87ceeb);
   border-radius: 50%;
   pointer-events: none;
   z-index: -2;
   animation: particleExplode 1s ease-out forwards;
  }

  @keyframes particleExplode {
   0% {
     transform: translate(-50%, -50%) scale(0);
     opacity: 1;
   }
   50% {
     opacity: 1;
   }
   100% {
     transform: translate(-50%, -50%) scale(1) translate(var(--x), var(--y));
     opacity: 0;
   }
  }

   
  .energy-wave {
   position: absolute;
   top: 50%;
   left: 50%;
   width: 0;
   height: 0;
   border: 2px solid transparent;
   border-radius: 50%;
   pointer-events: none;
   z-index: -3;
   animation: energyWave 1.2s ease-out forwards;
  }

  @keyframes energyWave {
   0% {
     width: 0;
     height: 0;
     border-color: rgba(255, 215, 0, 0.8);
     opacity: 1;
   }
   100% {
     width: 120px;
     height: 120px;
     border-color: rgba(255, 215, 0, 0);
     opacity: 0;
   }
  }

   
  .hero-aura {
   position: absolute;
   top: 50%;
   left: 50%;
   width: 100%;
   height: 100%;
   border-radius: 50%;
   background: conic-gradient(from 0deg, #ffd700, #ff69b4, #87ceeb, #98fb98, #ffa07a, #ffd700);
   background-size: 200% 200%;
   pointer-events: none;
   z-index: -4;
   animation: heroAura 2s linear infinite;
   opacity: 0;
   transition: opacity 0.3s ease;
  }

  #backTopBtn.sprinting .hero-aura {
   opacity: 0.6;
  }

  @keyframes heroAura {
   0% {
     background-position: 0% 0%;
     transform: translate(-50%, -50%) rotate(0deg);
   }
   100% {
     background-position: 100% 100%;
     transform: translate(-50%, -50%) rotate(360deg);
   }
  }

   
      @media (max-width: 768px) {
     #backTopBtn {
       left: 20px !important;  
       right: auto !important;
       bottom: 20px;
       width: 28px;
       height: 28px;
     }
     
     .button-tooltip {
       left: 20px !important;  
       right: auto !important;
       bottom: 35px;
     }
    }
  
    @media (max-width: 480px) {
     #backTopBtn {
       left: 15px !important;  
       right: auto !important;
       bottom: 15px;
       width: 26px;
       height: 26px;
     }
     
     .button-tooltip {
       left: 15px !important;
       right: auto !important;
       bottom: 31px;
     }
    }

   
   
   
  .no-text-selection {
    -webkit-user-select: none;  
    -moz-user-select: none;     
    -ms-user-select: none;      
    user-select: none;          
  }

   
   
   
  #rope-container {
    position: fixed;
    top: 0;
    left: 20px;
    z-index: 10000;
    width: 50px;
    height: 480px;
    pointer-events: none;
  }
  
   
  #rope-physics-container {
    pointer-events: auto !important;
  }
  
   
  #rope-svg-container svg {
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
  }
  
  #rope-svg-container path {
    transition: all 0.1s ease-out;
  }
  
   
  #rope-svg-container path,
  #rope-path {
    stroke: #4b2b0f !important;
    stroke-width: 2.5 !important;
  }
  
   
  #rope-svg-container svg path {
    stroke: #4b2b0f !important;
    stroke-width: 2.5 !important;
  }
  


  #rope {
    position: absolute;
    top: -80px;
    left: 50%;
    width: 3px;
    height: 400px;
    background: linear-gradient(to bottom, #654321, #8B4513, #A0522D, #8B4513, #654321);
    border-radius: 1.5px;
    transform: translateX(-50%);
    pointer-events: auto;
    transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    box-shadow: 0 1px 3px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.1);
  }

  #pull-ring {
    position: absolute;
    top: 300px;
    left: 50%;
    font-size: 20px;
    color: #ffffff;
    text-shadow: 0 0 8px rgba(255, 255, 255, 0.8);
    transform: translateX(-50%);
    pointer-events: auto;
    transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
  }

  #rope:hover {
    box-shadow: 0 2px 6px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.2);
  }

  #pull-ring:hover {
    transform: translateX(-50%) scale(1.2);
    text-shadow: 0 0 12px rgba(255, 255, 255, 1);
    filter: drop-shadow(0 4px 8px rgba(0,0,0,0.5));
  }

   
   
   
  .highlight {
   max-height: 400px;
   overflow: hidden;
   position: relative;
   transition: max-height 0.3s ease-out;
  }

  .code-show {
   max-height: none !important;
  }

  .code-more-box {
   width: 100%;
   padding-top: 20px;
   background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0), #fff);
   position: absolute;
   left: 0;
   right: 0;
   bottom: 0;
   z-index: 1;
   text-align: center;
  }

  .code-more-btn {
   display: inline-block;
   padding: 5px 15px;
   background: #f0f0f5;
   border-radius: 5px;
   cursor: pointer;
   font-size: 0.9em;
  }

   
   
   
  #particles-js {
   position: fixed;
   top: 0;
   left: 0;
    width: 100vw;
    height: 100vh;
   z-index: -1;
    pointer-events: none;
  }
  
  #particles-js canvas {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
  }

   
   
   
  .toc-lock-btn {
    position: absolute;
    top: 32px;
    right: 5px;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border-radius: 50%;
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    background: rgba(0, 0, 0, 0.05);
    color: rgba(0, 0, 0, 0.7);
    z-index: 100;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }
  
  .toc-lock-btn:hover {
    background: rgba(0, 0, 0, 0.1);
    transform: scale(1.1);
    border-color: rgba(0, 0, 0, 0.2);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
  }
  
  .toc-lock-btn:active {
    transform: scale(0.95);
  }
  
   
  .toc-lock-btn:focus {
    outline: none;
    border-color: rgba(0, 0, 0, 0.4);
    box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1), 0 2px 8px rgba(0, 0, 0, 0.1);
    background: rgba(0, 0, 0, 0.08);
  }
  
  .toc-lock-btn:focus-visible {
    outline: none;
    border-color: rgba(0, 0, 0, 0.4);
    box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1), 0 2px 8px rgba(0, 0, 0, 0.1);
    background: rgba(0, 0, 0, 0.08);
  }
  
  .toc-lock-btn.locked {
    color: rgba(0, 0, 0, 0.9);
    background: rgba(0, 0, 0, 0.1);
    border-color: rgba(0, 0, 0, 0.3);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  }
  
  .toc-lock-btn.locked:hover {
    background: rgba(0, 0, 0, 0.15);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.25);
  }
  
  .toc-lock-btn.locked .lock-icon.locked {
    display: block;
  }
  
  .toc-lock-btn.locked .lock-icon.unlocked {
    display: none;
  }
  
  .toc-lock-btn .lock-icon.locked {
    display: none;
  }
  
  .toc-lock-btn .lock-icon.unlocked {
    display: block;
  }
  
  .toc-lock-btn .lock-icon {
    width: 14px;
    height: 14px;
    stroke: currentColor;
    fill: none;
    stroke-width: 2.5;
    stroke-linecap: round;
    stroke-linejoin: round;
    transition: all 0.3s ease;
  }
  
   
  .toc-lock-label {
    position: absolute;
    top: 38px;
    right: 28px;
    font-size: 16px;
    color: rgba(0, 0, 0, 0.6);
    font-weight: 700;
    z-index: 100;
    user-select: none;
    pointer-events: none;
    line-height: 1;
    display: flex;
    align-items: center;
  }

   
  [data-scheme="dark"] .toc-lock-btn {
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.7);
  }
  
  [data-scheme="dark"] .toc-lock-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
    box-shadow: 0 4px 16px rgba(255, 255, 255, 0.15);
  }
  
   
  [data-scheme="dark"] .toc-lock-btn:focus,
  [data-scheme="dark"] .toc-lock-btn:focus-visible {
    outline: none;
    border-color: rgba(255, 255, 255, 0.4);
    box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1), 0 2px 8px rgba(255, 255, 255, 0.1);
    background: rgba(255, 255, 255, 0.08);
  }
  
  [data-scheme="dark"] .toc-lock-btn.locked {
    color: rgba(255, 255, 255, 0.9);
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.3);
    box-shadow: 0 2px 8px rgba(255, 255, 255, 0.2);
  }
  
  [data-scheme="dark"] .toc-lock-btn.locked:hover {
    background: rgba(255, 255, 255, 0.15);
    box-shadow: 0 4px 16px rgba(255, 255, 255, 0.25);
  }
  
   
  [data-scheme="dark"] .toc-lock-label {
    color: rgba(255, 255, 255, 0.6);
  }

   
  #TableOfContents[data-scrollspy-disabled="true"] {
    opacity: 0.8 !important;
  }
  
  #TableOfContents[data-scrollspy-disabled="true"] .active-class {
     
    display: block !important;
    opacity: 1 !important;
  }
  
  #TableOfContents[data-scrollspy-disabled="true"] a {
    cursor: pointer !important;
  }
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

<script>
   
   
   

  let s1 = '2025-5-8 15:00:00'; 
  s1 = new Date(s1.replace(/-/g, "/"));
  let s2 = new Date();
  let timeDifference = s2.getTime() - s1.getTime();

  let days = Math.floor(timeDifference / (1000 * 60 * 60 * 24));
  let hours = Math.floor((timeDifference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  let minutes = Math.floor((timeDifference % (1000 * 60 * 60)) / (1000 * 60));

  let result = days + "天" + hours + "小时" + minutes + "分钟";
  if (document.getElementById('runningdays')) {
      document.getElementById('runningdays').innerHTML = result;
  }
  
   
   
   
  
  

  function startContinuousRipple(button) {
   
   const buttonRipple = document.createElement('div');
   buttonRipple.className = 'button-ripple';
   button.appendChild(buttonRipple);
   
   
   button.buttonRipple = buttonRipple;
  }
  
  

  function createContinuousRipple(button) {
   
   if (button.querySelector('.continuous-ripple')) {
     return;
   }
   
   
   const rippleContainer = document.createElement('div');
   rippleContainer.className = 'ripple-container continuous-ripple';
   
   
   const ripple = document.createElement('div');
   ripple.className = 'ripple';
   ripple.style.background = 'radial-gradient(circle, rgba(255, 107, 107, 0.8) 0%, rgba(255, 255, 255, 0.9) 100%)';
   
   rippleContainer.appendChild(ripple);
   button.appendChild(rippleContainer);
   
   
   setTimeout(() => {
     if (rippleContainer.parentNode) {
       rippleContainer.parentNode.removeChild(rippleContainer);
     }
   }, 800);
  }
  
  

  function createHoverRipple(button) {
   
   if (button.buttonRipple) {
     
     button.buttonRipple.style.animationDuration = '1s';
     button.buttonRipple.classList.add('hover-mode');
   }
  }
  
  

  function showTooltip(button) {
   
   hideTooltip();
   
   
   const tooltip = document.createElement('div');
   tooltip.className = 'button-tooltip';
   tooltip.textContent = '返回顶部';
   document.body.appendChild(tooltip);
   
   
   setTimeout(() => {
     tooltip.classList.add('show');
   }, 10);
   
   
   button.tooltip = tooltip;
  }
  
  

  function hideTooltip() {
   const existingTooltip = document.querySelector('.button-tooltip');
   if (existingTooltip) {
     existingTooltip.classList.remove('show');
     setTimeout(() => {
       if (existingTooltip.parentNode) {
         existingTooltip.parentNode.removeChild(existingTooltip);
       }
     }, 300);
   }
  }
  
  

  function createRippleEffect(button) {
   
   
   
   const energyWave = document.createElement('div');
   energyWave.className = 'energy-wave';
   document.body.appendChild(energyWave);
   
   
   createParticleExplosion(button);
   
   
   setTimeout(() => {
     if (energyWave.parentNode) {
       energyWave.parentNode.removeChild(energyWave);
     }
   }, 1200);
  }

  

  function createParticleExplosion(button) {
   const particleCount = 16; 
   
   
   const particleColors = [
     'radial-gradient(circle, #ff6b6b, #ffd93d, #6bcf7f, #4d96ff)',
     'radial-gradient(circle, #ff8e8e, #ffed4e, #7ddb8f, #6ba6ff)',
     'radial-gradient(circle, #ffa1a1, #fff15f, #8ee79f, #89b6ff)',
     'radial-gradient(circle, #ffb4b4, #fff570, #9ff3af, #a7c6ff)'
   ];
   
   for (let i = 0; i < particleCount; i++) {
     const particle = document.createElement('div');
     particle.className = 'particle';
     
     
     const randomColor = particleColors[Math.floor(Math.random() * particleColors.length)];
     particle.style.background = randomColor;
     
     
     const angle = (i / particleCount) * 2 * Math.PI;
     const distance = 40 + Math.random() * 30; 
     const x = Math.cos(angle) * distance;
     const y = Math.sin(angle) * distance;
     
     particle.style.setProperty('--x', `${x}px`);
     particle.style.setProperty('--y', `${y}px`);
     
     
     particle.style.animationDelay = `${Math.random() * 0.4}s`;
     
     button.appendChild(particle);
     
     
     setTimeout(() => {
       if (particle.parentNode) {
         particle.parentNode.removeChild(particle);
       }
     }, 1000);
   }
  }

   
   
   
  

  function initScrollTop() {
   let rightSideBar = document.querySelector(".right-sidebar");
   if (!rightSideBar) {
    return;
   }

   
   let btn = document.createElement("div");
   btn.id = "backTopBtn";
   let isRotating = false; 

   
   const heroAura = document.createElement('div');
   heroAura.className = 'hero-aura';
   btn.appendChild(heroAura);

   
   btn.addEventListener('mouseenter', function() {
     createHoverRipple(this);
     showTooltip(this);
   });
   
   
   btn.addEventListener('mouseleave', function() {
     if (this.buttonRipple) {
       
       this.buttonRipple.style.animationDuration = '2s';
       this.buttonRipple.classList.remove('hover-mode');
     }
     hideTooltip();
   });

   btn.onclick = function() {
    if (!isRotating) {
     isRotating = true;
     backToTop(this, () => {
      isRotating = false; 
     });
    }
   };
   rightSideBar.appendChild(btn);

   
   btn.style.display = "block";
   
   
   startContinuousRipple(btn);
  }

  

  function backToTop(button, onComplete) {
   
   button.classList.add('sprinting');
   
   
   if (button.buttonRipple) {
     button.buttonRipple.style.display = 'none';
   }
   
   
   createRippleEffect(button);
   
   
   window.scrollTo({ top: 0, behavior: "smooth" });
   
   
   const checkScrollComplete = () => {
     if (window.scrollY === 0) {
       
       button.classList.remove('sprinting');
       
       
       button.classList.add('exploding');
       
       
       createParticleExplosion(button);
       
       
       if (button.buttonRipple) {
         button.buttonRipple.style.display = 'block';
       }
       
       
       setTimeout(() => {
         button.classList.remove('exploding');
         
         
         if (button.buttonRipple) {
           
           button.buttonRipple.style.animationPlayState = 'paused';
           
           button.buttonRipple.style.animation = 'none';
           button.buttonRipple.offsetHeight; 
           button.buttonRipple.style.animation = 'buttonRippleExpand 2s steps(25, end) infinite';
           button.buttonRipple.style.animationPlayState = 'running';
         }
         
         button.classList.add('reappearing');
         
         
         setTimeout(() => {
           button.classList.remove('reappearing');
           if (onComplete) {
             onComplete();
           }
         }, 600);
       }, 800); 
       
       return;
     }
     requestAnimationFrame(checkScrollComplete);
   };
   
   checkScrollComplete();
  }

  
  initScrollTop();
  
   
   
   
  

  function initRope() {


    if (typeof Matter === 'undefined') {
      console.error('Matter.js 库未加载，无法初始化物理绳索。');
      return;
    }
    if (document.getElementById('rope-physics-container')) {

      return;
    }

    let ropeContainer = document.getElementById('rope-container');
    if (!ropeContainer) {
      console.error('#rope-container 元素未在 HTML 或 CSS 中找到。');
      return;
    }
    
    ropeContainer.innerHTML = '';
    ropeContainer.style.height = '100vh';
    ropeContainer.style.pointerEvents = 'none';

    const monthlyEmojis = [
      { month: 1, name: "一月", ring: "❄️", falling: "❄️", description: "寒冬腊月，雪花飞舞" },
      { month: 2, name: "二月", ring: "🏮", falling: "🏮", description: "新春正月，灯笼高挂" },
      { month: 3, name: "三月", ring: "🌸", falling: "🌸", description: "春暖花开，樱花绽放" },
      { month: 4, name: "四月", ring: "🌧️", falling: "🌧️", description: "清明时节，春雨绵绵" },
      { month: 5, name: "五月", ring: "🌺", falling: "🌺", description: "立夏时节，牡丹盛开" },
      { month: 6, name: "六月", ring: "🌻", falling: "🌻", description: "芒种时节，向日葵开" },
      { month: 7, name: "七月", ring: "🌿", falling: "🌿", description: "小暑时节，绿意盎然" },
      { month: 8, name: "八月", ring: "🍉", falling: "🍉", description: "七夕时节，西瓜清甜" },
      { month: 9, name: "九月", ring: "🍁", falling: "🍁", description: "白露时节，秋葉飘落" },
      { month: 10, name: "十月", ring: "🍂", falling: "🍂", description: "寒露时节，落叶纷飞" },
      { month: 11, name: "十一月", ring: "🍊", falling: "🍊", description: "霜降时节，柑橘飘香" },
      { month: 12, name: "十二月", ring: "🌨️", falling: "🌨️", description: "大雪时节，雪花纷飞" }
    ];
    window.timeEmojis = [
      { period: "morning", name: "早晨", emojis: ["☀️", "🌤️", "🌱", "🌺", "🌿"], description: "晨曦初露，万物苏醒" },
      { period: "noon", name: "中午", emojis: ["🌞", "🌻", "🦋", "🦜", "🐝"], description: "烈日当空，生机勃勃" },
      { period: "evening", name: "傍晚", emojis: ["🌙", "⭐", "🦉"], description: "夕阳西下，夜幕降临" }
    ];
    const currentMonth = new Date().getMonth() + 1;
    const currentEmoji = monthlyEmojis.find(emoji => emoji.month === currentMonth);
    
    const ropeContainerLeft = 20;
    const ropeContainerWidth = 50;
    const ropeAnchorX = ropeContainerLeft + (ropeContainerWidth / 2);

    const { Engine, World, Bodies, Composite, Constraint, Runner, Mouse, MouseConstraint, Events, Body } = Matter;

    const engine = Engine.create();
    const world = engine.world;
    
    
    
    
    engine.world.gravity.y = 0;

    
    
    
    const ropeSegments = 80; 
    const segmentRadius = 1.5; 
    const segmentRenderHeight = 6; 
    const segmentRenderWidth = 4; 
    const constraintLength = 2.5; 

    const ropeGroup = Matter.Body.nextGroup(true);
    const ropeChain = Composite.create({ label: 'Rope' });

    
    for (let i = 0; i < ropeSegments - 1; i++) {
      const segment = Bodies.circle(ropeAnchorX, i * constraintLength, segmentRadius, {
          collisionFilter: { group: ropeGroup },
          density: 0.1, 
          friction: 0.4, 
          frictionAir: 0.08, 
          restitution: 0.02 
      });
      Composite.add(ropeChain, segment);
    }

    
    const pullRingBody = Bodies.circle(
      ropeAnchorX,
      (ropeSegments - 1) * constraintLength,
      15,
      {
        collisionFilter: { group: ropeGroup },
        density: 0.01, 
        friction: 0.5,  
        frictionAir: 0.1, 
        restitution: 0.02 
      }
    );
    Composite.add(ropeChain, pullRingBody);
    World.add(world, ropeChain);

    
    Composite.addConstraint(ropeChain, Constraint.create({
      bodyB: ropeChain.bodies[0],
      pointA: { x: ropeAnchorX, y: 0 },
      stiffness: 1 
    }));

    for (let i = 0; i < ropeSegments - 1; i++) {
      Composite.addConstraint(ropeChain, Constraint.create({
        bodyA: ropeChain.bodies[i],
        bodyB: ropeChain.bodies[i + 1],
        
        
        
        stiffness: 0.8, 
        damping: 0.8,   
        length: constraintLength * 0.6, 
        
        render: {
          visible: false
        }
      }));
    }
    
    const domContainer = document.createElement('div');
    domContainer.id = 'rope-physics-container';
    domContainer.style.position = 'fixed';
    domContainer.style.top = '0';
    domContainer.style.left = '0';
    domContainer.style.pointerEvents = 'auto'; 
    domContainer.style.zIndex = '10000';
    document.body.appendChild(domContainer);

    
    const svgContainer = document.createElement('div');
    svgContainer.id = 'rope-svg-container';
    svgContainer.style.cssText = `
      position: absolute;
      top: 0;
      left: 0;
      width: 100px;
      height: 100vh;
      pointer-events: none;
      z-index: 1;
      overflow: visible;
    `;
    domContainer.appendChild(svgContainer);
    
    
    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    svg.setAttribute('width', '100');
    svg.setAttribute('height', '100vh');
    svg.setAttribute('viewBox', '0 0 100 100vh');
    svg.style.cssText = `
      position: absolute;
      top: 0;
      left: 0;
      width: 100px;
      height: 100vh;
      overflow: visible;
    `;
    svgContainer.appendChild(svg);
    
    
    const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
    const gradient = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
    gradient.setAttribute('id', 'ropeGradient');
    gradient.setAttribute('x1', '0%');
    gradient.setAttribute('y1', '0%');
    gradient.setAttribute('x2', '0%');
    gradient.setAttribute('y2', '100%');
    
    const stop1 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    stop1.setAttribute('offset', '0%');
    stop1.setAttribute('stop-color', '#654321');
    
    const stop2 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    stop2.setAttribute('offset', '25%');
    stop2.setAttribute('stop-color', '#8B4513');
    
    const stop3 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    stop3.setAttribute('offset', '50%');
    stop3.setAttribute('stop-color', '#A0522D');
    
    const stop4 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    stop4.setAttribute('offset', '75%');
    stop4.setAttribute('stop-color', '#8B4513');
    
    const stop5 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    stop5.setAttribute('offset', '100%');
    stop5.setAttribute('stop-color', '#654321');
    
    gradient.appendChild(stop1);
    gradient.appendChild(stop2);
    gradient.appendChild(stop3);
    gradient.appendChild(stop4);
    gradient.appendChild(stop5);
    defs.appendChild(gradient);
    svg.appendChild(defs);
    
    
    const ropePath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    ropePath.setAttribute('fill', 'none');
    
    ropePath.setAttribute('stroke', '#4b2b0f');
    ropePath.setAttribute('stroke-width', '2.5');
    ropePath.setAttribute('stroke-linecap', 'round');
    ropePath.setAttribute('stroke-linejoin', 'round');
    ropePath.setAttribute('id', 'rope-path'); 
    svg.appendChild(ropePath);
    
    
    ropePath.setAttribute('d', `M 50 0 L 50 400`);
    
    
    
    
    
    const pullRingDiv = document.createElement('div');
    pullRingDiv.id = 'pull-ring-physics';
    pullRingDiv.innerHTML = currentEmoji.ring;
    pullRingDiv.title = `${currentEmoji.name}: ${currentEmoji.description}`;
    pullRingDiv.style.cssText = `
      font-size: 24px; cursor: grab; pointer-events: auto;
      width: 30px; height: 30px; text-align: center;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); position: absolute;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      z-index: 2;
      transform: translate(40px, 300px); /* 初始位置，向右移动5px */
    `;
    
    
    pullRingDiv.addEventListener('mousedown', () => {
      pullRingDiv.style.cursor = 'grabbing';
    });
    
    pullRingDiv.addEventListener('mouseup', () => {
      pullRingDiv.style.cursor = 'grab';
    });
    
    domContainer.appendChild(pullRingDiv);
    
    
    const ropeElements = {
      svg: svg,
      path: ropePath,
      pullRing: pullRingDiv
    };

    const mouse = Mouse.create(document.body);
    const mouseConstraint = MouseConstraint.create(engine, {
      mouse: mouse,
      constraint: { 
        stiffness: 0.8, 
        render: { visible: false },
        
        length: 0,
        damping: 0.05 
      }
    });
    World.add(world, mouseConstraint);
    
    
    mouseConstraint.constraint.bodyB = null;
    
    
    Events.on(mouseConstraint, 'mousedown', (event) => {

    });
    
    
    mouseConstraint.mouse.element = document.body;
    
    
    let dragStartPosition = null;
    
    Events.on(mouseConstraint, 'startdrag', () => {
      document.body.classList.add('no-text-selection');
      
      
      if (mouseConstraint.body && mouseConstraint.body === pullRingBody) {
        dragStartPosition = {
          x: mouseConstraint.body.position.x,
          y: mouseConstraint.body.position.y
        };
      }
    });
    
    Events.on(mouseConstraint, 'enddrag', () => {
      document.body.classList.remove('no-text-selection');
      
      
      
      if (dragStartPosition) {
        
        const currentPosition = pullRingBody.position;
        const dragDistance = Math.sqrt(
          Math.pow(currentPosition.x - dragStartPosition.x, 2) +
          Math.pow(currentPosition.y - dragStartPosition.y, 2)
        );
        
        
        if (dragDistance > 1) {
          createSeasonalFalling(currentEmoji);
          
          
          Matter.Body.applyForce(pullRingBody, pullRingBody.position, { x: 0, y: 0.5 });
          
          
          const targetX = ropeAnchorX;
          const targetY = (ropeSegments - 1) * constraintLength;
          
          
          const dx = targetX - currentPosition.x;
          const dy = targetY - currentPosition.y;
          
          
          Matter.Body.applyForce(pullRingBody, pullRingBody.position, { 
            x: dx * 0.001, 
            y: dy * 0.001 
          });
          
        }
        
        
        dragStartPosition = null;
      }
    });
    


    
    (function render() {
      
      let pathData = '';
      
      
      const topPoint = { x: 50, y: 0 }; 
      pathData += `M ${topPoint.x} ${topPoint.y}`;
      
      
      ropeChain.bodies.forEach((body, index) => {
        if (index < ropeSegments - 1) { 
          const relativeX = body.position.x - ropeAnchorX + 50; 
          const relativeY = body.position.y;
          pathData += ` L ${relativeX} ${relativeY}`;
        }
      });
      
      
      const pullRingBody = ropeChain.bodies[ropeSegments - 1];
      if (pullRingBody) {
        const relativeX = pullRingBody.position.x - ropeAnchorX + 50; 
        const relativeY = pullRingBody.position.y;
        pathData += ` L ${relativeX} ${relativeY}`;
      }
      
      
      ropeElements.path.setAttribute('d', pathData);
      
      
      if (pullRingBody) {
        
        
        const adjustedX = pullRingBody.position.x - 15 + 3.5; 
        const adjustedY = pullRingBody.position.y - 15;
        
        ropeElements.pullRing.style.transform = `translate(
          ${adjustedX}px,
          ${adjustedY}px
        )`;
        

      }
      
      setTimeout(() => requestAnimationFrame(render), 1000 / 240); 
    })();
    
    
    
    const runner = Runner.create();
    
    runner.delta = 1000 / 240; 
    Runner.run(runner, engine);

    
    
    
    setTimeout(() => {
      engine.world.gravity.y = 1.2;
    }, 100); 

    
    
    
    
    
    ropeChain.bodies.forEach((body, index) => {
      Matter.Body.set(body, 'sleeping', false);
      
      body.sleepThreshold = Infinity;
    });
    
    
    engine.enableSleeping = false;
    
    
    mouseConstraint.constraint.bodyB = null;
    mouseConstraint.mouse.element = document.body;


  }

  

  function createSeasonalFalling(emojiConfig) {

   
   
   const fallingContainer = document.createElement('div');
   fallingContainer.id = 'falling-container';
   fallingContainer.style.cssText = `
     position: fixed;
     top: 0;
     left: 0;
     width: 100vw;
     height: 100vh;
     pointer-events: none;
     z-index: 9999;
     overflow: hidden;
   `;
   document.body.appendChild(fallingContainer);

   
   
   const currentHour = new Date().getHours();
   let currentTimePeriod;
   if (currentHour >= 5 && currentHour < 11) {
    currentTimePeriod = window.timeEmojis.find(t => t.period === "morning");
   } else if (currentHour >= 11 && currentHour < 17) {
    currentTimePeriod = window.timeEmojis.find(t => t.period === "noon");
   } else {
    currentTimePeriod = window.timeEmojis.find(t => t.period === "evening");
   }
   

   
   
   const totalElements = emojiConfig.month >= 11 || emojiConfig.month <= 2 ? 30 : 25; 
   let activeElements = 0;
   

   
   for (let i = 0; i < totalElements; i++) {
    setTimeout(() => {
     const element = document.createElement('div');
     
     
     let selectedEmoji, emojiType;
     if (Math.random() < 0.7) {
      selectedEmoji = emojiConfig.falling;
      emojiType = "monthly";
     } else {
      
      selectedEmoji = currentTimePeriod.emojis[Math.floor(Math.random() * currentTimePeriod.emojis.length)];
      emojiType = "time";
     }
     

     element.innerHTML = selectedEmoji;
     
     
     let fontSize, color, textShadow;
     if (emojiType === "time") {
      
      if (currentTimePeriod.period === "morning") {
       
       fontSize = Math.random() * 18 + 16;
       color = '#FFD700';
       textShadow = '0 0 5px rgba(255, 215, 0, 0.7)';
      } else if (currentTimePeriod.period === "noon") {
       
       fontSize = Math.random() * 18 + 16;
       color = '#FF8C00';
       textShadow = '0 0 5px rgba(255, 140, 0, 0.7)';
      } else {
       
       fontSize = Math.random() * 18 + 16;
       color = '#4B0082';
       textShadow = '0 0 5px rgba(75, 0, 130, 0.7)';
      }
     } else {
      
      if (emojiConfig.month >= 11 || emojiConfig.month <= 2) {
       
       fontSize = Math.random() * 20 + 15;
       color = 'white';
       textShadow = '0 0 5px rgba(255, 255, 255, 0.8)';
      } else if (emojiConfig.month >= 3 && emojiConfig.month <= 5) {
       
       fontSize = Math.random() * 18 + 16;
       color = '#FF69B4';
       textShadow = '0 0 5px rgba(255, 105, 180, 0.6)';
      } else if (emojiConfig.month >= 6 && emojiConfig.month <= 8) {
       
       fontSize = Math.random() * 18 + 15;
       color = '#32CD32';
       textShadow = '0 0 5px rgba(50, 205, 50, 0.6)';
      } else {
       
       fontSize = Math.random() * 18 + 15;
       color = '#FF8C00';
       textShadow = '0 0 5px rgba(255, 140, 0, 0.6)';
      }
     }
     
     element.style.cssText = `
       position: absolute;
       font-size: ${fontSize}px;
       color: ${color};
       text-shadow: ${textShadow};
       left: ${Math.random() * window.innerWidth}px;
       top: -50px;
       user-select: none;
       pointer-events: none;
       z-index: 9999;
       transition: all 0.3s ease;
     `;
     
     fallingContainer.appendChild(element);
     activeElements++;
     
     
     const duration = 4000 + Math.random() * 2000;
     const endX = parseFloat(element.style.left) + (Math.random() - 0.5) * 400;
     const endY = window.innerHeight + 50;
     
     element.style.transition = `all ${duration}ms linear`;
     
     setTimeout(() => {
      element.style.left = endX + 'px';
      element.style.top = endY + 'px';
      element.style.opacity = '0';
     }, 50);
     
     
     setTimeout(() => {
      if (element.parentNode) {
       element.parentNode.removeChild(element);
      }
      activeElements--;
      
      
      if (activeElements === 0) {
       if (fallingContainer && fallingContainer.parentNode) {
        fallingContainer.parentNode.removeChild(fallingContainer);
       }
      }
     }, duration);
    }, i * 150);
   }
  }

   
   
   
  function initCodeMoreBox() {
   let codeBlocks = document.querySelectorAll(".highlight");
   if (!codeBlocks) {
    return;
   }
   codeBlocks.forEach(codeBlock => {
    
    if (codeBlock.scrollHeight <= codeBlock.clientHeight) {
     return;
    }
    
    
    let codeMoreBox = document.createElement('div');
    codeMoreBox.classList.add('code-more-box');
    
    let codeMoreBtn = document.createElement('span');
    codeMoreBtn.classList.add('code-more-btn');
    codeMoreBtn.innerText = '显示更多'; 
    let isExpanded = false; 

    codeMoreBtn.addEventListener('click', () => {
     if (!isExpanded) {
      codeBlock.classList.add('code-show'); 
      codeMoreBtn.innerText = '折叠'; 
      isExpanded = true;
     } else {
      codeBlock.classList.remove('code-show'); 
      codeMoreBtn.innerText = '显示更多'; 
      isExpanded = false;
     }
     
     window.dispatchEvent(new Event('resize'));
    });
    
    codeMoreBox.appendChild(codeMoreBtn);
    codeBlock.appendChild(codeMoreBox);
   });
  }


  
   
   
   
  
  

  function captureScrollListeners() {
    
    setTimeout(() => {
      
      overrideScrollspy();
    }, 2000);
  }
  
  

  function overrideScrollspy() {
    
    window.tocScrollspyEnabled = true;
    
    
    setTimeout(() => {
      
      
      
      
      if (!window.originalScrollTo) {
        window.originalScrollTo = HTMLElement.prototype.scrollTo;
        
        HTMLElement.prototype.scrollTo = function(options) {
          
          if (this.id === 'TableOfContents' && window.tocScrollDisabled) {
            return;
          }
          
          
          return window.originalScrollTo.call(this, options);
        };
      }
      
      
      if (!window.originalScrollIntoView) {
        window.originalScrollIntoView = HTMLElement.prototype.scrollIntoView;
        
        HTMLElement.prototype.scrollIntoView = function(options) {
          
          if (this.closest('#TableOfContents') && window.tocScrollDisabled) {
            return;
          }
          
          
          return window.originalScrollIntoView.call(this, options);
        };
      }
    }, 3000); 
  }
  
  function initTocLock() {
    
    
    const articleToc = document.querySelector('#TableOfContents');
    if (!articleToc) {
      
      return;
    }
    
    
    const tocContainer = document.querySelector('.widget.archives');
    if (!tocContainer) {
      return;
    }
    
    
    tocContainer.style.position = 'relative';
    
    
    captureScrollListeners();
    
    
    const lockLabel = document.createElement('div');
    lockLabel.className = 'toc-lock-label';
    lockLabel.textContent = '锁定：';
    
    
    const lockBtn = document.createElement('div');
    lockBtn.className = 'toc-lock-btn';
    lockBtn.innerHTML = `
      <svg class="lock-icon unlocked" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 11H5a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2z"/>
        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
      </svg>
      <svg class="lock-icon locked" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="11" width="18" height="10" rx="2" ry="2"/>
        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
        <path d="M9 12v3a3 3 0 0 0 6 0v-3"/>
      </svg>
    `;
    
    
    lockBtn.addEventListener('click', function() {
      const isLocked = this.classList.contains('locked');
      
      if (isLocked) {
        
        this.classList.remove('locked');
        localStorage.setItem('tocLocked', 'false');
        enableTocScroll();
      } else {
        
        this.classList.add('locked');
        localStorage.setItem('tocLocked', 'true');
        disableTocScroll();
      }
    });
    
    
    tocContainer.appendChild(lockLabel);
    tocContainer.appendChild(lockBtn);
    
    
    
    lockBtn.classList.remove('locked');
    localStorage.setItem('tocLocked', 'false');
    
    
    const observer = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
          const isLocked = lockBtn.classList.contains('locked');
          if (isLocked) {
            disableTocScroll();
          } else {
            enableTocScroll();
          }
        }
      });
    });
    
    observer.observe(lockBtn, { attributes: true });
  }

  

  function disableTocScroll() {
    
    window.tocScrollDisabled = true;
    
    
    const tocContainer = document.querySelector('#TableOfContents');
    if (tocContainer) {
      
      window.savedTocScrollTop = tocContainer.scrollTop;
      
      
      const currentActive = tocContainer.querySelector('.active-class');
      if (currentActive) {
        window.savedActiveElement = currentActive;
      }
    }
    
    
    if (tocContainer) {
      tocContainer.setAttribute('data-scrollspy-disabled', 'true');
      tocContainer.title = '目录已锁定，不会自动跟随滚动';
    }
    
    
    const archivesContainer = document.querySelector('.widget.archives');
    if (archivesContainer) {
      archivesContainer.style.opacity = '0.8';
      archivesContainer.title = '目录已锁定，不会自动跟随滚动';
    }
  }

  

  function enableTocScroll() {
    
    window.tocScrollDisabled = false;
    
    
    const tocContainer = document.querySelector('#TableOfContents');
    if (tocContainer) {
      
      tocContainer.removeAttribute('data-scrollspy-disabled');
      tocContainer.title = '';
    }
    
    
    const archivesContainer = document.querySelector('.widget.archives');
    if (archivesContainer) {
      archivesContainer.style.opacity = '1';
      archivesContainer.title = '';
    }
  }

  
  
  
  document.addEventListener('DOMContentLoaded', function() {
  

    
    initCodeMoreBox();
    initRope();

    
    setTimeout(initTocLock, 1000);
  });

</script>


<div id="rope-container"></div>


<div id="particles-js"></div>

<script>

particlesJS('particles-js', {
  "particles": {
    "number": {
      "value": 80,
      "density": {
        "enable": true,
        "value_area": 800
      }
    },
    "color": {
      "value": ["#888888", "#aaaaaa", "#cccccc", "#eeeeee"]
    },
    "shape": {
      "type": "circle",
      "stroke": {
        "width": 0,
        "color": "#000000"
      },
      "polygon": {
        "nb_sides": 5
      }
    },
    "opacity": {
      "value": 0.5,
      "random": false,
      "anim": {
        "enable": false,
        "speed": 1,
        "opacity_min": 0.1,
        "sync": false
      }
    },
    "size": {
      "value": 2,
      "random": true,
      "anim": {
        "enable": false,
        "speed": 40,
        "size_min": 0.1,
        "sync": false
      }
    },
    "line_linked": {
      "enable": true,
      "distance": 150,
      "color": "#888888",
      "opacity": 0.4,
      "width": 1
    },
    "move": {
      "enable": true,
      "speed": 2,
      "direction": "none",
      "random": false,
      "straight": false,
      "out_mode": "out",
      "bounce": false,
      "attract": {
        "enable": false,
        "rotateX": 600,
        "rotateY": 1200
      }
    }
  },
  "interactivity": {
    "detect_on": "canvas",
    "events": {
      "onhover": {
        "enable": true,
        "mode": "grab"
      },
      "onclick": {
        "enable": true,
        "mode": "push"
      },
      "resize": true
    },
    "modes": {
      "grab": {
        "distance": 140,
        "line_linked": {
          "opacity": 1
        }
      },
      "bubble": {
        "distance": 400,
        "size": 40,
        "duration": 2,
        "opacity": 8,
        "speed": 3
      },
      "repulse": {
        "distance": 200,
        "duration": 0.4
      },
      "push": {
        "particles_nb": 4
      },
      "remove": {
        "particles_nb": 2
      }
    }
  },
  "retina_detect": true
});
</script>


<script>
(function() {
  'use strict';
  
  
  const categoryColors = [
    '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57',
    '#ff9ff3', '#54a0ff', '#5f27cd', '#00d2d3', '#ff9f43',
    '#10ac84', '#ff6348', '#a55eea', '#e17055', '#d63031',
    '#00b894', '#fdcb6e', '#6c5ce7', '#fd79a8', '#f39c12',
    '#e67e22', '#e74c3c', '#9b59b6', '#3498db', '#1abc9c',
    '#16a085', '#27ae60', '#2ecc71', '#f1c40f', '#e67e22'
  ];
  
  
  function hashString(str) {
    let hash = 0;
    if (str.length === 0) return hash;
    
    for (let i = 0; i < str.length; i++) {
      const char = str.charCodeAt(i);
      hash = ((hash << 5) - hash) + char;
      hash = hash & hash; 
    }
    
    return Math.abs(hash);
  }
  
  
  function assignCategoryColors() {

    
    
    const isArchivesPage = document.body.classList.contains('template-archives') ||
                          window.location.pathname.includes('/archives/');
    const isArticlePage = document.querySelector('#TableOfContents') || 
                         document.querySelector('.article-category');
    
    
    
    
    if (isArticlePage && !isArchivesPage) {
      const categoryLinks = document.querySelectorAll('.article-category a');

      
      categoryLinks.forEach((link, index) => {
        
        const href = link.getAttribute('href');
        const categoryName = href.split('/').pop() || href.split('/').slice(-2, -1)[0] || 'default';
        
        
        const hash = hashString(categoryName);
        const colorIndex = hash % categoryColors.length;
        const backgroundColor = categoryColors[colorIndex];
        
        
        
        
        link.style.setProperty('background-color', backgroundColor, 'important');
        link.style.setProperty('color', '#fff', 'important');
        
        
        link.addEventListener('mouseenter', function() {
          this.style.opacity = '0.8';
          this.style.transform = 'scale(1.05)';
        });
        
        link.addEventListener('mouseleave', function() {
          this.style.opacity = '1';
          this.style.transform = 'scale(1)';
        });
      });
    }
    
    
    if (!isArchivesPage) {
      
      const sidebarCategories = document.querySelectorAll('.widget.categories a, .widget.tagCloud a');

      
      sidebarCategories.forEach((link, index) => {
        
        const href = link.getAttribute('href');
        const categoryName = href.split('/').pop() || href.split('/').slice(-2, -1)[0] || 'default';
        
        
        const hash = hashString(categoryName);
        const colorIndex = hash % categoryColors.length;
        const backgroundColor = categoryColors[colorIndex];
        
        
        
        
        link.style.setProperty('background-color', backgroundColor, 'important');
        link.style.setProperty('color', '#fff', 'important');
        link.style.setProperty('border-radius', '6px', 'important');
        link.style.setProperty('padding', '8px 12px', 'important');
        link.style.setProperty('margin', '4px 0', 'important');
        link.style.setProperty('display', 'inline-block', 'important');
        link.style.setProperty('text-decoration', 'none', 'important');
        link.style.setProperty('transition', 'all 0.3s ease', 'important');
        
        
        link.addEventListener('mouseenter', function() {
          this.style.opacity = '0.8';
          this.style.transform = 'scale(1.05)';
          this.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.2)';
        });
        
        link.addEventListener('mouseleave', function() {
          this.style.opacity = '1';
          this.style.transform = 'scale(1)';
          this.style.boxShadow = 'none';
        });
      });
    } else {
      

    }
    

  }
  
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', assignCategoryColors);
  } else {
    assignCategoryColors();
  }
  
  
  setTimeout(assignCategoryColors, 500);
  setTimeout(assignCategoryColors, 1000);
  setTimeout(assignCategoryColors, 2000);
  
  
  const observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
        
        const hasNewCategories = Array.from(mutation.addedNodes).some(node => {
          return node.nodeType === 1 && (
            node.classList.contains('article-category') ||
            node.querySelector('.article-category') ||
            node.classList.contains('widget') ||
            node.querySelector('.widget')
          );
        });
        
        if (hasNewCategories) {
          
          setTimeout(assignCategoryColors, 100);
          setTimeout(assignCategoryColors, 500);
        }
      }
    });
  });
  
  
  observer.observe(document.body, {
    childList: true,
    subtree: true
  });
})();
</script>


<script>
(function() {
  'use strict';
  
  
  function fixDarkModeToggleText() {
    const toggleBtn = document.getElementById('dark-mode-toggle');
    if (!toggleBtn) {
      return;
    }
    
    
    toggleBtn.classList.add('dark-mode-toggle-fix');
    
    
    const span = toggleBtn.querySelector('span');
    if (!span) {
      return;
    }
    
    
    function updateText() {
      const isDark = document.documentElement.dataset.scheme === 'dark';
      span.textContent = isDark ? '亮色模式' : '暗色模式';

    }
    
    
    updateText();
    
    
    function handleThemeChange() {
      setTimeout(updateText, 100); 
    }
    
    
    window.addEventListener('onColorSchemeChange', handleThemeChange);
    
    
    const observer = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'data-scheme') {
          handleThemeChange();
        }
      });
    });
    
    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['data-scheme']
    });
    
    
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', handleThemeChange);
    
    
    toggleBtn.addEventListener('click', function() {
      
      setTimeout(updateText, 200);
    });
    

  }
  
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', fixDarkModeToggleText);
  } else {
    fixDarkModeToggleText();
  }
  
  
  setTimeout(fixDarkModeToggleText, 1000);
  setTimeout(fixDarkModeToggleText, 2000);
})();
</script>

  
  <script>
  
  if (!document.getElementById('new-theme-switch')) {
    document.write(`
      <div id="new-theme-switch" style="position: fixed; bottom: 50px; left: 50px; z-index: 1000; text-align: center;">
        <label class="theme-switch">
          <input type="checkbox" class="theme-switch__checkbox" id="theme-switch-checkbox">
          <div class="theme-switch__container">
            <div class="theme-switch__clouds"></div>
            <div class="theme-switch__stars-container">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 144 55" fill="none">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M135.831 3.00688C135.055 3.85027 134.111 4.29946 133 4.35447C134.111 4.40947 135.055 4.85867 135.831 5.71123C136.607 6.55462 136.996 7.56303 136.996 8.72727C136.996 7.95722 137.172 7.25134 137.525 6.59129C137.886 5.93124 138.372 5.39954 138.98 5.00535C139.598 4.60199 140.268 4.39114 141 4.35447C139.88 4.2903 138.936 3.85027 138.16 3.00688C137.384 2.16348 136.996 1.16425 136.996 0C136.996 1.16425 136.607 2.16348 135.831 3.00688ZM31 23.3545C32.1114 23.2995 33.0551 22.8503 33.8313 22.0069C34.6075 21.1635 34.9956 20.1642 34.9956 19C34.9956 20.1642 35.3837 21.1635 36.1599 22.0069C36.9361 22.8503 37.8798 23.2903 39 23.3545C38.2679 23.3911 37.5976 23.602 36.9802 24.0053C36.3716 24.3995 35.8864 24.9312 35.5248 25.5913C35.172 26.2513 34.9956 26.9572 34.9956 27.7273C34.9956 26.563 34.6075 25.5546 33.8313 24.7112C33.0551 23.8587 32.1114 23.4095 31 23.3545ZM0 36.3545C1.11136 36.2995 2.05513 35.8503 2.83131 35.0069C3.6075 34.1635 3.99559 33.1642 3.99559 32C3.99559 33.1642 4.38368 34.1635 5.15987 35.0069C5.93605 35.8503 6.87982 36.2903 8 36.3545C7.26792 36.3911 6.59757 36.602 5.98015 37.0053C5.37155 37.3995 4.88644 37.9312 4.52481 38.5913C4.172 39.2513 3.99559 39.9572 3.99559 40.7273C3.99559 39.563 4.38368 38.5546 2.83131 37.7112C2.05513 36.8587 1.11136 36.4095 0 36.3545ZM56.8313 24.0069C56.0551 24.8503 55.1114 25.2995 54 25.3545C55.1114 25.4095 56.0551 25.8587 56.8313 26.7112C57.6075 27.5546 57.9956 28.563 57.9956 29.7273C57.9956 28.9572 58.172 28.2513 58.5248 27.5913C58.8864 26.9312 59.3716 26.3995 59.9802 26.0053C60.5976 25.602 61.2679 25.3911 62 25.3545C60.8798 25.2903 59.9361 24.8503 59.1599 24.0069C58.3837 23.1635 57.9956 22.1642 57.9956 21C57.9956 22.1642 57.6075 23.1635 56.8313 24.0069ZM81 25.3545C82.1114 25.2995 83.0551 24.8503 83.8313 24.0069C84.6075 23.1635 84.9956 22.1642 84.9956 21C84.9956 22.1642 85.3837 23.1635 86.1599 24.0069C86.9361 24.8503 87.8798 25.2903 89 25.3545C88.2679 25.3911 87.5976 25.602 86.9802 26.0053C86.3716 26.3995 85.8864 26.9312 85.5248 27.5913C85.172 28.2513 84.9956 28.9572 84.9956 29.7273C84.9956 28.563 84.6075 27.5546 83.8313 26.7112C83.0551 25.8587 82.1114 25.4095 81 25.3545ZM136 36.3545C137.111 36.2995 138.055 35.8503 138.831 35.0069C139.607 34.1635 139.996 33.1642 139.996 32C139.996 33.1642 140.384 34.1635 141.16 35.0069C141.936 35.8503 142.88 36.2903 144 36.3545C143.268 36.3911 142.598 36.602 141.98 37.0053C141.372 37.3995 140.886 37.9312 140.525 38.5913C140.172 39.2513 139.996 39.9572 139.996 40.7273C139.996 39.563 139.607 38.5546 138.831 37.7112C138.055 36.8587 137.111 36.4095 136 36.3545ZM101.831 49.0069C101.055 49.8503 100.111 50.2995 99 50.3545C100.111 50.4095 101.055 50.8587 101.831 51.7112C102.607 52.5546 102.996 53.563 102.996 54.7273C102.996 53.9572 103.172 53.2513 103.525 52.5913C103.886 51.9312 104.372 51.3995 104.98 51.0053C105.598 50.602 106.268 50.3911 107 50.3545C105.88 50.2903 104.936 49.8503 104.16 49.0069C103.384 48.1635 102.996 47.1642 102.996 46C102.996 47.1642 102.607 48.1635 101.831 49.0069Z" fill="currentColor"></path>
              </svg>
            </div>
            <div class="theme-switch__circle-container">
              <div class="theme-switch__sun-moon-container">
                <div class="theme-switch__moon">
                  <div class="theme-switch__spot"></div>
                  <div class="theme-switch__spot"></div>
                  <div class="theme-switch__spot"></div>
                </div>
              </div>
            </div>
          </div>
        </label>
        <div id="theme-switch-text" style="color: #fff; font-size: 14px; font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,0.5); margin-top: 8px; text-align: center;">亮色模式</div>
      </div>
    `);
  }
  </script>


<style>
   
  .theme-switch {
    --toggle-size: 20px;  
    --container-width: 3.75em;
    --container-height: 1.7em;
    --container-radius: 4.2em;
    --container-light-bg: #3D7EAE;
    --container-night-bg: #1D1F2C;
    --circle-container-diameter: 2.25em;
    --sun-moon-diameter: 1.4em;
    --sun-bg: #ECCA2F;
    --moon-bg: #C4C9D1;
    --spot-color: #959DB1;
    --circle-container-offset: calc((var(--circle-container-diameter) - var(--container-height)) / 2 * -1);
    --stars-color: #fff;
    --clouds-color: #F3FDFF;
    --back-clouds-color: #AACADF;
    --transition: .5s cubic-bezier(0, -0.02, 0.4, 1.25);
    --circle-transition: .3s cubic-bezier(0, -0.02, 0.35, 1.17);
  }

  .theme-switch, .theme-switch *, .theme-switch *::before, .theme-switch *::after {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-size: var(--toggle-size);
  }

  .theme-switch__container {
    width: var(--container-width);
    height: var(--container-height);
    background-color: var(--container-light-bg);
    border-radius: var(--container-radius);
    overflow: hidden;
    cursor: pointer;
    -webkit-box-shadow: 0em -0.062em 0.062em rgba(0, 0, 0, 0.25), 0em 0.062em 0.125em rgba(255, 255, 255, 0.94);
    box-shadow: 0em -0.062em 0.062em rgba(0, 0, 0, 0.25), 0em 0.062em 0.125em rgba(255, 255, 255, 0.94);
    -webkit-transition: var(--transition);
    -o-transition: var(--transition);
    transition: var(--transition);
    position: relative;
  }

  .theme-switch__container::before {
    content: "";
    position: absolute;
    z-index: 1;
    inset: 0;
    -webkit-box-shadow: 0em 0.05em 0.187em rgba(0, 0, 0, 0.25) inset, 0em 0.05em 0.187em rgba(0, 0, 0, 0.25) inset;
    box-shadow: 0em 0.05em 0.187em rgba(0, 0, 0, 0.25) inset, 0em 0.05em 0.187em rgba(0, 0, 0, 0.25) inset;
    border-radius: var(--container-radius)
  }

  .theme-switch__checkbox {
    display: none;
  }

  .theme-switch__circle-container {
    width: var(--circle-container-diameter);
    height: var(--circle-container-diameter);
    background-color: rgba(255, 255, 255, 0.1);
    position: absolute;
    left: var(--circle-container-offset);
    top: var(--circle-container-offset);
    border-radius: var(--container-radius);
    -webkit-box-shadow: inset 0 0 0 3.375em rgba(255, 255, 255, 0.1), inset 0 0 0 3.375em rgba(255, 255, 255, 0.1), 0 0 0 0.625em rgba(255, 255, 255, 0.1), 0 0 0 1.25em rgba(255, 255, 255, 0.1);
    box-shadow: inset 0 0 0 3.375em rgba(255, 255, 255, 0.1), inset 0 0 0 3.375em rgba(255, 255, 255, 0.1), 0 0 0 0.625em rgba(255, 255, 255, 0.1), 0 0 0 1.25em rgba(255, 255, 255, 0.1);
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-transition: var(--circle-transition);
    -o-transition: var(--circle-transition);
    transition: var(--circle-transition);
    pointer-events: none;
  }

  .theme-switch__sun-moon-container {
    pointer-events: auto;
    position: relative;
    z-index: 2;
    width: var(--sun-moon-diameter);
    height: var(--sun-moon-diameter);
    margin: auto;
    border-radius: var(--container-radius);
    background-color: var(--sun-bg);
    -webkit-box-shadow: 0.062em 0.062em 0.062em 0em rgba(254, 255, 239, 0.61) inset, 0em -0.062em 0.062em 0em #a1872a inset;
    box-shadow: 0.062em 0.062em 0.062em 0em rgba(254, 255, 239, 0.61) inset, 0em -0.062em 0.062em 0em #a1872a inset;
    -webkit-filter: drop-shadow(0.062em 0.125em 0.125em rgba(0, 0, 0, 0.25)) drop-shadow(0em 0.062em 0.125em rgba(0, 0, 0, 0.25));
    filter: drop-shadow(0.062em 0.125em 0.125em rgba(0, 0, 0, 0.25)) drop-shadow(0em 0.062em 0.125em rgba(0, 0, 0, 0.25));
    overflow: hidden;
    -webkit-transition: var(--transition);
    -o-transition: var(--transition);
    transition: var(--transition);
  }

  .theme-switch__moon {
    -webkit-transform: translateX(100%);
    -ms-transform: translateX(100%);
    transform: translateX(100%);
    width: 100%;
    height: 100%;
    background-color: var(--moon-bg);
    border-radius: inherit;
    -webkit-box-shadow: 0.062em 0.062em 0.062em 0em rgba(254, 255, 239, 0.61) inset, 0em -0.062em 0.062em 0em #969696 inset;
    box-shadow: 0.062em 0.062em 0.062em 0em rgba(254, 255, 239, 0.61) inset, 0em -0.062em 0.062em 0em #969696 inset;
    -webkit-transition: var(--transition);
    -o-transition: var(--transition);
    transition: var(--transition);
    position: relative;
  }

  .theme-switch__spot {
    position: absolute;
    top: 0.75em;
    left: 0.312em;
    width: 0.75em;
    height: 0.75em;
    border-radius: var(--container-radius);
    background-color: var(--spot-color);
    -webkit-box-shadow: 0em 0.0312em 0.062em rgba(0, 0, 0, 0.25) inset;
    box-shadow: 0em 0.0312em 0.062em rgba(0, 0, 0, 0.25) inset;
  }

  .theme-switch__spot:nth-of-type(2) {
    width: 0.375em;
    height: 0.375em;
    top: 0.937em;
    left: 1.375em;
  }

  .theme-switch__spot:nth-last-of-type(3) {
    width: 0.25em;
    height: 0.25em;
    top: 0.312em;
    left: 0.812em;
  }

  .theme-switch__clouds {
    width: 1.25em;
    height: 1.25em;
    background-color: var(--clouds-color);
    border-radius: var(--container-radius);
    position: absolute;
    bottom: -0.625em;
    left: 0.312em;
    -webkit-box-shadow: 0.937em 0.312em var(--clouds-color), -0.312em -0.312em var(--back-clouds-color), 1.437em 0.375em var(--clouds-color), 0.5em -0.125em var(--back-clouds-color), 2.187em 0 var(--clouds-color), 1.25em -0.062em var(--back-clouds-color), 2.937em 0.312em var(--clouds-color), 2em -0.312em var(--back-clouds-color), 3.625em -0.062em var(--clouds-color), 2.625em 0em var(--back-clouds-color), 4.5em -0.312em var(--clouds-color), 3.375em -0.437em var(--back-clouds-color), 4.625em -1.75em 0 0.437em var(--clouds-color), 4em -0.625em var(--back-clouds-color), 4.125em -2.125em 0 0.437em var(--back-clouds-color);
    box-shadow: 0.937em 0.312em var(--clouds-color), -0.312em -0.312em var(--back-clouds-color), 1.437em 0.375em var(--clouds-color), 0.5em -0.125em var(--back-clouds-color), 2.187em 0 var(--clouds-color), 1.25em -0.062em var(--back-clouds-color), 2.937em 0.312em var(--clouds-color), 2em -0.312em var(--back-clouds-color), 3.625em -0.062em var(--clouds-color), 2.625em 0em var(--back-clouds-color), 4.5em -0.312em var(--clouds-color), 3.375em -0.437em var(--back-clouds-color), 4.625em -1.75em 0 0.437em var(--clouds-color), 4em -0.625em var(--back-clouds-color), 4.125em -2.125em 0 0.437em var(--back-clouds-color);
    -webkit-transition: 0.5s cubic-bezier(0, -0.02, 0.4, 1.25);
    -o-transition: 0.5s cubic-bezier(0, -0.02, 0.4, 1.25);
    transition: 0.5s cubic-bezier(0, -0.02, 0.4, 1.25);
  }

  .theme-switch__stars-container {
    position: absolute;
    color: var(--stars-color);
    top: -100%;
    left: 0.312em;
    width: 2.75em;
    height: auto;
    -webkit-transition: var(--transition);
    -o-transition: var(--transition);
    transition: var(--transition);
  }

   
  .theme-switch__checkbox:checked + .theme-switch__container {
    background-color: var(--container-night-bg);
  }

  .theme-switch__checkbox:checked + .theme-switch__container .theme-switch__circle-container {
    left: calc(100% - var(--circle-container-offset) - var(--circle-container-diameter));
  }

  .theme-switch__checkbox:checked + .theme-switch__container .theme-switch__circle-container:hover {
    left: calc(100% - var(--circle-container-offset) - var(--circle-container-diameter) - 0.187em)
  }

  .theme-switch__circle-container:hover {
    left: calc(var(--circle-container-offset) + 0.187em);
  }

  .theme-switch__checkbox:checked + .theme-switch__container .theme-switch__moon {
    -webkit-transform: translate(0);
    -ms-transform: translate(0);
    transform: translate(0);
    transform: translate(0);
  }

  .theme-switch__checkbox:checked + .theme-switch__container .theme-switch__clouds {
    bottom: -4.062em;
  }

  .theme-switch__checkbox:checked + .theme-switch__container .theme-switch__stars-container {
    top: 50%;
    -webkit-transform: translateY(-50%);
    -ms-transform: translateY(-50%);
    transform: translateY(-50%);
  }

   
  #dark-mode-toggle {
    display: none !important;
  }

   
  .dark-mode-toggle-fix span {
    font-size: 18px !important;
    font-weight: 600 !important;
  }
</style>


<script>
(function() {
  'use strict';
  
  
  if (window.themeSwitchInitialized) {
    console.log('主题切换开关已经初始化，跳过重复执行');
    return;
  }
  
  let isInitialized = false;
  let observer = null;
  
  function initNewThemeSwitch() {
    
    if (isInitialized) {
      return;
    }
    
    const checkbox = document.getElementById('theme-switch-checkbox');
    if (!checkbox) {
      return;
    }
    
    
    function updateCheckboxState() {
      const isDark = document.documentElement.dataset.scheme === 'dark';
      checkbox.checked = isDark;
      
      
      const textElement = document.getElementById('theme-switch-text');
      if (textElement) {
        textElement.textContent = isDark ? '暗色模式' : '亮色模式';
        console.log('更新主题切换文字:', isDark ? '暗色模式' : '亮色模式');
      }
      
      console.log('当前主题状态:', isDark ? 'dark' : 'light', 'checkbox状态:', checkbox.checked);
    }
    
    
    function waitForThemeSystem() {
      
      const schemeFromData = document.documentElement.dataset.scheme;
      const schemeFromClass = document.documentElement.className.includes('dark') ? 'dark' : 
                             document.documentElement.className.includes('light') ? 'light' : null;
      const schemeFromLocalStorage = localStorage.getItem('StackColorScheme');
      
      if (schemeFromData || schemeFromClass || schemeFromLocalStorage) {
        
        let finalScheme = schemeFromData || schemeFromClass || schemeFromLocalStorage;
        
        
        if (schemeFromData) {
          finalScheme = schemeFromData;
        }
        
        
        document.documentElement.dataset.scheme = finalScheme;
        
        
        updateCheckboxState();
        isInitialized = true;
        window.themeSwitchInitialized = true;
        
        console.log('主题系统已初始化，当前主题:', finalScheme);
      } else {
        
        setTimeout(waitForThemeSystem, 100);
      }
    }
    
    
    waitForThemeSystem();
    
    
    checkbox.addEventListener('change', function() {
      const scheme = this.checked ? 'dark' : 'light';
      document.documentElement.dataset.scheme = scheme;
      
      
      localStorage.setItem('StackColorScheme', scheme);
      
      
      document.dispatchEvent(new CustomEvent('onColorSchemeChange'));
    });
    
    
    window.addEventListener('onColorSchemeChange', updateCheckboxState);
    
    
    observer = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'data-scheme') {
          updateCheckboxState();
        }
      });
    });
    
    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['data-scheme']
    });
  }
  
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initNewThemeSwitch);
  } else {
    initNewThemeSwitch();
  }
  
  
  setTimeout(initNewThemeSwitch, 1500);
})();
</script>


<script>
(function() {
  'use strict';
  
  
  if (window.hoverEffectsInitialized) {
    console.log('悬浮效果已经初始化，跳过重复执行');
    return;
  }
  
  let isHoverEffectsInitialized = false;
  let hoverObserver = null;
  
  
  function forceCategoryHoverEffects() {
    
    if (isHoverEffectsInitialized) {
      return;
    }
    
    const articles = document.querySelectorAll('.article-list--compact article');
    if (articles.length > 0) {
      articles.forEach(article => {
        
        if (article.hasAttribute('data-hover-initialized')) {
          return;
        }
        
        
        article.style.setProperty('transition', 'all 0.3s ease', 'important');
        article.style.setProperty('will-change', 'transform, box-shadow', 'important');
        
        
        article.addEventListener('mouseenter', function() {
          this.style.setProperty('transform', 'translateY(-5px)', 'important');
          this.style.setProperty('box-shadow', '0 10px 30px rgba(0, 0, 0, 0.12)', 'important');
        });
        
        article.addEventListener('mouseleave', function() {
          this.style.setProperty('transform', 'translateY(0)', 'important');
          this.style.setProperty('box-shadow', 'none', 'important');
        });
        
        
        article.setAttribute('data-hover-initialized', 'true');
      });
      
      isHoverEffectsInitialized = true;
      window.hoverEffectsInitialized = true;
    }
  }
  
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', forceCategoryHoverEffects);
  } else {
    forceCategoryHoverEffects();
  }
  
  
  setTimeout(forceCategoryHoverEffects, 1000);
  
  
  hoverObserver = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
        
        setTimeout(forceCategoryHoverEffects, 100);
      }
    });
  });
  
  
  hoverObserver.observe(document.body, {
    childList: true,
    subtree: true
  });
})();
</script>

    </body>
</html>
