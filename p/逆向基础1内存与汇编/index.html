<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="从这里开始的第一步">
<title>逆向基础1：内存与汇编</title>

<link rel='canonical' href='https://blog.928330.xyz/p/%E9%80%86%E5%90%91%E5%9F%BA%E7%A1%801%E5%86%85%E5%AD%98%E4%B8%8E%E6%B1%87%E7%BC%96/'>

<link rel="stylesheet" href="/scss/style.min.6eb8014a7c47067a823017bd97e0272008650fbf090fa26d21e955bb600446ce.css"><meta property='og:title' content="逆向基础1：内存与汇编">
<meta property='og:description' content="从这里开始的第一步">
<meta property='og:url' content='https://blog.928330.xyz/p/%E9%80%86%E5%90%91%E5%9F%BA%E7%A1%801%E5%86%85%E5%AD%98%E4%B8%8E%E6%B1%87%E7%BC%96/'>
<meta property='og:site_name' content='kakahuote'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='re' /><meta property='article:published_time' content='2025-10-07T14:46:52&#43;08:00'/><meta property='article:modified_time' content='2025-10-13T01:17:05&#43;08:00'/><meta property='og:image' content='http://picture.928330.xyz/typora/b0cd314b8588e4e7b43938004c890c48.png' />
<meta name="twitter:title" content="逆向基础1：内存与汇编">
<meta name="twitter:description" content="从这里开始的第一步"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='http://picture.928330.xyz/typora/b0cd314b8588e4e7b43938004c890c48.png' />
    <link rel="shortcut icon" href="/favicon.ico" />
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>加载动画</title>
    <style>
        .loading {
            position: fixed;
            display: flex;
            flex-direction: column;  
            justify-content: center;
            align-items: center;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 99;
            background-color: #f5f5fa;
            transition: transform 1.5s, opacity 1.5s;
            transform: scale(1);
            opacity: 1;
        }

        .loader-bars {
            display: flex;  
            align-items: flex-end;  
            gap: 3px;  
            margin-bottom: 20px;  
        }

        .bar {
            height: 5px;
            width: 12px;
            animation-duration: 0.45s;
            animation-name: changeHeight;
            animation-iteration-count: infinite;
            animation-direction: alternate;
        }

        .red {
            background-color: #E50000;
            box-shadow: 1px 1px 10px #E50000;
            animation-delay: 0.10s;
        }

        .orange {
            background-color: #FF8D00;
            box-shadow: 1px 1px 10px #FF8D00;
            animation-delay: 0.20s;
        }

        .yellow {
            background-color: #FFEE00;
            box-shadow: 1px 1px 10px #FFEE00;
            animation-delay: 0.25s;
        }

        .green {
            background-color: #008121;
            box-shadow: 1px 1px 10px #008121;
            animation-delay: 0.30s;
        }

        .blue {
            background-color: #004CFF;
            box-shadow: 1px 1px 10px #004CFF;
            animation-delay: 0.35s;
        }

        .violet {
            background-color: #760188;
            box-shadow: 1px 1px 10px #760188;
            animation-delay: 0.40s;
        }

        @keyframes changeHeight {
            from {
                height: 5px;
            }

            to {
                height: 40px;
            }
        }

        .scaleAndFadeout {
            transform: scale(1.5);
            opacity: 0;
        }

         
        .loading-text {
            color: #333;  
            font-size: 16px;  
        }
    </style>
</head>
<body>

    <div class="loading">
        <div class="loader-bars">
            <div class="red bar"></div>
            <div class="orange bar"></div>
            <div class="yellow bar"></div>
            <div class="green bar"></div>
            <div class="blue bar"></div>
            <div class="violet bar"></div>
        </div>
        <div class="loading-text">loading...</div>
    </div>

    <script>
        function initLoading() {
            let loading = document.querySelector(".loading");
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(() => {
                    loading.classList.add("scaleAndFadeout");
                    setTimeout(() => {
                        loading.style.display = "none";
                    }, 1500);
                }, 50);
            });
        }

        initLoading();
    </script>

</body>
</html>
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/" id="avatar-link">
                
                    
                    
                    
                        
                        <img class="site-logo original-logo" src="/img/avatar_hu_4804467f7cda2058.png" width="300" height="300" loading="lazy" alt="原始头像">
                    
                    
                        
                        <img class="site-logo hover-logo" src="/img/avatar-hover_hu_f231304c77e946da.png" width="300" height="300" loading="lazy" alt="悬停头像">
                    
                
                </a>
                
                    <span class="emoji">🤝</span>
                
            </figure>
            
        

        <div class="site-meta">
            <h1 class="site-name"><a href="/">kakahuote</a></h1>
            <h2 class="site-description">靡不有初，鲜克有终</h2>
        </div>
    </header>

    <ol class="menu-social">
                <li>
                    <a
                        href='https://bilibili.com'
                        target="_blank"
                        title="bilibili"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-brand-bilibili"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 10a4 4 0 0 1 4 -4h10a4 4 0 0 1 4 4v6a4 4 0 0 1 -4 4h-10a4 4 0 0 1 -4 -4v-6z" /><path d="M8 3l2 3" /><path d="M16 3l-2 3" /><path d="M9 13v-2" /><path d="M15 11v2" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a
                        href='https://github.com'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            </ol>

    <ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>主页</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>归档</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>搜索</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%8F%8B%E9%93%BE/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>友链</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>暗色模式</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>
    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#体系结构">体系结构</a>
      <ol>
        <li><a href="#x86-与-x64">x86 与 x64</a>
          <ol>
            <li><a href="#x86focusia-32">x86（focus：IA-32）</a></li>
            <li><a href="#x64">x64</a></li>
          </ol>
        </li>
        <li><a href="#字节序">字节序</a>
          <ol>
            <li><a href="#小端序">小端序</a></li>
            <li><a href="#大端序">大端序</a></li>
            <li><a href="#一个例子">一个例子</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#ia-32-内存">IA-32 内存</a>
      <ol>
        <li><a href="#内存模型">内存模型</a>
          <ol>
            <li><a href="#平面内存模型">平面内存模型</a></li>
            <li><a href="#分段内存模型">分段内存模型</a></li>
          </ol>
        </li>
        <li><a href="#分段内存模型的内存管理">分段内存模型的内存管理</a>
          <ol>
            <li><a href="#实模式下的内存管理">实模式下的内存管理</a>
              <ol>
                <li><a href="#管理方式">管理方式</a></li>
                <li><a href="#示例">示例</a></li>
              </ol>
            </li>
            <li><a href="#保护模式下的内存管理">保护模式下的内存管理</a>
              <ol>
                <li><a href="#总体流程">总体流程</a></li>
                <li><a href="#逻辑地址--线性地址">逻辑地址 → 线性地址</a></li>
                <li><a href="#线性地址--物理地址">线性地址 → 物理地址</a></li>
                <li><a href="#示例-1">示例</a></li>
              </ol>
            </li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#ia-32核心寄存器">IA-32核心寄存器</a>
      <ol>
        <li><a href="#通用寄存器-gpr">通用寄存器 (GPR)</a></li>
        <li><a href="#程序状态与控制寄存器-eflags">程序状态与控制寄存器 (EFLAGS)</a></li>
        <li><a href="#指令指针寄存器-eip">指令指针寄存器 (EIP)</a></li>
        <li><a href="#段寄存器">段寄存器</a></li>
      </ol>
    </li>
    <li><a href="#ia-32数据类型">IA-32数据类型</a>
      <ol>
        <li><a href="#基本数据类型">基本数据类型</a></li>
        <li><a href="#浮点数据类型">浮点数据类型</a></li>
        <li><a href="#指针类型">指针类型</a></li>
      </ol>
    </li>
    <li><a href="#ia-32汇编指令">IA-32汇编指令</a>
      <ol>
        <li><a href="#intel与att汇编语法">Intel与AT&amp;T汇编语法</a>
          <ol>
            <li><a href="#intel语法">Intel语法</a></li>
            <li><a href="#att语法">AT&amp;T语法</a></li>
            <li><a href="#示例-2">示例</a></li>
          </ol>
        </li>
        <li><a href="#数据移动指令">数据移动指令</a>
          <ol>
            <li><a href="#mov数据传送">MOV：数据传送</a>
              <ol>
                <li><a href="#立即数---寄存器">立即数 -&gt; 寄存器</a></li>
                <li><a href="#寄存器---寄存器">寄存器 -&gt; 寄存器</a></li>
                <li><a href="#立即数---内存">立即数 -&gt; 内存</a></li>
                <li><a href="#寄存器---内存">寄存器 -&gt; 内存</a></li>
                <li><a href="#内存---寄存器">内存 -&gt; 寄存器</a></li>
              </ol>
            </li>
            <li><a href="#lea加载有效地址">LEA：加载有效地址</a>
              <ol>
                <li><a href="#计算内存地址">计算内存地址</a></li>
                <li><a href="#执行快速数学运算">执行快速数学运算</a></li>
              </ol>
            </li>
            <li><a href="#串操作">串操作</a>
              <ol>
                <li><a href="#rep系列前缀">REP系列前缀</a></li>
                <li><a href="#索引增减控制指令cldstd">索引增减控制指令CLD/STD</a></li>
                <li><a href="#取地址运算符offset">取地址运算符OFFSET</a></li>
                <li><a href="#movsb--movsw--movsd移动字符串">MOVSB / MOVSW / MOVSD：移动字符串</a></li>
                <li><a href="#stosb--stosw--stosd存储字符串">STOSB / STOSW / STOSD：存储字符串</a></li>
                <li><a href="#scasb--scasw--scasd扫描字符串">SCASB / SCASW / SCASD：扫描字符串</a></li>
              </ol>
            </li>
          </ol>
        </li>
        <li><a href="#算术与位运算指令">算术与位运算指令</a>
          <ol>
            <li><a href="#add--sub加法--减法">ADD / SUB：加法 / 减法</a></li>
            <li><a href="#inc--dec加一--减一">INC / DEC：加一 / 减一</a></li>
            <li><a href="#neg取补">NEG：取补</a></li>
            <li><a href="#imul--mul有符号--无符号乘法">IMUL / MUL：有符号 / 无符号乘法</a>
              <ol>
                <li><a href="#单操作数imul和mul都支持">单操作数（IMUL和MUL都支持）</a></li>
                <li><a href="#多操作数只有imul支持">多操作数（只有IMUL支持）</a></li>
              </ol>
            </li>
            <li><a href="#idiv--div有符号--无符号除法">IDIV / DIV：有符号 / 无符号除法</a>
              <ol>
                <li><a href="#无符号的div">无符号的DIV</a></li>
                <li><a href="#有符号的idiv">有符号的IDIV</a></li>
              </ol>
            </li>
            <li><a href="#and--or--xor按位与--或--异或">AND / OR / XOR：按位与 / 或 / 异或</a></li>
            <li><a href="#not按位取反">NOT：按位取反</a></li>
            <li><a href="#shl--sal--shr--sar逻辑--算数-的-左移--右移">SHL / SAL / SHR / SAR：逻辑 / 算数 的 左移 / 右移</a></li>
            <li><a href="#rol--ror循环左移--右移">ROL / ROR：循环左移 / 右移</a></li>
          </ol>
        </li>
        <li><a href="#控制流指令">控制流指令</a>
          <ol>
            <li><a href="#比较指令">比较指令</a>
              <ol>
                <li><a href="#cmp减法比较">CMP：减法比较</a></li>
                <li><a href="#testand比较">TEST：AND比较</a></li>
              </ol>
            </li>
            <li><a href="#jmp无条件跳转">JMP：无条件跳转</a></li>
            <li><a href="#jcc条件跳转">Jcc：条件跳转</a></li>
            <li><a href="#跳转指令前缀">跳转指令前缀</a></li>
            <li><a href="#流程控制结构示例">流程控制结构示例</a>
              <ol>
                <li><a href="#if-else结构">if-else结构</a></li>
                <li><a href="#for循环结构">for循环结构</a></li>
              </ol>
            </li>
          </ol>
        </li>
        <li><a href="#栈与函数调用指令">栈与函数调用指令</a>
          <ol>
            <li><a href="#栈">栈</a></li>
            <li><a href="#栈帧">栈帧</a>
              <ol>
                <li><a href="#什么是栈帧">什么是栈帧</a></li>
                <li><a href="#栈帧基指针ebp">栈帧基指针（EBP）</a></li>
              </ol>
            </li>
            <li><a href="#基本栈操作push--pop">基本栈操作：PUSH / POP</a>
              <ol>
                <li><a href="#push压栈">PUSH：压栈</a></li>
                <li><a href="#pop出栈">POP：出栈</a></li>
              </ol>
            </li>
            <li><a href="#调用与返回的分类">调用与返回的分类</a>
              <ol>
                <li><a href="#近调用-near-call--近返回-near-return">近调用 (Near Call) / 近返回 (Near Return)</a></li>
                <li><a href="#远调用-far-call--远返回-far-return">远调用 (Far Call) / 远返回 (Far Return)</a></li>
              </ol>
            </li>
            <li><a href="#call调用函数">CALL：调用函数</a>
              <ol>
                <li><a href="#近调用">近调用</a></li>
                <li><a href="#远调用">远调用</a></li>
              </ol>
            </li>
            <li><a href="#ret从函数返回">RET：从函数返回</a>
              <ol>
                <li><a href="#近返回retretn">近返回（RET/RETN）</a></li>
                <li><a href="#远返回retf">远返回（RETF）</a></li>
              </ol>
            </li>
            <li><a href="#调用约定">调用约定</a></li>
            <li><a href="#栈帧的创建与销毁函数指令框架">栈帧的创建与销毁（函数指令框架）</a>
              <ol>
                <li><a href="#函数序言-prologue">函数序言 (Prologue)</a></li>
                <li><a href="#函数结尾-epilogue">函数结尾 (Epilogue)</a></li>
                <li><a href="#enter--leave">ENTER / LEAVE</a></li>
              </ol>
            </li>
            <li><a href="#调用流程总结">调用流程总结</a></li>
            <li><a href="#调用流程示例">调用流程示例</a>
              <ol>
                <li><a href="#进入main">进入main</a></li>
                <li><a href="#call-foo">call foo</a></li>
                <li><a href="#进入foo">进入foo</a></li>
                <li><a href="#foo调用bar">foo调用bar</a></li>
                <li><a href="#返回过程">返回过程</a></li>
              </ol>
            </li>
          </ol>
        </li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/%E9%80%86%E5%90%91%E5%9F%BA%E7%A1%801%E5%86%85%E5%AD%98%E4%B8%8E%E6%B1%87%E7%BC%96/">
                
                    <img src="http://picture.928330.xyz/typora/b0cd314b8588e4e7b43938004c890c48.png" loading="lazy" alt="Featured image of post 逆向基础1：内存与汇编" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0/" >
                技术学习
            </a>
        
    </header>
    

    <div class="article-title-wrapper">


        <h2 class="article-title">
            <a href="/p/%E9%80%86%E5%90%91%E5%9F%BA%E7%A1%801%E5%86%85%E5%AD%98%E4%B8%8E%E6%B1%87%E7%BC%96/">逆向基础1：内存与汇编</a>
        </h2>
        
        <h3 class="article-subtitle">
            从这里开始的第一步
        </h3>
        

    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">
                    发布时间：2025-10-07</time>
            </div>
        

        

        <div class="article-lastmod">
               <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



               <time>
                   更新时间：2025-10-13
               </time>
           </div>
        <div>
            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-eye"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" /><path d="M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6" /></svg>
            <time class="article-time--published">
                浏览量：<span class="waline-pageview-count" data-waline-pageview-count="0">0</span>
            </time>
        </div>
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p>早就想学了，正好学校选修了这门课，跟着老师的进度记录一下</p>
<h1 id="体系结构">体系结构
</h1><h2 id="x86-与-x64">x86 与 x64
</h2><h3 id="x86focusia-32">x86（focus：IA-32）
</h3><p>一个基于Intel8086处理器，向后兼容的指令集体系结构（ISA，Instruction Set Architecture）的总称</p>
<p>我们通常所说的x86逆向，主要指的是其32位版本，即<strong>IA-32</strong>（Intel Architecture, 32-bit）</p>
<p><strong>IA-32架构有三种主要操作模式：</strong></p>
<ul>
<li>
<p><strong>实模式</strong></p>
<p>16位运行环境，是早期MS-DOS等操作系统使用的模式</p>
</li>
<li>
<p><strong>保护模式</strong></p>
<p>现代操作系统所采用的模式，支持虚拟内存、分页等高级特性，为程序提供了独立的、受保护的内存空间</p>
</li>
<li>
<p><strong>系统管理模式</strong></p>
<p>用于执行固件中的特殊系统管理代码</p>
</li>
</ul>
<h3 id="x64">x64
</h3><p>也称为x86-64，是x86体系结构的64位扩展，它完全兼容IA-32，意味着32位程序可以在64位系统上运行</p>
<h2 id="字节序">字节序
</h2><p>字节序定义了多字节数据（如一个4字节的整数）在内存中是如何排列的</p>
<h3 id="小端序">小端序
</h3><p>数据的低位字节存储在内存的低地址处</p>
<p>这是Intel x86/x64架构使用的模式，因其电路设计和数据处理效率较高</p>
<h3 id="大端序">大端序
</h3><p>数据的高位字节存储在内存的低地址处</p>
<p>这种方式更符合人类的阅读习惯，常见于一些RISC架构的处理器</p>
<h3 id="一个例子">一个例子
</h3><p><strong>现在需要存储一个4字节的整数<code>0x12345678</code></strong></p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>内存地址</th>
          <th>大端序存储</th>
          <th>小端序存储</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>低地址</strong></td>
          <td><code>12</code></td>
          <td><code>78</code></td>
      </tr>
      <tr>
          <td><strong>↓</strong></td>
          <td><code>34</code></td>
          <td><code>56</code></td>
      </tr>
      <tr>
          <td><strong>↓</strong></td>
          <td><code>56</code></td>
          <td><code>34</code></td>
      </tr>
      <tr>
          <td><strong>高地址</strong></td>
          <td><code>78</code></td>
          <td><code>12</code></td>
      </tr>
  </tbody>
</table></div>
<p><strong>在逆向分析中，内存二进制地址方向是从上至下，从左至右增大</strong></p>
<p><strong>因此，当我们在内存窗口看到<code>78 56 34 12</code>时，须将其理解为<code>0x12345678</code></strong></p>
<h1 id="ia-32-内存">IA-32 内存
</h1><h2 id="内存模型">内存模型
</h2><h3 id="平面内存模型">平面内存模型
</h3><p>现代操作系统普遍采用的模型</p>
<p>程序的所有部分（代码、数据、栈）都位于一个连续统一的线性地址空间中</p>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" data-caption="image-20251005111551905" href="http://picture.928330.xyz/typora/image-20251005111551905.png">
<img src="http://picture.928330.xyz/typora/image-20251005111551905.png" alt="image-20251005111551905"  />
</a>
</div>
</p>
<h3 id="分段内存模型">分段内存模型
</h3><p>程序被划分为多个独立的段，比如有代码段、数据段、栈段等</p>
<p>一个逻辑地址由<strong>段选择器</strong>和<strong>段内偏移</strong>两部分组成：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#e06c75">逻辑地址</span> = <span style="color:#e06c75">段寄存器中的段选择器</span>/<span style="color:#e06c75">段选择子</span> + <span style="color:#e06c75">段内偏移量</span>
</span></span></code></pre></div><p>段选择子是一个16位的值，它存放在段寄存器里，二进制结构如下：</p>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" data-caption="保护模式篇——段描述符与段选择子- 寂静的羽夏- 博客园" href="http://picture.928330.xyz/typora/o_2109200226344-2.png">
<img src="http://picture.928330.xyz/typora/o_2109200226344-2.png" alt="保护模式篇——段描述符与段选择子- 寂静的羽夏- 博客园"  />
</a>
</div>
</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>位段</th>
          <th>名称</th>
          <th>含义</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Index</strong></td>
          <td>描述符索引</td>
          <td>表示该段描述符在描述符表中的序号</td>
      </tr>
      <tr>
          <td><strong>TI</strong></td>
          <td>表标志</td>
          <td>指示去哪个描述符表查段描述符（0是GDT，1是LDT）</td>
      </tr>
      <tr>
          <td><strong>RPL</strong></td>
          <td>请求特权级</td>
          <td>用于访问权限控制（0最高，3最低）</td>
      </tr>
  </tbody>
</table></div>
<p><strong>而汇编代码里一般只写偏移量，段选择器是隐含的，CPU自动知道用哪个段寄存器</strong></p>
<p><strong>比如<code>mov EAX, [0x0010]</code>，就相当于是<code>mov EAX, DS:[0x0010]</code></strong></p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>汇编语句类型</th>
          <th>默认段寄存器</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>mov eax, [offset]</code></td>
          <td><code>DS</code></td>
      </tr>
      <tr>
          <td><code>mov [offset], eax</code></td>
          <td><code>DS</code></td>
      </tr>
      <tr>
          <td>栈操作（<code>push</code> / <code>pop</code>）</td>
          <td><code>SS</code></td>
      </tr>
      <tr>
          <td>代码取指令</td>
          <td><code>CS</code></td>
      </tr>
  </tbody>
</table></div>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" data-caption="image-20251005111539852" href="http://picture.928330.xyz/typora/image-20251005111539852.png">
<img src="http://picture.928330.xyz/typora/image-20251005111539852.png" alt="image-20251005111539852"  />
</a>
</div>
</p>
<h2 id="分段内存模型的内存管理">分段内存模型的内存管理
</h2><p>对于分段内存模型，不同操作模式（实模式/保护模式）下，内存管理方式和寻址模式存在差异</p>
<h3 id="实模式下的内存管理">实模式下的内存管理
</h3><h4 id="管理方式">管理方式
</h4><p>实模式的内存管理方式非常简单，可以看作是一种特殊的分段模型</p>
<ul>
<li>
<p><strong>有20位地址总线，CPU能够访问的物理内存上限为1MB的地址空间</strong></p>
</li>
<li>
<p><strong>内存被划分为一系列64KB大小的段</strong></p>
</li>
</ul>
<p>程序使用的地址由两部分组成：</p>
<p>一个16位的<strong>段选择器</strong>和一个16位的<strong>偏移地址</strong></p>
<p>通过将段选择器的值左移4位，相当于乘以16（因为地址线是20位），加上16位的偏移地址得到物理地址</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#e06c75">物理地址</span> (<span style="color:#d19a66">20</span>-<span style="color:#e06c75">bit</span>) = <span style="color:#e06c75">段选择器</span> (<span style="color:#d19a66">16</span>-<span style="color:#e06c75">bit</span>)*<span style="color:#d19a66">16</span> + <span style="color:#e06c75">偏移量</span> (<span style="color:#d19a66">16</span>-<span style="color:#e06c75">bit</span>）
</span></span></code></pre></div><p>
<div class="post-img-view">
<a data-fancybox="gallery" data-caption="image-20251005111518978" href="http://picture.928330.xyz/typora/image-20251005111518978.png">
<img src="http://picture.928330.xyz/typora/image-20251005111518978.png" alt="image-20251005111518978"  />
</a>
</div>
</p>
<h4 id="示例">示例
</h4><p>假设段寄存器<code>DS</code>的值为<code>0x1000</code>，指令要访问的偏移地址是<code>0x0123</code></p>
<ol>
<li>CPU取出段选择器的值：<code>0x1000</code></li>
<li>将其左移4位：<code>0x10000</code></li>
<li>加上偏移地址：<code>0x10000 + 0x0123</code></li>
<li>最终得到的物理地址是<code>0x10123</code></li>
</ol>
<p>实模式没有内存保护机制，任何程序都可以访问全部1MB的内存空间，一个程序的错误可能会导致整个系统崩溃，也不支持虚拟内存等现代操作系统的核心功能</p>
<h3 id="保护模式下的内存管理">保护模式下的内存管理
</h3><h4 id="总体流程">总体流程
</h4><p>在保护模式下，我们代码中使用的地址（逻辑地址）需要经过CPU的转换才能访问到真正的物理内存</p>
<p>这个过程对程序是透明的</p>
<p><strong>保护模式的地址管理必须使用分段，另外也可以选择使用分页</strong></p>
<p>下图是完整的地址访问流程：</p>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" data-caption="image-20251005111658646" href="http://picture.928330.xyz/typora/image-20251005111658646.png">
<img src="http://picture.928330.xyz/typora/image-20251005111658646.png" alt="image-20251005111658646"  />
</a>
</div>
</p>
<h4 id="逻辑地址--线性地址">逻辑地址 → 线性地址
</h4><p><strong>逻辑地址的段选择器告诉CPU该去哪一个描述符表（GDT/LDT）查询得到段描述符</strong></p>
<p><strong>段描述符</strong>里存有<strong>段基址</strong>、段界限、访问权限等内容</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#e06c75">线性地址</span> = <span style="color:#e06c75">段基址</span> + <span style="color:#e06c75">偏移量</span>
</span></span></code></pre></div><h4 id="线性地址--物理地址">线性地址 → 物理地址
</h4><p><strong>如果没有开启分页机制</strong>**，那么：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#e06c75">物理地址</span> = <span style="color:#e06c75">线性地址</span>
</span></span></code></pre></div><p>但是现代操作系统一般都启用了分页，CPU的<strong>内存管理单元 (MMU)</strong> 会进行下一步转换</p>
<p>MMU将32位的线性地址拆分为三部分：<strong>页目录索引</strong> (10位) + <strong>页表索引</strong> (10位) + <strong>页内偏移</strong> (12位)</p>
<ul>
<li><strong>页目录表</strong>：有1024个表项，每项4B，共4KB，每项指向一个页表</li>
<li><strong>页表</strong>：也有1024个表项，每项4B，共4KB，每项指向一个物理页框</li>
<li><strong>页框</strong>：大小固定为4KB</li>
</ul>
<p>先查页目录，再查页表，最终找到数据所在的物理内存页，加上页内偏移，就得到了最终的物理地址</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#e06c75">物理地址</span> = <span style="color:#e06c75">物理页框基址</span> + <span style="color:#e06c75">页内偏移</span>
</span></span></code></pre></div><p>
<div class="post-img-view">
<a data-fancybox="gallery" data-caption="逻辑地址、线性地址和物理地址| vosamo" href="http://picture.928330.xyz/typora/fenye.jpg">
<img src="http://picture.928330.xyz/typora/fenye.jpg" alt="逻辑地址、线性地址和物理地址| vosamo"  />
</a>
</div>
</p>
<h4 id="示例-1">示例
</h4><p>我们现在运行在一个 32位保护模式的系统中，分页功能已经开启，程序中有这样一条指令：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#e06c75">mov</span> <span style="color:#e06c75">eax</span>, [<span style="color:#d19a66">0x1234</span>]
</span></span></code></pre></div><p>这条指令的意思是把内存中地址<code>DS:0x1234</code>处的数据读到EAX寄存器中，也就是说，这里访问的逻辑地址是：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#e06c75">逻辑地址</span> = <span style="color:#e06c75">DS</span> : <span style="color:#d19a66">0x1234</span>
</span></span></code></pre></div><p>假设段寄存器DS的内容是<code>0x0008</code>，二进制表示：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#d19a66">0000</span> <span style="color:#d19a66">0000</span> <span style="color:#d19a66">0000</span> <span style="color:#d19a66">1000</span><span style="color:#e06c75">b</span>
</span></span></code></pre></div><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>字段</th>
          <th>位</th>
          <th>值</th>
          <th>含义</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Index</td>
          <td>15:3</td>
          <td>1</td>
          <td>第1个描述符</td>
      </tr>
      <tr>
          <td>TI</td>
          <td>2</td>
          <td>0</td>
          <td>从GDT中查</td>
      </tr>
      <tr>
          <td>RPL</td>
          <td>1–0</td>
          <td>0</td>
          <td>当前访问特权级 0</td>
      </tr>
  </tbody>
</table></div>
<p>假设GDT[1]这个描述符里存的段信息是：</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>字段</th>
          <th>值</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>段基址</td>
          <td>0x00400000</td>
      </tr>
      <tr>
          <td>段界限</td>
          <td>0x000FFFFF</td>
      </tr>
      <tr>
          <td>访问属性</td>
          <td>可读可写数据段</td>
      </tr>
  </tbody>
</table></div>
<p>于是：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#e06c75">段基址</span> = <span style="color:#d19a66">0x00400000</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">线性地址</span> = <span style="color:#e06c75">段基址</span> + <span style="color:#e06c75">偏移量</span> = <span style="color:#d19a66">0x00400000</span> + <span style="color:#d19a66">0x00001234</span> = <span style="color:#d19a66">0x00401234</span>
</span></span></code></pre></div><p>现在系统开启了分页，假设页目录基址寄存器CR3的值是<code>0x00100000</code>，即页目录表在物理内存<code>0x00100000</code>处</p>
<p>把线性地址<code>0x00401234</code>拆成三段，二进制表示：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#d19a66">0000</span> <span style="color:#d19a66">0000</span> <span style="color:#d19a66">0100</span> <span style="color:#d19a66">0000</span> <span style="color:#d19a66">0001</span> <span style="color:#d19a66">0010</span> <span style="color:#d19a66">0011</span> <span style="color:#d19a66">0100</span>
</span></span></code></pre></div><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>部分</th>
          <th>位数</th>
          <th>值（二进制）</th>
          <th>十进制</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>页目录索引</td>
          <td>10 位</td>
          <td>0000000001</td>
          <td>1</td>
      </tr>
      <tr>
          <td>页表索引</td>
          <td>10 位</td>
          <td>0000000010</td>
          <td>2</td>
      </tr>
      <tr>
          <td>页内偏移</td>
          <td>12 位</td>
          <td>001101000100</td>
          <td>0x234</td>
      </tr>
  </tbody>
</table></div>
<p>页目录表起始于<code>0x00100000</code>，每个表项占4字节，页目录索引是<code>1</code>，所以要读的表项地址：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#d19a66">0x00100000</span> + <span style="color:#d19a66">1</span> * <span style="color:#d19a66">4</span> = <span style="color:#d19a66">0x00100004</span>
</span></span></code></pre></div><p>假设这个页目录项内容是<code>0x00200003</code></p>
<ul>
<li>高20位：页表的物理基址，是<code>0x00200000</code></li>
<li>低12位：标志位（Present=1, RW=1, US=0）</li>
</ul>
<p>页表基址<code>0x00200000</code>，页表索引是<code>2</code>，所以要读的表项地址：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#d19a66">0x00200000</span> + <span style="color:#d19a66">2</span> * <span style="color:#d19a66">4</span> = <span style="color:#d19a66">0x00200008</span>
</span></span></code></pre></div><p>假设这个页表项内容是<code>0x00A00003</code></p>
<ul>
<li>高20位：物理页框基址，是<code>0x00A00000</code></li>
</ul>
<p>最终得到物理地址：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#e06c75">物理地址</span> = <span style="color:#e06c75">页框基址</span> + <span style="color:#e06c75">页内偏移</span> = <span style="color:#d19a66">0x00A00000</span> + <span style="color:#d19a66">0x00000234</span> = <span style="color:#d19a66">0x00A00234</span>
</span></span></code></pre></div><h1 id="ia-32核心寄存器">IA-32核心寄存器
</h1><h2 id="通用寄存器-gpr">通用寄存器 (GPR)
</h2><p>IA-32架构有8个32位通用寄存器</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>32位</th>
          <th>16位</th>
          <th>8位高/低</th>
          <th>主要功能</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>EAX</strong></td>
          <td>AX</td>
          <td>AH / AL</td>
          <td><strong>累加器（Accumulator）</strong><br />用于算术运算和函数返回值</td>
      </tr>
      <tr>
          <td><strong>EBX</strong></td>
          <td>BX</td>
          <td>BH / BL</td>
          <td><strong>基址寄存器（Base）</strong><br />用于在内存中寻址</td>
      </tr>
      <tr>
          <td><strong>ECX</strong></td>
          <td>CX</td>
          <td>CH / CL</td>
          <td><strong>计数器（Counter）</strong><br />用于循环和字符串操作的计数，是<strong>无符号计数器</strong></td>
      </tr>
      <tr>
          <td><strong>EDX</strong></td>
          <td>DX</td>
          <td>DH / DL</td>
          <td><strong>数据寄存器（Data）</strong><br />配合EAX进行乘除法运算或存放I/O指针</td>
      </tr>
      <tr>
          <td><strong>ESI</strong></td>
          <td>SI</td>
          <td>-</td>
          <td><strong>源变址寄存器（Source Index）</strong><br />字符串和内存操作的源地址</td>
      </tr>
      <tr>
          <td><strong>EDI</strong></td>
          <td>DI</td>
          <td>-</td>
          <td><strong>目的变址寄存器（Destination Index）</strong><br />字符串和内存操作的目的地址</td>
      </tr>
      <tr>
          <td><strong>ESP</strong></td>
          <td>SP</td>
          <td>-</td>
          <td><strong>栈指针（Stack Pointer)</strong><br />永远指向当前栈的栈顶</td>
      </tr>
      <tr>
          <td><strong>EBP</strong></td>
          <td>BP</td>
          <td>-</td>
          <td><strong>基址指针（Base Pointer）</strong><br />用作当前函数栈帧的基址，用于访问局部变量和参数</td>
      </tr>
  </tbody>
</table></div>
<h2 id="程序状态与控制寄存器-eflags">程序状态与控制寄存器 (EFLAGS)
</h2><p>EFLAGS寄存器是一个32位的寄存器</p>
<p>它的每一位（标志位）都记录了程序运行中的特定状态，主要用于条件判断和流程控制</p>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" data-caption="Basic Execution Environment of Intel Processor 32-bit Architecture | Tachyon" href="http://picture.928330.xyz/typora/eflags.png">
<img src="http://picture.928330.xyz/typora/eflags.png" alt="Basic Execution Environment of Intel Processor 32-bit Architecture | Tachyon"  />
</a>
</div>
</p>
<p>下面是一些常用的标志位：</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>标志位</th>
          <th>名称</th>
          <th>描述和功能</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>ZF</strong></td>
          <td><strong>零标志</strong><br />(Zero Flag)</td>
          <td>若算术运算结果为0，则ZF置为1，否则为0，常用于判断相等</td>
      </tr>
      <tr>
          <td><strong>OF</strong></td>
          <td><strong>溢出标志</strong><br />(Overflow Flag)</td>
          <td>当有符号整数运算的结果超出寄存器能表示的范围时，OF置为1</td>
      </tr>
      <tr>
          <td><strong>CF</strong></td>
          <td><strong>进位标志</strong><br />(Carry Flag)</td>
          <td>当无符号整数运算的结果溢出（产生进位或借位）时，CF置为1</td>
      </tr>
      <tr>
          <td><strong>SF</strong></td>
          <td><strong>符号标志</strong><br />(Sign Flag)</td>
          <td>等于运算结果的最高位（也就是符号位）<br />对于有符号数，0表示正数，1表示负数</td>
      </tr>
      <tr>
          <td><strong>DF</strong></td>
          <td><strong>方向标志</strong><br />(Direction Flag)</td>
          <td>控制字符串操作指令（如MOVS, SCAS）的处理方向<br />若DF=0，变址寄存器（ESI, EDI）地址递增<br />若DF=1，则地址递减</td>
      </tr>
      <tr>
          <td><strong>TF</strong></td>
          <td><strong>陷阱标志</strong><br />(Trap Flag)</td>
          <td>若置为1，CPU在执行每条指令后会产生一个单步中断</td>
      </tr>
      <tr>
          <td><strong>IF</strong></td>
          <td><strong>中断允许标志</strong><br />(Interrupt Enable Flag)</td>
          <td>若置为1，CPU可以响应外部设备的中断请求</td>
      </tr>
  </tbody>
</table></div>
<h2 id="指令指针寄存器-eip">指令指针寄存器 (EIP)
</h2><p><strong>EIP（Extended Instruction Pointer）是一个32位的寄存器，存放着下一条将要被CPU执行的指令的地址</strong></p>
<p>CPU总是根据CS段寄存器和EIP寄存器中的地址来读取下一条指令，<strong>每当一条指令被读取后，EIP的值会自动增加，增加的大小等于刚刚被读取指令的字节数</strong>，从而指向紧随其后的下一条指令</p>
<p>EIP寄存器的值不能被直接修改，<strong>它的改变只能通过特定的控制流指令（如 <code>JMP</code>, <code>CALL</code>, <code>RET</code>）或者由中断、异常来完成</strong></p>
<h2 id="段寄存器">段寄存器
</h2><p>段寄存器是6个16位的寄存器，在保护模式的内存分段管理中，它们存放着指向各个内存段的“段选择器”，CPU通过这些段选择器在系统描述符表（GDT/LDT）中找到段的实际基地址。</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>寄存器</th>
          <th>名称</th>
          <th>主要功能</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>CS</strong></td>
          <td><strong>代码段寄存器</strong><br />(Code Segment)</td>
          <td>存放应用程序代码所在段的段选择器</td>
      </tr>
      <tr>
          <td><strong>SS</strong></td>
          <td><strong>栈段寄存器</strong><br />(Stack Segment)</td>
          <td>存放当前程序栈所在段的段选择器</td>
      </tr>
      <tr>
          <td><strong>DS</strong></td>
          <td><strong>数据段寄存器</strong><br />(Data Segment)</td>
          <td>存放程序主要数据所在段的段选择器</td>
      </tr>
      <tr>
          <td><strong>ES/FS/GS</strong></td>
          <td><strong>附加数据段寄存器</strong><br />(Extra Segment)</td>
          <td>存放程序使用的附加数据段的段选择器<br />可用于特殊目的，比如通过FS定位线程环境块（TEB）等</td>
      </tr>
  </tbody>
</table></div>
<h1 id="ia-32数据类型">IA-32数据类型
</h1><h2 id="基本数据类型">基本数据类型
</h2><p>这些是构成更复杂数据结构的基础整数类型</p>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" data-caption="image-20251005155825457" href="http://picture.928330.xyz/typora/image-20251005155825457.png">
<img src="http://picture.928330.xyz/typora/image-20251005155825457.png" alt="image-20251005155825457"  />
</a>
</div>
</p>
<ul>
<li>
<p><strong>Byte</strong></p>
<p>1字节（8位）的数据</p>
</li>
<li>
<p><strong>Word</strong></p>
<p>2字节（16位）的数据</p>
</li>
<li>
<p><strong>Doubleword</strong></p>
<p>4字节（32位）的数据</p>
<p>这是IA-32架构中最常用的数据大小，与通用寄存器（如EAX）的大小一致</p>
</li>
<li>
<p><strong>Quadword</strong></p>
<p>8字节（64位）的数据</p>
<p>虽然IA-32没有64位的通用寄存器，但在某些特定指令（如<code>RDTSC</code>）或通过组合EDX和EAX寄存器，可以处理64位数据</p>
</li>
<li>
<p><strong>Double Quadword</strong></p>
<p>16字节（128位）的数据</p>
</li>
</ul>
<h2 id="浮点数据类型">浮点数据类型
</h2><p>
<div class="post-img-view">
<a data-fancybox="gallery" data-caption="image-20251005160136310" href="http://picture.928330.xyz/typora/image-20251005160136310.png">
<img src="http://picture.928330.xyz/typora/image-20251005160136310.png" alt="image-20251005160136310"  />
</a>
</div>
</p>
<ul>
<li><strong>半精度（Half Precision）</strong>：16位浮点数</li>
<li><strong>单精度（Single Precision）</strong>：32位浮点数</li>
<li><strong>双精度（Double Precision）</strong>：64位浮点数</li>
<li><strong>扩展双精度（Double Extended Precision）</strong>：80位浮点数</li>
</ul>
<h2 id="指针类型">指针类型
</h2><p>指针在IA-32中用于存储内存地址，主要分为两种</p>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" data-caption="image-20251005160342658" href="http://picture.928330.xyz/typora/image-20251005160342658.png">
<img src="http://picture.928330.xyz/typora/image-20251005160342658.png" alt="image-20251005160342658"  />
</a>
</div>
</p>
<ul>
<li>
<p><strong>Near Pointer（近指针）</strong></p>
<p>这是一个32位的偏移量</p>
<p>它指向当前段内的某个地址，在现代操作系统的平面内存模型下，这实际上就是程序的虚拟地址</p>
</li>
<li>
<p><strong>Far Pointer（远指针）</strong></p>
<p>这是一个48位的指针，由一个16位的段选择器和一个32位的偏移量组成</p>
<p>它用于在分段内存模型下，跨段访问数据</p>
</li>
</ul>
<h1 id="ia-32汇编指令">IA-32汇编指令
</h1><h2 id="intel与att汇编语法">Intel与AT&amp;T汇编语法
</h2><h3 id="intel语法">Intel语法
</h3><p><strong>这是Windows环境下的主流语法，易于阅读</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#e06c75">[指令]</span> [<span style="color:#e06c75">目标操作数</span>], [<span style="color:#e06c75">源操作数</span>]
</span></span></code></pre></div><p><strong>逗号后面空格不是语法必须的</strong>，但是加空格是一个非常推荐的习惯，大多数逆向软件也遵从这个习惯</p>
<p><span style="color:red;font-size:20px"><strong>本文档后续将统一使用Intel语法</strong></span></p>
<h3 id="att语法">AT&amp;T语法
</h3><p><strong>常用于Linux和GNU工具链</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#e06c75">[指令]</span> [<span style="color:#e06c75">源操作数</span>], [<span style="color:#e06c75">目标操作数</span>]
</span></span></code></pre></div><h3 id="示例-2">示例
</h3><p>将立即数4移动到EAX寄存器</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>语法</th>
          <th>指令</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Intel</td>
          <td><code>mov eax, 4</code></td>
      </tr>
      <tr>
          <td>AT&amp;T</td>
          <td><code>mov $4, %eax</code></td>
      </tr>
  </tbody>
</table></div>
<h2 id="数据移动指令">数据移动指令
</h2><p>这类指令用于在寄存器、内存和立即数之间传递数据</p>
<h3 id="mov数据传送">MOV：数据传送
</h3><p><strong><code>MOV</code>(move)是数据传送指令，将右边操作数的值复制到左边操作数中</strong></p>
<p>但是这两个操作数中最多只能有<strong>一个是内存操作数（带方括号的那种）</strong>，另一个必须是寄存器或立即数</p>
<h4 id="立即数---寄存器">立即数 -&gt; 寄存器
</h4><p>将常量<code>0x12345678</code>放入<code>ESI</code></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">ESI</span>, <span style="color:#d19a66">0x12345678</span>
</span></span></code></pre></div><h4 id="寄存器---寄存器">寄存器 -&gt; 寄存器
</h4><p>将<code>ECX</code>的内容复制到<code>EAX</code></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">EAX</span>, <span style="color:#e06c75">ECX</span>
</span></span></code></pre></div><h4 id="立即数---内存">立即数 -&gt; 内存
</h4><p>将地址为<code>EAX</code>的4字节内存设为1</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">DWORD</span> <span style="color:#e06c75">PTR</span> [<span style="color:#e06c75">EAX</span>], <span style="color:#d19a66">1</span>
</span></span></code></pre></div><p><strong><code>[EAX]</code>表示取<code>EAX</code>寄存器中的值作为内存地址</strong></p>
<p><strong><code>DWORD PTR</code>表示操作的内存数据大小是4字节（32 位）</strong></p>
<p>当汇编器不清楚要操作内存的大小时，就需要使用修饰符来确定，以下是常用的修饰符：</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>修饰符</th>
          <th>大小</th>
          <th>说明</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>BYTE PTR</strong></td>
          <td>1 字节（8 位）</td>
          <td>访问 8 位数据</td>
      </tr>
      <tr>
          <td><strong>WORD PTR</strong></td>
          <td>2 字节（16 位）</td>
          <td>访问 16 位数据</td>
      </tr>
      <tr>
          <td><strong>DWORD PTR</strong></td>
          <td>4 字节（32 位）</td>
          <td>访问 32 位数据</td>
      </tr>
      <tr>
          <td><strong>QWORD PTR</strong></td>
          <td>8 字节（64 位）</td>
          <td>访问 64 位数据</td>
      </tr>
      <tr>
          <td><strong>NEAR PTR</strong></td>
          <td>2/4 字节偏移</td>
          <td>近指针，只包含偏移，段寄存器不变，常用于近调用</td>
      </tr>
      <tr>
          <td><strong>FAR PTR</strong></td>
          <td>段 + 偏移</td>
          <td>远指针，包含段选择符和偏移，常用于跨段调用</td>
      </tr>
  </tbody>
</table></div>
<h4 id="寄存器---内存">寄存器 -&gt; 内存
</h4><p>将<code>EBX</code>的值写入地址为<code>EAX</code>的内存中</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> [<span style="color:#e06c75">EAX</span>], <span style="color:#e06c75">EBX</span>
</span></span></code></pre></div><p>将<code>EAX</code>的值写入地址为<code>ESI+0x34</code>的内存中</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> [<span style="color:#e06c75">ESI</span><span style="color:#56b6c2">+</span><span style="color:#d19a66">34</span><span style="color:#e06c75">H</span>], <span style="color:#e06c75">EAX</span> 
</span></span></code></pre></div><p><strong>注意这里的<code>[]</code>不能拆开写！</strong></p>
<h4 id="内存---寄存器">内存 -&gt; 寄存器
</h4><p>将地址为<code>ECX</code>的内存中的值读入<code>EAX</code></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">EAX</span>, [<span style="color:#e06c75">ECX</span>]
</span></span></code></pre></div><p>将地址为<code>ECX+EAX</code>的内存中的值读入<code>EDX</code></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">EDX</span>, [<span style="color:#e06c75">ECX</span><span style="color:#56b6c2">+</span><span style="color:#e06c75">EAX</span>]  
</span></span></code></pre></div><p>将内存中地址<code>0x50</code>处的数据读入寄存器<code>EAX</code></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">EAX</span>, [<span style="color:#d19a66">0x50</span>]
</span></span></code></pre></div><h3 id="lea加载有效地址">LEA：加载有效地址
</h3><p><strong><code>LEA</code> (Load Effective Address) 用于计算源操作数指定的内存地址，并将地址加载到目标寄存器中</strong></p>
<p>它与<code>MOV</code>的关键区别在于，<code>MOV</code>会访问该地址并取出其中的数据，<strong>而<code>LEA</code>只计算地址，不访问内存</strong></p>
<p><strong>也正因如此，使用<code>LEA</code>计算时，寄存器必须加上<code>[]</code>表示取地址</strong></p>
<h4 id="计算内存地址">计算内存地址
</h4><p>假设<code>EAX = 0x1000</code>, 内存地址<code>0x1000</code>处的值为<code>0xABCD</code></p>
<p><strong>使用MOV：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">EBX</span>, [<span style="color:#e06c75">EAX</span>]
</span></span></code></pre></div><p><code>MOV</code>将地址<code>EAX</code>（<code>0x1000</code>）指向的数据<code>0xABCD</code>放入<code>EBX</code>，结果是<code>EBX = 0xABCD</code></p>
<p><strong>使用LEA：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">LEA</span> <span style="color:#e06c75">EBX</span>, [<span style="color:#e06c75">EAX</span>]  
</span></span></code></pre></div><p><code>LEA</code>将地址表达式<code>[EAX]</code>本身的值<code>0x1000</code>放入<code>EBX</code>，结果是<code>EBX = 0x1000</code></p>
<h4 id="执行快速数学运算">执行快速数学运算
</h4><p><code>LEA</code>可以执行一些基础的数学运算，且比使用<code>ADD</code>或<code>MUL</code>等指令更高效，因为它不影响CPU的标志位</p>
<p><strong>计算<code>EAX = EBX + ECX * 4 + 100H</code></strong>：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">LEA</span> <span style="color:#e06c75">EAX</span>, [<span style="color:#e06c75">EBX</span> <span style="color:#56b6c2">+</span> <span style="color:#e06c75">ECX</span><span style="color:#56b6c2">*</span><span style="color:#d19a66">4</span> <span style="color:#56b6c2">+</span> <span style="color:#d19a66">100</span><span style="color:#e06c75">H</span>]
</span></span></code></pre></div><p><strong>注意这里的<code>[]</code>不能拆开写！</strong></p>
<h3 id="串操作">串操作
</h3><p>这类指令专门用于高效处理内存中的连续数据块（字符串）</p>
<p>它们通常与 <code>REP</code> 系列前缀结合使用，以重复执行相同的操作，重复次数由 <code>ECX</code> 寄存器控制</p>
<h4 id="rep系列前缀">REP系列前缀
</h4><p><mark><strong>REP</strong></mark></p>
<p><strong>全称REPeat，在执行指令前会检查<code>ECX</code>，指令会重复执行<code>ECX</code>次</strong></p>
<p>eg：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">ECX</span>, <span style="color:#d19a66">5</span>        ; 重复次数
</span></span><span style="display:flex;"><span><span style="color:#e06c75">REP</span> <span style="color:#e06c75">MOVSB</span>         ; 将[<span style="color:#e06c75">ESI</span>]的字节移动到[<span style="color:#e06c75">EDI</span>]，重复<span style="color:#d19a66">5</span>次
</span></span></code></pre></div><p><mark><strong>REPE / REPZ</strong></mark></p>
<p><strong>全称REPeat While Equal / REPeat While Zero，当<code>ZF=1</code>且<code>ECX</code>不为0时继续重复</strong></p>
<p>eg：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">ECX</span>, <span style="color:#d19a66">10</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">REP</span> <span style="color:#e06c75">CMPSB</span>        ; 比较两个字符串，<span style="color:#e06c75">ZF</span><span style="color:#56b6c2">=</span><span style="color:#d19a66">1</span>时继续，最多<span style="color:#d19a66">10</span>次
</span></span></code></pre></div><p><mark><strong>REPNE / REPNZ</strong></mark></p>
<p><strong>全称REPeat while Not Equal / REPeat while Not Zero，当<code>ZF=0</code>且<code>ECX</code>不为0时继续重复</strong></p>
<p>eg：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">ECX</span>, <span style="color:#d19a66">10</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">REPNE</span> <span style="color:#e06c75">SCASB</span>       ; 扫描字符串，<span style="color:#e06c75">ZF</span><span style="color:#56b6c2">=</span><span style="color:#d19a66">0</span>时继续，最多<span style="color:#d19a66">10</span>次
</span></span></code></pre></div><h4 id="索引增减控制指令cldstd">索引增减控制指令CLD/STD
</h4><p><code>EFLAGS</code>寄存器中的<code>DF</code>标志位决定了每次操作后<code>ESI</code>和<code>EDI</code>的变化方向，而<code>CLD</code>和<code>SLD</code>指令控制着<code>DF</code></p>
<p><mark><strong>CLD指令</strong></mark></p>
<p>全称Clear Direction Flag，<strong><code>DF = 0</code>，<code>ESI</code>和<code>EDI</code>在每次操作后递增</strong></p>
<p><mark><strong>STD指令</strong></mark></p>
<p>全称Set Direction Flag，<strong><code>DF = 1</code>，<code>ESI</code>和<code>EDI</code>在每次操作后递减</strong></p>
<h4 id="取地址运算符offset">取地址运算符OFFSET
</h4><p><strong><code>OFFSET</code>是汇编语言中的一个编译时运算符，作用是取得一个标号（变量、数组等）的内存地址（偏移量）</strong></p>
<p>比如我在数据段（.data）定义一个变量：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>.<span style="color:#e06c75">data</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">SourceAddress</span> <span style="color:#e06c75">DB</span> <span style="color:#98c379">&#39;A&#39;</span>, <span style="color:#98c379">&#39;B&#39;</span>, <span style="color:#98c379">&#39;C&#39;</span>, <span style="color:#d19a66">0</span>
</span></span></code></pre></div><p><strong>假设编译器把这段数据放在内存地址<code>0x00405000</code></strong></p>
<p><strong>那么<code>OFFSET SourceAddress</code>在汇编时就会被计算为<code>0x00405000</code></strong></p>
<div class="alert alert-tip">
    <div class="alert-header">
        <span class="alert-icon">
            💡
        </span>
        <span class="alert-title">
            Tip
        </span>
    </div>
    <div class="alert-content">
        <p>这里的DB被称作<strong>伪指令</strong></p>
<p><strong>它不是CPU执行的指令，是给汇编器用的命令，告诉汇编器在程序中生成数据、定义常量或分配空间</strong></p>
<p>类似伪指令还有：</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>指令</th>
          <th>全称</th>
          <th>定义单位</th>
          <th>示例</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>DB</code></td>
          <td>Define Byte</td>
          <td>1 字节</td>
          <td><code>DB 1, 2, 3</code></td>
      </tr>
      <tr>
          <td><code>DW</code></td>
          <td>Define Word</td>
          <td>2 字节</td>
          <td><code>DW 1234h</code></td>
      </tr>
      <tr>
          <td><code>DD</code></td>
          <td>Define Doubleword</td>
          <td>4 字节</td>
          <td><code>DD 0x12345678</code></td>
      </tr>
      <tr>
          <td><code>DQ</code></td>
          <td>Define Quadword</td>
          <td>8 字节</td>
          <td><code>DQ 0x1122334455667788</code></td>
      </tr>
  </tbody>
</table></div></div>
</div>
<h4 id="movsb--movsw--movsd移动字符串">MOVSB / MOVSW / MOVSD：移动字符串
</h4><p><strong><code>MOVS</code>（Move String）指令用于将数据从源地址<code>DS:ESI</code>复制到目标地址<code>ES:EDI</code></strong></p>
<p>根据指令后缀，它每次可以复制1、2或4个字节</p>
<ul>
<li><strong><code>MOVSB</code>：移动1字节（Byte）</strong></li>
<li><strong><code>MOVSW</code>：移动2字节（Word）</strong></li>
<li><strong><code>MOVSD</code>：移动4字节（Double Word）</strong></li>
</ul>
<p>下面的代码是使用<code>REP MOVSD</code>将源地址的32字节数据复制到目标地址：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>;设置参数
</span></span><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">ESI</span>, <span style="color:#e06c75">OFFSET</span> <span style="color:#e06c75">SourceAddress</span>      ; 将源地址加载到<span style="color:#e06c75">ESI</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">EDI</span>, <span style="color:#e06c75">OFFSET</span> <span style="color:#e06c75">DestAddress</span>         ; 将目标地址加载到<span style="color:#e06c75">EDI</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">ECX</span>, <span style="color:#d19a66">8</span>                                       ; 设置重复次数 (<span style="color:#d19a66">8</span>次<span style="color:#56b6c2">*</span><span style="color:#d19a66">4</span>字节<span style="color:#56b6c2">/</span>次<span style="color:#56b6c2">=</span><span style="color:#d19a66">32</span>字节)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>;执行复制
</span></span><span style="display:flex;"><span><span style="color:#e06c75">CLD</span>                                                     ; 清除方向标志位（<span style="color:#e06c75">DF</span><span style="color:#56b6c2">=</span><span style="color:#d19a66">0</span>），确保<span style="color:#e06c75">ESI和EDI递增</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">REP</span> <span style="color:#e06c75">MOVSD</span>                                        ; 重复执行<span style="color:#e06c75">MOVSD指令ECX次</span>，即<span style="color:#d19a66">8</span>次
</span></span></code></pre></div><h4 id="stosb--stosw--stosd存储字符串">STOSB / STOSW / STOSD：存储字符串
</h4><p><strong><code>STOS</code>（Store String）指令用于将<code>AL</code>/<code>AX</code>/<code>EAX</code>寄存器中的值存储到<code>ES:EDI</code>指向的内存地址</strong></p>
<p>它常用于初始化一块内存区域</p>
<ul>
<li><strong><code>STOSB</code>：将<code>AL</code>的内容存入<code>[EDI]</code></strong></li>
<li><strong><code>STOSW</code>：将<code>AX</code>的内容存入<code>[EDI]</code></strong></li>
<li><strong><code>STOSD</code>：将<code>EAX</code>的内容存入<code>[EDI]</code></strong></li>
</ul>
<p>以下代码演示了如何将<code>EDI</code>指向的 36 字节内存块全部设置为 0</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>;设置参数
</span></span><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">EDI</span>, <span style="color:#e06c75">ESI</span>                   ; 设置目标内存地址 (假设地址已在<span style="color:#e06c75">ESI中</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">XOR</span> <span style="color:#e06c75">EAX</span>, <span style="color:#e06c75">EAX</span>                  ; 将<span style="color:#e06c75">EAX清零</span>，这是我们要写入的值
</span></span><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">ECX</span>, <span style="color:#d19a66">9</span>                     ; 设置重复次数 (<span style="color:#d19a66">9</span>次<span style="color:#56b6c2">*</span><span style="color:#d19a66">4</span>字节<span style="color:#56b6c2">/</span>次<span style="color:#56b6c2">=</span><span style="color:#d19a66">36</span>字节)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>;执行写入
</span></span><span style="display:flex;"><span><span style="color:#e06c75">CLD</span>                                  ; 确保<span style="color:#e06c75">EDI递增</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">REP</span> <span style="color:#e06c75">STOSD</span>                      ; 重复执行<span style="color:#e06c75">STOSD指令ECX次</span>，将<span style="color:#e06c75">EAX</span>(<span style="color:#d19a66">0</span>)连续写入目标内存
</span></span></code></pre></div><div class="alert alert-note">
    <div class="alert-header">
        <span class="alert-icon">
            📝
        </span>
        <span class="alert-title">
            Note
        </span>
    </div>
    <div class="alert-content">
        <p><strong><code>XOR EAX, EAX</code>效果和<code>MOV EAX, 0</code>一样，都是将寄存器值置零，但是会更加高效</strong></p>
<p><strong>这是因为CPU看到<code>XOR reg, reg</code>这种特殊模式，会自动识别为清零优化，不会依赖旧值</strong></p>
<p>Intel官方优化手册明确指出：</p>
<p>“Zero idioms such as<code>XOR reg, reg</code>or<code>SUB reg, reg</code>are recognized by the processor and are handled specially — they do not create a dependency on the old register value.”</p></div>
</div>
<h4 id="scasb--scasw--scasd扫描字符串">SCASB / SCASW / SCASD：扫描字符串
</h4><p><strong><code>SCAS</code>（Scan String）指令用于将<code>AL</code>/<code>AX</code>/<code>EAX</code>寄存器中的值与<code>ES:EDI</code>指向的内存值进行比较，并根据比较结果设置<code>EFLAGS</code>寄存器的标志位</strong></p>
<ul>
<li><strong>寄存器值等于内存值：<code>ZF = 1</code></strong></li>
<li><strong>寄存器值不等于内存值：<code>ZF = 0</code></strong></li>
</ul>
<p>它常用于在字符串中搜索特定字符</p>
<ul>
<li><strong><code>SCASB</code>：比较<code>AL</code>和<code>[EDI]</code></strong></li>
<li><strong><code>SCASW</code>：比较<code>AX</code>和<code>[EDI]</code></strong></li>
<li><strong><code>SCASD</code>：比较<code>EAX</code>和<code>[EDI]</code></strong></li>
</ul>
<p>下面的代码展示了如何计算一个以<code>\0</code>（NULL）结尾的字符串的长度</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>;设置参数
</span></span><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">EDI</span>, <span style="color:#e06c75">EBX</span>                   ; 假设字符串的起始地址在<span style="color:#e06c75">EBX中</span>，将其加载到<span style="color:#e06c75">EDI</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">XOR</span> <span style="color:#e06c75">AL</span>, <span style="color:#e06c75">AL</span>                        ; 将<span style="color:#e06c75">AL设置为0</span>，即我們要查找的字符串结束符<span style="color:#98c379">&#39;\0&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">ECX</span>, <span style="color:#56b6c2">-</span><span style="color:#d19a66">1</span>                     ; 将<span style="color:#e06c75">ECX设为最大值</span>，以扫描任意长度的字符串
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>;执行扫描
</span></span><span style="display:flex;"><span><span style="color:#e06c75">CLD</span>                                    ; 确保<span style="color:#e06c75">EDI递增</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">REPNE</span> <span style="color:#e06c75">SCASB</span>                    ; 当<span style="color:#e06c75">AL</span><span style="color:#56b6c2">!=</span>[<span style="color:#e06c75">EDI</span>]时重复扫描，每次扫描<span style="color:#e06c75">EDI都会递增</span>，直到找到<span style="color:#98c379">&#39;\0&#39;</span>或扫描完<span style="color:#e06c75">ECX次</span>
</span></span><span style="display:flex;"><span>                                           ; 找到<span style="color:#98c379">&#39;\0&#39;</span>后，<span style="color:#e06c75">EDI指向</span><span style="color:#98c379">&#39;\0&#39;</span>字符的下一个字节
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>;计算长度
</span></span><span style="display:flex;"><span><span style="color:#e06c75">NOT</span> <span style="color:#e06c75">ECX</span>                            ; 对<span style="color:#e06c75">ECX按位取反</span>，得到扫描过的字符数
</span></span><span style="display:flex;"><span><span style="color:#e06c75">DEC</span> <span style="color:#e06c75">ECX</span>                             ; 让<span style="color:#e06c75">ECX减一</span>，即减去最后的<span style="color:#98c379">&#39;\0&#39;</span>字符，得到字符串的实际长度
</span></span><span style="display:flex;"><span>                                           ; 最终长度存储在<span style="color:#e06c75">ECX中</span>
</span></span></code></pre></div><div class="alert alert-note">
    <div class="alert-header">
        <span class="alert-icon">
            📝
        </span>
        <span class="alert-title">
            Note
        </span>
    </div>
    <div class="alert-content">
        <p><strong><code>MOV ECX, -1</code>这一步是为了什么？</strong></p>
<p>在底层机器码中，<code>-1</code>并不会以负号形式存储，而是使用补码表示，而32位补码中<code>-1 = 0xFFFFFFFF</code></p>
<p>所以这条指令本质上等价于：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">ECX</span>, <span style="color:#d19a66">0xFFFFFFFF</span>
</span></span></code></pre></div><p><strong>这样就把<code>ECX</code>设为了最大值<code>0xFFFFFFFF</code>，而<code>ECX</code>是无符号计数器，递减就从这个极大数开始，而不是<code>-1</code></strong></p>
<p><code>SCASB</code>每执行一次，会自动让<code>ECX</code>减1，我们不知道字符串长度是多少，所以干脆从最大值开始扫</p>
<p>看看类似的用法：</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>汇编写法</th>
          <th>实际数值</th>
          <th>寄存器值</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>MOV ECX, 0</code></td>
          <td>0</td>
          <td><code>0x00000000</code></td>
      </tr>
      <tr>
          <td><code>MOV ECX, 1</code></td>
          <td>1</td>
          <td><code>0x00000001</code></td>
      </tr>
      <tr>
          <td><code>MOV ECX, -1</code></td>
          <td>-1</td>
          <td><code>0xFFFFFFFF</code></td>
      </tr>
      <tr>
          <td><code>MOV ECX, -2</code></td>
          <td>-2</td>
          <td><code>0xFFFFFFFE</code></td>
      </tr>
  </tbody>
</table></div></div>
</div>
<h2 id="算术与位运算指令">算术与位运算指令
</h2><p>这类指令用于执行基本的数学计算和位级操作</p>
<h3 id="add--sub加法--减法">ADD / SUB：加法 / 减法
</h3><p>执行加法或减法运算，并将结果存回目标操作数</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">ADD</span> <span style="color:#e06c75">dest</span>, <span style="color:#e06c75">src</span>              ; 结果是<span style="color:#e06c75">dest</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">dest</span> <span style="color:#56b6c2">+</span> <span style="color:#e06c75">src</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">SUB</span> <span style="color:#e06c75">dest</span>, <span style="color:#e06c75">src</span>               ; 结果是<span style="color:#e06c75">dest</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">dest</span> <span style="color:#56b6c2">-</span> <span style="color:#e06c75">src</span>
</span></span></code></pre></div><h3 id="inc--dec加一--减一">INC / DEC：加一 / 减一
</h3><p>将操作数的值增加1或减少1，比等效的 <code>ADD/SUB</code> 指令更短、更快</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">INC</span> <span style="color:#e06c75">ECX</span>                       ; 结果是<span style="color:#e06c75">ECX</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">ECX</span> <span style="color:#56b6c2">+</span> <span style="color:#d19a66">1</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">DEC</span> <span style="color:#e06c75">EAX</span>                      ; 结果是<span style="color:#e06c75">EAX</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">EAX</span> <span style="color:#56b6c2">-</span> <span style="color:#d19a66">1</span>
</span></span></code></pre></div><h3 id="neg取补">NEG：取补
</h3><p>通过执行按位取反后加一的操作来获得操作数的算术相反数（补码）</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">NEG</span> <span style="color:#e06c75">EBX</span>                     ; 结果是<span style="color:#e06c75">EBX</span> <span style="color:#56b6c2">=</span> <span style="color:#56b6c2">-</span><span style="color:#e06c75">EBX</span>
</span></span></code></pre></div><h3 id="imul--mul有符号--无符号乘法">IMUL / MUL：有符号 / 无符号乘法
</h3><p>执行乘法运算，根据操作数的数量，用法有所不同</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>指令</th>
          <th>操作数形式</th>
          <th>结果寄存器</th>
          <th>是否占用EDX</th>
          <th>特点</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>MUL SRC</code></td>
          <td>单操作数</td>
          <td>EDX:EAX</td>
          <td>是</td>
          <td>完整64位结果，无符号</td>
      </tr>
      <tr>
          <td><code>IMUL SRC</code></td>
          <td>单操作数</td>
          <td>EDX:EAX</td>
          <td>是</td>
          <td>完整64位结果，有符号</td>
      </tr>
      <tr>
          <td><code>IMUL DEC, SRC</code></td>
          <td>双操作数</td>
          <td>ECX</td>
          <td>否</td>
          <td>只保留低32位，有符号</td>
      </tr>
      <tr>
          <td><code>IMUL DEC, SRC, 立即数</code></td>
          <td>三操作数</td>
          <td>ECX</td>
          <td>否</td>
          <td>可立即数乘，有符号</td>
      </tr>
  </tbody>
</table></div>
<h4 id="单操作数imul和mul都支持">单操作数（IMUL和MUL都支持）
</h4><p><strong>将<code>EAX</code>与指定操作数相乘，结果是一个64位数，高32位存入<code>EDX</code>，低32位存入<code>EAX</code></strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">EAX</span>, <span style="color:#56b6c2">-</span><span style="color:#d19a66">2</span>       ; <span style="color:#e06c75">EAX</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">0xFFFFFFFE</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">EBX</span>, <span style="color:#d19a66">3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">IMUL</span> <span style="color:#e06c75">EBX</span>           ; <span style="color:#e06c75">EAX</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">EBX</span> <span style="color:#56b6c2">=</span> <span style="color:#56b6c2">-</span><span style="color:#d19a66">6</span>                        <span style="color:#56b6c2">-&gt;</span>           <span style="color:#e06c75">EDX</span>:<span style="color:#e06c75">EAX</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">0xFFFFFFFF</span><span style="color:#56b6c2">:</span><span style="color:#d19a66">0xFFFFFFFA</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">MUL</span> <span style="color:#e06c75">EBX</span>            ; <span style="color:#e06c75">EAX</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">EBX</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">4294967290</span>        <span style="color:#56b6c2">-&gt;</span>           <span style="color:#e06c75">EDX</span>:<span style="color:#e06c75">EAX</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">0x00000002</span><span style="color:#56b6c2">:</span><span style="color:#d19a66">0xFFFFFFFA</span>
</span></span></code></pre></div><h4 id="多操作数只有imul支持">多操作数（只有IMUL支持）
</h4><p>提供更高的灵活性，<strong>，可指定目标寄存器，结果直接存入目标寄存器，不分高低位，不占用EDX</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">EBX</span>, <span style="color:#d19a66">3</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">IMUL</span> <span style="color:#e06c75">EAX</span>, <span style="color:#e06c75">EBX</span>        ; <span style="color:#e06c75">EAX</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">EAX</span> <span style="color:#56b6c2">*</span> <span style="color:#e06c75">EBX</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">IMUL</span> <span style="color:#e06c75">ECX</span>, <span style="color:#e06c75">EBX</span>, <span style="color:#d19a66">5</span>    ; <span style="color:#e06c75">ECX</span> <span style="color:#56b6c2">=</span> <span style="color:#e06c75">EBX</span> <span style="color:#56b6c2">*</span> <span style="color:#d19a66">5</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">20</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>; 也可以直接指定内存，假设 [<span style="color:#d19a66">0x123</span>] <span style="color:#56b6c2">=</span> <span style="color:#56b6c2">-</span><span style="color:#d19a66">3</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">IMUL</span> <span style="color:#e06c75">ECX</span>, [<span style="color:#d19a66">0x123</span>], <span style="color:#d19a66">5</span>   ; <span style="color:#e06c75">ECX</span> <span style="color:#56b6c2">=</span> <span style="color:#56b6c2">-</span><span style="color:#d19a66">3</span> <span style="color:#56b6c2">*</span> <span style="color:#d19a66">5</span> <span style="color:#56b6c2">=</span> <span style="color:#56b6c2">-</span><span style="color:#d19a66">15</span>
</span></span></code></pre></div><h3 id="idiv--div有符号--无符号除法">IDIV / DIV：有符号 / 无符号除法
</h3><p>执行除法运算</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>位宽</th>
          <th>被除数寄存器</th>
          <th>商寄存器</th>
          <th>余数寄存器</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>8位</td>
          <td>AX</td>
          <td>AL</td>
          <td>AH</td>
      </tr>
      <tr>
          <td>16位</td>
          <td>DX:AX</td>
          <td>AX</td>
          <td>DX</td>
      </tr>
      <tr>
          <td>32位</td>
          <td>EDX:EAX</td>
          <td>EAX</td>
          <td>EDX</td>
      </tr>
  </tbody>
</table></div>
<h4 id="无符号的div">无符号的DIV
</h4><div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">EAX</span>, <span style="color:#d19a66">20</span>       ; 低 <span style="color:#d19a66">32</span> 位被除数
</span></span><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">EDX</span>, <span style="color:#d19a66">0</span>        ; 高 <span style="color:#d19a66">32</span> 位被除数
</span></span><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">EBX</span>, <span style="color:#d19a66">6</span>        ; 除数
</span></span><span style="display:flex;"><span><span style="color:#e06c75">DIV</span> <span style="color:#e06c75">EBX</span>
</span></span><span style="display:flex;"><span>; <span style="color:#e06c75">EAX</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">20</span> <span style="color:#56b6c2">/</span> <span style="color:#d19a66">6</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">3</span> (商)
</span></span><span style="display:flex;"><span>; <span style="color:#e06c75">EDX</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">20</span> <span style="color:#56b6c2">%</span> <span style="color:#d19a66">6</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">2</span> (余数)
</span></span></code></pre></div><h4 id="有符号的idiv">有符号的IDIV
</h4><div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">EAX</span>, <span style="color:#56b6c2">-</span><span style="color:#d19a66">20</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">EDX</span>, <span style="color:#d19a66">0</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">EBX</span>, <span style="color:#d19a66">6</span>        ; 除数
</span></span><span style="display:flex;"><span><span style="color:#e06c75">IDIV</span> <span style="color:#e06c75">EBX</span>
</span></span><span style="display:flex;"><span>; <span style="color:#e06c75">EAX</span> <span style="color:#56b6c2">=</span> <span style="color:#56b6c2">-</span><span style="color:#d19a66">20</span> <span style="color:#56b6c2">/</span> <span style="color:#d19a66">6</span> <span style="color:#56b6c2">=</span> <span style="color:#56b6c2">-</span><span style="color:#d19a66">3</span> (商)
</span></span><span style="display:flex;"><span>; <span style="color:#e06c75">EDX</span> <span style="color:#56b6c2">=</span> <span style="color:#56b6c2">-</span><span style="color:#d19a66">20</span> <span style="color:#56b6c2">%</span> <span style="color:#d19a66">6</span> <span style="color:#56b6c2">=</span> <span style="color:#56b6c2">-</span><span style="color:#d19a66">2</span> (余数)
</span></span></code></pre></div><h3 id="and--or--xor按位与--或--异或">AND / OR / XOR：按位与 / 或 / 异或
</h3><p>对操作数进行按位逻辑运算，<strong>结果存回第一个操作数</strong></p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>指令</th>
          <th>运算类型</th>
          <th>说明</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>AND</td>
          <td>按位与</td>
          <td>两位都为1时结果为1，否则为0</td>
      </tr>
      <tr>
          <td>OR</td>
          <td>按位或</td>
          <td>两位有1时结果为1，否则为0</td>
      </tr>
      <tr>
          <td>XOR</td>
          <td>按位异或</td>
          <td>两位不同时结果为1，相同为0</td>
      </tr>
  </tbody>
</table></div>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">AND</span> <span style="color:#e06c75">EAX</span>, <span style="color:#d19a66">0x0F</span>                        ; 取低<span style="color:#d19a66">4</span>位，清除高<span style="color:#d19a66">28</span>位
</span></span><span style="display:flex;"><span><span style="color:#e06c75">OR</span> <span style="color:#e06c75">EAX</span>, <span style="color:#e06c75">EBX</span>                            ; 将<span style="color:#e06c75">EBX中为1的位合并到EAX</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">XOR</span> <span style="color:#e06c75">EAX</span>, <span style="color:#d19a66">0xFFFFFFFF</span>              ; 按位取反
</span></span></code></pre></div><p>之前提到过的<code>XOR EAX, EAX</code>是将<code>EAX</code>寄存器清零的最快方式，CPU能识别这种特殊形式并进行优化，不产生对旧值的依赖，因此比<code>MOV EAX, 0</code>更高效</p>
<h3 id="not按位取反">NOT：按位取反
</h3><p>将操作数的每一位反转（0变1，1变0）</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">EAX</span>, <span style="color:#d19a66">0x0F</span>                         ; 二进制<span style="color:#d19a66">0000</span> <span style="color:#d19a66">0000</span> <span style="color:#d19a66">0000</span> <span style="color:#d19a66">1111</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">NOT</span> <span style="color:#e06c75">EAX</span>                                    ; 变成<span style="color:#d19a66">1111</span> <span style="color:#d19a66">1111</span> <span style="color:#d19a66">1111</span> <span style="color:#d19a66">0000</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">0xFFFFFFF0</span>
</span></span></code></pre></div><h3 id="shl--sal--shr--sar逻辑--算数-的-左移--右移">SHL / SAL / SHR / SAR：逻辑 / 算数 的 左移 / 右移
</h3><p>将操作数的位向左或向右移动，空出的位用0填充</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>指令</th>
          <th>运算</th>
          <th>填充位</th>
          <th>运算结果</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>SHL / SAL</td>
          <td>左移</td>
          <td>低位补 0</td>
          <td>左移N位=乘以$2^N$</td>
      </tr>
      <tr>
          <td>SHR</td>
          <td>逻辑右移</td>
          <td>高位补 0</td>
          <td>右移N位=无符号除以$2^N$</td>
      </tr>
      <tr>
          <td>SAR</td>
          <td>算术右移</td>
          <td>高位补符号位</td>
          <td>右移N位=有符号除以$2^N$（保留符号）</td>
      </tr>
  </tbody>
</table></div>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">EAX</span>, <span style="color:#d19a66">3</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">SHL</span> <span style="color:#e06c75">EAX</span>, <span style="color:#d19a66">2</span>        ; <span style="color:#e06c75">EAX</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">3</span> <span style="color:#56b6c2">&lt;&lt;</span> <span style="color:#d19a66">2</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">12</span> (<span style="color:#d19a66">3</span><span style="color:#56b6c2">*</span><span style="color:#d19a66">2</span><span style="color:#56b6c2">^</span><span style="color:#d19a66">2</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">SAL</span> <span style="color:#e06c75">EAX</span>, <span style="color:#d19a66">2</span>        ; 和<span style="color:#e06c75">SHL完全一样</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">EBX</span>, <span style="color:#d19a66">16</span>    ; <span style="color:#d19a66">0x00000010</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">SHR</span> <span style="color:#e06c75">EBX</span>, <span style="color:#d19a66">2</span>        ; <span style="color:#e06c75">EBX</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">16</span> <span style="color:#56b6c2">&gt;&gt;</span> <span style="color:#d19a66">2</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">4</span> (无符号除以 <span style="color:#d19a66">4</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">ECX</span>, <span style="color:#56b6c2">-</span><span style="color:#d19a66">16</span>   ; <span style="color:#d19a66">0xFFFFFFF0</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">SAR</span> <span style="color:#e06c75">ECX</span>, <span style="color:#d19a66">2</span>        ; <span style="color:#e06c75">ECX</span> <span style="color:#56b6c2">=</span> <span style="color:#56b6c2">-</span><span style="color:#d19a66">16</span> <span style="color:#56b6c2">&gt;&gt;</span> <span style="color:#d19a66">2</span> <span style="color:#56b6c2">=</span> <span style="color:#56b6c2">-</span><span style="color:#d19a66">4</span> (保留符号)
</span></span></code></pre></div><h3 id="rol--ror循环左移--右移">ROL / ROR：循环左移 / 右移
</h3><p>将操作数的位向左或向右移动，移出的位会从另一端循环回来填充空位</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">AL</span>, <span style="color:#d19a66">10010011</span><span style="color:#e06c75">b</span>       ; 二进制数 <span style="color:#d19a66">10010011</span>，<span style="color:#e06c75">AL</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">0x93</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">ROL</span> <span style="color:#e06c75">AL</span>, <span style="color:#d19a66">2</span>                         ; <span style="color:#e06c75">AL</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">01001110</span><span style="color:#e06c75">b</span>, 原高<span style="color:#d19a66">2</span>位“<span style="color:#d19a66">10</span>”循环到低位
</span></span><span style="display:flex;"><span><span style="color:#e06c75">ROR</span> <span style="color:#e06c75">AL</span>, <span style="color:#d19a66">3</span>                        ; <span style="color:#e06c75">AL</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">11001001</span><span style="color:#e06c75">b</span>, 低<span style="color:#d19a66">3</span>位“<span style="color:#d19a66">110</span>”循环到高位
</span></span></code></pre></div><h2 id="控制流指令">控制流指令
</h2><p>这类指令通过修改<code>EIP</code>（指令指针）寄存器的值来改变程序的执行流程，从而实现分支、循环等结构</p>
<h3 id="比较指令">比较指令
</h3><p>这两个指令通过执行内部运算来改变<code>EFLAGS</code>寄存器中的状态标志位，<strong>但不会修改操作数本身</strong></p>
<p>它们为后续的条件跳转指令提供判断依据</p>
<h4 id="cmp减法比较">CMP：减法比较
</h4><p><strong>内部执行<code>A - B</code>的减法运算</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">EAX</span>, <span style="color:#d19a66">5</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">CMP</span> <span style="color:#e06c75">EAX</span>, <span style="color:#d19a66">3</span>       ; 实际执行 <span style="color:#d19a66">5</span> <span style="color:#56b6c2">-</span> <span style="color:#d19a66">3</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">JG</span> <span style="color:#e06c75">greater</span>          ; 如果 <span style="color:#e06c75">EAX</span> <span style="color:#56b6c2">&gt;</span> <span style="color:#d19a66">3</span>, 跳转
</span></span></code></pre></div><h4 id="testand比较">TEST：AND比较
</h4><p><strong>内部执行<code>A AND B</code>的按位与运算</strong></p>
<p>eg1：检测寄存器是否为0</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">TEST</span> <span style="color:#e06c75">EAX</span>, <span style="color:#e06c75">EAX</span>         ; <span style="color:#e06c75">A</span> <span style="color:#e06c75">AND</span> <span style="color:#e06c75">A</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">JZ</span>  <span style="color:#e06c75">is_zero</span>                ; 如果结果为 <span style="color:#d19a66">0</span> (<span style="color:#e06c75">ZF</span><span style="color:#56b6c2">=</span><span style="color:#d19a66">1</span>)，跳转
</span></span></code></pre></div><p>eg2：检测某一位是否为1</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">TEST</span> <span style="color:#e06c75">AL</span>, <span style="color:#d19a66">1</span>                 ; 检查最低位是否为 <span style="color:#d19a66">1</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">JNZ</span> <span style="color:#e06c75">odd_number</span>      ; 若最低位为<span style="color:#d19a66">1</span>（奇数），跳转
</span></span></code></pre></div><h3 id="jmp无条件跳转">JMP：无条件跳转
</h3><p><code>JMP</code>（Jump）指令会立即无条件地将程序的执行点转移到指定的目标地址</p>
<p><strong>基本语法：</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">JMP</span> <span style="color:#e06c75">label</span>
</span></span></code></pre></div><p><code>label</code>可以是同一段代码内的标签（短跳转或近跳转），也可以是其他段的地址（远跳转）</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>    <span style="color:#e06c75">MOV</span> <span style="color:#e06c75">EAX</span>, <span style="color:#d19a66">0</span>      ; <span style="color:#e06c75">EAX</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">JMP</span> <span style="color:#e06c75">skip</span>            ; 无条件跳转到 <span style="color:#e06c75">skip</span> 标签
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">MOV</span> <span style="color:#e06c75">EAX</span>, <span style="color:#d19a66">5</span>      ; 这一行永远不会被执行！
</span></span><span style="display:flex;"><span><span style="color:#e06c75">skip</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">MOV</span> <span style="color:#e06c75">EAX</span>, <span style="color:#d19a66">1</span>      ; 执行到这里
</span></span></code></pre></div><h3 id="jcc条件跳转">Jcc：条件跳转
</h3><p><code>Jcc</code> (Jump on Condition) 是一系列指令的统称</p>
<p>它们在<code>CMP</code>或<code>TEST</code>指令之后，根据<code>EFLAGS</code>寄存器的状态来决定是否进行跳转</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>指令</th>
          <th>跳转条件（基于 EFLAGS）</th>
          <th>含义（中文描述）</th>
          <th>比较类型</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>JE / JZ</strong></td>
          <td><code>ZF = 1</code></td>
          <td>相等 / 结果为零</td>
          <td>通用</td>
      </tr>
      <tr>
          <td><strong>JNE / JNZ</strong></td>
          <td><code>ZF = 0</code></td>
          <td>不相等 / 结果非零</td>
          <td>通用</td>
      </tr>
      <tr>
          <td><strong>JG / JNLE</strong></td>
          <td><code>ZF = 0 AND SF = OF</code></td>
          <td>大于（有符号数）</td>
          <td>有符号</td>
      </tr>
      <tr>
          <td><strong>JGE / JNL</strong></td>
          <td><code>SF = OF</code></td>
          <td>大于等于（有符号数）</td>
          <td>有符号</td>
      </tr>
      <tr>
          <td><strong>JL / JNGE</strong></td>
          <td><code>SF ≠ OF</code></td>
          <td>小于（有符号数）</td>
          <td>有符号</td>
      </tr>
      <tr>
          <td><strong>JLE / JNG</strong></td>
          <td><code>ZF = 1 OR SF ≠ OF</code></td>
          <td>小于等于（有符号数）</td>
          <td>有符号</td>
      </tr>
      <tr>
          <td><strong>JA / JNBE</strong></td>
          <td><code>CF = 0 AND ZF = 0</code></td>
          <td>大于（无符号数）</td>
          <td>无符号</td>
      </tr>
      <tr>
          <td><strong>JAE / JNB</strong></td>
          <td><code>CF = 0</code></td>
          <td>大于等于（无符号数）</td>
          <td>无符号</td>
      </tr>
      <tr>
          <td><strong>JB / JNAE</strong></td>
          <td><code>CF = 1</code></td>
          <td>小于（无符号数）</td>
          <td>无符号</td>
      </tr>
      <tr>
          <td><strong>JBE / JNA</strong></td>
          <td><code>CF = 1 OR ZF = 1</code></td>
          <td>小于等于（无符号数）</td>
          <td>无符号</td>
      </tr>
      <tr>
          <td><strong>JS</strong></td>
          <td><code>SF = 1</code></td>
          <td>结果为负</td>
          <td>通用</td>
      </tr>
      <tr>
          <td><strong>JNS</strong></td>
          <td><code>SF = 0</code></td>
          <td>结果为正或零</td>
          <td>通用</td>
      </tr>
      <tr>
          <td><strong>JO</strong></td>
          <td><code>OF = 1</code></td>
          <td>溢出发生</td>
          <td>通用</td>
      </tr>
      <tr>
          <td><strong>JNO</strong></td>
          <td><code>OF = 0</code></td>
          <td>无溢出</td>
          <td>通用</td>
      </tr>
      <tr>
          <td><strong>JC</strong></td>
          <td><code>CF = 1</code></td>
          <td>进位（或借位）发生</td>
          <td>通用</td>
      </tr>
      <tr>
          <td><strong>JNC</strong></td>
          <td><code>CF = 0</code></td>
          <td>无进位 / 无借位</td>
          <td>通用</td>
      </tr>
      <tr>
          <td><strong>JP / JPE</strong></td>
          <td><code>PF = 1</code></td>
          <td>奇偶标志为偶（结果1个数为偶数）</td>
          <td>通用</td>
      </tr>
      <tr>
          <td><strong>JNP / JPO</strong></td>
          <td><code>PF = 0</code></td>
          <td>奇偶标志为奇</td>
          <td>通用</td>
      </tr>
  </tbody>
</table></div>
<h3 id="跳转指令前缀">跳转指令前缀
</h3><p><strong>跳转指令前缀是汇编器用来指示跳转类型或范围的关键字</strong></p>
<p>它不改变跳转的条件本身，只影响指令编码和偏移量大小，也就是CPU计算跳转地址时用多少字节表示偏移</p>
<p>这本质上是告诉CPU跳转目标离它有多远，CPU会选择合适的指令长度（1-6字节）存储偏移</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>前缀</th>
          <th>偏移量大小</th>
          <th>说明</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>SHORT</strong></td>
          <td>8位有符号偏移量 (-128 ~ +127)</td>
          <td><strong>近距离跳转</strong>，小范围循环或if/else</td>
      </tr>
      <tr>
          <td><strong>NEAR</strong></td>
          <td>16位或32位偏移量（同段跳转）</td>
          <td><strong>目标在当前代码段内，距离较远</strong></td>
      </tr>
      <tr>
          <td><strong>FAR</strong></td>
          <td>16/32位段内偏移 + 16位段选择子</td>
          <td><strong>跨段跳转</strong>，改变CS寄存器</td>
      </tr>
  </tbody>
</table></div>
<p><strong>条件跳转（Jcc）默认使用SHORT，如果目标太远，汇编器会自动转换为NEAR</strong></p>
<h3 id="流程控制结构示例">流程控制结构示例
</h3><h4 id="if-else结构">if-else结构
</h4><p>C语言：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#c678dd">if</span> (<span style="color:#56b6c2">*</span><span style="color:#e06c75">esi</span> <span style="color:#56b6c2">!=</span> <span style="color:#d19a66">0</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#7f848e">// block A
</span></span></span><span style="display:flex;"><span><span style="color:#7f848e"></span>}
</span></span><span style="display:flex;"><span><span style="color:#7f848e">// block B
</span></span></span></code></pre></div><p>汇编：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>    <span style="color:#e06c75">MOV</span> <span style="color:#e06c75">EDX</span>, [<span style="color:#e06c75">ESI</span>]      ; <span style="color:#e06c75">EDX</span> <span style="color:#56b6c2">=</span> <span style="color:#56b6c2">*</span><span style="color:#e06c75">esi</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">TEST</span> <span style="color:#e06c75">EDX</span>, <span style="color:#e06c75">EDX</span>       ; 比较 <span style="color:#e06c75">EDX</span> 和 <span style="color:#d19a66">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">JZ</span> <span style="color:#e06c75">SHORT</span> <span style="color:#e06c75">block_B</span>    ; 如果 <span style="color:#e06c75">EDX</span> 为 <span style="color:#d19a66">0</span>, 则跳转到 <span style="color:#e06c75">block_B</span>
</span></span><span style="display:flex;"><span>    ;<span style="color:#e06c75">block</span> <span style="color:#e06c75">A</span> 的代码
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span><span style="color:#e06c75">block_B</span>:
</span></span><span style="display:flex;"><span>    ;<span style="color:#e06c75">block</span> <span style="color:#e06c75">B</span> 的代码
</span></span></code></pre></div><h4 id="for循环结构">for循环结构
</h4><p>C语言：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#c678dd">for</span> (<span style="color:#e5c07b">int</span> <span style="color:#e06c75">i</span><span style="color:#56b6c2">=</span><span style="color:#d19a66">0</span>; <span style="color:#e06c75">i</span><span style="color:#56b6c2">&lt;</span><span style="color:#d19a66">10</span>; <span style="color:#e06c75">i</span><span style="color:#56b6c2">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#61afef;font-weight:bold">printf</span>(<span style="color:#98c379">&#34;%d</span><span style="color:#98c379">\n</span><span style="color:#98c379">&#34;</span>, <span style="color:#e06c75">i</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>汇编：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>    <span style="color:#e06c75">XOR</span> <span style="color:#e06c75">ESI</span>, <span style="color:#e06c75">ESI</span>                                              ; <span style="color:#e06c75">ESI</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">0</span> (作为计数器 <span style="color:#e06c75">i</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">LOOP_START</span>:
</span></span><span style="display:flex;"><span>    ;调用 <span style="color:#e06c75">printf</span> 的代码
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">PUSH</span> <span style="color:#e06c75">ESI</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">PUSH</span> <span style="color:#e06c75">OFFSET</span> <span style="color:#e06c75">FORMAT_STRING</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">CALL</span> <span style="color:#e06c75">printf</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">ADD</span> <span style="color:#e06c75">ESP</span>, <span style="color:#d19a66">8</span>                    						      ; 平衡堆栈
</span></span><span style="display:flex;"><span>    	
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">INC</span> <span style="color:#e06c75">ESI</span>            											  ; <span style="color:#e06c75">i</span><span style="color:#56b6c2">++</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">CMP</span> <span style="color:#e06c75">ESI</span>, <span style="color:#d19a66">10</span>         									  ; 比较 <span style="color:#e06c75">i</span> 和 <span style="color:#d19a66">10</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">JL</span> <span style="color:#e06c75">SHORT</span> <span style="color:#e06c75">LOOP_START</span>  						    ; 如果 <span style="color:#e06c75">i</span> <span style="color:#56b6c2">&lt;</span> <span style="color:#d19a66">10</span>, 继续循环
</span></span></code></pre></div><h2 id="栈与函数调用指令">栈与函数调用指令
</h2><h3 id="栈">栈
</h3><p>在IA-32架构下，栈是连续的内存区域，用于存储临时数据、函数参数和返回地址</p>
<ul>
<li>
<p><strong>栈存在于一个栈段内，由段寄存器SS指向段描述符</strong></p>
</li>
<li>
<p><strong>ESP寄存器所包含的栈指针永远指向栈顶位置，所有针对栈的操作都是基于<code>SS:ESP</code>的地址引用</strong></p>
</li>
</ul>
<p>IA-32 的栈通常是<strong>高地址向低地址生长</strong></p>
<h3 id="栈帧">栈帧
</h3><h4 id="什么是栈帧">什么是栈帧
</h4><p>每当一个函数被调用时，都会在栈上为其分配一块专属空间，称为该函数的<strong>栈帧</strong></p>
<p>栈帧用于存放函数的局部变量、传递给其他函数的参数以及保存调用者的上下文信息</p>
<p>栈帧的组成内容如下：</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>内容</th>
          <th>说明</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>局部变量</td>
          <td>函数内部声明的变量，存放在栈帧中</td>
      </tr>
      <tr>
          <td>参数</td>
          <td>调用被调用函数时压入栈的参数</td>
      </tr>
      <tr>
          <td>栈帧相关指针</td>
          <td>用于管理函数返回与栈帧切换</td>
      </tr>
      <tr>
          <td>返回指令指针</td>
          <td><code>CALL</code>指令将EIP（下一条指令地址）压栈，函数返回后跳转到这里执行</td>
      </tr>
  </tbody>
</table></div>
<h4 id="栈帧基指针ebp">栈帧基指针（EBP）
</h4><p><code>EBP</code>在函数调用时用作栈帧的固定参考点，方便访问局部变量和函数参数</p>
<h3 id="基本栈操作push--pop">基本栈操作：PUSH / POP
</h3><h4 id="push压栈">PUSH：压栈
</h4><p>将一个寄存器、内存或立即数的值压入栈顶</p>
<p>先将栈顶指针<code>ESP</code>减去一个单位，然后将操作数存入<code>ESP</code>指向的新地址：</p>
<ul>
<li>
<p><strong>栈向低地址扩展，IA-32下，一个单位4字节（32bit）：<code>ESP = ESP - 4</code></strong></p>
</li>
<li>
<p><strong>将数据写入栈顶：<code>[ESP] = 操作数</code></strong></p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">EAX</span>, <span style="color:#d19a66">0x1234</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">PUSH</span> <span style="color:#e06c75">EAX</span>   ; <span style="color:#e06c75">ESP</span> <span style="color:#56b6c2">-=</span> <span style="color:#d19a66">4</span> , [<span style="color:#e06c75">ESP</span>] <span style="color:#56b6c2">=</span> <span style="color:#d19a66">0x1234</span>
</span></span></code></pre></div><p><mark><strong>PUSH先减再存值</strong></mark></p>
<h4 id="pop出栈">POP：出栈
</h4><p>从栈顶取出数据到寄存器或内存，并恢复栈指针</p>
<p>先将<code>ESP</code>指向地址的值取出到目标操作数，然后将<code>ESP</code>增加一个单位：</p>
<ul>
<li><strong>取出<code>[ESP]</code>的值到目标操作数</strong></li>
<li><strong>栈指针上移，恢复原位置：<code>ESP = ESP + 4</code></strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">POP</span> <span style="color:#e06c75">EBX</span>    ; <span style="color:#e06c75">EBX</span> <span style="color:#56b6c2">=</span> 栈顶值 , <span style="color:#e06c75">ESP</span> <span style="color:#56b6c2">+=</span> <span style="color:#d19a66">4</span>
</span></span></code></pre></div><p><mark><strong>POP先取值再加</strong></mark></p>
<h3 id="调用与返回的分类">调用与返回的分类
</h3><p>根据目标函数与调用者是否在同一个代码段，调用和返回可以分为两类</p>
<h4 id="近调用-near-call--近返回-near-return">近调用 (Near Call) / 近返回 (Near Return)
</h4><p>控制流转移到<strong>当前代码段</strong>中的函数，或从当前代码段的函数返回</p>
<p>这是最常见的调用方式，用于访问程序内部的本地函数</p>
<h4 id="远调用-far-call--远返回-far-return">远调用 (Far Call) / 远返回 (Far Return)
</h4><p>控制流转移到<strong>其他代码段</strong>中的函数，或从其他代码段返回</p>
<p>这种方式通常用于访问操作系统提供的服务（API）或其他进程的函数</p>
<h3 id="call调用函数">CALL：调用函数
</h3><p>跳转到被调用函数，并保存返回地址以便函数执行完毕后回到调用点</p>
<h4 id="近调用">近调用
</h4><ol>
<li><strong>压栈返回地址</strong>：<code>CALL</code>指令会将下一条指令的地址（EIP） 压入栈顶</li>
<li><strong>跳转到函数入口</strong>：CPU将EIP设置为被调用函数的起始地址</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>; 假设当前 <span style="color:#e06c75">EIP</span> <span style="color:#56b6c2">=</span> <span style="color:#d19a66">0x00401000</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">CALL</span> <span style="color:#e06c75">my_function</span>  ; <span style="color:#d19a66">1.</span> 保存返回地址：<span style="color:#e06c75">PUSH</span> <span style="color:#d19a66">0x00401005</span> (<span style="color:#e06c75">CALL指令长度为5字节</span>)
</span></span><span style="display:flex;"><span>                               ; <span style="color:#d19a66">2.</span> 跳转到<span style="color:#e06c75">my_function</span>：<span style="color:#e06c75">JMP</span> <span style="color:#e06c75">my_function</span>
</span></span></code></pre></div><h4 id="远调用">远调用
</h4><p>对于远调用，由于跨越了代码段，CPU不仅需要保存返回的地址偏移（EIP），还必须保存返回的段（CS），以便能够正确返回到调用者所在的原始代码段</p>
<ol>
<li><strong>压栈段寄存器CS</strong>：将当前代码段寄存器CS的值压入栈顶</li>
<li><strong>压栈返回地址EIP</strong>：将EIP的当前值压入栈顶</li>
<li><strong>跳转到函数入口</strong>：将目标函数的段选择器和偏移地址分别载入CS和EIP寄存器</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">CALL</span> <span style="color:#e06c75">FAR</span> <span style="color:#e06c75">PTR</span> <span style="color:#d19a66">2000</span><span style="color:#e06c75">h</span>:<span style="color:#d19a66">0100</span><span style="color:#e06c75">h</span>  ; 远调用到 <span style="color:#d19a66">2000</span><span style="color:#56b6c2">:</span><span style="color:#d19a66">0100</span>
</span></span></code></pre></div><p><strong>这里必须使用<code>FAR PTR</code>表示是远调用，否则会被当成近调用处理</strong></p>
<h3 id="ret从函数返回">RET：从函数返回
</h3><p>从栈顶取出返回地址，恢复执行流到调用者</p>
<h4 id="近返回retretn">近返回（RET/RETN）
</h4><ol>
<li><strong>弹出返回地址</strong>：从栈顶弹出一个32位的值到EIP寄存器</li>
<li><strong>清理参数 (可选)</strong>：<code>RET n</code>会在弹出返回地址后，额外将ESP增加n字节，用于清理调用者压入栈的参数</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">RET</span>       ; 标准返回
</span></span><span style="display:flex;"><span><span style="color:#e06c75">RETN</span>     ; 近返回
</span></span><span style="display:flex;"><span><span style="color:#e06c75">RET</span> <span style="color:#d19a66">8</span>     ; 返回并清理栈上 <span style="color:#d19a66">8</span> 字节参数
</span></span></code></pre></div><p>此时就可以把RET理解为：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">POP</span> <span style="color:#e06c75">EIP</span>
</span></span></code></pre></div><h4 id="远返回retf">远返回（RETF）
</h4><ol>
<li><strong>弹出返回地址EIP</strong>：从栈顶弹出一个32位的值到EIP寄存器</li>
<li><strong>弹出段寄存器CS</strong>：从栈顶弹出一个16位的值到CS寄存器</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">RETF</span> ; 远返回
</span></span></code></pre></div><p>CPU不跟踪返回指令指针在栈上的位置，程序员必须确保在执行<code>RET</code>指令时，栈顶内容恰好是正确的返回地址</p>
<p>如果栈上的返回地址在<code>RET</code>执行前被修改（例如通过缓冲区溢出），程序的执行流就可能被劫持，这是一个常见的安全漏洞</p>
<h3 id="调用约定">调用约定
</h3><p>这是函数调用双方必须遵守的一套规则，它规定了参数如何传递、返回值如何返回、以及哪一方（调用者或被调用者）负责清理栈上的参数。</p>
<ul>
<li>
<p><strong>cdecl</strong></p>
<p>C语言的默认约定，参数从右到左压栈，<strong>调用者</strong>负责清理栈</p>
</li>
<li>
<p><strong>stdcall</strong></p>
<p>Win32API常用，参数从右到左压栈，<strong>被调用者</strong>负责清理栈（通过 <code>RET n</code>）</p>
</li>
<li>
<p><strong>fastcall</strong></p>
<p><code>stdcall</code>的变种，前两个（或更多）参数通过<code>ECX</code>和<code>EDX</code>等寄存器传递，以提高速度，剩余参数压栈，被调用者负责清理</p>
</li>
</ul>
<h3 id="栈帧的创建与销毁函数指令框架">栈帧的创建与销毁（函数指令框架）
</h3><h4 id="函数序言-prologue">函数序言 (Prologue)
</h4><p>当执行<code>CALL</code>语句之后，函数开始时建立自己的栈帧</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">PUSH</span> <span style="color:#e06c75">EBP</span>              ; 保存调用者的栈帧基址 (旧<span style="color:#e06c75">EBP</span>)
</span></span><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">EBP</span>, <span style="color:#e06c75">ESP</span>        ; 将当前栈顶设为新的栈帧基址
</span></span><span style="display:flex;"><span><span style="color:#e06c75">SUB</span> <span style="color:#e06c75">ESP</span>, <span style="color:#d19a66">20</span><span style="color:#e06c75">H</span>         ; 让栈顶向低地址处延伸，以此为局部变量分配<span style="color:#d19a66">32</span>字节空间
</span></span></code></pre></div><p>局部变量会放在<code>EBP</code>下面（地址更小），参数会放在<code>EBP</code>上面（地址更大），也就是这样访问：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>[<span style="color:#e06c75">EBP</span> <span style="color:#56b6c2">+</span> <span style="color:#d19a66">8</span>]     	   	    ; 第一个参数（返回地址占用了<span style="color:#d19a66">4</span>字节，所以从第<span style="color:#d19a66">8</span>字节开始）
</span></span><span style="display:flex;"><span>[<span style="color:#e06c75">EBP</span> <span style="color:#56b6c2">+</span> <span style="color:#d19a66">12</span>]     		   ; 第二个参数
</span></span><span style="display:flex;"><span>[<span style="color:#e06c75">EBP</span> <span style="color:#56b6c2">-</span> <span style="color:#d19a66">4</span>]     		     ; 第一个局部变量
</span></span><span style="display:flex;"><span>[<span style="color:#e06c75">EBP</span> <span style="color:#56b6c2">-</span> <span style="color:#d19a66">8</span>]     		      ; 第二个局部变量
</span></span></code></pre></div><h4 id="函数结尾-epilogue">函数结尾 (Epilogue)
</h4><p>函数返回前恢复调用者栈帧的标准操作</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">ESP</span>, <span style="color:#e06c75">EBP</span>         ; 释放局部变量空间
</span></span><span style="display:flex;"><span><span style="color:#e06c75">POP</span> <span style="color:#e06c75">EBP</span>                  ; 恢复调用者的栈帧基址
</span></span><span style="display:flex;"><span><span style="color:#e06c75">RET</span>                          ; 返回
</span></span></code></pre></div><h4 id="enter--leave">ENTER / LEAVE
</h4><p>高级指令，用于简化栈帧的创建和销毁</p>
<p><strong><code>ENTER</code>等价于函数序言，<code>LEAVE</code>等价于<code>MOV ESP, EBP; POP EBP</code></strong></p>
<p>也就是说，一个函数应该（不是必须）写在这样的框架里：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">PUSH</span> <span style="color:#e06c75">EBP</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">EBP</span>, <span style="color:#e06c75">ESP</span>
</span></span><span style="display:flex;"><span>;（函数主体，局部变量<span style="color:#56b6c2">/</span>操作）
</span></span><span style="display:flex;"><span><span style="color:#e06c75">MOV</span> <span style="color:#e06c75">ESP</span>, <span style="color:#e06c75">EBP</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">POP</span> <span style="color:#e06c75">EBP</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">RET</span>
</span></span></code></pre></div><p>或者：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">ENTER</span>
</span></span><span style="display:flex;"><span>;（函数主体，局部变量<span style="color:#56b6c2">/</span>操作）
</span></span><span style="display:flex;"><span><span style="color:#e06c75">LEAVE</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">RET</span>
</span></span></code></pre></div><h3 id="调用流程总结">调用流程总结
</h3><p>结合之前所说的一切，我们就总结出来一个函数被调用时触发的操作顺序：</p>
<ol>
<li><strong>调用者准备调用      （压入参数）</strong></li>
<li><strong>执行CALL指令        （压入返回地址）</strong></li>
<li><strong>函数序言                （压入调用者的EBP，为局部变量开辟空间）</strong></li>
<li><strong>函数主体                （压入局部变量）</strong></li>
</ol>
<p>那么当一个栈帧创建完毕，应该是这样的：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#e06c75">高地址</span>
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">参数</span>                                        ← <span style="color:#e06c75">函数调用者压入</span>
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">返回地址</span>                                 ← <span style="color:#e06c75">call</span> <span style="color:#e06c75">自动压入</span>
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">旧</span> <span style="color:#e06c75">EBP</span>（<span style="color:#e06c75">上一个EBP</span>）             ← <span style="color:#e06c75">push</span> <span style="color:#e06c75">ebp</span> <span style="color:#e06c75">保存调用者基址</span>    
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">局部变量</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">低地址</span>
</span></span></code></pre></div><p>而在<code>PUSH EBP</code>之后，当前栈顶变成了栈帧的基址，也就是说帧创建完毕后，EBP和ESP位置如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#e06c75">高地址</span>
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">参数</span>                                       
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">返回地址</span>                                 
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">旧</span> <span style="color:#e06c75">EBP</span>（<span style="color:#e06c75">上一个EBP</span>）
</span></span><span style="display:flex;"><span><span style="color:#e06c75">   [EBP位置]</span>
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">局部变量</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">   [ESP位置]</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">低地址</span>
</span></span></code></pre></div><p>此时[EBP]存放着调用者的EBP，[ESP]存放着最后一个局部变量（如果申请的空间用满了的话）</p>
<p>下面的图就很好展示了调用函数栈帧变化：</p>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" data-caption="栈帧与调用惯例| nullwy&rsquo;s blog" href="http://picture.928330.xyz/typora/stack-frame-layout-zh.png">
<img src="http://picture.928330.xyz/typora/stack-frame-layout-zh.png" alt="栈帧与调用惯例| nullwy&rsquo;s blog"  />
</a>
</div>
</p>
<h3 id="调用流程示例">调用流程示例
</h3><p>举个例子，假设有这样一个程序：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">main</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">call</span> <span style="color:#e06c75">foo</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">ret</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">foo</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">push</span> <span style="color:#e06c75">ebp</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">mov</span>  <span style="color:#e06c75">ebp</span>, <span style="color:#e06c75">esp</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">sub</span>  <span style="color:#e06c75">esp</span>, <span style="color:#d19a66">4</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">mov</span>  <span style="color:#e06c75">DWORD</span> <span style="color:#e06c75">PTR</span> [<span style="color:#e06c75">ebp</span><span style="color:#56b6c2">-</span><span style="color:#d19a66">4</span>], <span style="color:#d19a66">1</span> ;局部变量
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">push</span> <span style="color:#d19a66">1</span> ;传入<span style="color:#e06c75">bar的参数</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">call</span> <span style="color:#e06c75">bar</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">mov</span>  <span style="color:#e06c75">esp</span>, <span style="color:#e06c75">ebp</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">pop</span>  <span style="color:#e06c75">ebp</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">ret</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">bar</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">push</span> <span style="color:#e06c75">ebp</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">mov</span>  <span style="color:#e06c75">ebp</span>, <span style="color:#e06c75">esp</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">sub</span>  <span style="color:#e06c75">esp</span>, <span style="color:#d19a66">4</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">mov</span>  <span style="color:#e06c75">esp</span>, <span style="color:#e06c75">ebp</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">pop</span>  <span style="color:#e06c75">ebp</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e06c75">ret</span>
</span></span></code></pre></div><h4 id="进入main">进入main
</h4><p><strong><code>EBP</code>：main的旧EBP</strong></p>
<p><strong><code>ESP</code>：main栈顶（局部变量区底）</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#e06c75">高地址</span>
</span></span><span style="display:flex;"><span>┌───────────────────────┐
</span></span><span style="display:flex;"><span>│   <span style="color:#e06c75">main</span> <span style="color:#e06c75">的参数</span>（<span style="color:#e06c75">也许有也许没有</span>）				   │
</span></span><span style="display:flex;"><span>├───────────────────────┤
</span></span><span style="display:flex;"><span>│   <span style="color:#e06c75">main</span> <span style="color:#e06c75">的返回地址</span>                          │ ← <span style="color:#e06c75">调用者是CRT</span>（<span style="color:#e06c75">C运行时</span>）
</span></span><span style="display:flex;"><span>├───────────────────────┤
</span></span><span style="display:flex;"><span>│   <span style="color:#e06c75">调用</span> <span style="color:#e06c75">main</span> <span style="color:#e06c75">的栈帧的EBP</span>                │ ← <span style="color:#e06c75">EBP</span> <span style="color:#e06c75">指向这里</span>
</span></span><span style="display:flex;"><span>├───────────────────────┤
</span></span><span style="display:flex;"><span>│   <span style="color:#e06c75">main</span> <span style="color:#e06c75">的局部变量</span>                          │
</span></span><span style="display:flex;"><span>└───────────────────────┘
</span></span><span style="display:flex;"><span><span style="color:#e06c75">低地址</span>
</span></span></code></pre></div><h4 id="call-foo">call foo
</h4><p>main函数先把foo需要的参数压栈，之后<code>call foo</code></p>
<p><code>call foo</code>做了两件事：</p>
<p><strong>1.把<code>call</code>下一条指令的地址，即当前EIP（指向call指令）+call指令长度，也即foo的返回地址，压入栈</strong></p>
<p><strong>2.让EIP跳转到foo的开始地址</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#e06c75">高地址</span>
</span></span><span style="display:flex;"><span>┌───────────────────────┐
</span></span><span style="display:flex;"><span>│   <span style="color:#e06c75">main</span> <span style="color:#e06c75">的参数</span>                                 │
</span></span><span style="display:flex;"><span>├───────────────────────┤
</span></span><span style="display:flex;"><span>│   <span style="color:#e06c75">main</span> <span style="color:#e06c75">的返回地址</span>                          │
</span></span><span style="display:flex;"><span>├───────────────────────┤
</span></span><span style="display:flex;"><span>│   <span style="color:#e06c75">调用</span> <span style="color:#e06c75">main</span> <span style="color:#e06c75">的栈帧的EBP</span>                │
</span></span><span style="display:flex;"><span>├───────────────────────┤
</span></span><span style="display:flex;"><span>│   <span style="color:#e06c75">main</span> <span style="color:#e06c75">的局部变量</span>                          │
</span></span><span style="display:flex;"><span>├───────────────────────┤
</span></span><span style="display:flex;"><span>│ → <span style="color:#e06c75">foo</span> <span style="color:#e06c75">的参数</span>                                 │
</span></span><span style="display:flex;"><span>├───────────────────────┤
</span></span><span style="display:flex;"><span>│ → <span style="color:#e06c75">foo</span> <span style="color:#e06c75">的返回地址</span> (<span style="color:#e06c75">ret</span> <span style="color:#e06c75">to</span> <span style="color:#e06c75">main</span>)     │ ← <span style="color:#e06c75">ESP</span>
</span></span><span style="display:flex;"><span>└───────────────────────┘
</span></span><span style="display:flex;"><span><span style="color:#e06c75">低地址</span>
</span></span></code></pre></div><h4 id="进入foo">进入foo
</h4><p>进入foo后，执行序言，为foo创建帧：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e06c75">push</span> <span style="color:#e06c75">ebp</span>         ; 保存 <span style="color:#e06c75">main</span> 的 <span style="color:#e06c75">EBP</span>
</span></span><span style="display:flex;"><span><span style="color:#e06c75">mov</span>  <span style="color:#e06c75">ebp</span>, <span style="color:#e06c75">esp</span>    ; 建立 <span style="color:#e06c75">foo</span> 的基址
</span></span><span style="display:flex;"><span><span style="color:#e06c75">sub</span>  <span style="color:#e06c75">esp</span>, <span style="color:#d19a66">4</span>      ; 为 <span style="color:#e06c75">foo</span> 的局部变量分配空间
</span></span></code></pre></div><p><strong><code>EBP</code>：当前栈帧的固定基址</strong></p>
<p><strong><code>[EBP]</code>：main的旧EBP</strong></p>
<p><strong><code>[EBP+4]</code>：返回地址（返回 main）</strong></p>
<p><strong><code>[EBP-4]</code>、<code>[EBP-8]</code>：foo的局部变量</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#e06c75">高地址</span>
</span></span><span style="display:flex;"><span>┌─────────────────────────────┐
</span></span><span style="display:flex;"><span>│   <span style="color:#e06c75">main</span> <span style="color:#e06c75">的参数</span>                                               │
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│   <span style="color:#e06c75">main</span> <span style="color:#e06c75">的返回地址</span>                                        │
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│   <span style="color:#e06c75">调用</span> <span style="color:#e06c75">main</span> <span style="color:#e06c75">的栈帧的EBP</span>                              │
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│   <span style="color:#e06c75">main</span> <span style="color:#e06c75">的局部变量</span>                                         │
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│   <span style="color:#e06c75">foo</span> <span style="color:#e06c75">的参数</span>                                                  │
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│   <span style="color:#e06c75">foo</span> <span style="color:#e06c75">的返回地址</span> (<span style="color:#e06c75">ret</span> <span style="color:#e06c75">to</span> <span style="color:#e06c75">main</span>)                      │
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│  → <span style="color:#e06c75">main</span> <span style="color:#e06c75">的</span> <span style="color:#e06c75">EBP</span>                                            │ ← <span style="color:#e06c75">EBP</span>
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│  → <span style="color:#e06c75">foo</span> <span style="color:#e06c75">的局部变量</span> (<span style="color:#d19a66">4</span><span style="color:#e06c75">字节</span>)                           │ ← <span style="color:#e06c75">ESP</span> <span style="color:#e06c75">指向这里</span>
</span></span><span style="display:flex;"><span>└─────────────────────────────┘
</span></span><span style="display:flex;"><span><span style="color:#e06c75">低地址</span>
</span></span></code></pre></div><p>之后执行：</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span> <span style="color:#e06c75">mov</span>  <span style="color:#e06c75">DWORD</span> <span style="color:#e06c75">PTR</span> [<span style="color:#e06c75">ebp</span><span style="color:#56b6c2">-</span><span style="color:#d19a66">4</span>], <span style="color:#d19a66">1</span>
</span></span></code></pre></div><p>给foo的局部变量空间写入值</p>
<h4 id="foo调用bar">foo调用bar
</h4><p>同样的流程</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#e06c75">高地址</span>
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">main</span> <span style="color:#e06c75">的</span> <span style="color:#56b6c2">..</span>.                                                    │
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">foo</span> <span style="color:#e06c75">的参数</span>                                                    │
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">foo</span> <span style="color:#e06c75">的返回地址</span> (<span style="color:#e06c75">ret</span> <span style="color:#e06c75">to</span> <span style="color:#e06c75">main</span>)                        │
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">main</span> <span style="color:#e06c75">的</span> <span style="color:#e06c75">EBP</span>                                                 │
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">foo</span> <span style="color:#e06c75">的局部变量</span> (<span style="color:#d19a66">4</span><span style="color:#e06c75">字节</span>)                                 │
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">bar</span> <span style="color:#e06c75">的参数</span>                                                    │
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">bar</span> <span style="color:#e06c75">的返回地址</span> (<span style="color:#e06c75">ret</span> <span style="color:#e06c75">to</span> <span style="color:#e06c75">foo</span>)                           │
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">foo</span> <span style="color:#e06c75">的</span> <span style="color:#e06c75">EBP</span>                                                   │  ← <span style="color:#e06c75">EBP</span>
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">bar</span> <span style="color:#e06c75">的局部变量</span> (<span style="color:#d19a66">4</span><span style="color:#e06c75">字节</span>)                                 │ ← <span style="color:#e06c75">ESP</span>
</span></span><span style="display:flex;"><span>└─────────────────────────────┘
</span></span><span style="display:flex;"><span><span style="color:#e06c75">低地址</span>
</span></span></code></pre></div><h4 id="返回过程">返回过程
</h4><p>首先bar执行<code>MOV ESP, EBP</code>，释放bar栈帧中存放了bar局部变量的地方</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#e06c75">高地址</span>
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">main</span> <span style="color:#e06c75">的</span> <span style="color:#56b6c2">..</span>.                                                    │
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">foo</span> <span style="color:#e06c75">的参数</span>                                                    │
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">foo</span> <span style="color:#e06c75">的返回地址</span> (<span style="color:#e06c75">ret</span> <span style="color:#e06c75">to</span> <span style="color:#e06c75">main</span>)                        │
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">main</span> <span style="color:#e06c75">的</span> <span style="color:#e06c75">EBP</span>                                                 │
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">foo</span> <span style="color:#e06c75">的局部变量</span> (<span style="color:#d19a66">4</span><span style="color:#e06c75">字节</span>)                                 │
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">bar</span> <span style="color:#e06c75">的参数</span>                                                    │
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">bar</span> <span style="color:#e06c75">的返回地址</span> (<span style="color:#e06c75">ret</span> <span style="color:#e06c75">to</span> <span style="color:#e06c75">foo</span>)                           │
</span></span><span style="display:flex;"><span>├─────────────────────────────┤ 
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">foo</span> <span style="color:#e06c75">的</span> <span style="color:#e06c75">EBP</span>                                                   │   ← <span style="color:#e06c75">EBP</span>  ← <span style="color:#e06c75">ESP</span> 
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">bar</span> <span style="color:#e06c75">的局部变量</span> (<span style="color:#d19a66">4</span><span style="color:#e06c75">字节</span>)                                 │ （<span style="color:#e06c75">被释放</span>）
</span></span><span style="display:flex;"><span>└─────────────────────────────┘
</span></span><span style="display:flex;"><span><span style="color:#e06c75">低地址</span>
</span></span></code></pre></div><p>然后执行<code>POP EBP</code>，将ESP指向的内容（foo的EBP）给EBP，然后释放这部分空间</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#e06c75">高地址</span>
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">main</span> <span style="color:#e06c75">的</span> <span style="color:#56b6c2">..</span>.                                                    │
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">foo</span> <span style="color:#e06c75">的参数</span>                                                    │
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">foo</span> <span style="color:#e06c75">的返回地址</span> (<span style="color:#e06c75">ret</span> <span style="color:#e06c75">to</span> <span style="color:#e06c75">main</span>)                        │
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">main</span> <span style="color:#e06c75">的</span> <span style="color:#e06c75">EBP</span>                                                 │ ← <span style="color:#e06c75">EBP</span>
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">foo</span> <span style="color:#e06c75">的局部变量</span> (<span style="color:#d19a66">4</span><span style="color:#e06c75">字节</span>)                                 │
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">bar</span> <span style="color:#e06c75">的参数</span>                                                    │
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">bar</span> <span style="color:#e06c75">的返回地址</span> (<span style="color:#e06c75">ret</span> <span style="color:#e06c75">to</span> <span style="color:#e06c75">foo</span>)                           │ ← <span style="color:#e06c75">ESP</span>
</span></span><span style="display:flex;"><span>├─────────────────────────────┤ 
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">foo</span> <span style="color:#e06c75">的</span> <span style="color:#e06c75">EBP</span>                                                   │ （<span style="color:#e06c75">被释放</span>）   
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">bar</span> <span style="color:#e06c75">的局部变量</span> (<span style="color:#d19a66">4</span><span style="color:#e06c75">字节</span>)                                 │ （<span style="color:#e06c75">被释放</span>）
</span></span><span style="display:flex;"><span>└─────────────────────────────┘
</span></span><span style="display:flex;"><span><span style="color:#e06c75">低地址</span>
</span></span></code></pre></div><p>最后执行<code>RET</code>，弹出返回地址，<code>EIP</code>跳转到foo的返回位置（main函数）</p>
<p>如果有参数则额外<code>RET N</code>释放参数空间</p>
<div class="highlight"><pre tabindex="0" style="color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-kotlin" data-lang="kotlin"><span style="display:flex;"><span><span style="color:#e06c75">高地址</span>
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">main</span> <span style="color:#e06c75">的</span> <span style="color:#56b6c2">..</span>.                                                    │
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">foo</span> <span style="color:#e06c75">的参数</span>                                                    │
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">foo</span> <span style="color:#e06c75">的返回地址</span> (<span style="color:#e06c75">ret</span> <span style="color:#e06c75">to</span> <span style="color:#e06c75">main</span>)                        │
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">main</span> <span style="color:#e06c75">的</span> <span style="color:#e06c75">EBP</span>                                                 │ ← <span style="color:#e06c75">EBP</span>
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">foo</span> <span style="color:#e06c75">的局部变量</span> (<span style="color:#d19a66">4</span><span style="color:#e06c75">字节</span>)                                 │ ← <span style="color:#e06c75">ESP</span>
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">bar</span> <span style="color:#e06c75">的参数</span>                                                    │（<span style="color:#e06c75">被释放</span>）
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">bar</span> <span style="color:#e06c75">的返回地址</span> (<span style="color:#e06c75">ret</span> <span style="color:#e06c75">to</span> <span style="color:#e06c75">foo</span>)                           │（<span style="color:#e06c75">被释放</span>）
</span></span><span style="display:flex;"><span>├─────────────────────────────┤ 
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">foo</span> <span style="color:#e06c75">的</span> <span style="color:#e06c75">EBP</span>                                                   │ （<span style="color:#e06c75">被释放</span>）   
</span></span><span style="display:flex;"><span>├─────────────────────────────┤
</span></span><span style="display:flex;"><span>│ <span style="color:#e06c75">bar</span> <span style="color:#e06c75">的局部变量</span> (<span style="color:#d19a66">4</span><span style="color:#e06c75">字节</span>)                                 │ （<span style="color:#e06c75">被释放</span>）
</span></span><span style="display:flex;"><span>└─────────────────────────────┘
</span></span><span style="display:flex;"><span><span style="color:#e06c75">低地址</span>
</span></span></code></pre></div><p>这样一来，bar的整个栈帧被销毁，ESP和EBP还原至foo栈帧</p>
<p>foo返回也是一样</p>
<p>下图关于参数划分的栈帧位置有些不同，不过也能辅助理解嵌套调用：</p>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" data-caption="函数调用实现过程详解（栈空间解析）_函数调用栈过程-CSDN博客" href="http://picture.928330.xyz/typora/f44cf3dc1d84b6bc6cd299fb572340a6.gif">
<img src="http://picture.928330.xyz/typora/f44cf3dc1d84b6bc6cd299fb572340a6.gif" alt="函数调用实现过程详解（栈空间解析）_函数调用栈过程-CSDN博客"  />
</a>
</div>
</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/re/">Re</a>
        
    </section>


    <section class="article-lastmod">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <span>
            最后更新于 2025-10-13
        </span>
    </section></footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">相关文章</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/%E9%80%86%E5%90%91%E5%9F%BA%E7%A1%804pe%E6%96%87%E4%BB%B6/">
        
        
            <div class="article-image">
                
                    <img src="http://picture.928330.xyz/typora/d9dc6363235d1bc4e4bf2e1debb14e39.jpg" loading="lazy" data-key="" data-hash="http://picture.928330.xyz/typora/d9dc6363235d1bc4e4bf2e1debb14e39.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">逆向基础4：PE文件</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/%E9%80%86%E5%90%91%E5%9F%BA%E7%A1%803elf%E6%96%87%E4%BB%B6/">
        
        
            <div class="article-image">
                
                    <img src="http://picture.928330.xyz/typora/16e7b03d07acb9525b5cade30292739c.jpg" loading="lazy" data-key="" data-hash="http://picture.928330.xyz/typora/16e7b03d07acb9525b5cade30292739c.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">逆向基础3：ELF文件</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/%E9%80%86%E5%90%91%E5%9F%BA%E7%A1%802%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6%E6%A6%82%E8%BF%B0/">
        
        
            <div class="article-image">
                
                    <img src="http://picture.928330.xyz/typora/fd5a5ff7fbfb389c2ea3c8f72e2c9e69.png" loading="lazy" data-key="" data-hash="http://picture.928330.xyz/typora/fd5a5ff7fbfb389c2ea3c8f72e2c9e69.png"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">逆向基础2：可执行文件概述</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/raid%E4%B8%8E%E5%AE%83%E7%9A%84%E9%87%8D%E7%BB%84/">
        
        
            <div class="article-image">
                
                    <img src="http://picture.928330.xyz/typora/56ab540a33f6eab79937c1187dd72855.jpg" loading="lazy" data-key="" data-hash="http://picture.928330.xyz/typora/56ab540a33f6eab79937c1187dd72855.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">RAID与它的重组</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/linux%E5%91%BD%E4%BB%A4%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E4%B8%8E%E6%9F%A5%E7%9C%8B%E7%AF%87/">
        
        
            <div class="article-image">
                
                    <img src="http://picture.928330.xyz/typora/fcc033dfd187d8eb0d29169a672d75ce.jpg" loading="lazy" data-key="" data-hash="http://picture.928330.xyz/typora/fcc033dfd187d8eb0d29169a672d75ce.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Linux命令（文件写入与查看篇）</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src='//unpkg.com/@waline/client@v2/dist/waline.js'></script>
<link href='//unpkg.com/@waline/client@v2/dist/waline.css' rel='stylesheet'/>
<div id="waline" class="waline-container"></div>
<style>
    .waline-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
        --waline-font-size: var(--article-font-size);
    }
    .waline-container .wl-count {
        color: var(--card-text-color-main);
    }
</style><script>
    
    Waline.init({"dark":"html[data-scheme=\"dark\"]","el":"#waline","emoji":["https://npm.elemecdn.com/@waline/emojis@1.1.0/bilibili","https://npm.elemecdn.com/@waline/emojis@1.1.0/bmoji","https://npm.elemecdn.com/@waline/emojis@1.1.0/weibo"],"lang":"zh-cn","locale":{"admin":"Admin","placeholder":null},"pageview":true,"placeholder":"欢迎评论，不好的评论我会删🙄💅🏻","requiredMeta":["name","email","url"],"serverURL":"https://comment.928330.xyz/"});
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 2025 - 2025 kakahuote | 引用请注明文章链接
    </section>

    <section class="running-time">
        距离小站第一行代码被置下已经过去
        <span id="runningdays" class="running-days"></span>    
    </section>  

    <section class="powerby">
        使用 <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> 构建 <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计 <br />

        
        <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
        <script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
        

        <span>...当然还有kakahuote🤓👆</span>
    </section>
</footer>

    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >
    
    <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>
<style>
   
   
   
  @font-face {
   font-family: 'yuan';
   src: url('https://blog.928330.xyz/font/round.ttf') format('truetype');
  }

   
   
   
  :root {
   --base-font-family: 'yuan';
   --code-font-family: 'yuan';
  }

   
   
   
   
   
  #backTopBtn {
   position: fixed;
   bottom: 30px;
   right: 450px;
   z-index: 99;
   cursor: pointer;
   width: 32px;
   height: 32px;
   background-image: url('/icons/backTop.svg');
   background-size: cover;
   background-color: rgba(255, 255, 255, 0.9);
   border-radius: 50%;
   box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
   transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
   transform-origin: center center;
    
   animation: gentleFloat 3s ease-in-out infinite;
    
   overflow: visible;
  }

   
  [data-scheme="dark"] #backTopBtn {
   background-image: url('/icons/backTop-dark.svg') !important;
   background-color: rgba(0, 0, 0, 0.8) !important;
   box-shadow: 0 4px 20px rgba(255, 255, 255, 0.1) !important;
  }

   
  @media (prefers-color-scheme: dark) {
    #backTopBtn {
      background-image: url('/icons/backTop-dark.svg') !important;
      background-color: rgba(0, 0, 0, 0.8) !important;
      box-shadow: 0 4px 20px rgba(255, 255, 255, 0.1) !important;
    }
    
    .button-ripple {
      background-image: url('/icons/backTop-dark.svg') !important;
       
    }
  }

   
  html[data-scheme="dark"] #backTopBtn,
  body[data-scheme="dark"] #backTopBtn,
  .dark #backTopBtn,
  .dark-mode #backTopBtn {
    background-image: url('/icons/backTop-dark.svg') !important;
    background-color: rgba(0, 0, 0, 0.8) !important;
    box-shadow: 0 4px 20px rgba(255, 255, 255, 0.1) !important;
  }

  html[data-scheme="dark"] .button-ripple,
  body[data-scheme="dark"] .button-ripple,
  .dark .button-ripple,
  .dark-mode .button-ripple {
    background-image: url('/icons/backTop-dark.svg') !important;
     
  }

   
  [data-scheme="dark"] #backTopBtn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 10px solid #ffffff;
    transform: translate(-50%, -50%);
    z-index: 1;
     
    display: var(--show-css-arrow, none);
  }

   
  #backTopBtn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 10px solid #000000;
    transform: translate(-50%, -50%);
    z-index: 1;
     
    display: var(--show-css-arrow, none);
  }

   
  @keyframes gentleFloat {
   0%, 100% { transform: translateY(0px); }
   50% { transform: translateY(-6px); }
  }

   
  .button-ripple {
   position: absolute;
   top: 0;
   left: 0;
   width: 32px;
   height: 32px;
   border-radius: 50%;
   background-image: url('/icons/backTop.svg');
   background-size: cover;
   background-repeat: no-repeat;
   background-position: center;
   pointer-events: none;
   z-index: -1;
   animation: buttonRippleExpand 2.5s linear infinite;
   transform-origin: center center;
    
   will-change: transform, opacity;
   backface-visibility: hidden;
   perspective: 1000px;
   contain: layout style;
    
   transform: translateZ(0);
    
   transition: animation-duration 0.3s ease;
    
   --show-css-arrow: none !important;
    
   opacity: var(--ripple-opacity, 0.8) !important;
  }

   
  [data-scheme="dark"] .button-ripple {
   background-image: url('/icons/backTop-dark.svg') !important;
    
    
   --show-css-arrow: none !important;
  }

   
  @media (prefers-color-scheme: dark) {
    .button-ripple {
      background-image: url('/icons/backTop-dark.svg') !important;
       
       
      --show-css-arrow: none !important;
    }
  }

   
  .button-ripple.hover-mode {
   animation-duration: 1s;
  }

  @keyframes buttonRippleExpand {
   0% {
     --ripple-opacity: 0.8;
     transform: scale(1);
   }
   2% {
     --ripple-opacity: 0.78;
     transform: scale(1.02);
   }
   4% {
     --ripple-opacity: 0.76;
     transform: scale(1.04);
   }
   6% {
     --ripple-opacity: 0.74;
     transform: scale(1.06);
   }
   8% {
     --ripple-opacity: 0.72;
     transform: scale(1.08);
   }
   10% {
     --ripple-opacity: 0.7;
     transform: scale(1.1);
   }
   12% {
     --ripple-opacity: 0.68;
     transform: scale(1.12);
   }
   14% {
     --ripple-opacity: 0.66;
     transform: scale(1.14);
   }
   16% {
     --ripple-opacity: 0.64;
     transform: scale(1.16);
   }
   18% {
     --ripple-opacity: 0.62;
     transform: scale(1.18);
   }
   20% {
     --ripple-opacity: 0.6;
     transform: scale(1.2);
   }
   22% {
     --ripple-opacity: 0.58;
     transform: scale(1.22);
   }
   24% {
     --ripple-opacity: 0.56;
     transform: scale(1.24);
   }
   26% {
     --ripple-opacity: 0.54;
     transform: scale(1.26);
   }
   28% {
     --ripple-opacity: 0.52;
     transform: scale(1.28);
   }
   30% {
     --ripple-opacity: 0.5;
     transform: scale(1.3);
   }
   32% {
     --ripple-opacity: 0.48;
     transform: scale(1.32);
   }
   34% {
     --ripple-opacity: 0.46;
     transform: scale(1.34);
   }
   36% {
     --ripple-opacity: 0.44;
     transform: scale(1.36);
   }
   38% {
     --ripple-opacity: 0.42;
     transform: scale(1.38);
   }
   40% {
     --ripple-opacity: 0.4;
     transform: scale(1.4);
   }
   42% {
     --ripple-opacity: 0.38;
     transform: scale(1.42);
   }
   44% {
     --ripple-opacity: 0.36;
     transform: scale(1.44);
   }
   46% {
     --ripple-opacity: 0.34;
     transform: scale(1.46);
   }
   48% {
     --ripple-opacity: 0.32;
     transform: scale(1.48);
   }
   50% {
     --ripple-opacity: 0.3;
     transform: scale(1.5);
   }
   52% {
     --ripple-opacity: 0.28;
     transform: scale(1.52);
   }
   54% {
     --ripple-opacity: 0.26;
     transform: scale(1.54);
   }
   56% {
     --ripple-opacity: 0.24;
     transform: scale(1.56);
   }
   58% {
     --ripple-opacity: 0.22;
     transform: scale(1.58);
   }
   60% {
     --ripple-opacity: 0.2;
     transform: scale(1.6);
   }
   62% {
     --ripple-opacity: 0.18;
     transform: scale(1.62);
   }
   64% {
     --ripple-opacity: 0.16;
     transform: scale(1.64);
   }
   66% {
     --ripple-opacity: 0.14;
     transform: scale(1.66);
   }
   68% {
     --ripple-opacity: 0.12;
     transform: scale(1.68);
   }
   70% {
     --ripple-opacity: 0.1;
     transform: scale(1.7);
   }
   72% {
     --ripple-opacity: 0.08;
     transform: scale(1.72);
   }
   74% {
     --ripple-opacity: 0.07;
     transform: scale(1.74);
   }
   76% {
     --ripple-opacity: 0.06;
     transform: scale(1.76);
   }
   78% {
     --ripple-opacity: 0.05;
     transform: scale(1.78);
   }
   80% {
     --ripple-opacity: 0.04;
     transform: scale(1.8);
   }
   82% {
     --ripple-opacity: 0.035;
     transform: scale(1.82);
   }
   84% {
     --ripple-opacity: 0.03;
     transform: scale(1.84);
   }
   86% {
     --ripple-opacity: 0.025;
     transform: scale(1.86);
   }
   88% {
     --ripple-opacity: 0.02;
     transform: scale(1.88);
   }
   90% {
     --ripple-opacity: 0.015;
     transform: scale(1.9);
   }
   92% {
     --ripple-opacity: 0.01;
     transform: scale(1.92);
   }
   94% {
     --ripple-opacity: 0.008;
     transform: scale(1.94);
   }
   96% {
     --ripple-opacity: 0.005;
     transform: scale(1.96);
   }
   98% {
     --ripple-opacity: 0.002;
     transform: scale(1.98);
   }
   100% {
     --ripple-opacity: 0;
     transform: scale(2.0);
   }
  }

   
  .button-tooltip {
   position: absolute;
   bottom: 45px;
   right: 450px;
   background: rgba(0, 0, 0, 0.8);
   color: white;
   padding: 8px 12px;
   border-radius: 6px;
   font-size: 12px;
   white-space: nowrap;
   opacity: 0;
   transform: translateY(10px);
   transition: all 0.3s ease;
   pointer-events: none;
   z-index: 100;
  }

  .button-tooltip.show {
   opacity: 1;
   transform: translateY(0);
  }

  .button-tooltip::after {
   content: '';
   position: absolute;
   top: 100%;
   left: 50%;
   transform: translateX(-50%);
   border: 5px solid transparent;
   border-top-color: rgba(0, 0, 0, 0.8);
  }

   
  .hover-ripple-effect {
   display: none;
  }

   
  #backTopBtn:hover {
   transform: translateY(-8px) scale(1.1);
   box-shadow: 0 8px 30px rgba(0, 0, 0, 0.25);
   background-color: rgba(255, 255, 255, 1);
  }

   
  #backTopBtn.sprinting {
   animation: energyBurst 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
  }

  @keyframes energyBurst {
   0% {
     transform: scale(1) rotate(0deg);
     opacity: 1;
     filter: brightness(1) hue-rotate(0deg);
     box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
   }
   15% {
     transform: scale(1.2) rotate(0deg);
     opacity: 1;
     filter: brightness(1.2) hue-rotate(0deg);
     box-shadow: 0 0 25px rgba(255, 215, 0, 0.8), 0 0 50px rgba(255, 107, 107, 0.6);
   }
   30% {
     transform: scale(1.4) rotate(0deg);
     opacity: 1;
     filter: brightness(1.4) hue-rotate(60deg);
     box-shadow: 0 0 35px rgba(255, 182, 193, 0.8), 0 0 70px rgba(255, 215, 0, 0.6);
   }
   45% {
     transform: scale(1.6) rotate(0deg);
     opacity: 1;
     filter: brightness(1.6) hue-rotate(120deg);
     box-shadow: 0 0 45px rgba(173, 216, 230, 0.8), 0 0 90px rgba(255, 182, 193, 0.6);
   }
   60% {
     transform: scale(1.4) rotate(0deg);
     opacity: 1;
     filter: brightness(1.4) hue-rotate(180deg);
     box-shadow: 0 0 35px rgba(144, 238, 144, 0.8), 0 0 70px rgba(173, 216, 230, 0.6);
   }
   75% {
     transform: scale(1.2) rotate(0deg);
     opacity: 1;
     filter: brightness(1.2) hue-rotate(240deg);
     box-shadow: 0 0 25px rgba(255, 215, 0, 0.8), 0 0 50px rgba(144, 238, 144, 0.6);
   }
   90% {
     transform: scale(1.05) rotate(0deg);
     opacity: 1;
     filter: brightness(1.05) hue-rotate(300deg);
     box-shadow: 0 0 15px rgba(255, 107, 107, 0.6), 0 0 30px rgba(255, 215, 0, 0.4);
   }
   100% {
     transform: scale(1) rotate(0deg);
     opacity: 1;
     filter: brightness(1) hue-rotate(360deg);
     box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
   }
  }

   
  #backTopBtn.reappearing {
   animation: reappear 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
  }

   
  #backTopBtn.exploding {
   animation: explosionTransition 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
    
   z-index: 1000;
  }

   
  #backTopBtn.exploding .button-ripple {
   opacity: 0;
   animation-play-state: paused;
  }

  @keyframes explosionTransition {
   0% {
     transform: scale(1.6) rotate(0deg);
     opacity: 1;
     filter: brightness(1.6) hue-rotate(0deg);
     box-shadow: 0 0 50px rgba(255, 215, 0, 0.8), 0 0 100px rgba(255, 107, 107, 0.6);
   }
   30% {
     transform: scale(1.4) rotate(5deg);
     opacity: 1;
     filter: brightness(1.4) hue-rotate(120deg);
     box-shadow: 0 0 40px rgba(255, 182, 193, 0.8), 0 0 80px rgba(255, 215, 0, 0.6);
   }

   100% {
     transform: scale(1) rotate(0deg);
     opacity: 1;
     filter: brightness(1) hue-rotate(360deg);
     box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
   }
  }

  @keyframes reappear {
   0% {
     transform: scale(0.85);
     opacity: 0.7;
   }
   50% {
     transform: scale(1.05);
     opacity: 1;
   }
   100% {
     transform: scale(1);
     opacity: 1;
   }
  }

  #backTopBtn.rotating {
   animation: rotate360 0.6s ease-in-out;
  }

  @keyframes rotate360 {
   0% { transform: rotate(0deg); }
   100% { transform: rotate(360deg); }
  }

   
  .particle {
   position: absolute;
   top: 50%;
   left: 50%;
   width: 4px;
   height: 4px;
   background: radial-gradient(circle, #fff, #ffd700, #ff69b4, #87ceeb);
   border-radius: 50%;
   pointer-events: none;
   z-index: -2;
   animation: particleExplode 1s ease-out forwards;
  }

  @keyframes particleExplode {
   0% {
     transform: translate(-50%, -50%) scale(0);
     opacity: 1;
   }
   50% {
     opacity: 1;
   }
   100% {
     transform: translate(-50%, -50%) scale(1) translate(var(--x), var(--y));
     opacity: 0;
   }
  }

   
  .energy-wave {
   position: absolute;
   top: 50%;
   left: 50%;
   width: 0;
   height: 0;
   border: 2px solid transparent;
   border-radius: 50%;
   pointer-events: none;
   z-index: -3;
   animation: energyWave 1.2s ease-out forwards;
  }

  @keyframes energyWave {
   0% {
     width: 0;
     height: 0;
     border-color: rgba(255, 215, 0, 0.8);
     opacity: 1;
   }
   100% {
     width: 120px;
     height: 120px;
     border-color: rgba(255, 215, 0, 0);
     opacity: 0;
   }
  }

   
  .hero-aura {
   position: absolute;
   top: 50%;
   left: 50%;
   width: 100%;
   height: 100%;
   border-radius: 50%;
   background: conic-gradient(from 0deg, #ffd700, #ff69b4, #87ceeb, #98fb98, #ffa07a, #ffd700);
   background-size: 200% 200%;
   pointer-events: none;
   z-index: -4;
   animation: heroAura 2s linear infinite;
   opacity: 0;
   transition: opacity 0.3s ease;
  }

  #backTopBtn.sprinting .hero-aura {
   opacity: 0.6;
  }

  @keyframes heroAura {
   0% {
     background-position: 0% 0%;
     transform: translate(-50%, -50%) rotate(0deg);
   }
   100% {
     background-position: 100% 100%;
     transform: translate(-50%, -50%) rotate(360deg);
   }
  }

   
      @media (max-width: 768px) {
     #backTopBtn {
       left: 20px !important;  
       right: auto !important;
       bottom: 20px;
       width: 28px;
       height: 28px;
     }
     
     .button-tooltip {
       left: 20px !important;  
       right: auto !important;
       bottom: 35px;
     }
    }
  
    @media (max-width: 480px) {
     #backTopBtn {
       left: 15px !important;  
       right: auto !important;
       bottom: 15px;
       width: 26px;
       height: 26px;
     }
     
     .button-tooltip {
       left: 15px !important;
       right: auto !important;
       bottom: 31px;
     }
    }

   
   
   
  .no-text-selection {
    -webkit-user-select: none;  
    -moz-user-select: none;     
    -ms-user-select: none;      
    user-select: none;          
  }

   
   
   
  #rope-container {
    position: fixed;
    top: 0;
    left: 20px;
    z-index: 10000;
    width: 50px;
    height: 480px;
    pointer-events: none;
  }
  
   
  #rope-physics-container {
    pointer-events: auto !important;
  }
  
   
  #rope-svg-container svg {
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
  }
  
  #rope-svg-container path {
    transition: all 0.1s ease-out;
  }
  
   
  #rope-svg-container path,
  #rope-path {
    stroke: #4b2b0f !important;
    stroke-width: 2.5 !important;
  }
  
   
  #rope-svg-container svg path {
    stroke: #4b2b0f !important;
    stroke-width: 2.5 !important;
  }
  


  #rope {
    position: absolute;
    top: -80px;
    left: 50%;
    width: 3px;
    height: 400px;
    background: linear-gradient(to bottom, #654321, #8B4513, #A0522D, #8B4513, #654321);
    border-radius: 1.5px;
    transform: translateX(-50%);
    pointer-events: auto;
    transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    box-shadow: 0 1px 3px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.1);
  }

  #pull-ring {
    position: absolute;
    top: 300px;
    left: 50%;
    font-size: 20px;
    color: #ffffff;
    text-shadow: 0 0 8px rgba(255, 255, 255, 0.8);
    transform: translateX(-50%);
    pointer-events: auto;
    transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
  }

  #rope:hover {
    box-shadow: 0 2px 6px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.2);
  }

  #pull-ring:hover {
    transform: translateX(-50%) scale(1.2);
    text-shadow: 0 0 12px rgba(255, 255, 255, 1);
    filter: drop-shadow(0 4px 8px rgba(0,0,0,0.5));
  }

   
   
   
  .highlight {
   max-height: 400px;
   overflow: hidden;
   position: relative;
   transition: max-height 0.3s ease-out;
  }

  .code-show {
   max-height: none !important;
  }

  .code-more-box {
   width: 100%;
   padding-top: 20px;
   background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0), #fff);
   position: absolute;
   left: 0;
   right: 0;
   bottom: 0;
   z-index: 1;
   text-align: center;
  }

  .code-more-btn {
   display: inline-block;
   padding: 5px 15px;
   background: #f0f0f5;
   border-radius: 5px;
   cursor: pointer;
   font-size: 0.9em;
  }

   
   
   
  #particles-js {
   position: fixed;
   top: 0;
   left: 0;
    width: 100vw;
    height: 100vh;
   z-index: -1;
    pointer-events: none;
  }
  
  #particles-js canvas {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
  }

   
   
   
  .toc-lock-btn {
    position: absolute;
    top: 32px;
    right: 5px;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border-radius: 50%;
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    background: rgba(0, 0, 0, 0.05);
    color: rgba(0, 0, 0, 0.7);
    z-index: 100;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }
  
  .toc-lock-btn:hover {
    background: rgba(0, 0, 0, 0.1);
    transform: scale(1.1);
    border-color: rgba(0, 0, 0, 0.2);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
  }
  
  .toc-lock-btn:active {
    transform: scale(0.95);
  }
  
   
  .toc-lock-btn:focus {
    outline: none;
    border-color: rgba(0, 0, 0, 0.4);
    box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1), 0 2px 8px rgba(0, 0, 0, 0.1);
    background: rgba(0, 0, 0, 0.08);
  }
  
  .toc-lock-btn:focus-visible {
    outline: none;
    border-color: rgba(0, 0, 0, 0.4);
    box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1), 0 2px 8px rgba(0, 0, 0, 0.1);
    background: rgba(0, 0, 0, 0.08);
  }
  
  .toc-lock-btn.locked {
    color: rgba(0, 0, 0, 0.9);
    background: rgba(0, 0, 0, 0.1);
    border-color: rgba(0, 0, 0, 0.3);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  }
  
  .toc-lock-btn.locked:hover {
    background: rgba(0, 0, 0, 0.15);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.25);
  }
  
  .toc-lock-btn.locked .lock-icon.locked {
    display: block;
  }
  
  .toc-lock-btn.locked .lock-icon.unlocked {
    display: none;
  }
  
  .toc-lock-btn .lock-icon.locked {
    display: none;
  }
  
  .toc-lock-btn .lock-icon.unlocked {
    display: block;
  }
  
  .toc-lock-btn .lock-icon {
    width: 14px;
    height: 14px;
    stroke: currentColor;
    fill: none;
    stroke-width: 2.5;
    stroke-linecap: round;
    stroke-linejoin: round;
    transition: all 0.3s ease;
  }
  
   
  .toc-lock-label {
    position: absolute;
    top: 38px;
    right: 28px;
    font-size: 16px;
    color: rgba(0, 0, 0, 0.6);
    font-weight: 700;
    z-index: 100;
    user-select: none;
    pointer-events: none;
    line-height: 1;
    display: flex;
    align-items: center;
  }

   
  [data-scheme="dark"] .toc-lock-btn {
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.7);
  }
  
  [data-scheme="dark"] .toc-lock-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
    box-shadow: 0 4px 16px rgba(255, 255, 255, 0.15);
  }
  
   
  [data-scheme="dark"] .toc-lock-btn:focus,
  [data-scheme="dark"] .toc-lock-btn:focus-visible {
    outline: none;
    border-color: rgba(255, 255, 255, 0.4);
    box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1), 0 2px 8px rgba(255, 255, 255, 0.1);
    background: rgba(255, 255, 255, 0.08);
  }
  
  [data-scheme="dark"] .toc-lock-btn.locked {
    color: rgba(255, 255, 255, 0.9);
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.3);
    box-shadow: 0 2px 8px rgba(255, 255, 255, 0.2);
  }
  
  [data-scheme="dark"] .toc-lock-btn.locked:hover {
    background: rgba(255, 255, 255, 0.15);
    box-shadow: 0 4px 16px rgba(255, 255, 255, 0.25);
  }
  
   
  [data-scheme="dark"] .toc-lock-label {
    color: rgba(255, 255, 255, 0.6);
  }

   
  #TableOfContents[data-scrollspy-disabled="true"] {
    opacity: 0.8 !important;
  }
  
  #TableOfContents[data-scrollspy-disabled="true"] .active-class {
     
    display: block !important;
    opacity: 1 !important;
  }
  
  #TableOfContents[data-scrollspy-disabled="true"] a {
    cursor: pointer !important;
  }
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

<script>
   
   
   

  let s1 = '2025-5-8 15:00:00'; 
  s1 = new Date(s1.replace(/-/g, "/"));
  let s2 = new Date();
  let timeDifference = s2.getTime() - s1.getTime();

  let days = Math.floor(timeDifference / (1000 * 60 * 60 * 24));
  let hours = Math.floor((timeDifference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  let minutes = Math.floor((timeDifference % (1000 * 60 * 60)) / (1000 * 60));

  let result = days + "天" + hours + "小时" + minutes + "分钟";
  if (document.getElementById('runningdays')) {
      document.getElementById('runningdays').innerHTML = result;
  }
  
   
   
   
  
  

  function startContinuousRipple(button) {
   
   const buttonRipple = document.createElement('div');
   buttonRipple.className = 'button-ripple';
   button.appendChild(buttonRipple);
   
   
   button.buttonRipple = buttonRipple;
  }
  
  

  function createContinuousRipple(button) {
   
   if (button.querySelector('.continuous-ripple')) {
     return;
   }
   
   
   const rippleContainer = document.createElement('div');
   rippleContainer.className = 'ripple-container continuous-ripple';
   
   
   const ripple = document.createElement('div');
   ripple.className = 'ripple';
   ripple.style.background = 'radial-gradient(circle, rgba(255, 107, 107, 0.8) 0%, rgba(255, 255, 255, 0.9) 100%)';
   
   rippleContainer.appendChild(ripple);
   button.appendChild(rippleContainer);
   
   
   setTimeout(() => {
     if (rippleContainer.parentNode) {
       rippleContainer.parentNode.removeChild(rippleContainer);
     }
   }, 800);
  }
  
  

  function createHoverRipple(button) {
   
   if (button.buttonRipple) {
     
     button.buttonRipple.style.animationDuration = '1s';
     button.buttonRipple.classList.add('hover-mode');
   }
  }
  
  

  function showTooltip(button) {
   
   hideTooltip();
   
   
   const tooltip = document.createElement('div');
   tooltip.className = 'button-tooltip';
   tooltip.textContent = '返回顶部';
   document.body.appendChild(tooltip);
   
   
   setTimeout(() => {
     tooltip.classList.add('show');
   }, 10);
   
   
   button.tooltip = tooltip;
  }
  
  

  function hideTooltip() {
   const existingTooltip = document.querySelector('.button-tooltip');
   if (existingTooltip) {
     existingTooltip.classList.remove('show');
     setTimeout(() => {
       if (existingTooltip.parentNode) {
         existingTooltip.parentNode.removeChild(existingTooltip);
       }
     }, 300);
   }
  }
  
  

  function createRippleEffect(button) {
   
   
   
   const energyWave = document.createElement('div');
   energyWave.className = 'energy-wave';
   document.body.appendChild(energyWave);
   
   
   createParticleExplosion(button);
   
   
   setTimeout(() => {
     if (energyWave.parentNode) {
       energyWave.parentNode.removeChild(energyWave);
     }
   }, 1200);
  }

  

  function createParticleExplosion(button) {
   const particleCount = 16; 
   
   
   const particleColors = [
     'radial-gradient(circle, #ff6b6b, #ffd93d, #6bcf7f, #4d96ff)',
     'radial-gradient(circle, #ff8e8e, #ffed4e, #7ddb8f, #6ba6ff)',
     'radial-gradient(circle, #ffa1a1, #fff15f, #8ee79f, #89b6ff)',
     'radial-gradient(circle, #ffb4b4, #fff570, #9ff3af, #a7c6ff)'
   ];
   
   for (let i = 0; i < particleCount; i++) {
     const particle = document.createElement('div');
     particle.className = 'particle';
     
     
     const randomColor = particleColors[Math.floor(Math.random() * particleColors.length)];
     particle.style.background = randomColor;
     
     
     const angle = (i / particleCount) * 2 * Math.PI;
     const distance = 40 + Math.random() * 30; 
     const x = Math.cos(angle) * distance;
     const y = Math.sin(angle) * distance;
     
     particle.style.setProperty('--x', `${x}px`);
     particle.style.setProperty('--y', `${y}px`);
     
     
     particle.style.animationDelay = `${Math.random() * 0.4}s`;
     
     button.appendChild(particle);
     
     
     setTimeout(() => {
       if (particle.parentNode) {
         particle.parentNode.removeChild(particle);
       }
     }, 1000);
   }
  }

   
   
   
  

  function initScrollTop() {
   let rightSideBar = document.querySelector(".right-sidebar");
   if (!rightSideBar) {
    return;
   }

   
   let btn = document.createElement("div");
   btn.id = "backTopBtn";
   let isRotating = false; 

   
   const heroAura = document.createElement('div');
   heroAura.className = 'hero-aura';
   btn.appendChild(heroAura);

   
   btn.addEventListener('mouseenter', function() {
     createHoverRipple(this);
     showTooltip(this);
   });
   
   
   btn.addEventListener('mouseleave', function() {
     if (this.buttonRipple) {
       
       this.buttonRipple.style.animationDuration = '2s';
       this.buttonRipple.classList.remove('hover-mode');
     }
     hideTooltip();
   });

   btn.onclick = function() {
    if (!isRotating) {
     isRotating = true;
     backToTop(this, () => {
      isRotating = false; 
     });
    }
   };
   rightSideBar.appendChild(btn);

   
   btn.style.display = "block";
   
   
   startContinuousRipple(btn);
  }

  

  function backToTop(button, onComplete) {
   
   button.classList.add('sprinting');
   
   
   if (button.buttonRipple) {
     button.buttonRipple.style.display = 'none';
   }
   
   
   createRippleEffect(button);
   
   
   window.scrollTo({ top: 0, behavior: "smooth" });
   
   
   const checkScrollComplete = () => {
     if (window.scrollY === 0) {
       
       button.classList.remove('sprinting');
       
       
       button.classList.add('exploding');
       
       
       createParticleExplosion(button);
       
       
       if (button.buttonRipple) {
         button.buttonRipple.style.display = 'block';
       }
       
       
       setTimeout(() => {
         button.classList.remove('exploding');
         
         
         if (button.buttonRipple) {
           
           button.buttonRipple.style.animationPlayState = 'paused';
           
           button.buttonRipple.style.animation = 'none';
           button.buttonRipple.offsetHeight; 
           button.buttonRipple.style.animation = 'buttonRippleExpand 2s steps(25, end) infinite';
           button.buttonRipple.style.animationPlayState = 'running';
         }
         
         button.classList.add('reappearing');
         
         
         setTimeout(() => {
           button.classList.remove('reappearing');
           if (onComplete) {
             onComplete();
           }
         }, 600);
       }, 800); 
       
       return;
     }
     requestAnimationFrame(checkScrollComplete);
   };
   
   checkScrollComplete();
  }

  
  initScrollTop();
  
   
   
   
  

  function initRope() {


    if (typeof Matter === 'undefined') {
      console.error('Matter.js 库未加载，无法初始化物理绳索。');
      return;
    }
    if (document.getElementById('rope-physics-container')) {

      return;
    }

    let ropeContainer = document.getElementById('rope-container');
    if (!ropeContainer) {
      console.error('#rope-container 元素未在 HTML 或 CSS 中找到。');
      return;
    }
    
    ropeContainer.innerHTML = '';
    ropeContainer.style.height = '100vh';
    ropeContainer.style.pointerEvents = 'none';

    const monthlyEmojis = [
      { month: 1, name: "一月", ring: "❄️", falling: "❄️", description: "寒冬腊月，雪花飞舞" },
      { month: 2, name: "二月", ring: "🏮", falling: "🏮", description: "新春正月，灯笼高挂" },
      { month: 3, name: "三月", ring: "🌸", falling: "🌸", description: "春暖花开，樱花绽放" },
      { month: 4, name: "四月", ring: "🌧️", falling: "🌧️", description: "清明时节，春雨绵绵" },
      { month: 5, name: "五月", ring: "🌺", falling: "🌺", description: "立夏时节，牡丹盛开" },
      { month: 6, name: "六月", ring: "🌻", falling: "🌻", description: "芒种时节，向日葵开" },
      { month: 7, name: "七月", ring: "🌿", falling: "🌿", description: "小暑时节，绿意盎然" },
      { month: 8, name: "八月", ring: "🍉", falling: "🍉", description: "七夕时节，西瓜清甜" },
      { month: 9, name: "九月", ring: "🍁", falling: "🍁", description: "白露时节，秋葉飘落" },
      { month: 10, name: "十月", ring: "🍂", falling: "🍂", description: "寒露时节，落叶纷飞" },
      { month: 11, name: "十一月", ring: "🍊", falling: "🍊", description: "霜降时节，柑橘飘香" },
      { month: 12, name: "十二月", ring: "🌨️", falling: "🌨️", description: "大雪时节，雪花纷飞" }
    ];
    window.timeEmojis = [
      { period: "morning", name: "早晨", emojis: ["☀️", "🌤️", "🌱", "🌺", "🌿"], description: "晨曦初露，万物苏醒" },
      { period: "noon", name: "中午", emojis: ["🌞", "🌻", "🦋", "🦜", "🐝"], description: "烈日当空，生机勃勃" },
      { period: "evening", name: "傍晚", emojis: ["🌙", "⭐", "🦉"], description: "夕阳西下，夜幕降临" }
    ];
    const currentMonth = new Date().getMonth() + 1;
    const currentEmoji = monthlyEmojis.find(emoji => emoji.month === currentMonth);
    
    const ropeContainerLeft = 20;
    const ropeContainerWidth = 50;
    const ropeAnchorX = ropeContainerLeft + (ropeContainerWidth / 2);

    const { Engine, World, Bodies, Composite, Constraint, Runner, Mouse, MouseConstraint, Events, Body } = Matter;

    const engine = Engine.create();
    const world = engine.world;
    
    
    
    
    engine.world.gravity.y = 0;

    
    
    
    const ropeSegments = 80; 
    const segmentRadius = 1.5; 
    const segmentRenderHeight = 6; 
    const segmentRenderWidth = 4; 
    const constraintLength = 2.5; 

    const ropeGroup = Matter.Body.nextGroup(true);
    const ropeChain = Composite.create({ label: 'Rope' });

    
    for (let i = 0; i < ropeSegments - 1; i++) {
      const segment = Bodies.circle(ropeAnchorX, i * constraintLength, segmentRadius, {
          collisionFilter: { group: ropeGroup },
          density: 0.1, 
          friction: 0.4, 
          frictionAir: 0.08, 
          restitution: 0.02 
      });
      Composite.add(ropeChain, segment);
    }

    
    const pullRingBody = Bodies.circle(
      ropeAnchorX,
      (ropeSegments - 1) * constraintLength,
      15,
      {
        collisionFilter: { group: ropeGroup },
        density: 0.01, 
        friction: 0.5,  
        frictionAir: 0.1, 
        restitution: 0.02 
      }
    );
    Composite.add(ropeChain, pullRingBody);
    World.add(world, ropeChain);

    
    Composite.addConstraint(ropeChain, Constraint.create({
      bodyB: ropeChain.bodies[0],
      pointA: { x: ropeAnchorX, y: 0 },
      stiffness: 1 
    }));

    for (let i = 0; i < ropeSegments - 1; i++) {
      Composite.addConstraint(ropeChain, Constraint.create({
        bodyA: ropeChain.bodies[i],
        bodyB: ropeChain.bodies[i + 1],
        
        
        
        stiffness: 0.8, 
        damping: 0.8,   
        length: constraintLength * 0.6, 
        
        render: {
          visible: false
        }
      }));
    }
    
    const domContainer = document.createElement('div');
    domContainer.id = 'rope-physics-container';
    domContainer.style.position = 'fixed';
    domContainer.style.top = '0';
    domContainer.style.left = '0';
    domContainer.style.pointerEvents = 'auto'; 
    domContainer.style.zIndex = '10000';
    document.body.appendChild(domContainer);

    
    const svgContainer = document.createElement('div');
    svgContainer.id = 'rope-svg-container';
    svgContainer.style.cssText = `
      position: absolute;
      top: 0;
      left: 0;
      width: 100px;
      height: 100vh;
      pointer-events: none;
      z-index: 1;
      overflow: visible;
    `;
    domContainer.appendChild(svgContainer);
    
    
    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    svg.setAttribute('width', '100');
    svg.setAttribute('height', '100vh');
    svg.setAttribute('viewBox', '0 0 100 100vh');
    svg.style.cssText = `
      position: absolute;
      top: 0;
      left: 0;
      width: 100px;
      height: 100vh;
      overflow: visible;
    `;
    svgContainer.appendChild(svg);
    
    
    const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
    const gradient = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
    gradient.setAttribute('id', 'ropeGradient');
    gradient.setAttribute('x1', '0%');
    gradient.setAttribute('y1', '0%');
    gradient.setAttribute('x2', '0%');
    gradient.setAttribute('y2', '100%');
    
    const stop1 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    stop1.setAttribute('offset', '0%');
    stop1.setAttribute('stop-color', '#654321');
    
    const stop2 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    stop2.setAttribute('offset', '25%');
    stop2.setAttribute('stop-color', '#8B4513');
    
    const stop3 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    stop3.setAttribute('offset', '50%');
    stop3.setAttribute('stop-color', '#A0522D');
    
    const stop4 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    stop4.setAttribute('offset', '75%');
    stop4.setAttribute('stop-color', '#8B4513');
    
    const stop5 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    stop5.setAttribute('offset', '100%');
    stop5.setAttribute('stop-color', '#654321');
    
    gradient.appendChild(stop1);
    gradient.appendChild(stop2);
    gradient.appendChild(stop3);
    gradient.appendChild(stop4);
    gradient.appendChild(stop5);
    defs.appendChild(gradient);
    svg.appendChild(defs);
    
    
    const ropePath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    ropePath.setAttribute('fill', 'none');
    
    ropePath.setAttribute('stroke', '#4b2b0f');
    ropePath.setAttribute('stroke-width', '2.5');
    ropePath.setAttribute('stroke-linecap', 'round');
    ropePath.setAttribute('stroke-linejoin', 'round');
    ropePath.setAttribute('id', 'rope-path'); 
    svg.appendChild(ropePath);
    
    
    ropePath.setAttribute('d', `M 50 0 L 50 400`);
    
    
    
    
    
    const pullRingDiv = document.createElement('div');
    pullRingDiv.id = 'pull-ring-physics';
    pullRingDiv.innerHTML = currentEmoji.ring;
    pullRingDiv.title = `${currentEmoji.name}: ${currentEmoji.description}`;
    pullRingDiv.style.cssText = `
      font-size: 24px; cursor: grab; pointer-events: auto;
      width: 30px; height: 30px; text-align: center;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); position: absolute;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      z-index: 2;
      transform: translate(40px, 300px); /* 初始位置，向右移动5px */
    `;
    
    
    pullRingDiv.addEventListener('mousedown', () => {
      pullRingDiv.style.cursor = 'grabbing';
    });
    
    pullRingDiv.addEventListener('mouseup', () => {
      pullRingDiv.style.cursor = 'grab';
    });
    
    domContainer.appendChild(pullRingDiv);
    
    
    const ropeElements = {
      svg: svg,
      path: ropePath,
      pullRing: pullRingDiv
    };

    const mouse = Mouse.create(document.body);
    const mouseConstraint = MouseConstraint.create(engine, {
      mouse: mouse,
      constraint: { 
        stiffness: 0.8, 
        render: { visible: false },
        
        length: 0,
        damping: 0.05 
      }
    });
    World.add(world, mouseConstraint);
    
    
    mouseConstraint.constraint.bodyB = null;
    
    
    Events.on(mouseConstraint, 'mousedown', (event) => {

    });
    
    
    mouseConstraint.mouse.element = document.body;
    
    
    let dragStartPosition = null;
    
    Events.on(mouseConstraint, 'startdrag', () => {
      document.body.classList.add('no-text-selection');
      
      
      if (mouseConstraint.body && mouseConstraint.body === pullRingBody) {
        dragStartPosition = {
          x: mouseConstraint.body.position.x,
          y: mouseConstraint.body.position.y
        };
      }
    });
    
    Events.on(mouseConstraint, 'enddrag', () => {
      document.body.classList.remove('no-text-selection');
      
      
      
      if (dragStartPosition) {
        
        const currentPosition = pullRingBody.position;
        const dragDistance = Math.sqrt(
          Math.pow(currentPosition.x - dragStartPosition.x, 2) +
          Math.pow(currentPosition.y - dragStartPosition.y, 2)
        );
        
        
        if (dragDistance > 1) {
          createSeasonalFalling(currentEmoji);
          
          
          Matter.Body.applyForce(pullRingBody, pullRingBody.position, { x: 0, y: 0.5 });
          
          
          const targetX = ropeAnchorX;
          const targetY = (ropeSegments - 1) * constraintLength;
          
          
          const dx = targetX - currentPosition.x;
          const dy = targetY - currentPosition.y;
          
          
          Matter.Body.applyForce(pullRingBody, pullRingBody.position, { 
            x: dx * 0.001, 
            y: dy * 0.001 
          });
          
        }
        
        
        dragStartPosition = null;
      }
    });
    


    
    (function render() {
      
      let pathData = '';
      
      
      const topPoint = { x: 50, y: 0 }; 
      pathData += `M ${topPoint.x} ${topPoint.y}`;
      
      
      ropeChain.bodies.forEach((body, index) => {
        if (index < ropeSegments - 1) { 
          const relativeX = body.position.x - ropeAnchorX + 50; 
          const relativeY = body.position.y;
          pathData += ` L ${relativeX} ${relativeY}`;
        }
      });
      
      
      const pullRingBody = ropeChain.bodies[ropeSegments - 1];
      if (pullRingBody) {
        const relativeX = pullRingBody.position.x - ropeAnchorX + 50; 
        const relativeY = pullRingBody.position.y;
        pathData += ` L ${relativeX} ${relativeY}`;
      }
      
      
      ropeElements.path.setAttribute('d', pathData);
      
      
      if (pullRingBody) {
        
        
        const adjustedX = pullRingBody.position.x - 15 + 3.5; 
        const adjustedY = pullRingBody.position.y - 15;
        
        ropeElements.pullRing.style.transform = `translate(
          ${adjustedX}px,
          ${adjustedY}px
        )`;
        

      }
      
      setTimeout(() => requestAnimationFrame(render), 1000 / 240); 
    })();
    
    
    
    const runner = Runner.create();
    
    runner.delta = 1000 / 240; 
    Runner.run(runner, engine);

    
    
    
    setTimeout(() => {
      engine.world.gravity.y = 1.2;
    }, 100); 

    
    
    
    
    
    ropeChain.bodies.forEach((body, index) => {
      Matter.Body.set(body, 'sleeping', false);
      
      body.sleepThreshold = Infinity;
    });
    
    
    engine.enableSleeping = false;
    
    
    mouseConstraint.constraint.bodyB = null;
    mouseConstraint.mouse.element = document.body;


  }

  

  function createSeasonalFalling(emojiConfig) {

   
   
   const fallingContainer = document.createElement('div');
   fallingContainer.id = 'falling-container';
   fallingContainer.style.cssText = `
     position: fixed;
     top: 0;
     left: 0;
     width: 100vw;
     height: 100vh;
     pointer-events: none;
     z-index: 9999;
     overflow: hidden;
   `;
   document.body.appendChild(fallingContainer);

   
   
   const currentHour = new Date().getHours();
   let currentTimePeriod;
   if (currentHour >= 5 && currentHour < 11) {
    currentTimePeriod = window.timeEmojis.find(t => t.period === "morning");
   } else if (currentHour >= 11 && currentHour < 17) {
    currentTimePeriod = window.timeEmojis.find(t => t.period === "noon");
   } else {
    currentTimePeriod = window.timeEmojis.find(t => t.period === "evening");
   }
   

   
   
   const totalElements = emojiConfig.month >= 11 || emojiConfig.month <= 2 ? 30 : 25; 
   let activeElements = 0;
   

   
   for (let i = 0; i < totalElements; i++) {
    setTimeout(() => {
     const element = document.createElement('div');
     
     
     let selectedEmoji, emojiType;
     if (Math.random() < 0.7) {
      selectedEmoji = emojiConfig.falling;
      emojiType = "monthly";
     } else {
      
      selectedEmoji = currentTimePeriod.emojis[Math.floor(Math.random() * currentTimePeriod.emojis.length)];
      emojiType = "time";
     }
     

     element.innerHTML = selectedEmoji;
     
     
     let fontSize, color, textShadow;
     if (emojiType === "time") {
      
      if (currentTimePeriod.period === "morning") {
       
       fontSize = Math.random() * 18 + 16;
       color = '#FFD700';
       textShadow = '0 0 5px rgba(255, 215, 0, 0.7)';
      } else if (currentTimePeriod.period === "noon") {
       
       fontSize = Math.random() * 18 + 16;
       color = '#FF8C00';
       textShadow = '0 0 5px rgba(255, 140, 0, 0.7)';
      } else {
       
       fontSize = Math.random() * 18 + 16;
       color = '#4B0082';
       textShadow = '0 0 5px rgba(75, 0, 130, 0.7)';
      }
     } else {
      
      if (emojiConfig.month >= 11 || emojiConfig.month <= 2) {
       
       fontSize = Math.random() * 20 + 15;
       color = 'white';
       textShadow = '0 0 5px rgba(255, 255, 255, 0.8)';
      } else if (emojiConfig.month >= 3 && emojiConfig.month <= 5) {
       
       fontSize = Math.random() * 18 + 16;
       color = '#FF69B4';
       textShadow = '0 0 5px rgba(255, 105, 180, 0.6)';
      } else if (emojiConfig.month >= 6 && emojiConfig.month <= 8) {
       
       fontSize = Math.random() * 18 + 15;
       color = '#32CD32';
       textShadow = '0 0 5px rgba(50, 205, 50, 0.6)';
      } else {
       
       fontSize = Math.random() * 18 + 15;
       color = '#FF8C00';
       textShadow = '0 0 5px rgba(255, 140, 0, 0.6)';
      }
     }
     
     element.style.cssText = `
       position: absolute;
       font-size: ${fontSize}px;
       color: ${color};
       text-shadow: ${textShadow};
       left: ${Math.random() * window.innerWidth}px;
       top: -50px;
       user-select: none;
       pointer-events: none;
       z-index: 9999;
       transition: all 0.3s ease;
     `;
     
     fallingContainer.appendChild(element);
     activeElements++;
     
     
     const duration = 4000 + Math.random() * 2000;
     const endX = parseFloat(element.style.left) + (Math.random() - 0.5) * 400;
     const endY = window.innerHeight + 50;
     
     element.style.transition = `all ${duration}ms linear`;
     
     setTimeout(() => {
      element.style.left = endX + 'px';
      element.style.top = endY + 'px';
      element.style.opacity = '0';
     }, 50);
     
     
     setTimeout(() => {
      if (element.parentNode) {
       element.parentNode.removeChild(element);
      }
      activeElements--;
      
      
      if (activeElements === 0) {
       if (fallingContainer && fallingContainer.parentNode) {
        fallingContainer.parentNode.removeChild(fallingContainer);
       }
      }
     }, duration);
    }, i * 150);
   }
  }

   
   
   
  function initCodeMoreBox() {
   let codeBlocks = document.querySelectorAll(".highlight");
   if (!codeBlocks) {
    return;
   }
   codeBlocks.forEach(codeBlock => {
    
    if (codeBlock.scrollHeight <= codeBlock.clientHeight) {
     return;
    }
    
    
    let codeMoreBox = document.createElement('div');
    codeMoreBox.classList.add('code-more-box');
    
    let codeMoreBtn = document.createElement('span');
    codeMoreBtn.classList.add('code-more-btn');
    codeMoreBtn.innerText = '显示更多'; 
    let isExpanded = false; 

    codeMoreBtn.addEventListener('click', () => {
     if (!isExpanded) {
      codeBlock.classList.add('code-show'); 
      codeMoreBtn.innerText = '折叠'; 
      isExpanded = true;
     } else {
      codeBlock.classList.remove('code-show'); 
      codeMoreBtn.innerText = '显示更多'; 
      isExpanded = false;
     }
     
     window.dispatchEvent(new Event('resize'));
    });
    
    codeMoreBox.appendChild(codeMoreBtn);
    codeBlock.appendChild(codeMoreBox);
   });
  }


  
   
   
   
  
  

  function captureScrollListeners() {
    
    setTimeout(() => {
      
      overrideScrollspy();
    }, 2000);
  }
  
  

  function overrideScrollspy() {
    
    window.tocScrollspyEnabled = true;
    
    
    setTimeout(() => {
      
      
      
      
      if (!window.originalScrollTo) {
        window.originalScrollTo = HTMLElement.prototype.scrollTo;
        
        HTMLElement.prototype.scrollTo = function(options) {
          
          if (this.id === 'TableOfContents' && window.tocScrollDisabled) {
            return;
          }
          
          
          return window.originalScrollTo.call(this, options);
        };
      }
      
      
      if (!window.originalScrollIntoView) {
        window.originalScrollIntoView = HTMLElement.prototype.scrollIntoView;
        
        HTMLElement.prototype.scrollIntoView = function(options) {
          
          if (this.closest('#TableOfContents') && window.tocScrollDisabled) {
            return;
          }
          
          
          return window.originalScrollIntoView.call(this, options);
        };
      }
    }, 3000); 
  }
  
  function initTocLock() {
    
    
    const articleToc = document.querySelector('#TableOfContents');
    if (!articleToc) {
      
      return;
    }
    
    
    const tocContainer = document.querySelector('.widget.archives');
    if (!tocContainer) {
      return;
    }
    
    
    tocContainer.style.position = 'relative';
    
    
    captureScrollListeners();
    
    
    const lockLabel = document.createElement('div');
    lockLabel.className = 'toc-lock-label';
    lockLabel.textContent = '锁定：';
    
    
    const lockBtn = document.createElement('div');
    lockBtn.className = 'toc-lock-btn';
    lockBtn.innerHTML = `
      <svg class="lock-icon unlocked" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 11H5a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2z"/>
        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
      </svg>
      <svg class="lock-icon locked" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="11" width="18" height="10" rx="2" ry="2"/>
        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
        <path d="M9 12v3a3 3 0 0 0 6 0v-3"/>
      </svg>
    `;
    
    
    lockBtn.addEventListener('click', function() {
      const isLocked = this.classList.contains('locked');
      
      if (isLocked) {
        
        this.classList.remove('locked');
        localStorage.setItem('tocLocked', 'false');
        enableTocScroll();
      } else {
        
        this.classList.add('locked');
        localStorage.setItem('tocLocked', 'true');
        disableTocScroll();
      }
    });
    
    
    tocContainer.appendChild(lockLabel);
    tocContainer.appendChild(lockBtn);
    
    
    
    lockBtn.classList.remove('locked');
    localStorage.setItem('tocLocked', 'false');
    
    
    const observer = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
          const isLocked = lockBtn.classList.contains('locked');
          if (isLocked) {
            disableTocScroll();
          } else {
            enableTocScroll();
          }
        }
      });
    });
    
    observer.observe(lockBtn, { attributes: true });
  }

  

  function disableTocScroll() {
    
    window.tocScrollDisabled = true;
    
    
    const tocContainer = document.querySelector('#TableOfContents');
    if (tocContainer) {
      
      window.savedTocScrollTop = tocContainer.scrollTop;
      
      
      const currentActive = tocContainer.querySelector('.active-class');
      if (currentActive) {
        window.savedActiveElement = currentActive;
      }
    }
    
    
    if (tocContainer) {
      tocContainer.setAttribute('data-scrollspy-disabled', 'true');
      tocContainer.title = '目录已锁定，不会自动跟随滚动';
    }
    
    
    const archivesContainer = document.querySelector('.widget.archives');
    if (archivesContainer) {
      archivesContainer.style.opacity = '0.8';
      archivesContainer.title = '目录已锁定，不会自动跟随滚动';
    }
  }

  

  function enableTocScroll() {
    
    window.tocScrollDisabled = false;
    
    
    const tocContainer = document.querySelector('#TableOfContents');
    if (tocContainer) {
      
      tocContainer.removeAttribute('data-scrollspy-disabled');
      tocContainer.title = '';
    }
    
    
    const archivesContainer = document.querySelector('.widget.archives');
    if (archivesContainer) {
      archivesContainer.style.opacity = '1';
      archivesContainer.title = '';
    }
  }

  
  
  
  document.addEventListener('DOMContentLoaded', function() {
  

    
    initCodeMoreBox();
    initRope();

    
    setTimeout(initTocLock, 1000);
  });

</script>


<div id="rope-container"></div>


<div id="particles-js"></div>

<script>

particlesJS('particles-js', {
  "particles": {
    "number": {
      "value": 80,
      "density": {
        "enable": true,
        "value_area": 800
      }
    },
    "color": {
      "value": ["#888888", "#aaaaaa", "#cccccc", "#eeeeee"]
    },
    "shape": {
      "type": "circle",
      "stroke": {
        "width": 0,
        "color": "#000000"
      },
      "polygon": {
        "nb_sides": 5
      }
    },
    "opacity": {
      "value": 0.5,
      "random": false,
      "anim": {
        "enable": false,
        "speed": 1,
        "opacity_min": 0.1,
        "sync": false
      }
    },
    "size": {
      "value": 2,
      "random": true,
      "anim": {
        "enable": false,
        "speed": 40,
        "size_min": 0.1,
        "sync": false
      }
    },
    "line_linked": {
      "enable": true,
      "distance": 150,
      "color": "#888888",
      "opacity": 0.4,
      "width": 1
    },
    "move": {
      "enable": true,
      "speed": 2,
      "direction": "none",
      "random": false,
      "straight": false,
      "out_mode": "out",
      "bounce": false,
      "attract": {
        "enable": false,
        "rotateX": 600,
        "rotateY": 1200
      }
    }
  },
  "interactivity": {
    "detect_on": "canvas",
    "events": {
      "onhover": {
        "enable": true,
        "mode": "grab"
      },
      "onclick": {
        "enable": true,
        "mode": "push"
      },
      "resize": true
    },
    "modes": {
      "grab": {
        "distance": 140,
        "line_linked": {
          "opacity": 1
        }
      },
      "bubble": {
        "distance": 400,
        "size": 40,
        "duration": 2,
        "opacity": 8,
        "speed": 3
      },
      "repulse": {
        "distance": 200,
        "duration": 0.4
      },
      "push": {
        "particles_nb": 4
      },
      "remove": {
        "particles_nb": 2
      }
    }
  },
  "retina_detect": true
});
</script>


<script>
(function() {
  'use strict';
  
  
  const categoryColors = [
    '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57',
    '#ff9ff3', '#54a0ff', '#5f27cd', '#00d2d3', '#ff9f43',
    '#10ac84', '#ff6348', '#a55eea', '#e17055', '#d63031',
    '#00b894', '#fdcb6e', '#6c5ce7', '#fd79a8', '#f39c12',
    '#e67e22', '#e74c3c', '#9b59b6', '#3498db', '#1abc9c',
    '#16a085', '#27ae60', '#2ecc71', '#f1c40f', '#e67e22'
  ];
  
  
  function hashString(str) {
    let hash = 0;
    if (str.length === 0) return hash;
    
    for (let i = 0; i < str.length; i++) {
      const char = str.charCodeAt(i);
      hash = ((hash << 5) - hash) + char;
      hash = hash & hash; 
    }
    
    return Math.abs(hash);
  }
  
  
  function assignCategoryColors() {

    
    
    const isArchivesPage = document.body.classList.contains('template-archives') ||
                          window.location.pathname.includes('/archives/');
    const isArticlePage = document.querySelector('#TableOfContents') || 
                         document.querySelector('.article-category');
    
    
    
    
    if (isArticlePage && !isArchivesPage) {
      const categoryLinks = document.querySelectorAll('.article-category a');

      
      categoryLinks.forEach((link, index) => {
        
        const href = link.getAttribute('href');
        const categoryName = href.split('/').pop() || href.split('/').slice(-2, -1)[0] || 'default';
        
        
        const hash = hashString(categoryName);
        const colorIndex = hash % categoryColors.length;
        const backgroundColor = categoryColors[colorIndex];
        
        
        
        
        link.style.setProperty('background-color', backgroundColor, 'important');
        link.style.setProperty('color', '#fff', 'important');
        
        
        link.addEventListener('mouseenter', function() {
          this.style.opacity = '0.8';
          this.style.transform = 'scale(1.05)';
        });
        
        link.addEventListener('mouseleave', function() {
          this.style.opacity = '1';
          this.style.transform = 'scale(1)';
        });
      });
    }
    
    
    if (!isArchivesPage) {
      
      const sidebarCategories = document.querySelectorAll('.widget.categories a, .widget.tagCloud a');

      
      sidebarCategories.forEach((link, index) => {
        
        const href = link.getAttribute('href');
        const categoryName = href.split('/').pop() || href.split('/').slice(-2, -1)[0] || 'default';
        
        
        const hash = hashString(categoryName);
        const colorIndex = hash % categoryColors.length;
        const backgroundColor = categoryColors[colorIndex];
        
        
        
        
        link.style.setProperty('background-color', backgroundColor, 'important');
        link.style.setProperty('color', '#fff', 'important');
        link.style.setProperty('border-radius', '6px', 'important');
        link.style.setProperty('padding', '8px 12px', 'important');
        link.style.setProperty('margin', '4px 0', 'important');
        link.style.setProperty('display', 'inline-block', 'important');
        link.style.setProperty('text-decoration', 'none', 'important');
        link.style.setProperty('transition', 'all 0.3s ease', 'important');
        
        
        link.addEventListener('mouseenter', function() {
          this.style.opacity = '0.8';
          this.style.transform = 'scale(1.05)';
          this.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.2)';
        });
        
        link.addEventListener('mouseleave', function() {
          this.style.opacity = '1';
          this.style.transform = 'scale(1)';
          this.style.boxShadow = 'none';
        });
      });
    } else {
      

    }
    

  }
  
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', assignCategoryColors);
  } else {
    assignCategoryColors();
  }
  
  
  setTimeout(assignCategoryColors, 500);
  setTimeout(assignCategoryColors, 1000);
  setTimeout(assignCategoryColors, 2000);
  
  
  const observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
        
        const hasNewCategories = Array.from(mutation.addedNodes).some(node => {
          return node.nodeType === 1 && (
            node.classList.contains('article-category') ||
            node.querySelector('.article-category') ||
            node.classList.contains('widget') ||
            node.querySelector('.widget')
          );
        });
        
        if (hasNewCategories) {
          
          setTimeout(assignCategoryColors, 100);
          setTimeout(assignCategoryColors, 500);
        }
      }
    });
  });
  
  
  observer.observe(document.body, {
    childList: true,
    subtree: true
  });
})();
</script>


<script>
(function() {
  'use strict';
  
  
  function fixDarkModeToggleText() {
    const toggleBtn = document.getElementById('dark-mode-toggle');
    if (!toggleBtn) {
      return;
    }
    
    
    toggleBtn.classList.add('dark-mode-toggle-fix');
    
    
    const span = toggleBtn.querySelector('span');
    if (!span) {
      return;
    }
    
    
    function updateText() {
      const isDark = document.documentElement.dataset.scheme === 'dark';
      span.textContent = isDark ? '亮色模式' : '暗色模式';

    }
    
    
    updateText();
    
    
    function handleThemeChange() {
      setTimeout(updateText, 100); 
    }
    
    
    window.addEventListener('onColorSchemeChange', handleThemeChange);
    
    
    const observer = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'data-scheme') {
          handleThemeChange();
        }
      });
    });
    
    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['data-scheme']
    });
    
    
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', handleThemeChange);
    
    
    toggleBtn.addEventListener('click', function() {
      
      setTimeout(updateText, 200);
    });
    

  }
  
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', fixDarkModeToggleText);
  } else {
    fixDarkModeToggleText();
  }
  
  
  setTimeout(fixDarkModeToggleText, 1000);
  setTimeout(fixDarkModeToggleText, 2000);
})();
</script>

  
  <script>
  
  if (!document.getElementById('new-theme-switch')) {
    document.write(`
      <div id="new-theme-switch" style="position: fixed; bottom: 50px; left: 50px; z-index: 1000; text-align: center;">
        <label class="theme-switch">
          <input type="checkbox" class="theme-switch__checkbox" id="theme-switch-checkbox">
          <div class="theme-switch__container">
            <div class="theme-switch__clouds"></div>
            <div class="theme-switch__stars-container">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 144 55" fill="none">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M135.831 3.00688C135.055 3.85027 134.111 4.29946 133 4.35447C134.111 4.40947 135.055 4.85867 135.831 5.71123C136.607 6.55462 136.996 7.56303 136.996 8.72727C136.996 7.95722 137.172 7.25134 137.525 6.59129C137.886 5.93124 138.372 5.39954 138.98 5.00535C139.598 4.60199 140.268 4.39114 141 4.35447C139.88 4.2903 138.936 3.85027 138.16 3.00688C137.384 2.16348 136.996 1.16425 136.996 0C136.996 1.16425 136.607 2.16348 135.831 3.00688ZM31 23.3545C32.1114 23.2995 33.0551 22.8503 33.8313 22.0069C34.6075 21.1635 34.9956 20.1642 34.9956 19C34.9956 20.1642 35.3837 21.1635 36.1599 22.0069C36.9361 22.8503 37.8798 23.2903 39 23.3545C38.2679 23.3911 37.5976 23.602 36.9802 24.0053C36.3716 24.3995 35.8864 24.9312 35.5248 25.5913C35.172 26.2513 34.9956 26.9572 34.9956 27.7273C34.9956 26.563 34.6075 25.5546 33.8313 24.7112C33.0551 23.8587 32.1114 23.4095 31 23.3545ZM0 36.3545C1.11136 36.2995 2.05513 35.8503 2.83131 35.0069C3.6075 34.1635 3.99559 33.1642 3.99559 32C3.99559 33.1642 4.38368 34.1635 5.15987 35.0069C5.93605 35.8503 6.87982 36.2903 8 36.3545C7.26792 36.3911 6.59757 36.602 5.98015 37.0053C5.37155 37.3995 4.88644 37.9312 4.52481 38.5913C4.172 39.2513 3.99559 39.9572 3.99559 40.7273C3.99559 39.563 4.38368 38.5546 2.83131 37.7112C2.05513 36.8587 1.11136 36.4095 0 36.3545ZM56.8313 24.0069C56.0551 24.8503 55.1114 25.2995 54 25.3545C55.1114 25.4095 56.0551 25.8587 56.8313 26.7112C57.6075 27.5546 57.9956 28.563 57.9956 29.7273C57.9956 28.9572 58.172 28.2513 58.5248 27.5913C58.8864 26.9312 59.3716 26.3995 59.9802 26.0053C60.5976 25.602 61.2679 25.3911 62 25.3545C60.8798 25.2903 59.9361 24.8503 59.1599 24.0069C58.3837 23.1635 57.9956 22.1642 57.9956 21C57.9956 22.1642 57.6075 23.1635 56.8313 24.0069ZM81 25.3545C82.1114 25.2995 83.0551 24.8503 83.8313 24.0069C84.6075 23.1635 84.9956 22.1642 84.9956 21C84.9956 22.1642 85.3837 23.1635 86.1599 24.0069C86.9361 24.8503 87.8798 25.2903 89 25.3545C88.2679 25.3911 87.5976 25.602 86.9802 26.0053C86.3716 26.3995 85.8864 26.9312 85.5248 27.5913C85.172 28.2513 84.9956 28.9572 84.9956 29.7273C84.9956 28.563 84.6075 27.5546 83.8313 26.7112C83.0551 25.8587 82.1114 25.4095 81 25.3545ZM136 36.3545C137.111 36.2995 138.055 35.8503 138.831 35.0069C139.607 34.1635 139.996 33.1642 139.996 32C139.996 33.1642 140.384 34.1635 141.16 35.0069C141.936 35.8503 142.88 36.2903 144 36.3545C143.268 36.3911 142.598 36.602 141.98 37.0053C141.372 37.3995 140.886 37.9312 140.525 38.5913C140.172 39.2513 139.996 39.9572 139.996 40.7273C139.996 39.563 139.607 38.5546 138.831 37.7112C138.055 36.8587 137.111 36.4095 136 36.3545ZM101.831 49.0069C101.055 49.8503 100.111 50.2995 99 50.3545C100.111 50.4095 101.055 50.8587 101.831 51.7112C102.607 52.5546 102.996 53.563 102.996 54.7273C102.996 53.9572 103.172 53.2513 103.525 52.5913C103.886 51.9312 104.372 51.3995 104.98 51.0053C105.598 50.602 106.268 50.3911 107 50.3545C105.88 50.2903 104.936 49.8503 104.16 49.0069C103.384 48.1635 102.996 47.1642 102.996 46C102.996 47.1642 102.607 48.1635 101.831 49.0069Z" fill="currentColor"></path>
              </svg>
            </div>
            <div class="theme-switch__circle-container">
              <div class="theme-switch__sun-moon-container">
                <div class="theme-switch__moon">
                  <div class="theme-switch__spot"></div>
                  <div class="theme-switch__spot"></div>
                  <div class="theme-switch__spot"></div>
                </div>
              </div>
            </div>
          </div>
        </label>
        <div id="theme-switch-text" style="color: #fff; font-size: 14px; font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,0.5); margin-top: 8px; text-align: center;">亮色模式</div>
      </div>
    `);
  }
  </script>


<style>
   
  .theme-switch {
    --toggle-size: 20px;  
    --container-width: 3.75em;
    --container-height: 1.7em;
    --container-radius: 4.2em;
    --container-light-bg: #3D7EAE;
    --container-night-bg: #1D1F2C;
    --circle-container-diameter: 2.25em;
    --sun-moon-diameter: 1.4em;
    --sun-bg: #ECCA2F;
    --moon-bg: #C4C9D1;
    --spot-color: #959DB1;
    --circle-container-offset: calc((var(--circle-container-diameter) - var(--container-height)) / 2 * -1);
    --stars-color: #fff;
    --clouds-color: #F3FDFF;
    --back-clouds-color: #AACADF;
    --transition: .5s cubic-bezier(0, -0.02, 0.4, 1.25);
    --circle-transition: .3s cubic-bezier(0, -0.02, 0.35, 1.17);
  }

  .theme-switch, .theme-switch *, .theme-switch *::before, .theme-switch *::after {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-size: var(--toggle-size);
  }

  .theme-switch__container {
    width: var(--container-width);
    height: var(--container-height);
    background-color: var(--container-light-bg);
    border-radius: var(--container-radius);
    overflow: hidden;
    cursor: pointer;
    -webkit-box-shadow: 0em -0.062em 0.062em rgba(0, 0, 0, 0.25), 0em 0.062em 0.125em rgba(255, 255, 255, 0.94);
    box-shadow: 0em -0.062em 0.062em rgba(0, 0, 0, 0.25), 0em 0.062em 0.125em rgba(255, 255, 255, 0.94);
    -webkit-transition: var(--transition);
    -o-transition: var(--transition);
    transition: var(--transition);
    position: relative;
  }

  .theme-switch__container::before {
    content: "";
    position: absolute;
    z-index: 1;
    inset: 0;
    -webkit-box-shadow: 0em 0.05em 0.187em rgba(0, 0, 0, 0.25) inset, 0em 0.05em 0.187em rgba(0, 0, 0, 0.25) inset;
    box-shadow: 0em 0.05em 0.187em rgba(0, 0, 0, 0.25) inset, 0em 0.05em 0.187em rgba(0, 0, 0, 0.25) inset;
    border-radius: var(--container-radius)
  }

  .theme-switch__checkbox {
    display: none;
  }

  .theme-switch__circle-container {
    width: var(--circle-container-diameter);
    height: var(--circle-container-diameter);
    background-color: rgba(255, 255, 255, 0.1);
    position: absolute;
    left: var(--circle-container-offset);
    top: var(--circle-container-offset);
    border-radius: var(--container-radius);
    -webkit-box-shadow: inset 0 0 0 3.375em rgba(255, 255, 255, 0.1), inset 0 0 0 3.375em rgba(255, 255, 255, 0.1), 0 0 0 0.625em rgba(255, 255, 255, 0.1), 0 0 0 1.25em rgba(255, 255, 255, 0.1);
    box-shadow: inset 0 0 0 3.375em rgba(255, 255, 255, 0.1), inset 0 0 0 3.375em rgba(255, 255, 255, 0.1), 0 0 0 0.625em rgba(255, 255, 255, 0.1), 0 0 0 1.25em rgba(255, 255, 255, 0.1);
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-transition: var(--circle-transition);
    -o-transition: var(--circle-transition);
    transition: var(--circle-transition);
    pointer-events: none;
  }

  .theme-switch__sun-moon-container {
    pointer-events: auto;
    position: relative;
    z-index: 2;
    width: var(--sun-moon-diameter);
    height: var(--sun-moon-diameter);
    margin: auto;
    border-radius: var(--container-radius);
    background-color: var(--sun-bg);
    -webkit-box-shadow: 0.062em 0.062em 0.062em 0em rgba(254, 255, 239, 0.61) inset, 0em -0.062em 0.062em 0em #a1872a inset;
    box-shadow: 0.062em 0.062em 0.062em 0em rgba(254, 255, 239, 0.61) inset, 0em -0.062em 0.062em 0em #a1872a inset;
    -webkit-filter: drop-shadow(0.062em 0.125em 0.125em rgba(0, 0, 0, 0.25)) drop-shadow(0em 0.062em 0.125em rgba(0, 0, 0, 0.25));
    filter: drop-shadow(0.062em 0.125em 0.125em rgba(0, 0, 0, 0.25)) drop-shadow(0em 0.062em 0.125em rgba(0, 0, 0, 0.25));
    overflow: hidden;
    -webkit-transition: var(--transition);
    -o-transition: var(--transition);
    transition: var(--transition);
  }

  .theme-switch__moon {
    -webkit-transform: translateX(100%);
    -ms-transform: translateX(100%);
    transform: translateX(100%);
    width: 100%;
    height: 100%;
    background-color: var(--moon-bg);
    border-radius: inherit;
    -webkit-box-shadow: 0.062em 0.062em 0.062em 0em rgba(254, 255, 239, 0.61) inset, 0em -0.062em 0.062em 0em #969696 inset;
    box-shadow: 0.062em 0.062em 0.062em 0em rgba(254, 255, 239, 0.61) inset, 0em -0.062em 0.062em 0em #969696 inset;
    -webkit-transition: var(--transition);
    -o-transition: var(--transition);
    transition: var(--transition);
    position: relative;
  }

  .theme-switch__spot {
    position: absolute;
    top: 0.75em;
    left: 0.312em;
    width: 0.75em;
    height: 0.75em;
    border-radius: var(--container-radius);
    background-color: var(--spot-color);
    -webkit-box-shadow: 0em 0.0312em 0.062em rgba(0, 0, 0, 0.25) inset;
    box-shadow: 0em 0.0312em 0.062em rgba(0, 0, 0, 0.25) inset;
  }

  .theme-switch__spot:nth-of-type(2) {
    width: 0.375em;
    height: 0.375em;
    top: 0.937em;
    left: 1.375em;
  }

  .theme-switch__spot:nth-last-of-type(3) {
    width: 0.25em;
    height: 0.25em;
    top: 0.312em;
    left: 0.812em;
  }

  .theme-switch__clouds {
    width: 1.25em;
    height: 1.25em;
    background-color: var(--clouds-color);
    border-radius: var(--container-radius);
    position: absolute;
    bottom: -0.625em;
    left: 0.312em;
    -webkit-box-shadow: 0.937em 0.312em var(--clouds-color), -0.312em -0.312em var(--back-clouds-color), 1.437em 0.375em var(--clouds-color), 0.5em -0.125em var(--back-clouds-color), 2.187em 0 var(--clouds-color), 1.25em -0.062em var(--back-clouds-color), 2.937em 0.312em var(--clouds-color), 2em -0.312em var(--back-clouds-color), 3.625em -0.062em var(--clouds-color), 2.625em 0em var(--back-clouds-color), 4.5em -0.312em var(--clouds-color), 3.375em -0.437em var(--back-clouds-color), 4.625em -1.75em 0 0.437em var(--clouds-color), 4em -0.625em var(--back-clouds-color), 4.125em -2.125em 0 0.437em var(--back-clouds-color);
    box-shadow: 0.937em 0.312em var(--clouds-color), -0.312em -0.312em var(--back-clouds-color), 1.437em 0.375em var(--clouds-color), 0.5em -0.125em var(--back-clouds-color), 2.187em 0 var(--clouds-color), 1.25em -0.062em var(--back-clouds-color), 2.937em 0.312em var(--clouds-color), 2em -0.312em var(--back-clouds-color), 3.625em -0.062em var(--clouds-color), 2.625em 0em var(--back-clouds-color), 4.5em -0.312em var(--clouds-color), 3.375em -0.437em var(--back-clouds-color), 4.625em -1.75em 0 0.437em var(--clouds-color), 4em -0.625em var(--back-clouds-color), 4.125em -2.125em 0 0.437em var(--back-clouds-color);
    -webkit-transition: 0.5s cubic-bezier(0, -0.02, 0.4, 1.25);
    -o-transition: 0.5s cubic-bezier(0, -0.02, 0.4, 1.25);
    transition: 0.5s cubic-bezier(0, -0.02, 0.4, 1.25);
  }

  .theme-switch__stars-container {
    position: absolute;
    color: var(--stars-color);
    top: -100%;
    left: 0.312em;
    width: 2.75em;
    height: auto;
    -webkit-transition: var(--transition);
    -o-transition: var(--transition);
    transition: var(--transition);
  }

   
  .theme-switch__checkbox:checked + .theme-switch__container {
    background-color: var(--container-night-bg);
  }

  .theme-switch__checkbox:checked + .theme-switch__container .theme-switch__circle-container {
    left: calc(100% - var(--circle-container-offset) - var(--circle-container-diameter));
  }

  .theme-switch__checkbox:checked + .theme-switch__container .theme-switch__circle-container:hover {
    left: calc(100% - var(--circle-container-offset) - var(--circle-container-diameter) - 0.187em)
  }

  .theme-switch__circle-container:hover {
    left: calc(var(--circle-container-offset) + 0.187em);
  }

  .theme-switch__checkbox:checked + .theme-switch__container .theme-switch__moon {
    -webkit-transform: translate(0);
    -ms-transform: translate(0);
    transform: translate(0);
    transform: translate(0);
  }

  .theme-switch__checkbox:checked + .theme-switch__container .theme-switch__clouds {
    bottom: -4.062em;
  }

  .theme-switch__checkbox:checked + .theme-switch__container .theme-switch__stars-container {
    top: 50%;
    -webkit-transform: translateY(-50%);
    -ms-transform: translateY(-50%);
    transform: translateY(-50%);
  }

   
  #dark-mode-toggle {
    display: none !important;
  }

   
  .dark-mode-toggle-fix span {
    font-size: 18px !important;
    font-weight: 600 !important;
  }
</style>


<script>
(function() {
  'use strict';
  
  
  if (window.themeSwitchInitialized) {
    console.log('主题切换开关已经初始化，跳过重复执行');
    return;
  }
  
  let isInitialized = false;
  let observer = null;
  
  function initNewThemeSwitch() {
    
    if (isInitialized) {
      return;
    }
    
    const checkbox = document.getElementById('theme-switch-checkbox');
    if (!checkbox) {
      return;
    }
    
    
    function updateCheckboxState() {
      const isDark = document.documentElement.dataset.scheme === 'dark';
      checkbox.checked = isDark;
      
      
      const textElement = document.getElementById('theme-switch-text');
      if (textElement) {
        textElement.textContent = isDark ? '暗色模式' : '亮色模式';
        console.log('更新主题切换文字:', isDark ? '暗色模式' : '亮色模式');
      }
      
      console.log('当前主题状态:', isDark ? 'dark' : 'light', 'checkbox状态:', checkbox.checked);
    }
    
    
    function waitForThemeSystem() {
      
      const schemeFromData = document.documentElement.dataset.scheme;
      const schemeFromClass = document.documentElement.className.includes('dark') ? 'dark' : 
                             document.documentElement.className.includes('light') ? 'light' : null;
      const schemeFromLocalStorage = localStorage.getItem('StackColorScheme');
      
      if (schemeFromData || schemeFromClass || schemeFromLocalStorage) {
        
        let finalScheme = schemeFromData || schemeFromClass || schemeFromLocalStorage;
        
        
        if (schemeFromData) {
          finalScheme = schemeFromData;
        }
        
        
        document.documentElement.dataset.scheme = finalScheme;
        
        
        updateCheckboxState();
        isInitialized = true;
        window.themeSwitchInitialized = true;
        
        console.log('主题系统已初始化，当前主题:', finalScheme);
      } else {
        
        setTimeout(waitForThemeSystem, 100);
      }
    }
    
    
    waitForThemeSystem();
    
    
    checkbox.addEventListener('change', function() {
      const scheme = this.checked ? 'dark' : 'light';
      document.documentElement.dataset.scheme = scheme;
      
      
      localStorage.setItem('StackColorScheme', scheme);
      
      
      document.dispatchEvent(new CustomEvent('onColorSchemeChange'));
    });
    
    
    window.addEventListener('onColorSchemeChange', updateCheckboxState);
    
    
    observer = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'data-scheme') {
          updateCheckboxState();
        }
      });
    });
    
    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['data-scheme']
    });
  }
  
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initNewThemeSwitch);
  } else {
    initNewThemeSwitch();
  }
  
  
  setTimeout(initNewThemeSwitch, 1500);
})();
</script>


<script>
(function() {
  'use strict';
  
  
  if (window.hoverEffectsInitialized) {
    console.log('悬浮效果已经初始化，跳过重复执行');
    return;
  }
  
  let isHoverEffectsInitialized = false;
  let hoverObserver = null;
  
  
  function forceCategoryHoverEffects() {
    
    if (isHoverEffectsInitialized) {
      return;
    }
    
    const articles = document.querySelectorAll('.article-list--compact article');
    if (articles.length > 0) {
      articles.forEach(article => {
        
        if (article.hasAttribute('data-hover-initialized')) {
          return;
        }
        
        
        article.style.setProperty('transition', 'all 0.3s ease', 'important');
        article.style.setProperty('will-change', 'transform, box-shadow', 'important');
        
        
        article.addEventListener('mouseenter', function() {
          this.style.setProperty('transform', 'translateY(-5px)', 'important');
          this.style.setProperty('box-shadow', '0 10px 30px rgba(0, 0, 0, 0.12)', 'important');
        });
        
        article.addEventListener('mouseleave', function() {
          this.style.setProperty('transform', 'translateY(0)', 'important');
          this.style.setProperty('box-shadow', 'none', 'important');
        });
        
        
        article.setAttribute('data-hover-initialized', 'true');
      });
      
      isHoverEffectsInitialized = true;
      window.hoverEffectsInitialized = true;
    }
  }
  
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', forceCategoryHoverEffects);
  } else {
    forceCategoryHoverEffects();
  }
  
  
  setTimeout(forceCategoryHoverEffects, 1000);
  
  
  hoverObserver = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
        
        setTimeout(forceCategoryHoverEffects, 100);
      }
    });
  });
  
  
  hoverObserver.observe(document.body, {
    childList: true,
    subtree: true
  });
})();
</script>


            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>
<style>
   
   
   
  @font-face {
   font-family: 'yuan';
   src: url('https://blog.928330.xyz/font/round.ttf') format('truetype');
  }

   
   
   
  :root {
   --base-font-family: 'yuan';
   --code-font-family: 'yuan';
  }

   
   
   
   
   
  #backTopBtn {
   position: fixed;
   bottom: 30px;
   right: 450px;
   z-index: 99;
   cursor: pointer;
   width: 32px;
   height: 32px;
   background-image: url('/icons/backTop.svg');
   background-size: cover;
   background-color: rgba(255, 255, 255, 0.9);
   border-radius: 50%;
   box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
   transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
   transform-origin: center center;
    
   animation: gentleFloat 3s ease-in-out infinite;
    
   overflow: visible;
  }

   
  [data-scheme="dark"] #backTopBtn {
   background-image: url('/icons/backTop-dark.svg') !important;
   background-color: rgba(0, 0, 0, 0.8) !important;
   box-shadow: 0 4px 20px rgba(255, 255, 255, 0.1) !important;
  }

   
  @media (prefers-color-scheme: dark) {
    #backTopBtn {
      background-image: url('/icons/backTop-dark.svg') !important;
      background-color: rgba(0, 0, 0, 0.8) !important;
      box-shadow: 0 4px 20px rgba(255, 255, 255, 0.1) !important;
    }
    
    .button-ripple {
      background-image: url('/icons/backTop-dark.svg') !important;
       
    }
  }

   
  html[data-scheme="dark"] #backTopBtn,
  body[data-scheme="dark"] #backTopBtn,
  .dark #backTopBtn,
  .dark-mode #backTopBtn {
    background-image: url('/icons/backTop-dark.svg') !important;
    background-color: rgba(0, 0, 0, 0.8) !important;
    box-shadow: 0 4px 20px rgba(255, 255, 255, 0.1) !important;
  }

  html[data-scheme="dark"] .button-ripple,
  body[data-scheme="dark"] .button-ripple,
  .dark .button-ripple,
  .dark-mode .button-ripple {
    background-image: url('/icons/backTop-dark.svg') !important;
     
  }

   
  [data-scheme="dark"] #backTopBtn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 10px solid #ffffff;
    transform: translate(-50%, -50%);
    z-index: 1;
     
    display: var(--show-css-arrow, none);
  }

   
  #backTopBtn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 10px solid #000000;
    transform: translate(-50%, -50%);
    z-index: 1;
     
    display: var(--show-css-arrow, none);
  }

   
  @keyframes gentleFloat {
   0%, 100% { transform: translateY(0px); }
   50% { transform: translateY(-6px); }
  }

   
  .button-ripple {
   position: absolute;
   top: 0;
   left: 0;
   width: 32px;
   height: 32px;
   border-radius: 50%;
   background-image: url('/icons/backTop.svg');
   background-size: cover;
   background-repeat: no-repeat;
   background-position: center;
   pointer-events: none;
   z-index: -1;
   animation: buttonRippleExpand 2.5s linear infinite;
   transform-origin: center center;
    
   will-change: transform, opacity;
   backface-visibility: hidden;
   perspective: 1000px;
   contain: layout style;
    
   transform: translateZ(0);
    
   transition: animation-duration 0.3s ease;
    
   --show-css-arrow: none !important;
    
   opacity: var(--ripple-opacity, 0.8) !important;
  }

   
  [data-scheme="dark"] .button-ripple {
   background-image: url('/icons/backTop-dark.svg') !important;
    
    
   --show-css-arrow: none !important;
  }

   
  @media (prefers-color-scheme: dark) {
    .button-ripple {
      background-image: url('/icons/backTop-dark.svg') !important;
       
       
      --show-css-arrow: none !important;
    }
  }

   
  .button-ripple.hover-mode {
   animation-duration: 1s;
  }

  @keyframes buttonRippleExpand {
   0% {
     --ripple-opacity: 0.8;
     transform: scale(1);
   }
   2% {
     --ripple-opacity: 0.78;
     transform: scale(1.02);
   }
   4% {
     --ripple-opacity: 0.76;
     transform: scale(1.04);
   }
   6% {
     --ripple-opacity: 0.74;
     transform: scale(1.06);
   }
   8% {
     --ripple-opacity: 0.72;
     transform: scale(1.08);
   }
   10% {
     --ripple-opacity: 0.7;
     transform: scale(1.1);
   }
   12% {
     --ripple-opacity: 0.68;
     transform: scale(1.12);
   }
   14% {
     --ripple-opacity: 0.66;
     transform: scale(1.14);
   }
   16% {
     --ripple-opacity: 0.64;
     transform: scale(1.16);
   }
   18% {
     --ripple-opacity: 0.62;
     transform: scale(1.18);
   }
   20% {
     --ripple-opacity: 0.6;
     transform: scale(1.2);
   }
   22% {
     --ripple-opacity: 0.58;
     transform: scale(1.22);
   }
   24% {
     --ripple-opacity: 0.56;
     transform: scale(1.24);
   }
   26% {
     --ripple-opacity: 0.54;
     transform: scale(1.26);
   }
   28% {
     --ripple-opacity: 0.52;
     transform: scale(1.28);
   }
   30% {
     --ripple-opacity: 0.5;
     transform: scale(1.3);
   }
   32% {
     --ripple-opacity: 0.48;
     transform: scale(1.32);
   }
   34% {
     --ripple-opacity: 0.46;
     transform: scale(1.34);
   }
   36% {
     --ripple-opacity: 0.44;
     transform: scale(1.36);
   }
   38% {
     --ripple-opacity: 0.42;
     transform: scale(1.38);
   }
   40% {
     --ripple-opacity: 0.4;
     transform: scale(1.4);
   }
   42% {
     --ripple-opacity: 0.38;
     transform: scale(1.42);
   }
   44% {
     --ripple-opacity: 0.36;
     transform: scale(1.44);
   }
   46% {
     --ripple-opacity: 0.34;
     transform: scale(1.46);
   }
   48% {
     --ripple-opacity: 0.32;
     transform: scale(1.48);
   }
   50% {
     --ripple-opacity: 0.3;
     transform: scale(1.5);
   }
   52% {
     --ripple-opacity: 0.28;
     transform: scale(1.52);
   }
   54% {
     --ripple-opacity: 0.26;
     transform: scale(1.54);
   }
   56% {
     --ripple-opacity: 0.24;
     transform: scale(1.56);
   }
   58% {
     --ripple-opacity: 0.22;
     transform: scale(1.58);
   }
   60% {
     --ripple-opacity: 0.2;
     transform: scale(1.6);
   }
   62% {
     --ripple-opacity: 0.18;
     transform: scale(1.62);
   }
   64% {
     --ripple-opacity: 0.16;
     transform: scale(1.64);
   }
   66% {
     --ripple-opacity: 0.14;
     transform: scale(1.66);
   }
   68% {
     --ripple-opacity: 0.12;
     transform: scale(1.68);
   }
   70% {
     --ripple-opacity: 0.1;
     transform: scale(1.7);
   }
   72% {
     --ripple-opacity: 0.08;
     transform: scale(1.72);
   }
   74% {
     --ripple-opacity: 0.07;
     transform: scale(1.74);
   }
   76% {
     --ripple-opacity: 0.06;
     transform: scale(1.76);
   }
   78% {
     --ripple-opacity: 0.05;
     transform: scale(1.78);
   }
   80% {
     --ripple-opacity: 0.04;
     transform: scale(1.8);
   }
   82% {
     --ripple-opacity: 0.035;
     transform: scale(1.82);
   }
   84% {
     --ripple-opacity: 0.03;
     transform: scale(1.84);
   }
   86% {
     --ripple-opacity: 0.025;
     transform: scale(1.86);
   }
   88% {
     --ripple-opacity: 0.02;
     transform: scale(1.88);
   }
   90% {
     --ripple-opacity: 0.015;
     transform: scale(1.9);
   }
   92% {
     --ripple-opacity: 0.01;
     transform: scale(1.92);
   }
   94% {
     --ripple-opacity: 0.008;
     transform: scale(1.94);
   }
   96% {
     --ripple-opacity: 0.005;
     transform: scale(1.96);
   }
   98% {
     --ripple-opacity: 0.002;
     transform: scale(1.98);
   }
   100% {
     --ripple-opacity: 0;
     transform: scale(2.0);
   }
  }

   
  .button-tooltip {
   position: absolute;
   bottom: 45px;
   right: 450px;
   background: rgba(0, 0, 0, 0.8);
   color: white;
   padding: 8px 12px;
   border-radius: 6px;
   font-size: 12px;
   white-space: nowrap;
   opacity: 0;
   transform: translateY(10px);
   transition: all 0.3s ease;
   pointer-events: none;
   z-index: 100;
  }

  .button-tooltip.show {
   opacity: 1;
   transform: translateY(0);
  }

  .button-tooltip::after {
   content: '';
   position: absolute;
   top: 100%;
   left: 50%;
   transform: translateX(-50%);
   border: 5px solid transparent;
   border-top-color: rgba(0, 0, 0, 0.8);
  }

   
  .hover-ripple-effect {
   display: none;
  }

   
  #backTopBtn:hover {
   transform: translateY(-8px) scale(1.1);
   box-shadow: 0 8px 30px rgba(0, 0, 0, 0.25);
   background-color: rgba(255, 255, 255, 1);
  }

   
  #backTopBtn.sprinting {
   animation: energyBurst 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
  }

  @keyframes energyBurst {
   0% {
     transform: scale(1) rotate(0deg);
     opacity: 1;
     filter: brightness(1) hue-rotate(0deg);
     box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
   }
   15% {
     transform: scale(1.2) rotate(0deg);
     opacity: 1;
     filter: brightness(1.2) hue-rotate(0deg);
     box-shadow: 0 0 25px rgba(255, 215, 0, 0.8), 0 0 50px rgba(255, 107, 107, 0.6);
   }
   30% {
     transform: scale(1.4) rotate(0deg);
     opacity: 1;
     filter: brightness(1.4) hue-rotate(60deg);
     box-shadow: 0 0 35px rgba(255, 182, 193, 0.8), 0 0 70px rgba(255, 215, 0, 0.6);
   }
   45% {
     transform: scale(1.6) rotate(0deg);
     opacity: 1;
     filter: brightness(1.6) hue-rotate(120deg);
     box-shadow: 0 0 45px rgba(173, 216, 230, 0.8), 0 0 90px rgba(255, 182, 193, 0.6);
   }
   60% {
     transform: scale(1.4) rotate(0deg);
     opacity: 1;
     filter: brightness(1.4) hue-rotate(180deg);
     box-shadow: 0 0 35px rgba(144, 238, 144, 0.8), 0 0 70px rgba(173, 216, 230, 0.6);
   }
   75% {
     transform: scale(1.2) rotate(0deg);
     opacity: 1;
     filter: brightness(1.2) hue-rotate(240deg);
     box-shadow: 0 0 25px rgba(255, 215, 0, 0.8), 0 0 50px rgba(144, 238, 144, 0.6);
   }
   90% {
     transform: scale(1.05) rotate(0deg);
     opacity: 1;
     filter: brightness(1.05) hue-rotate(300deg);
     box-shadow: 0 0 15px rgba(255, 107, 107, 0.6), 0 0 30px rgba(255, 215, 0, 0.4);
   }
   100% {
     transform: scale(1) rotate(0deg);
     opacity: 1;
     filter: brightness(1) hue-rotate(360deg);
     box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
   }
  }

   
  #backTopBtn.reappearing {
   animation: reappear 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
  }

   
  #backTopBtn.exploding {
   animation: explosionTransition 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
    
   z-index: 1000;
  }

   
  #backTopBtn.exploding .button-ripple {
   opacity: 0;
   animation-play-state: paused;
  }

  @keyframes explosionTransition {
   0% {
     transform: scale(1.6) rotate(0deg);
     opacity: 1;
     filter: brightness(1.6) hue-rotate(0deg);
     box-shadow: 0 0 50px rgba(255, 215, 0, 0.8), 0 0 100px rgba(255, 107, 107, 0.6);
   }
   30% {
     transform: scale(1.4) rotate(5deg);
     opacity: 1;
     filter: brightness(1.4) hue-rotate(120deg);
     box-shadow: 0 0 40px rgba(255, 182, 193, 0.8), 0 0 80px rgba(255, 215, 0, 0.6);
   }

   100% {
     transform: scale(1) rotate(0deg);
     opacity: 1;
     filter: brightness(1) hue-rotate(360deg);
     box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
   }
  }

  @keyframes reappear {
   0% {
     transform: scale(0.85);
     opacity: 0.7;
   }
   50% {
     transform: scale(1.05);
     opacity: 1;
   }
   100% {
     transform: scale(1);
     opacity: 1;
   }
  }

  #backTopBtn.rotating {
   animation: rotate360 0.6s ease-in-out;
  }

  @keyframes rotate360 {
   0% { transform: rotate(0deg); }
   100% { transform: rotate(360deg); }
  }

   
  .particle {
   position: absolute;
   top: 50%;
   left: 50%;
   width: 4px;
   height: 4px;
   background: radial-gradient(circle, #fff, #ffd700, #ff69b4, #87ceeb);
   border-radius: 50%;
   pointer-events: none;
   z-index: -2;
   animation: particleExplode 1s ease-out forwards;
  }

  @keyframes particleExplode {
   0% {
     transform: translate(-50%, -50%) scale(0);
     opacity: 1;
   }
   50% {
     opacity: 1;
   }
   100% {
     transform: translate(-50%, -50%) scale(1) translate(var(--x), var(--y));
     opacity: 0;
   }
  }

   
  .energy-wave {
   position: absolute;
   top: 50%;
   left: 50%;
   width: 0;
   height: 0;
   border: 2px solid transparent;
   border-radius: 50%;
   pointer-events: none;
   z-index: -3;
   animation: energyWave 1.2s ease-out forwards;
  }

  @keyframes energyWave {
   0% {
     width: 0;
     height: 0;
     border-color: rgba(255, 215, 0, 0.8);
     opacity: 1;
   }
   100% {
     width: 120px;
     height: 120px;
     border-color: rgba(255, 215, 0, 0);
     opacity: 0;
   }
  }

   
  .hero-aura {
   position: absolute;
   top: 50%;
   left: 50%;
   width: 100%;
   height: 100%;
   border-radius: 50%;
   background: conic-gradient(from 0deg, #ffd700, #ff69b4, #87ceeb, #98fb98, #ffa07a, #ffd700);
   background-size: 200% 200%;
   pointer-events: none;
   z-index: -4;
   animation: heroAura 2s linear infinite;
   opacity: 0;
   transition: opacity 0.3s ease;
  }

  #backTopBtn.sprinting .hero-aura {
   opacity: 0.6;
  }

  @keyframes heroAura {
   0% {
     background-position: 0% 0%;
     transform: translate(-50%, -50%) rotate(0deg);
   }
   100% {
     background-position: 100% 100%;
     transform: translate(-50%, -50%) rotate(360deg);
   }
  }

   
      @media (max-width: 768px) {
     #backTopBtn {
       left: 20px !important;  
       right: auto !important;
       bottom: 20px;
       width: 28px;
       height: 28px;
     }
     
     .button-tooltip {
       left: 20px !important;  
       right: auto !important;
       bottom: 35px;
     }
    }
  
    @media (max-width: 480px) {
     #backTopBtn {
       left: 15px !important;  
       right: auto !important;
       bottom: 15px;
       width: 26px;
       height: 26px;
     }
     
     .button-tooltip {
       left: 15px !important;
       right: auto !important;
       bottom: 31px;
     }
    }

   
   
   
  .no-text-selection {
    -webkit-user-select: none;  
    -moz-user-select: none;     
    -ms-user-select: none;      
    user-select: none;          
  }

   
   
   
  #rope-container {
    position: fixed;
    top: 0;
    left: 20px;
    z-index: 10000;
    width: 50px;
    height: 480px;
    pointer-events: none;
  }
  
   
  #rope-physics-container {
    pointer-events: auto !important;
  }
  
   
  #rope-svg-container svg {
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
  }
  
  #rope-svg-container path {
    transition: all 0.1s ease-out;
  }
  
   
  #rope-svg-container path,
  #rope-path {
    stroke: #4b2b0f !important;
    stroke-width: 2.5 !important;
  }
  
   
  #rope-svg-container svg path {
    stroke: #4b2b0f !important;
    stroke-width: 2.5 !important;
  }
  


  #rope {
    position: absolute;
    top: -80px;
    left: 50%;
    width: 3px;
    height: 400px;
    background: linear-gradient(to bottom, #654321, #8B4513, #A0522D, #8B4513, #654321);
    border-radius: 1.5px;
    transform: translateX(-50%);
    pointer-events: auto;
    transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    box-shadow: 0 1px 3px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.1);
  }

  #pull-ring {
    position: absolute;
    top: 300px;
    left: 50%;
    font-size: 20px;
    color: #ffffff;
    text-shadow: 0 0 8px rgba(255, 255, 255, 0.8);
    transform: translateX(-50%);
    pointer-events: auto;
    transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
  }

  #rope:hover {
    box-shadow: 0 2px 6px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.2);
  }

  #pull-ring:hover {
    transform: translateX(-50%) scale(1.2);
    text-shadow: 0 0 12px rgba(255, 255, 255, 1);
    filter: drop-shadow(0 4px 8px rgba(0,0,0,0.5));
  }

   
   
   
  .highlight {
   max-height: 400px;
   overflow: hidden;
   position: relative;
   transition: max-height 0.3s ease-out;
  }

  .code-show {
   max-height: none !important;
  }

  .code-more-box {
   width: 100%;
   padding-top: 20px;
   background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0), #fff);
   position: absolute;
   left: 0;
   right: 0;
   bottom: 0;
   z-index: 1;
   text-align: center;
  }

  .code-more-btn {
   display: inline-block;
   padding: 5px 15px;
   background: #f0f0f5;
   border-radius: 5px;
   cursor: pointer;
   font-size: 0.9em;
  }

   
   
   
  #particles-js {
   position: fixed;
   top: 0;
   left: 0;
    width: 100vw;
    height: 100vh;
   z-index: -1;
    pointer-events: none;
  }
  
  #particles-js canvas {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
  }

   
   
   
  .toc-lock-btn {
    position: absolute;
    top: 32px;
    right: 5px;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border-radius: 50%;
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    background: rgba(0, 0, 0, 0.05);
    color: rgba(0, 0, 0, 0.7);
    z-index: 100;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }
  
  .toc-lock-btn:hover {
    background: rgba(0, 0, 0, 0.1);
    transform: scale(1.1);
    border-color: rgba(0, 0, 0, 0.2);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
  }
  
  .toc-lock-btn:active {
    transform: scale(0.95);
  }
  
   
  .toc-lock-btn:focus {
    outline: none;
    border-color: rgba(0, 0, 0, 0.4);
    box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1), 0 2px 8px rgba(0, 0, 0, 0.1);
    background: rgba(0, 0, 0, 0.08);
  }
  
  .toc-lock-btn:focus-visible {
    outline: none;
    border-color: rgba(0, 0, 0, 0.4);
    box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1), 0 2px 8px rgba(0, 0, 0, 0.1);
    background: rgba(0, 0, 0, 0.08);
  }
  
  .toc-lock-btn.locked {
    color: rgba(0, 0, 0, 0.9);
    background: rgba(0, 0, 0, 0.1);
    border-color: rgba(0, 0, 0, 0.3);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  }
  
  .toc-lock-btn.locked:hover {
    background: rgba(0, 0, 0, 0.15);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.25);
  }
  
  .toc-lock-btn.locked .lock-icon.locked {
    display: block;
  }
  
  .toc-lock-btn.locked .lock-icon.unlocked {
    display: none;
  }
  
  .toc-lock-btn .lock-icon.locked {
    display: none;
  }
  
  .toc-lock-btn .lock-icon.unlocked {
    display: block;
  }
  
  .toc-lock-btn .lock-icon {
    width: 14px;
    height: 14px;
    stroke: currentColor;
    fill: none;
    stroke-width: 2.5;
    stroke-linecap: round;
    stroke-linejoin: round;
    transition: all 0.3s ease;
  }
  
   
  .toc-lock-label {
    position: absolute;
    top: 38px;
    right: 28px;
    font-size: 16px;
    color: rgba(0, 0, 0, 0.6);
    font-weight: 700;
    z-index: 100;
    user-select: none;
    pointer-events: none;
    line-height: 1;
    display: flex;
    align-items: center;
  }

   
  [data-scheme="dark"] .toc-lock-btn {
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.7);
  }
  
  [data-scheme="dark"] .toc-lock-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
    box-shadow: 0 4px 16px rgba(255, 255, 255, 0.15);
  }
  
   
  [data-scheme="dark"] .toc-lock-btn:focus,
  [data-scheme="dark"] .toc-lock-btn:focus-visible {
    outline: none;
    border-color: rgba(255, 255, 255, 0.4);
    box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1), 0 2px 8px rgba(255, 255, 255, 0.1);
    background: rgba(255, 255, 255, 0.08);
  }
  
  [data-scheme="dark"] .toc-lock-btn.locked {
    color: rgba(255, 255, 255, 0.9);
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.3);
    box-shadow: 0 2px 8px rgba(255, 255, 255, 0.2);
  }
  
  [data-scheme="dark"] .toc-lock-btn.locked:hover {
    background: rgba(255, 255, 255, 0.15);
    box-shadow: 0 4px 16px rgba(255, 255, 255, 0.25);
  }
  
   
  [data-scheme="dark"] .toc-lock-label {
    color: rgba(255, 255, 255, 0.6);
  }

   
  #TableOfContents[data-scrollspy-disabled="true"] {
    opacity: 0.8 !important;
  }
  
  #TableOfContents[data-scrollspy-disabled="true"] .active-class {
     
    display: block !important;
    opacity: 1 !important;
  }
  
  #TableOfContents[data-scrollspy-disabled="true"] a {
    cursor: pointer !important;
  }
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

<script>
   
   
   

  let s1 = '2025-5-8 15:00:00'; 
  s1 = new Date(s1.replace(/-/g, "/"));
  let s2 = new Date();
  let timeDifference = s2.getTime() - s1.getTime();

  let days = Math.floor(timeDifference / (1000 * 60 * 60 * 24));
  let hours = Math.floor((timeDifference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  let minutes = Math.floor((timeDifference % (1000 * 60 * 60)) / (1000 * 60));

  let result = days + "天" + hours + "小时" + minutes + "分钟";
  if (document.getElementById('runningdays')) {
      document.getElementById('runningdays').innerHTML = result;
  }
  
   
   
   
  
  

  function startContinuousRipple(button) {
   
   const buttonRipple = document.createElement('div');
   buttonRipple.className = 'button-ripple';
   button.appendChild(buttonRipple);
   
   
   button.buttonRipple = buttonRipple;
  }
  
  

  function createContinuousRipple(button) {
   
   if (button.querySelector('.continuous-ripple')) {
     return;
   }
   
   
   const rippleContainer = document.createElement('div');
   rippleContainer.className = 'ripple-container continuous-ripple';
   
   
   const ripple = document.createElement('div');
   ripple.className = 'ripple';
   ripple.style.background = 'radial-gradient(circle, rgba(255, 107, 107, 0.8) 0%, rgba(255, 255, 255, 0.9) 100%)';
   
   rippleContainer.appendChild(ripple);
   button.appendChild(rippleContainer);
   
   
   setTimeout(() => {
     if (rippleContainer.parentNode) {
       rippleContainer.parentNode.removeChild(rippleContainer);
     }
   }, 800);
  }
  
  

  function createHoverRipple(button) {
   
   if (button.buttonRipple) {
     
     button.buttonRipple.style.animationDuration = '1s';
     button.buttonRipple.classList.add('hover-mode');
   }
  }
  
  

  function showTooltip(button) {
   
   hideTooltip();
   
   
   const tooltip = document.createElement('div');
   tooltip.className = 'button-tooltip';
   tooltip.textContent = '返回顶部';
   document.body.appendChild(tooltip);
   
   
   setTimeout(() => {
     tooltip.classList.add('show');
   }, 10);
   
   
   button.tooltip = tooltip;
  }
  
  

  function hideTooltip() {
   const existingTooltip = document.querySelector('.button-tooltip');
   if (existingTooltip) {
     existingTooltip.classList.remove('show');
     setTimeout(() => {
       if (existingTooltip.parentNode) {
         existingTooltip.parentNode.removeChild(existingTooltip);
       }
     }, 300);
   }
  }
  
  

  function createRippleEffect(button) {
   
   
   
   const energyWave = document.createElement('div');
   energyWave.className = 'energy-wave';
   document.body.appendChild(energyWave);
   
   
   createParticleExplosion(button);
   
   
   setTimeout(() => {
     if (energyWave.parentNode) {
       energyWave.parentNode.removeChild(energyWave);
     }
   }, 1200);
  }

  

  function createParticleExplosion(button) {
   const particleCount = 16; 
   
   
   const particleColors = [
     'radial-gradient(circle, #ff6b6b, #ffd93d, #6bcf7f, #4d96ff)',
     'radial-gradient(circle, #ff8e8e, #ffed4e, #7ddb8f, #6ba6ff)',
     'radial-gradient(circle, #ffa1a1, #fff15f, #8ee79f, #89b6ff)',
     'radial-gradient(circle, #ffb4b4, #fff570, #9ff3af, #a7c6ff)'
   ];
   
   for (let i = 0; i < particleCount; i++) {
     const particle = document.createElement('div');
     particle.className = 'particle';
     
     
     const randomColor = particleColors[Math.floor(Math.random() * particleColors.length)];
     particle.style.background = randomColor;
     
     
     const angle = (i / particleCount) * 2 * Math.PI;
     const distance = 40 + Math.random() * 30; 
     const x = Math.cos(angle) * distance;
     const y = Math.sin(angle) * distance;
     
     particle.style.setProperty('--x', `${x}px`);
     particle.style.setProperty('--y', `${y}px`);
     
     
     particle.style.animationDelay = `${Math.random() * 0.4}s`;
     
     button.appendChild(particle);
     
     
     setTimeout(() => {
       if (particle.parentNode) {
         particle.parentNode.removeChild(particle);
       }
     }, 1000);
   }
  }

   
   
   
  

  function initScrollTop() {
   let rightSideBar = document.querySelector(".right-sidebar");
   if (!rightSideBar) {
    return;
   }

   
   let btn = document.createElement("div");
   btn.id = "backTopBtn";
   let isRotating = false; 

   
   const heroAura = document.createElement('div');
   heroAura.className = 'hero-aura';
   btn.appendChild(heroAura);

   
   btn.addEventListener('mouseenter', function() {
     createHoverRipple(this);
     showTooltip(this);
   });
   
   
   btn.addEventListener('mouseleave', function() {
     if (this.buttonRipple) {
       
       this.buttonRipple.style.animationDuration = '2s';
       this.buttonRipple.classList.remove('hover-mode');
     }
     hideTooltip();
   });

   btn.onclick = function() {
    if (!isRotating) {
     isRotating = true;
     backToTop(this, () => {
      isRotating = false; 
     });
    }
   };
   rightSideBar.appendChild(btn);

   
   btn.style.display = "block";
   
   
   startContinuousRipple(btn);
  }

  

  function backToTop(button, onComplete) {
   
   button.classList.add('sprinting');
   
   
   if (button.buttonRipple) {
     button.buttonRipple.style.display = 'none';
   }
   
   
   createRippleEffect(button);
   
   
   window.scrollTo({ top: 0, behavior: "smooth" });
   
   
   const checkScrollComplete = () => {
     if (window.scrollY === 0) {
       
       button.classList.remove('sprinting');
       
       
       button.classList.add('exploding');
       
       
       createParticleExplosion(button);
       
       
       if (button.buttonRipple) {
         button.buttonRipple.style.display = 'block';
       }
       
       
       setTimeout(() => {
         button.classList.remove('exploding');
         
         
         if (button.buttonRipple) {
           
           button.buttonRipple.style.animationPlayState = 'paused';
           
           button.buttonRipple.style.animation = 'none';
           button.buttonRipple.offsetHeight; 
           button.buttonRipple.style.animation = 'buttonRippleExpand 2s steps(25, end) infinite';
           button.buttonRipple.style.animationPlayState = 'running';
         }
         
         button.classList.add('reappearing');
         
         
         setTimeout(() => {
           button.classList.remove('reappearing');
           if (onComplete) {
             onComplete();
           }
         }, 600);
       }, 800); 
       
       return;
     }
     requestAnimationFrame(checkScrollComplete);
   };
   
   checkScrollComplete();
  }

  
  initScrollTop();
  
   
   
   
  

  function initRope() {


    if (typeof Matter === 'undefined') {
      console.error('Matter.js 库未加载，无法初始化物理绳索。');
      return;
    }
    if (document.getElementById('rope-physics-container')) {

      return;
    }

    let ropeContainer = document.getElementById('rope-container');
    if (!ropeContainer) {
      console.error('#rope-container 元素未在 HTML 或 CSS 中找到。');
      return;
    }
    
    ropeContainer.innerHTML = '';
    ropeContainer.style.height = '100vh';
    ropeContainer.style.pointerEvents = 'none';

    const monthlyEmojis = [
      { month: 1, name: "一月", ring: "❄️", falling: "❄️", description: "寒冬腊月，雪花飞舞" },
      { month: 2, name: "二月", ring: "🏮", falling: "🏮", description: "新春正月，灯笼高挂" },
      { month: 3, name: "三月", ring: "🌸", falling: "🌸", description: "春暖花开，樱花绽放" },
      { month: 4, name: "四月", ring: "🌧️", falling: "🌧️", description: "清明时节，春雨绵绵" },
      { month: 5, name: "五月", ring: "🌺", falling: "🌺", description: "立夏时节，牡丹盛开" },
      { month: 6, name: "六月", ring: "🌻", falling: "🌻", description: "芒种时节，向日葵开" },
      { month: 7, name: "七月", ring: "🌿", falling: "🌿", description: "小暑时节，绿意盎然" },
      { month: 8, name: "八月", ring: "🍉", falling: "🍉", description: "七夕时节，西瓜清甜" },
      { month: 9, name: "九月", ring: "🍁", falling: "🍁", description: "白露时节，秋葉飘落" },
      { month: 10, name: "十月", ring: "🍂", falling: "🍂", description: "寒露时节，落叶纷飞" },
      { month: 11, name: "十一月", ring: "🍊", falling: "🍊", description: "霜降时节，柑橘飘香" },
      { month: 12, name: "十二月", ring: "🌨️", falling: "🌨️", description: "大雪时节，雪花纷飞" }
    ];
    window.timeEmojis = [
      { period: "morning", name: "早晨", emojis: ["☀️", "🌤️", "🌱", "🌺", "🌿"], description: "晨曦初露，万物苏醒" },
      { period: "noon", name: "中午", emojis: ["🌞", "🌻", "🦋", "🦜", "🐝"], description: "烈日当空，生机勃勃" },
      { period: "evening", name: "傍晚", emojis: ["🌙", "⭐", "🦉"], description: "夕阳西下，夜幕降临" }
    ];
    const currentMonth = new Date().getMonth() + 1;
    const currentEmoji = monthlyEmojis.find(emoji => emoji.month === currentMonth);
    
    const ropeContainerLeft = 20;
    const ropeContainerWidth = 50;
    const ropeAnchorX = ropeContainerLeft + (ropeContainerWidth / 2);

    const { Engine, World, Bodies, Composite, Constraint, Runner, Mouse, MouseConstraint, Events, Body } = Matter;

    const engine = Engine.create();
    const world = engine.world;
    
    
    
    
    engine.world.gravity.y = 0;

    
    
    
    const ropeSegments = 80; 
    const segmentRadius = 1.5; 
    const segmentRenderHeight = 6; 
    const segmentRenderWidth = 4; 
    const constraintLength = 2.5; 

    const ropeGroup = Matter.Body.nextGroup(true);
    const ropeChain = Composite.create({ label: 'Rope' });

    
    for (let i = 0; i < ropeSegments - 1; i++) {
      const segment = Bodies.circle(ropeAnchorX, i * constraintLength, segmentRadius, {
          collisionFilter: { group: ropeGroup },
          density: 0.1, 
          friction: 0.4, 
          frictionAir: 0.08, 
          restitution: 0.02 
      });
      Composite.add(ropeChain, segment);
    }

    
    const pullRingBody = Bodies.circle(
      ropeAnchorX,
      (ropeSegments - 1) * constraintLength,
      15,
      {
        collisionFilter: { group: ropeGroup },
        density: 0.01, 
        friction: 0.5,  
        frictionAir: 0.1, 
        restitution: 0.02 
      }
    );
    Composite.add(ropeChain, pullRingBody);
    World.add(world, ropeChain);

    
    Composite.addConstraint(ropeChain, Constraint.create({
      bodyB: ropeChain.bodies[0],
      pointA: { x: ropeAnchorX, y: 0 },
      stiffness: 1 
    }));

    for (let i = 0; i < ropeSegments - 1; i++) {
      Composite.addConstraint(ropeChain, Constraint.create({
        bodyA: ropeChain.bodies[i],
        bodyB: ropeChain.bodies[i + 1],
        
        
        
        stiffness: 0.8, 
        damping: 0.8,   
        length: constraintLength * 0.6, 
        
        render: {
          visible: false
        }
      }));
    }
    
    const domContainer = document.createElement('div');
    domContainer.id = 'rope-physics-container';
    domContainer.style.position = 'fixed';
    domContainer.style.top = '0';
    domContainer.style.left = '0';
    domContainer.style.pointerEvents = 'auto'; 
    domContainer.style.zIndex = '10000';
    document.body.appendChild(domContainer);

    
    const svgContainer = document.createElement('div');
    svgContainer.id = 'rope-svg-container';
    svgContainer.style.cssText = `
      position: absolute;
      top: 0;
      left: 0;
      width: 100px;
      height: 100vh;
      pointer-events: none;
      z-index: 1;
      overflow: visible;
    `;
    domContainer.appendChild(svgContainer);
    
    
    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    svg.setAttribute('width', '100');
    svg.setAttribute('height', '100vh');
    svg.setAttribute('viewBox', '0 0 100 100vh');
    svg.style.cssText = `
      position: absolute;
      top: 0;
      left: 0;
      width: 100px;
      height: 100vh;
      overflow: visible;
    `;
    svgContainer.appendChild(svg);
    
    
    const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
    const gradient = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
    gradient.setAttribute('id', 'ropeGradient');
    gradient.setAttribute('x1', '0%');
    gradient.setAttribute('y1', '0%');
    gradient.setAttribute('x2', '0%');
    gradient.setAttribute('y2', '100%');
    
    const stop1 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    stop1.setAttribute('offset', '0%');
    stop1.setAttribute('stop-color', '#654321');
    
    const stop2 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    stop2.setAttribute('offset', '25%');
    stop2.setAttribute('stop-color', '#8B4513');
    
    const stop3 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    stop3.setAttribute('offset', '50%');
    stop3.setAttribute('stop-color', '#A0522D');
    
    const stop4 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    stop4.setAttribute('offset', '75%');
    stop4.setAttribute('stop-color', '#8B4513');
    
    const stop5 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    stop5.setAttribute('offset', '100%');
    stop5.setAttribute('stop-color', '#654321');
    
    gradient.appendChild(stop1);
    gradient.appendChild(stop2);
    gradient.appendChild(stop3);
    gradient.appendChild(stop4);
    gradient.appendChild(stop5);
    defs.appendChild(gradient);
    svg.appendChild(defs);
    
    
    const ropePath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    ropePath.setAttribute('fill', 'none');
    
    ropePath.setAttribute('stroke', '#4b2b0f');
    ropePath.setAttribute('stroke-width', '2.5');
    ropePath.setAttribute('stroke-linecap', 'round');
    ropePath.setAttribute('stroke-linejoin', 'round');
    ropePath.setAttribute('id', 'rope-path'); 
    svg.appendChild(ropePath);
    
    
    ropePath.setAttribute('d', `M 50 0 L 50 400`);
    
    
    
    
    
    const pullRingDiv = document.createElement('div');
    pullRingDiv.id = 'pull-ring-physics';
    pullRingDiv.innerHTML = currentEmoji.ring;
    pullRingDiv.title = `${currentEmoji.name}: ${currentEmoji.description}`;
    pullRingDiv.style.cssText = `
      font-size: 24px; cursor: grab; pointer-events: auto;
      width: 30px; height: 30px; text-align: center;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); position: absolute;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      z-index: 2;
      transform: translate(40px, 300px); /* 初始位置，向右移动5px */
    `;
    
    
    pullRingDiv.addEventListener('mousedown', () => {
      pullRingDiv.style.cursor = 'grabbing';
    });
    
    pullRingDiv.addEventListener('mouseup', () => {
      pullRingDiv.style.cursor = 'grab';
    });
    
    domContainer.appendChild(pullRingDiv);
    
    
    const ropeElements = {
      svg: svg,
      path: ropePath,
      pullRing: pullRingDiv
    };

    const mouse = Mouse.create(document.body);
    const mouseConstraint = MouseConstraint.create(engine, {
      mouse: mouse,
      constraint: { 
        stiffness: 0.8, 
        render: { visible: false },
        
        length: 0,
        damping: 0.05 
      }
    });
    World.add(world, mouseConstraint);
    
    
    mouseConstraint.constraint.bodyB = null;
    
    
    Events.on(mouseConstraint, 'mousedown', (event) => {

    });
    
    
    mouseConstraint.mouse.element = document.body;
    
    
    let dragStartPosition = null;
    
    Events.on(mouseConstraint, 'startdrag', () => {
      document.body.classList.add('no-text-selection');
      
      
      if (mouseConstraint.body && mouseConstraint.body === pullRingBody) {
        dragStartPosition = {
          x: mouseConstraint.body.position.x,
          y: mouseConstraint.body.position.y
        };
      }
    });
    
    Events.on(mouseConstraint, 'enddrag', () => {
      document.body.classList.remove('no-text-selection');
      
      
      
      if (dragStartPosition) {
        
        const currentPosition = pullRingBody.position;
        const dragDistance = Math.sqrt(
          Math.pow(currentPosition.x - dragStartPosition.x, 2) +
          Math.pow(currentPosition.y - dragStartPosition.y, 2)
        );
        
        
        if (dragDistance > 1) {
          createSeasonalFalling(currentEmoji);
          
          
          Matter.Body.applyForce(pullRingBody, pullRingBody.position, { x: 0, y: 0.5 });
          
          
          const targetX = ropeAnchorX;
          const targetY = (ropeSegments - 1) * constraintLength;
          
          
          const dx = targetX - currentPosition.x;
          const dy = targetY - currentPosition.y;
          
          
          Matter.Body.applyForce(pullRingBody, pullRingBody.position, { 
            x: dx * 0.001, 
            y: dy * 0.001 
          });
          
        }
        
        
        dragStartPosition = null;
      }
    });
    


    
    (function render() {
      
      let pathData = '';
      
      
      const topPoint = { x: 50, y: 0 }; 
      pathData += `M ${topPoint.x} ${topPoint.y}`;
      
      
      ropeChain.bodies.forEach((body, index) => {
        if (index < ropeSegments - 1) { 
          const relativeX = body.position.x - ropeAnchorX + 50; 
          const relativeY = body.position.y;
          pathData += ` L ${relativeX} ${relativeY}`;
        }
      });
      
      
      const pullRingBody = ropeChain.bodies[ropeSegments - 1];
      if (pullRingBody) {
        const relativeX = pullRingBody.position.x - ropeAnchorX + 50; 
        const relativeY = pullRingBody.position.y;
        pathData += ` L ${relativeX} ${relativeY}`;
      }
      
      
      ropeElements.path.setAttribute('d', pathData);
      
      
      if (pullRingBody) {
        
        
        const adjustedX = pullRingBody.position.x - 15 + 3.5; 
        const adjustedY = pullRingBody.position.y - 15;
        
        ropeElements.pullRing.style.transform = `translate(
          ${adjustedX}px,
          ${adjustedY}px
        )`;
        

      }
      
      setTimeout(() => requestAnimationFrame(render), 1000 / 240); 
    })();
    
    
    
    const runner = Runner.create();
    
    runner.delta = 1000 / 240; 
    Runner.run(runner, engine);

    
    
    
    setTimeout(() => {
      engine.world.gravity.y = 1.2;
    }, 100); 

    
    
    
    
    
    ropeChain.bodies.forEach((body, index) => {
      Matter.Body.set(body, 'sleeping', false);
      
      body.sleepThreshold = Infinity;
    });
    
    
    engine.enableSleeping = false;
    
    
    mouseConstraint.constraint.bodyB = null;
    mouseConstraint.mouse.element = document.body;


  }

  

  function createSeasonalFalling(emojiConfig) {

   
   
   const fallingContainer = document.createElement('div');
   fallingContainer.id = 'falling-container';
   fallingContainer.style.cssText = `
     position: fixed;
     top: 0;
     left: 0;
     width: 100vw;
     height: 100vh;
     pointer-events: none;
     z-index: 9999;
     overflow: hidden;
   `;
   document.body.appendChild(fallingContainer);

   
   
   const currentHour = new Date().getHours();
   let currentTimePeriod;
   if (currentHour >= 5 && currentHour < 11) {
    currentTimePeriod = window.timeEmojis.find(t => t.period === "morning");
   } else if (currentHour >= 11 && currentHour < 17) {
    currentTimePeriod = window.timeEmojis.find(t => t.period === "noon");
   } else {
    currentTimePeriod = window.timeEmojis.find(t => t.period === "evening");
   }
   

   
   
   const totalElements = emojiConfig.month >= 11 || emojiConfig.month <= 2 ? 30 : 25; 
   let activeElements = 0;
   

   
   for (let i = 0; i < totalElements; i++) {
    setTimeout(() => {
     const element = document.createElement('div');
     
     
     let selectedEmoji, emojiType;
     if (Math.random() < 0.7) {
      selectedEmoji = emojiConfig.falling;
      emojiType = "monthly";
     } else {
      
      selectedEmoji = currentTimePeriod.emojis[Math.floor(Math.random() * currentTimePeriod.emojis.length)];
      emojiType = "time";
     }
     

     element.innerHTML = selectedEmoji;
     
     
     let fontSize, color, textShadow;
     if (emojiType === "time") {
      
      if (currentTimePeriod.period === "morning") {
       
       fontSize = Math.random() * 18 + 16;
       color = '#FFD700';
       textShadow = '0 0 5px rgba(255, 215, 0, 0.7)';
      } else if (currentTimePeriod.period === "noon") {
       
       fontSize = Math.random() * 18 + 16;
       color = '#FF8C00';
       textShadow = '0 0 5px rgba(255, 140, 0, 0.7)';
      } else {
       
       fontSize = Math.random() * 18 + 16;
       color = '#4B0082';
       textShadow = '0 0 5px rgba(75, 0, 130, 0.7)';
      }
     } else {
      
      if (emojiConfig.month >= 11 || emojiConfig.month <= 2) {
       
       fontSize = Math.random() * 20 + 15;
       color = 'white';
       textShadow = '0 0 5px rgba(255, 255, 255, 0.8)';
      } else if (emojiConfig.month >= 3 && emojiConfig.month <= 5) {
       
       fontSize = Math.random() * 18 + 16;
       color = '#FF69B4';
       textShadow = '0 0 5px rgba(255, 105, 180, 0.6)';
      } else if (emojiConfig.month >= 6 && emojiConfig.month <= 8) {
       
       fontSize = Math.random() * 18 + 15;
       color = '#32CD32';
       textShadow = '0 0 5px rgba(50, 205, 50, 0.6)';
      } else {
       
       fontSize = Math.random() * 18 + 15;
       color = '#FF8C00';
       textShadow = '0 0 5px rgba(255, 140, 0, 0.6)';
      }
     }
     
     element.style.cssText = `
       position: absolute;
       font-size: ${fontSize}px;
       color: ${color};
       text-shadow: ${textShadow};
       left: ${Math.random() * window.innerWidth}px;
       top: -50px;
       user-select: none;
       pointer-events: none;
       z-index: 9999;
       transition: all 0.3s ease;
     `;
     
     fallingContainer.appendChild(element);
     activeElements++;
     
     
     const duration = 4000 + Math.random() * 2000;
     const endX = parseFloat(element.style.left) + (Math.random() - 0.5) * 400;
     const endY = window.innerHeight + 50;
     
     element.style.transition = `all ${duration}ms linear`;
     
     setTimeout(() => {
      element.style.left = endX + 'px';
      element.style.top = endY + 'px';
      element.style.opacity = '0';
     }, 50);
     
     
     setTimeout(() => {
      if (element.parentNode) {
       element.parentNode.removeChild(element);
      }
      activeElements--;
      
      
      if (activeElements === 0) {
       if (fallingContainer && fallingContainer.parentNode) {
        fallingContainer.parentNode.removeChild(fallingContainer);
       }
      }
     }, duration);
    }, i * 150);
   }
  }

   
   
   
  function initCodeMoreBox() {
   let codeBlocks = document.querySelectorAll(".highlight");
   if (!codeBlocks) {
    return;
   }
   codeBlocks.forEach(codeBlock => {
    
    if (codeBlock.scrollHeight <= codeBlock.clientHeight) {
     return;
    }
    
    
    let codeMoreBox = document.createElement('div');
    codeMoreBox.classList.add('code-more-box');
    
    let codeMoreBtn = document.createElement('span');
    codeMoreBtn.classList.add('code-more-btn');
    codeMoreBtn.innerText = '显示更多'; 
    let isExpanded = false; 

    codeMoreBtn.addEventListener('click', () => {
     if (!isExpanded) {
      codeBlock.classList.add('code-show'); 
      codeMoreBtn.innerText = '折叠'; 
      isExpanded = true;
     } else {
      codeBlock.classList.remove('code-show'); 
      codeMoreBtn.innerText = '显示更多'; 
      isExpanded = false;
     }
     
     window.dispatchEvent(new Event('resize'));
    });
    
    codeMoreBox.appendChild(codeMoreBtn);
    codeBlock.appendChild(codeMoreBox);
   });
  }


  
   
   
   
  
  

  function captureScrollListeners() {
    
    setTimeout(() => {
      
      overrideScrollspy();
    }, 2000);
  }
  
  

  function overrideScrollspy() {
    
    window.tocScrollspyEnabled = true;
    
    
    setTimeout(() => {
      
      
      
      
      if (!window.originalScrollTo) {
        window.originalScrollTo = HTMLElement.prototype.scrollTo;
        
        HTMLElement.prototype.scrollTo = function(options) {
          
          if (this.id === 'TableOfContents' && window.tocScrollDisabled) {
            return;
          }
          
          
          return window.originalScrollTo.call(this, options);
        };
      }
      
      
      if (!window.originalScrollIntoView) {
        window.originalScrollIntoView = HTMLElement.prototype.scrollIntoView;
        
        HTMLElement.prototype.scrollIntoView = function(options) {
          
          if (this.closest('#TableOfContents') && window.tocScrollDisabled) {
            return;
          }
          
          
          return window.originalScrollIntoView.call(this, options);
        };
      }
    }, 3000); 
  }
  
  function initTocLock() {
    
    
    const articleToc = document.querySelector('#TableOfContents');
    if (!articleToc) {
      
      return;
    }
    
    
    const tocContainer = document.querySelector('.widget.archives');
    if (!tocContainer) {
      return;
    }
    
    
    tocContainer.style.position = 'relative';
    
    
    captureScrollListeners();
    
    
    const lockLabel = document.createElement('div');
    lockLabel.className = 'toc-lock-label';
    lockLabel.textContent = '锁定：';
    
    
    const lockBtn = document.createElement('div');
    lockBtn.className = 'toc-lock-btn';
    lockBtn.innerHTML = `
      <svg class="lock-icon unlocked" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 11H5a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2z"/>
        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
      </svg>
      <svg class="lock-icon locked" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="11" width="18" height="10" rx="2" ry="2"/>
        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
        <path d="M9 12v3a3 3 0 0 0 6 0v-3"/>
      </svg>
    `;
    
    
    lockBtn.addEventListener('click', function() {
      const isLocked = this.classList.contains('locked');
      
      if (isLocked) {
        
        this.classList.remove('locked');
        localStorage.setItem('tocLocked', 'false');
        enableTocScroll();
      } else {
        
        this.classList.add('locked');
        localStorage.setItem('tocLocked', 'true');
        disableTocScroll();
      }
    });
    
    
    tocContainer.appendChild(lockLabel);
    tocContainer.appendChild(lockBtn);
    
    
    
    lockBtn.classList.remove('locked');
    localStorage.setItem('tocLocked', 'false');
    
    
    const observer = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
          const isLocked = lockBtn.classList.contains('locked');
          if (isLocked) {
            disableTocScroll();
          } else {
            enableTocScroll();
          }
        }
      });
    });
    
    observer.observe(lockBtn, { attributes: true });
  }

  

  function disableTocScroll() {
    
    window.tocScrollDisabled = true;
    
    
    const tocContainer = document.querySelector('#TableOfContents');
    if (tocContainer) {
      
      window.savedTocScrollTop = tocContainer.scrollTop;
      
      
      const currentActive = tocContainer.querySelector('.active-class');
      if (currentActive) {
        window.savedActiveElement = currentActive;
      }
    }
    
    
    if (tocContainer) {
      tocContainer.setAttribute('data-scrollspy-disabled', 'true');
      tocContainer.title = '目录已锁定，不会自动跟随滚动';
    }
    
    
    const archivesContainer = document.querySelector('.widget.archives');
    if (archivesContainer) {
      archivesContainer.style.opacity = '0.8';
      archivesContainer.title = '目录已锁定，不会自动跟随滚动';
    }
  }

  

  function enableTocScroll() {
    
    window.tocScrollDisabled = false;
    
    
    const tocContainer = document.querySelector('#TableOfContents');
    if (tocContainer) {
      
      tocContainer.removeAttribute('data-scrollspy-disabled');
      tocContainer.title = '';
    }
    
    
    const archivesContainer = document.querySelector('.widget.archives');
    if (archivesContainer) {
      archivesContainer.style.opacity = '1';
      archivesContainer.title = '';
    }
  }

  
  
  
  document.addEventListener('DOMContentLoaded', function() {
  

    
    initCodeMoreBox();
    initRope();

    
    setTimeout(initTocLock, 1000);
  });

</script>


<div id="rope-container"></div>


<div id="particles-js"></div>

<script>

particlesJS('particles-js', {
  "particles": {
    "number": {
      "value": 80,
      "density": {
        "enable": true,
        "value_area": 800
      }
    },
    "color": {
      "value": ["#888888", "#aaaaaa", "#cccccc", "#eeeeee"]
    },
    "shape": {
      "type": "circle",
      "stroke": {
        "width": 0,
        "color": "#000000"
      },
      "polygon": {
        "nb_sides": 5
      }
    },
    "opacity": {
      "value": 0.5,
      "random": false,
      "anim": {
        "enable": false,
        "speed": 1,
        "opacity_min": 0.1,
        "sync": false
      }
    },
    "size": {
      "value": 2,
      "random": true,
      "anim": {
        "enable": false,
        "speed": 40,
        "size_min": 0.1,
        "sync": false
      }
    },
    "line_linked": {
      "enable": true,
      "distance": 150,
      "color": "#888888",
      "opacity": 0.4,
      "width": 1
    },
    "move": {
      "enable": true,
      "speed": 2,
      "direction": "none",
      "random": false,
      "straight": false,
      "out_mode": "out",
      "bounce": false,
      "attract": {
        "enable": false,
        "rotateX": 600,
        "rotateY": 1200
      }
    }
  },
  "interactivity": {
    "detect_on": "canvas",
    "events": {
      "onhover": {
        "enable": true,
        "mode": "grab"
      },
      "onclick": {
        "enable": true,
        "mode": "push"
      },
      "resize": true
    },
    "modes": {
      "grab": {
        "distance": 140,
        "line_linked": {
          "opacity": 1
        }
      },
      "bubble": {
        "distance": 400,
        "size": 40,
        "duration": 2,
        "opacity": 8,
        "speed": 3
      },
      "repulse": {
        "distance": 200,
        "duration": 0.4
      },
      "push": {
        "particles_nb": 4
      },
      "remove": {
        "particles_nb": 2
      }
    }
  },
  "retina_detect": true
});
</script>


<script>
(function() {
  'use strict';
  
  
  const categoryColors = [
    '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57',
    '#ff9ff3', '#54a0ff', '#5f27cd', '#00d2d3', '#ff9f43',
    '#10ac84', '#ff6348', '#a55eea', '#e17055', '#d63031',
    '#00b894', '#fdcb6e', '#6c5ce7', '#fd79a8', '#f39c12',
    '#e67e22', '#e74c3c', '#9b59b6', '#3498db', '#1abc9c',
    '#16a085', '#27ae60', '#2ecc71', '#f1c40f', '#e67e22'
  ];
  
  
  function hashString(str) {
    let hash = 0;
    if (str.length === 0) return hash;
    
    for (let i = 0; i < str.length; i++) {
      const char = str.charCodeAt(i);
      hash = ((hash << 5) - hash) + char;
      hash = hash & hash; 
    }
    
    return Math.abs(hash);
  }
  
  
  function assignCategoryColors() {

    
    
    const isArchivesPage = document.body.classList.contains('template-archives') ||
                          window.location.pathname.includes('/archives/');
    const isArticlePage = document.querySelector('#TableOfContents') || 
                         document.querySelector('.article-category');
    
    
    
    
    if (isArticlePage && !isArchivesPage) {
      const categoryLinks = document.querySelectorAll('.article-category a');

      
      categoryLinks.forEach((link, index) => {
        
        const href = link.getAttribute('href');
        const categoryName = href.split('/').pop() || href.split('/').slice(-2, -1)[0] || 'default';
        
        
        const hash = hashString(categoryName);
        const colorIndex = hash % categoryColors.length;
        const backgroundColor = categoryColors[colorIndex];
        
        
        
        
        link.style.setProperty('background-color', backgroundColor, 'important');
        link.style.setProperty('color', '#fff', 'important');
        
        
        link.addEventListener('mouseenter', function() {
          this.style.opacity = '0.8';
          this.style.transform = 'scale(1.05)';
        });
        
        link.addEventListener('mouseleave', function() {
          this.style.opacity = '1';
          this.style.transform = 'scale(1)';
        });
      });
    }
    
    
    if (!isArchivesPage) {
      
      const sidebarCategories = document.querySelectorAll('.widget.categories a, .widget.tagCloud a');

      
      sidebarCategories.forEach((link, index) => {
        
        const href = link.getAttribute('href');
        const categoryName = href.split('/').pop() || href.split('/').slice(-2, -1)[0] || 'default';
        
        
        const hash = hashString(categoryName);
        const colorIndex = hash % categoryColors.length;
        const backgroundColor = categoryColors[colorIndex];
        
        
        
        
        link.style.setProperty('background-color', backgroundColor, 'important');
        link.style.setProperty('color', '#fff', 'important');
        link.style.setProperty('border-radius', '6px', 'important');
        link.style.setProperty('padding', '8px 12px', 'important');
        link.style.setProperty('margin', '4px 0', 'important');
        link.style.setProperty('display', 'inline-block', 'important');
        link.style.setProperty('text-decoration', 'none', 'important');
        link.style.setProperty('transition', 'all 0.3s ease', 'important');
        
        
        link.addEventListener('mouseenter', function() {
          this.style.opacity = '0.8';
          this.style.transform = 'scale(1.05)';
          this.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.2)';
        });
        
        link.addEventListener('mouseleave', function() {
          this.style.opacity = '1';
          this.style.transform = 'scale(1)';
          this.style.boxShadow = 'none';
        });
      });
    } else {
      

    }
    

  }
  
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', assignCategoryColors);
  } else {
    assignCategoryColors();
  }
  
  
  setTimeout(assignCategoryColors, 500);
  setTimeout(assignCategoryColors, 1000);
  setTimeout(assignCategoryColors, 2000);
  
  
  const observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
        
        const hasNewCategories = Array.from(mutation.addedNodes).some(node => {
          return node.nodeType === 1 && (
            node.classList.contains('article-category') ||
            node.querySelector('.article-category') ||
            node.classList.contains('widget') ||
            node.querySelector('.widget')
          );
        });
        
        if (hasNewCategories) {
          
          setTimeout(assignCategoryColors, 100);
          setTimeout(assignCategoryColors, 500);
        }
      }
    });
  });
  
  
  observer.observe(document.body, {
    childList: true,
    subtree: true
  });
})();
</script>


<script>
(function() {
  'use strict';
  
  
  function fixDarkModeToggleText() {
    const toggleBtn = document.getElementById('dark-mode-toggle');
    if (!toggleBtn) {
      return;
    }
    
    
    toggleBtn.classList.add('dark-mode-toggle-fix');
    
    
    const span = toggleBtn.querySelector('span');
    if (!span) {
      return;
    }
    
    
    function updateText() {
      const isDark = document.documentElement.dataset.scheme === 'dark';
      span.textContent = isDark ? '亮色模式' : '暗色模式';

    }
    
    
    updateText();
    
    
    function handleThemeChange() {
      setTimeout(updateText, 100); 
    }
    
    
    window.addEventListener('onColorSchemeChange', handleThemeChange);
    
    
    const observer = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'data-scheme') {
          handleThemeChange();
        }
      });
    });
    
    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['data-scheme']
    });
    
    
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', handleThemeChange);
    
    
    toggleBtn.addEventListener('click', function() {
      
      setTimeout(updateText, 200);
    });
    

  }
  
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', fixDarkModeToggleText);
  } else {
    fixDarkModeToggleText();
  }
  
  
  setTimeout(fixDarkModeToggleText, 1000);
  setTimeout(fixDarkModeToggleText, 2000);
})();
</script>

  
  <script>
  
  if (!document.getElementById('new-theme-switch')) {
    document.write(`
      <div id="new-theme-switch" style="position: fixed; bottom: 50px; left: 50px; z-index: 1000; text-align: center;">
        <label class="theme-switch">
          <input type="checkbox" class="theme-switch__checkbox" id="theme-switch-checkbox">
          <div class="theme-switch__container">
            <div class="theme-switch__clouds"></div>
            <div class="theme-switch__stars-container">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 144 55" fill="none">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M135.831 3.00688C135.055 3.85027 134.111 4.29946 133 4.35447C134.111 4.40947 135.055 4.85867 135.831 5.71123C136.607 6.55462 136.996 7.56303 136.996 8.72727C136.996 7.95722 137.172 7.25134 137.525 6.59129C137.886 5.93124 138.372 5.39954 138.98 5.00535C139.598 4.60199 140.268 4.39114 141 4.35447C139.88 4.2903 138.936 3.85027 138.16 3.00688C137.384 2.16348 136.996 1.16425 136.996 0C136.996 1.16425 136.607 2.16348 135.831 3.00688ZM31 23.3545C32.1114 23.2995 33.0551 22.8503 33.8313 22.0069C34.6075 21.1635 34.9956 20.1642 34.9956 19C34.9956 20.1642 35.3837 21.1635 36.1599 22.0069C36.9361 22.8503 37.8798 23.2903 39 23.3545C38.2679 23.3911 37.5976 23.602 36.9802 24.0053C36.3716 24.3995 35.8864 24.9312 35.5248 25.5913C35.172 26.2513 34.9956 26.9572 34.9956 27.7273C34.9956 26.563 34.6075 25.5546 33.8313 24.7112C33.0551 23.8587 32.1114 23.4095 31 23.3545ZM0 36.3545C1.11136 36.2995 2.05513 35.8503 2.83131 35.0069C3.6075 34.1635 3.99559 33.1642 3.99559 32C3.99559 33.1642 4.38368 34.1635 5.15987 35.0069C5.93605 35.8503 6.87982 36.2903 8 36.3545C7.26792 36.3911 6.59757 36.602 5.98015 37.0053C5.37155 37.3995 4.88644 37.9312 4.52481 38.5913C4.172 39.2513 3.99559 39.9572 3.99559 40.7273C3.99559 39.563 4.38368 38.5546 2.83131 37.7112C2.05513 36.8587 1.11136 36.4095 0 36.3545ZM56.8313 24.0069C56.0551 24.8503 55.1114 25.2995 54 25.3545C55.1114 25.4095 56.0551 25.8587 56.8313 26.7112C57.6075 27.5546 57.9956 28.563 57.9956 29.7273C57.9956 28.9572 58.172 28.2513 58.5248 27.5913C58.8864 26.9312 59.3716 26.3995 59.9802 26.0053C60.5976 25.602 61.2679 25.3911 62 25.3545C60.8798 25.2903 59.9361 24.8503 59.1599 24.0069C58.3837 23.1635 57.9956 22.1642 57.9956 21C57.9956 22.1642 57.6075 23.1635 56.8313 24.0069ZM81 25.3545C82.1114 25.2995 83.0551 24.8503 83.8313 24.0069C84.6075 23.1635 84.9956 22.1642 84.9956 21C84.9956 22.1642 85.3837 23.1635 86.1599 24.0069C86.9361 24.8503 87.8798 25.2903 89 25.3545C88.2679 25.3911 87.5976 25.602 86.9802 26.0053C86.3716 26.3995 85.8864 26.9312 85.5248 27.5913C85.172 28.2513 84.9956 28.9572 84.9956 29.7273C84.9956 28.563 84.6075 27.5546 83.8313 26.7112C83.0551 25.8587 82.1114 25.4095 81 25.3545ZM136 36.3545C137.111 36.2995 138.055 35.8503 138.831 35.0069C139.607 34.1635 139.996 33.1642 139.996 32C139.996 33.1642 140.384 34.1635 141.16 35.0069C141.936 35.8503 142.88 36.2903 144 36.3545C143.268 36.3911 142.598 36.602 141.98 37.0053C141.372 37.3995 140.886 37.9312 140.525 38.5913C140.172 39.2513 139.996 39.9572 139.996 40.7273C139.996 39.563 139.607 38.5546 138.831 37.7112C138.055 36.8587 137.111 36.4095 136 36.3545ZM101.831 49.0069C101.055 49.8503 100.111 50.2995 99 50.3545C100.111 50.4095 101.055 50.8587 101.831 51.7112C102.607 52.5546 102.996 53.563 102.996 54.7273C102.996 53.9572 103.172 53.2513 103.525 52.5913C103.886 51.9312 104.372 51.3995 104.98 51.0053C105.598 50.602 106.268 50.3911 107 50.3545C105.88 50.2903 104.936 49.8503 104.16 49.0069C103.384 48.1635 102.996 47.1642 102.996 46C102.996 47.1642 102.607 48.1635 101.831 49.0069Z" fill="currentColor"></path>
              </svg>
            </div>
            <div class="theme-switch__circle-container">
              <div class="theme-switch__sun-moon-container">
                <div class="theme-switch__moon">
                  <div class="theme-switch__spot"></div>
                  <div class="theme-switch__spot"></div>
                  <div class="theme-switch__spot"></div>
                </div>
              </div>
            </div>
          </div>
        </label>
        <div id="theme-switch-text" style="color: #fff; font-size: 14px; font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,0.5); margin-top: 8px; text-align: center;">亮色模式</div>
      </div>
    `);
  }
  </script>


<style>
   
  .theme-switch {
    --toggle-size: 20px;  
    --container-width: 3.75em;
    --container-height: 1.7em;
    --container-radius: 4.2em;
    --container-light-bg: #3D7EAE;
    --container-night-bg: #1D1F2C;
    --circle-container-diameter: 2.25em;
    --sun-moon-diameter: 1.4em;
    --sun-bg: #ECCA2F;
    --moon-bg: #C4C9D1;
    --spot-color: #959DB1;
    --circle-container-offset: calc((var(--circle-container-diameter) - var(--container-height)) / 2 * -1);
    --stars-color: #fff;
    --clouds-color: #F3FDFF;
    --back-clouds-color: #AACADF;
    --transition: .5s cubic-bezier(0, -0.02, 0.4, 1.25);
    --circle-transition: .3s cubic-bezier(0, -0.02, 0.35, 1.17);
  }

  .theme-switch, .theme-switch *, .theme-switch *::before, .theme-switch *::after {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-size: var(--toggle-size);
  }

  .theme-switch__container {
    width: var(--container-width);
    height: var(--container-height);
    background-color: var(--container-light-bg);
    border-radius: var(--container-radius);
    overflow: hidden;
    cursor: pointer;
    -webkit-box-shadow: 0em -0.062em 0.062em rgba(0, 0, 0, 0.25), 0em 0.062em 0.125em rgba(255, 255, 255, 0.94);
    box-shadow: 0em -0.062em 0.062em rgba(0, 0, 0, 0.25), 0em 0.062em 0.125em rgba(255, 255, 255, 0.94);
    -webkit-transition: var(--transition);
    -o-transition: var(--transition);
    transition: var(--transition);
    position: relative;
  }

  .theme-switch__container::before {
    content: "";
    position: absolute;
    z-index: 1;
    inset: 0;
    -webkit-box-shadow: 0em 0.05em 0.187em rgba(0, 0, 0, 0.25) inset, 0em 0.05em 0.187em rgba(0, 0, 0, 0.25) inset;
    box-shadow: 0em 0.05em 0.187em rgba(0, 0, 0, 0.25) inset, 0em 0.05em 0.187em rgba(0, 0, 0, 0.25) inset;
    border-radius: var(--container-radius)
  }

  .theme-switch__checkbox {
    display: none;
  }

  .theme-switch__circle-container {
    width: var(--circle-container-diameter);
    height: var(--circle-container-diameter);
    background-color: rgba(255, 255, 255, 0.1);
    position: absolute;
    left: var(--circle-container-offset);
    top: var(--circle-container-offset);
    border-radius: var(--container-radius);
    -webkit-box-shadow: inset 0 0 0 3.375em rgba(255, 255, 255, 0.1), inset 0 0 0 3.375em rgba(255, 255, 255, 0.1), 0 0 0 0.625em rgba(255, 255, 255, 0.1), 0 0 0 1.25em rgba(255, 255, 255, 0.1);
    box-shadow: inset 0 0 0 3.375em rgba(255, 255, 255, 0.1), inset 0 0 0 3.375em rgba(255, 255, 255, 0.1), 0 0 0 0.625em rgba(255, 255, 255, 0.1), 0 0 0 1.25em rgba(255, 255, 255, 0.1);
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-transition: var(--circle-transition);
    -o-transition: var(--circle-transition);
    transition: var(--circle-transition);
    pointer-events: none;
  }

  .theme-switch__sun-moon-container {
    pointer-events: auto;
    position: relative;
    z-index: 2;
    width: var(--sun-moon-diameter);
    height: var(--sun-moon-diameter);
    margin: auto;
    border-radius: var(--container-radius);
    background-color: var(--sun-bg);
    -webkit-box-shadow: 0.062em 0.062em 0.062em 0em rgba(254, 255, 239, 0.61) inset, 0em -0.062em 0.062em 0em #a1872a inset;
    box-shadow: 0.062em 0.062em 0.062em 0em rgba(254, 255, 239, 0.61) inset, 0em -0.062em 0.062em 0em #a1872a inset;
    -webkit-filter: drop-shadow(0.062em 0.125em 0.125em rgba(0, 0, 0, 0.25)) drop-shadow(0em 0.062em 0.125em rgba(0, 0, 0, 0.25));
    filter: drop-shadow(0.062em 0.125em 0.125em rgba(0, 0, 0, 0.25)) drop-shadow(0em 0.062em 0.125em rgba(0, 0, 0, 0.25));
    overflow: hidden;
    -webkit-transition: var(--transition);
    -o-transition: var(--transition);
    transition: var(--transition);
  }

  .theme-switch__moon {
    -webkit-transform: translateX(100%);
    -ms-transform: translateX(100%);
    transform: translateX(100%);
    width: 100%;
    height: 100%;
    background-color: var(--moon-bg);
    border-radius: inherit;
    -webkit-box-shadow: 0.062em 0.062em 0.062em 0em rgba(254, 255, 239, 0.61) inset, 0em -0.062em 0.062em 0em #969696 inset;
    box-shadow: 0.062em 0.062em 0.062em 0em rgba(254, 255, 239, 0.61) inset, 0em -0.062em 0.062em 0em #969696 inset;
    -webkit-transition: var(--transition);
    -o-transition: var(--transition);
    transition: var(--transition);
    position: relative;
  }

  .theme-switch__spot {
    position: absolute;
    top: 0.75em;
    left: 0.312em;
    width: 0.75em;
    height: 0.75em;
    border-radius: var(--container-radius);
    background-color: var(--spot-color);
    -webkit-box-shadow: 0em 0.0312em 0.062em rgba(0, 0, 0, 0.25) inset;
    box-shadow: 0em 0.0312em 0.062em rgba(0, 0, 0, 0.25) inset;
  }

  .theme-switch__spot:nth-of-type(2) {
    width: 0.375em;
    height: 0.375em;
    top: 0.937em;
    left: 1.375em;
  }

  .theme-switch__spot:nth-last-of-type(3) {
    width: 0.25em;
    height: 0.25em;
    top: 0.312em;
    left: 0.812em;
  }

  .theme-switch__clouds {
    width: 1.25em;
    height: 1.25em;
    background-color: var(--clouds-color);
    border-radius: var(--container-radius);
    position: absolute;
    bottom: -0.625em;
    left: 0.312em;
    -webkit-box-shadow: 0.937em 0.312em var(--clouds-color), -0.312em -0.312em var(--back-clouds-color), 1.437em 0.375em var(--clouds-color), 0.5em -0.125em var(--back-clouds-color), 2.187em 0 var(--clouds-color), 1.25em -0.062em var(--back-clouds-color), 2.937em 0.312em var(--clouds-color), 2em -0.312em var(--back-clouds-color), 3.625em -0.062em var(--clouds-color), 2.625em 0em var(--back-clouds-color), 4.5em -0.312em var(--clouds-color), 3.375em -0.437em var(--back-clouds-color), 4.625em -1.75em 0 0.437em var(--clouds-color), 4em -0.625em var(--back-clouds-color), 4.125em -2.125em 0 0.437em var(--back-clouds-color);
    box-shadow: 0.937em 0.312em var(--clouds-color), -0.312em -0.312em var(--back-clouds-color), 1.437em 0.375em var(--clouds-color), 0.5em -0.125em var(--back-clouds-color), 2.187em 0 var(--clouds-color), 1.25em -0.062em var(--back-clouds-color), 2.937em 0.312em var(--clouds-color), 2em -0.312em var(--back-clouds-color), 3.625em -0.062em var(--clouds-color), 2.625em 0em var(--back-clouds-color), 4.5em -0.312em var(--clouds-color), 3.375em -0.437em var(--back-clouds-color), 4.625em -1.75em 0 0.437em var(--clouds-color), 4em -0.625em var(--back-clouds-color), 4.125em -2.125em 0 0.437em var(--back-clouds-color);
    -webkit-transition: 0.5s cubic-bezier(0, -0.02, 0.4, 1.25);
    -o-transition: 0.5s cubic-bezier(0, -0.02, 0.4, 1.25);
    transition: 0.5s cubic-bezier(0, -0.02, 0.4, 1.25);
  }

  .theme-switch__stars-container {
    position: absolute;
    color: var(--stars-color);
    top: -100%;
    left: 0.312em;
    width: 2.75em;
    height: auto;
    -webkit-transition: var(--transition);
    -o-transition: var(--transition);
    transition: var(--transition);
  }

   
  .theme-switch__checkbox:checked + .theme-switch__container {
    background-color: var(--container-night-bg);
  }

  .theme-switch__checkbox:checked + .theme-switch__container .theme-switch__circle-container {
    left: calc(100% - var(--circle-container-offset) - var(--circle-container-diameter));
  }

  .theme-switch__checkbox:checked + .theme-switch__container .theme-switch__circle-container:hover {
    left: calc(100% - var(--circle-container-offset) - var(--circle-container-diameter) - 0.187em)
  }

  .theme-switch__circle-container:hover {
    left: calc(var(--circle-container-offset) + 0.187em);
  }

  .theme-switch__checkbox:checked + .theme-switch__container .theme-switch__moon {
    -webkit-transform: translate(0);
    -ms-transform: translate(0);
    transform: translate(0);
    transform: translate(0);
  }

  .theme-switch__checkbox:checked + .theme-switch__container .theme-switch__clouds {
    bottom: -4.062em;
  }

  .theme-switch__checkbox:checked + .theme-switch__container .theme-switch__stars-container {
    top: 50%;
    -webkit-transform: translateY(-50%);
    -ms-transform: translateY(-50%);
    transform: translateY(-50%);
  }

   
  #dark-mode-toggle {
    display: none !important;
  }

   
  .dark-mode-toggle-fix span {
    font-size: 18px !important;
    font-weight: 600 !important;
  }
</style>


<script>
(function() {
  'use strict';
  
  
  if (window.themeSwitchInitialized) {
    console.log('主题切换开关已经初始化，跳过重复执行');
    return;
  }
  
  let isInitialized = false;
  let observer = null;
  
  function initNewThemeSwitch() {
    
    if (isInitialized) {
      return;
    }
    
    const checkbox = document.getElementById('theme-switch-checkbox');
    if (!checkbox) {
      return;
    }
    
    
    function updateCheckboxState() {
      const isDark = document.documentElement.dataset.scheme === 'dark';
      checkbox.checked = isDark;
      
      
      const textElement = document.getElementById('theme-switch-text');
      if (textElement) {
        textElement.textContent = isDark ? '暗色模式' : '亮色模式';
        console.log('更新主题切换文字:', isDark ? '暗色模式' : '亮色模式');
      }
      
      console.log('当前主题状态:', isDark ? 'dark' : 'light', 'checkbox状态:', checkbox.checked);
    }
    
    
    function waitForThemeSystem() {
      
      const schemeFromData = document.documentElement.dataset.scheme;
      const schemeFromClass = document.documentElement.className.includes('dark') ? 'dark' : 
                             document.documentElement.className.includes('light') ? 'light' : null;
      const schemeFromLocalStorage = localStorage.getItem('StackColorScheme');
      
      if (schemeFromData || schemeFromClass || schemeFromLocalStorage) {
        
        let finalScheme = schemeFromData || schemeFromClass || schemeFromLocalStorage;
        
        
        if (schemeFromData) {
          finalScheme = schemeFromData;
        }
        
        
        document.documentElement.dataset.scheme = finalScheme;
        
        
        updateCheckboxState();
        isInitialized = true;
        window.themeSwitchInitialized = true;
        
        console.log('主题系统已初始化，当前主题:', finalScheme);
      } else {
        
        setTimeout(waitForThemeSystem, 100);
      }
    }
    
    
    waitForThemeSystem();
    
    
    checkbox.addEventListener('change', function() {
      const scheme = this.checked ? 'dark' : 'light';
      document.documentElement.dataset.scheme = scheme;
      
      
      localStorage.setItem('StackColorScheme', scheme);
      
      
      document.dispatchEvent(new CustomEvent('onColorSchemeChange'));
    });
    
    
    window.addEventListener('onColorSchemeChange', updateCheckboxState);
    
    
    observer = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'data-scheme') {
          updateCheckboxState();
        }
      });
    });
    
    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['data-scheme']
    });
  }
  
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initNewThemeSwitch);
  } else {
    initNewThemeSwitch();
  }
  
  
  setTimeout(initNewThemeSwitch, 1500);
})();
</script>


<script>
(function() {
  'use strict';
  
  
  if (window.hoverEffectsInitialized) {
    console.log('悬浮效果已经初始化，跳过重复执行');
    return;
  }
  
  let isHoverEffectsInitialized = false;
  let hoverObserver = null;
  
  
  function forceCategoryHoverEffects() {
    
    if (isHoverEffectsInitialized) {
      return;
    }
    
    const articles = document.querySelectorAll('.article-list--compact article');
    if (articles.length > 0) {
      articles.forEach(article => {
        
        if (article.hasAttribute('data-hover-initialized')) {
          return;
        }
        
        
        article.style.setProperty('transition', 'all 0.3s ease', 'important');
        article.style.setProperty('will-change', 'transform, box-shadow', 'important');
        
        
        article.addEventListener('mouseenter', function() {
          this.style.setProperty('transform', 'translateY(-5px)', 'important');
          this.style.setProperty('box-shadow', '0 10px 30px rgba(0, 0, 0, 0.12)', 'important');
        });
        
        article.addEventListener('mouseleave', function() {
          this.style.setProperty('transform', 'translateY(0)', 'important');
          this.style.setProperty('box-shadow', 'none', 'important');
        });
        
        
        article.setAttribute('data-hover-initialized', 'true');
      });
      
      isHoverEffectsInitialized = true;
      window.hoverEffectsInitialized = true;
    }
  }
  
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', forceCategoryHoverEffects);
  } else {
    forceCategoryHoverEffects();
  }
  
  
  setTimeout(forceCategoryHoverEffects, 1000);
  
  
  hoverObserver = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
        
        setTimeout(forceCategoryHoverEffects, 100);
      }
    });
  });
  
  
  hoverObserver.observe(document.body, {
    childList: true,
    subtree: true
  });
})();
</script>

    </body>
</html>
